<!DOCTYPE html>
<html>
<head>
    <title>JSPlots.jl</title>
    <meta charset="UTF-8">
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apache-arrow@14.0.1/Arrow.es2015.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #controls {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        #$div_id {
            width: 100%;
            height: 600px;
        }
    </style>
        <style>
        .textblock-content {
            padding: 20px;
            margin: 10px 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
        }

        .textblock-content h1 {
            font-size: 2em;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }

        .textblock-content h2 {
            font-size: 1.5em;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }

        .textblock-content h3 {
            font-size: 1.25em;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }

        .textblock-content p {
            margin: 0.5em 0;
        }

        .textblock-content ul, .textblock-content ol {
            margin: 0.5em 0;
            padding-left: 2em;
        }

        .textblock-content code {
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .textblock-content pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }

        .textblock-content pre code {
            background-color: transparent;
            padding: 0;
        }

        .textblock-content blockquote {
            border-left: 4px solid #ddd;
            padding-left: 1em;
            margin-left: 0;
            color: #666;
        }

        .textblock-content a {
            color: #0066cc;
            text-decoration: none;
        }

        .textblock-content a:hover {
            text-decoration: underline;
        }

        .textblock-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }

        .textblock-content th, .textblock-content td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .textblock-content th {
            background-color: #f5f5f5;
            font-weight: 600;
        }
    </style>


    <!-- external libs -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/pivot.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/pivot.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/d3_renderers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/c3_renderers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/export_renderers.min.js"></script>

    <!-- Prism.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    

</head>

<body>

<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

<script type="module">
// Import parquet-wasm for Parquet file support
import * as parquet from 'https://unpkg.com/parquet-wasm@0.6.1/esm/parquet_wasm.js';

// Initialize parquet-wasm
await parquet.default();

// Make parquet available globally for loadDataset
window.parquetWasm = parquet;
window.parquetReady = true;
console.log('Parquet-wasm library loaded successfully');
</script>

<script>
// Helper function to wait for parquet-wasm to be loaded
function waitForParquet() {
    return new Promise(function(resolve) {
        if (window.parquetReady) {
            resolve();
            return;
        }
        var checkInterval = setInterval(function() {
            if (window.parquetReady) {
                clearInterval(checkInterval);
                resolve();
            }
        }, 50);
    });
}

// Centralized data loading function
// Centralized date parsing function
// Converts ISO date strings to JavaScript Date objects
// This is the ONLY place in the package where date parsing happens
function parseDatesInData(data) {
    if (!data || data.length === 0) return data;

    // Regex patterns for ISO date formats
    var datePattern = /^\d{4}-\d{2}-\d{2}$/;  // YYYY-MM-DD
    var datetimePattern = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/;  // YYYY-MM-DDTHH:MM:SS
    var timePattern = /^\d{2}:\d{2}:\d{2}(\.\d+)?$/;  // HH:MM:SS or HH:MM:SS.sss

    // Check first row to identify date and time columns
    var firstRow = data[0];
    var dateColumns = [];
    var timeColumns = [];

    for (var key in firstRow) {
        if (firstRow.hasOwnProperty(key)) {
            var value = firstRow[key];
            if (typeof value === 'string') {
                if (datetimePattern.test(value) || datePattern.test(value)) {
                    dateColumns.push(key);
                } else if (timePattern.test(value)) {
                    timeColumns.push(key);
                }
            }
        }
    }

    // If no date or time columns found, return data unchanged
    if (dateColumns.length === 0 && timeColumns.length === 0) return data;

    // Convert date strings to Date objects and time strings to milliseconds in all rows
    return data.map(function(row) {
        var newRow = {};
        for (var key in row) {
            if (row.hasOwnProperty(key)) {
                if (dateColumns.indexOf(key) !== -1 && typeof row[key] === 'string') {
                    newRow[key] = new Date(row[key]);
                } else if (timeColumns.indexOf(key) !== -1 && typeof row[key] === 'string') {
                    // Convert HH:MM:SS or HH:MM:SS.sss to milliseconds since midnight
                    var parts = row[key].split(':');
                    var hours = parseInt(parts[0], 10);
                    var minutes = parseInt(parts[1], 10);
                    var seconds = parseFloat(parts[2]);  // Use parseFloat to handle decimal seconds
                    newRow[key] = (hours * 3600 + minutes * 60 + seconds) * 1000;
                } else {
                    newRow[key] = row[key];
                }
            }
        }
        return newRow;
    });
}

// Helper function to convert temporal values back to string format for categorical filtering
// Takes a value and returns the appropriate string representation
function temporalValueToString(value) {
    if (value instanceof Date) {
        // Convert Date to ISO string
        var year = value.getFullYear();
        var month = String(value.getMonth() + 1).padStart(2, '0');
        var day = String(value.getDate()).padStart(2, '0');
        var hours = String(value.getHours()).padStart(2, '0');
        var minutes = String(value.getMinutes()).padStart(2, '0');
        var seconds = String(value.getSeconds()).padStart(2, '0');

        // Check if this is a date-only value (time is midnight UTC)
        if (hours === '00' && minutes === '00' && seconds === '00') {
            return year + '-' + month + '-' + day;
        } else {
            return year + '-' + month + '-' + day + 'T' + hours + ':' + minutes + ':' + seconds;
        }
    } else if (typeof value === 'number' && value >= 0 && value < 86400000) {
        // Likely a Time value (milliseconds since midnight, less than 24 hours)
        var totalSeconds = Math.floor(value / 1000);
        var hours = Math.floor(totalSeconds / 3600);
        var minutes = Math.floor((totalSeconds % 3600) / 60);
        var seconds = totalSeconds % 60;
        var milliseconds = value % 1000;

        var timeStr = String(hours).padStart(2, '0') + ':' +
                      String(minutes).padStart(2, '0') + ':' +
                      String(seconds).padStart(2, '0');

        // Add decimal part if there are milliseconds
        if (milliseconds > 0) {
            timeStr += '.' + String(milliseconds);
        }

        return timeStr;
    } else {
        // Return as-is for other types
        return String(value);
    }
}

// Centralized observation counting and filtering function
// Applies filters incrementally while updating observation count displays
// Returns filtered data
function applyFiltersWithCounting(allData, chartTitle, categoricalFilters, continuousFilters, filters, rangeFilters) {
    var totalObs = allData.length;

    // Update total observation count
    var totalObsElement = document.getElementById(chartTitle + '_total_obs');
    if (totalObsElement) {
        totalObsElement.textContent = totalObs + ' observations';
    }

    // Apply filters incrementally to track observation counts
    var currentData = allData;

    // Apply categorical filters and update counts
    categoricalFilters.forEach(function(col) {
        if (filters[col] && filters[col].length > 0) {
            currentData = currentData.filter(function(row) {
                var rowValueStr = temporalValueToString(row[col]);
                return filters[col].includes(rowValueStr);
            });
        }

        var countElement = document.getElementById(col + '_select_' + chartTitle + '_obs_count');
        if (countElement) {
            var pct = totalObs > 0 ? Math.round((currentData.length / totalObs) * 100) : 100;
            countElement.textContent = pct + '% (' + currentData.length + ') remaining';
        }
    });

    // Apply continuous filters and update counts
    continuousFilters.forEach(function(col) {
        if (rangeFilters[col]) {
            var range = rangeFilters[col];
            currentData = currentData.filter(function(row) {
                var rawValue = row[col];
                var value;
                if (rawValue instanceof Date) {
                    value = rawValue.getTime();
                } else {
                    value = parseFloat(rawValue);
                }
                return value >= range.min && value <= range.max;
            });
        }

        var countElement = document.getElementById(col + '_range_' + chartTitle + '_obs_count');
        if (countElement) {
            var pct = totalObs > 0 ? Math.round((currentData.length / totalObs) * 100) : 100;
            countElement.textContent = pct + '% (' + currentData.length + ') remaining';
        }
    });

    return currentData;
}

// Axis transformation functions
// These transform data values according to selected transformation type
function applyAxisTransform(values, transformType) {
    if (!values || values.length === 0) return [];

    switch(transformType) {
        case 'identity':
            return values;

        case 'log':
            return values.map(function(v) {
                return v > 0 ? Math.log(v) : NaN;
            });

        case 'z_score':
            // Z-score standardization: (x - mean) / std
            var numericVals = values.filter(function(v) { return !isNaN(v) && isFinite(v); });
            if (numericVals.length === 0) return values;

            var mean = numericVals.reduce(function(a, b) { return a + b; }, 0) / numericVals.length;
            var variance = numericVals.reduce(function(sum, v) {
                return sum + Math.pow(v - mean, 2);
            }, 0) / numericVals.length;
            var std = Math.sqrt(variance);

            if (std === 0) return values;

            return values.map(function(v) {
                if (isNaN(v) || !isFinite(v)) return NaN;
                return (v - mean) / std;
            });

        case 'quantile':
            // Rank-based transformation to [0, 1]
            // Create array of {value, originalIndex} pairs
            var indexedValues = values.map(function(v, i) {
                return { value: v, index: i };
            });

            // Filter out invalid values and sort
            var validValues = indexedValues.filter(function(item) {
                return !isNaN(item.value) && isFinite(item.value);
            }).sort(function(a, b) {
                return a.value - b.value;
            });

            if (validValues.length === 0) return values;

            // Assign ranks (0 to 1)
            var ranks = new Array(values.length).fill(NaN);
            validValues.forEach(function(item, rank) {
                // Map rank to [0, 1] where lowest = 0, highest = 1
                ranks[item.index] = validValues.length === 1 ? 0.5 : rank / (validValues.length - 1);
            });

            return ranks;

        case 'inverse_cdf':
            // Z-score followed by normal CDF transformation to [0, 1]
            var numericVals2 = values.filter(function(v) { return !isNaN(v) && isFinite(v); });
            if (numericVals2.length === 0) return values;

            var mean2 = numericVals2.reduce(function(a, b) { return a + b; }, 0) / numericVals2.length;
            var variance2 = numericVals2.reduce(function(sum, v) {
                return sum + Math.pow(v - mean2, 2);
            }, 0) / numericVals2.length;
            var std2 = Math.sqrt(variance2);

            if (std2 === 0) return values.map(function() { return 0.5; });

            return values.map(function(v) {
                if (isNaN(v) || !isFinite(v)) return NaN;
                var zscore = (v - mean2) / std2;
                return normalCDF(zscore);
            });

        default:
            return values;
    }
}

// Normal CDF (cumulative distribution function) for standard normal
function normalCDF(x) {
    // Using error function approximation
    var t = 1 / (1 + 0.2316419 * Math.abs(x));
    var d = 0.3989423 * Math.exp(-x * x / 2);
    var prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
    return x > 0 ? 1 - prob : prob;
}

// Inverse normal CDF (quantile function) for standard normal
function inverseNormalCDF(p) {
    // Rational approximation for inverse normal CDF
    // Valid for 0 < p < 1
    if (p <= 0 || p >= 1) {
        return NaN;
    }

    var a = [0, -3.969683028665376e+01, 2.209460984245205e+02,
             -2.759285104469687e+02, 1.383577518672690e+02,
             -3.066479806614716e+01, 2.506628277459239e+00];
    var b = [0, -5.447609879822406e+01, 1.615858368580409e+02,
             -1.556989798598866e+02, 6.680131188771972e+01,
             -1.328068155288572e+01];
    var c = [0, -7.784894002430293e-03, -3.223964580411365e-01,
             -2.400758277161838e+00, -2.549732539343734e+00,
             4.374664141464968e+00, 2.938163982698783e+00];
    var d = [0, 7.784695709041462e-03, 3.224671290700398e-01,
             2.445134137142996e+00, 3.754408661907416e+00];

    var q, r, result;

    if (p < 0.02425) {
        q = Math.sqrt(-2 * Math.log(p));
        result = (((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q + c[6]) /
                 ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1);
    } else if (p > 0.97575) {
        q = Math.sqrt(-2 * Math.log(1 - p));
        result = -(((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q + c[6]) /
                  ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1);
    } else {
        q = p - 0.5;
        r = q * q;
        result = (((((a[1] * r + a[2]) * r + a[3]) * r + a[4]) * r + a[5]) * r + a[6]) * q /
                 (((((b[1] * r + b[2]) * r + b[3]) * r + b[4]) * r + b[5]) * r + 1);
    }

    return result;
}

// Get axis label with transformation applied
function getAxisLabel(originalLabel, transformType) {
    switch(transformType) {
        case 'log':
            return 'log(' + originalLabel + ')';
        case 'z_score':
            return 'z(' + originalLabel + ')';
        case 'quantile':
            return 'quantile(' + originalLabel + ')';
        case 'inverse_cdf':
            return 'Î¦(' + originalLabel + ')';
        default:
            return originalLabel;
    }
}

// Setup aspect ratio control for a chart
// This should be called after the chart is first rendered
// Uses logarithmic scale for better precision at smaller aspect ratios
function setupAspectRatioControl(chartId, updateCallback) {
    var slider = document.getElementById(chartId + '_aspect_ratio_slider');
    var label = document.getElementById(chartId + '_aspect_ratio_label');

    if (!slider || !label) return; // Not all charts have aspect ratio control

    slider.addEventListener('input', function() {
        // Convert from log space to linear space
        var logValue = parseFloat(this.value);
        var aspectRatio = Math.exp(logValue);
        label.textContent = aspectRatio.toFixed(2);

        // Get current width of chart div
        var chartDiv = document.getElementById(chartId);
        if (!chartDiv) return;

        var width = chartDiv.offsetWidth;
        var height = width * aspectRatio;

        // Update chart layout with new height
        Plotly.relayout(chartId, { height: height });

        // Call the optional callback if provided
        if (updateCallback && typeof updateCallback === 'function') {
            updateCallback(height);
        }
    });

    // Trigger initial sizing
    var initialLogValue = parseFloat(slider.value);
    var initialAspectRatio = Math.exp(initialLogValue);
    label.textContent = initialAspectRatio.toFixed(2);
    var chartDiv = document.getElementById(chartId);
    if (chartDiv) {
        var width = chartDiv.offsetWidth;
        var height = width * initialAspectRatio;
        Plotly.relayout(chartId, { height: height });
    }
}

// This function parses data from embedded or external sources and returns a Promise
// Supports CSV (embedded/external), JSON (embedded/external), and Parquet (external) formats
// Usage: loadDataset('dataLabel').then(function(data) { /* use data */ });
function loadDataset(dataLabel) {
    return new Promise(function(resolve, reject) {
        var dataElement = document.getElementById(dataLabel);
        if (!dataElement) {
            reject(new Error('Data element not found: ' + dataLabel));
            return;
        }

        var format = dataElement.getAttribute('data-format') || 'csv_embedded';
        var dataSrc = dataElement.getAttribute('data-src');

        // Handle external JSON files
        if (format === 'json_external' && dataSrc) {
            fetch(dataSrc)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.json();
                })
                .then(function(data) {
                    // Parse dates in JSON data (centralized)
                    resolve(parseDatesInData(data));
                })
                .catch(function(error) {
                    console.error('Error loading external JSON:', error);
                    reject(error);
                });
            return;
        }

        // Handle external Parquet files
        if (format === 'parquet' && dataSrc) {
            // Wait for parquet-wasm to be loaded first
            waitForParquet()
                .then(function() {
                    return fetch(dataSrc);
                })
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.arrayBuffer();
                })
                .then(function(arrayBuffer) {
                    // Use parquet-wasm to read the file
                    var uint8Array = new Uint8Array(arrayBuffer);

                    // readParquet returns an Arrow Table
                    var wasmTable = window.parquetWasm.readParquet(uint8Array);

                    // Convert to Arrow IPC stream
                    var ipcStream = wasmTable.intoIPCStream();

                    // Use Apache Arrow JS to read the IPC stream
                    var arrowTable = window.Arrow.tableFromIPC(ipcStream);

                    // Convert Arrow Table to array of JavaScript objects
                    var data = [];
                    for (var i = 0; i < arrowTable.numRows; i++) {
                        var row = {};
                        arrowTable.schema.fields.forEach(function(field) {
                            var column = arrowTable.getChild(field.name);
                            var value = column.get(i);

                            // Convert BigInt to Number (Arrow returns BigInt for Int64)
                            if (typeof value === 'bigint') {
                                value = Number(value);
                            }

                            row[field.name] = value;
                        });
                        data.push(row);
                    }

                    resolve(data);
                })
                .catch(function(error) {
                    console.error('Error loading external Parquet:', error);
                    reject(error);
                });
            return;
        }

        // Handle external CSV files
        if (format === 'csv_external' && dataSrc) {
            fetch(dataSrc)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.text();
                })
                .then(function(csvText) {
                    Papa.parse(csvText, {
                        header: true,
                        dynamicTyping: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            // Check for fatal errors only (not warnings)
                            var fatalErrors = results.errors.filter(function(err) {
                                return err.type !== 'Delimiter';
                            });

                            if (fatalErrors.length > 0) {
                                console.error('CSV parsing errors:', fatalErrors);
                                reject(fatalErrors);
                            } else if (results.data && results.data.length > 0) {
                                // Parse dates in CSV data (centralized)
                                resolve(parseDatesInData(results.data));
                            } else {
                                reject(new Error('No data parsed from CSV'));
                            }
                        },
                        error: function(error) {
                            console.error('CSV parsing error:', error);
                            reject(error);
                        }
                    });
                })
                .catch(function(error) {
                    console.error('Error loading external CSV:', error);
                    reject(error);
                });
            return;
        }

        // Handle embedded data
        var dataText = dataElement.textContent.trim();

        if (format === 'json_embedded') {
            // Parse JSON data
            try {
                var data = JSON.parse(dataText);
                // Parse dates in JSON data (centralized)
                resolve(parseDatesInData(data));
            } catch (error) {
                console.error('JSON parsing error:', error);
                reject(error);
            }
        } else if (format === 'csv_embedded') {
            // Parse CSV data using PapaParse
            Papa.parse(dataText, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    // Check for fatal errors only (not warnings)
                    // PapaParse includes non-fatal warnings in errors array
                    var fatalErrors = results.errors.filter(function(err) {
                        // Filter out delimiter detection warnings - these aren't fatal
                        // (common for single-column CSVs)
                        return err.type !== 'Delimiter';
                    });

                    if (fatalErrors.length > 0) {
                        console.error('CSV parsing errors:', fatalErrors);
                        reject(fatalErrors);
                    } else if (results.data && results.data.length > 0) {
                        // Parse dates in CSV data (centralized)
                        resolve(parseDatesInData(results.data));
                    } else {
                        reject(new Error('No data parsed from CSV'));
                    }
                },
                error: function(error) {
                    console.error('CSV parsing error:', error);
                    reject(error);
                }
            });
        } else {
            reject(new Error('Unsupported data format: ' + format));
        }
    });
}

$(function(){

(function() {
    const dendroData = {"maxHeight":2.0521405699499455,"leafLabels":["price_to_book","profit_margin","roa","roe","revenue","profit","pe_ratio","asset_turnover","debt_to_equity","inventory_turnover"],"leafPositions":[0,1,2,3,4,5,6,7,8,9],"shapes":[{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.2948934339044749,"x0":2.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.2948934339044749,"x0":2.0,"type":"line","y0":0.2948934339044749},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.0,"x0":3.0,"type":"line","y0":0.2948934339044749},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.4764895732140456,"x0":1.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":2.5,"y1":0.4764895732140456,"x0":1.0,"type":"line","y0":0.4764895732140456},{"line":{"color":"#636efa","width":2},"x1":2.5,"y1":0.2948934339044749,"x0":2.5,"type":"line","y0":0.4764895732140456},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.6629580871591967,"x0":4.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.6629580871591967,"x0":4.0,"type":"line","y0":0.6629580871591967},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.0,"x0":5.0,"type":"line","y0":0.6629580871591967},{"line":{"color":"#636efa","width":2},"x1":0.0,"y1":0.6826895387107041,"x0":0.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":1.75,"y1":0.6826895387107041,"x0":0.0,"type":"line","y0":0.6826895387107041},{"line":{"color":"#636efa","width":2},"x1":1.75,"y1":0.4764895732140456,"x0":1.75,"type":"line","y0":0.6826895387107041},{"line":{"color":"#636efa","width":2},"x1":8.0,"y1":0.8475723915108836,"x0":8.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":9.0,"y1":0.8475723915108836,"x0":8.0,"type":"line","y0":0.8475723915108836},{"line":{"color":"#636efa","width":2},"x1":9.0,"y1":0.0,"x0":9.0,"type":"line","y0":0.8475723915108836},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.944325525669351,"x0":7.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":8.5,"y1":0.944325525669351,"x0":7.0,"type":"line","y0":0.944325525669351},{"line":{"color":"#636efa","width":2},"x1":8.5,"y1":0.8475723915108836,"x0":8.5,"type":"line","y0":0.944325525669351},{"line":{"color":"#636efa","width":2},"x1":6.0,"y1":1.0662534480945671,"x0":6.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":7.75,"y1":1.0662534480945671,"x0":6.0,"type":"line","y0":1.0662534480945671},{"line":{"color":"#636efa","width":2},"x1":7.75,"y1":0.944325525669351,"x0":7.75,"type":"line","y0":1.0662534480945671},{"line":{"color":"#636efa","width":2},"x1":4.5,"y1":1.3885455260927368,"x0":4.5,"type":"line","y0":0.6629580871591967},{"line":{"color":"#636efa","width":2},"x1":6.875,"y1":1.3885455260927368,"x0":4.5,"type":"line","y0":1.3885455260927368},{"line":{"color":"#636efa","width":2},"x1":6.875,"y1":1.0662534480945671,"x0":6.875,"type":"line","y0":1.3885455260927368},{"line":{"color":"#636efa","width":2},"x1":0.875,"y1":2.0521405699499455,"x0":0.875,"type":"line","y0":0.6826895387107041},{"line":{"color":"#636efa","width":2},"x1":5.6875,"y1":2.0521405699499455,"x0":0.875,"type":"line","y0":2.0521405699499455},{"line":{"color":"#636efa","width":2},"x1":5.6875,"y1":1.3885455260927368,"x0":5.6875,"type":"line","y0":2.0521405699499455}]};
    const labels = ["price_to_book","profit_margin","roa","roe","revenue","profit","pe_ratio","asset_turnover","debt_to_equity","inventory_turnover"];
    const n = labels.length;

    // Load correlation data from external file
    loadDataset('financial_corr_data').then(function(corrDataRaw) {
        // Build correlation matrix for heatmap from loaded data
        const zValues = [];
        const textValues = [];
        const hoverText = [];

        for (let i = 0; i < n; i++) {
            zValues[i] = [];
            textValues[i] = [];
            hoverText[i] = [];
            for (let j = 0; j < n; j++) {
                // Get Pearson correlation (upper triangle)
                const pearsonItem = corrDataRaw.find(d =>
                    d.asset1 === labels[i] && d.asset2 === labels[j] &&
                    d.correlation_method === 'pearson');
                const pearsonCorr = pearsonItem ? pearsonItem.correlation : 0;

                // Get Spearman correlation (lower triangle)
                const spearmanItem = corrDataRaw.find(d =>
                    d.asset1 === labels[i] && d.asset2 === labels[j] &&
                    d.correlation_method === 'spearman');
                const spearmanCorr = spearmanItem ? spearmanItem.correlation : 0;

                // Use Pearson for upper triangle and diagonal, Spearman for lower
                let corr, type;
                if (i === j) {
                    corr = pearsonCorr;
                    type = 'diagonal';
                } else if (i < j) {
                    corr = pearsonCorr;
                    type = 'Pearson';
                } else {
                    corr = spearmanCorr;
                    type = 'Spearman';
                }

                zValues[i][j] = corr;

                if (type === 'diagonal') {
                    textValues[i][j] = '1.00';
                    hoverText[i][j] = labels[i];
                } else if (type === 'Pearson') {
                    textValues[i][j] = 'P: ' + corr.toFixed(2);
                    hoverText[i][j] = labels[i] + ' vs ' + labels[j] + '<br>Pearson: ' + corr.toFixed(3);
                } else {
                    textValues[i][j] = 'S: ' + corr.toFixed(2);
                    hoverText[i][j] = labels[i] + ' vs ' + labels[j] + '<br>Spearman: ' + corr.toFixed(3);
                }
            }
        }

    // Create correlation heatmap
    const heatmapTrace = {
        z: zValues,
        x: labels,
        y: labels,
        type: 'heatmap',
        colorscale: [
            [0, '#ff0000'],    // -1: red
            [0.5, '#ffffff'],  //  0: white
            [1, '#0000ff']     //  1: blue
        ],
        zmin: -1,
        zmax: 1,
        text: hoverText,
        hovertemplate: '%{text}<extra></extra>',
        colorbar: {
            title: 'Correlation',
            titleside: 'right'
        }
    };

    const heatmapLayout = {
        xaxis: { side: 'bottom', tickangle: -45 },
        yaxis: { autorange: 'reversed' },
        annotations: [],
        margin: { l: 150, r: 50, b: 150, t: 50 }
    };

    // Add text annotations to cells
    for (let i = 0; i < n; i++) {
        for (let j = 0; j < n; j++) {
            heatmapLayout.annotations.push({
                x: labels[j],
                y: labels[i],
                text: textValues[i][j],
                showarrow: false,
                font: {
                    size: 10,
                    color: Math.abs(zValues[i][j]) > 0.5 ? 'white' : 'black'
                }
            });
        }
    }

        Plotly.newPlot('corrmatrix_financial_corr', [heatmapTrace], heatmapLayout, {responsive: true});

        // Draw dendrogram
        if (dendroData.shapes && dendroData.shapes.length > 0) {
            const leafTrace = {
                x: dendroData.leafPositions,
                y: Array(n).fill(0),
                mode: 'text',
                type: 'scatter',
                text: dendroData.leafLabels,
                textposition: 'bottom center',
                textfont: { size: 10 },
                hoverinfo: 'text',
                showlegend: false
            };

            const dendroLayout = {
                title: 'Hierarchical Clustering Dendrogram',
                xaxis: {
                    visible: false,
                    range: [-0.5, n - 0.5]
                },
                yaxis: {
                    title: 'Height',
                    range: [0, dendroData.maxHeight * 1.15]
                },
                margin: { l: 80, r: 50, b: 120, t: 50 },
                showlegend: false,
                shapes: dendroData.shapes
            };

            Plotly.newPlot('dendrogram_financial_corr', [leafTrace], dendroLayout, {responsive: true});
        }
    }).catch(function(error) {
        console.error('Error loading correlation data:', error);
        document.getElementById('corrmatrix_financial_corr').innerHTML =
            '<p style="color: red;">Error loading correlation data: ' + error.message + '</p>';
    });
})();
(function() {
    const dendroData = {"maxHeight":1.3350762684627675,"leafLabels":["customer_satisfaction","days_to_close","conversion_rate","revenue","marketing_spend","leads","units_sold","inventory_level","response_time_hours","avg_deal_size","cac"],"leafPositions":[0,1,2,3,4,5,6,7,8,9,10],"shapes":[{"line":{"color":"#636efa","width":2},"x1":6.0,"y1":0.32134256867177413,"x0":6.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.32134256867177413,"x0":6.0,"type":"line","y0":0.32134256867177413},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.0,"x0":7.0,"type":"line","y0":0.32134256867177413},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.36997271836786055,"x0":3.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.36997271836786055,"x0":3.0,"type":"line","y0":0.36997271836786055},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.0,"x0":4.0,"type":"line","y0":0.36997271836786055},{"line":{"color":"#636efa","width":2},"x1":9.0,"y1":0.48088001126463087,"x0":9.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":10.0,"y1":0.48088001126463087,"x0":9.0,"type":"line","y0":0.48088001126463087},{"line":{"color":"#636efa","width":2},"x1":10.0,"y1":0.0,"x0":10.0,"type":"line","y0":0.48088001126463087},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.5691921957457459,"x0":5.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":0.5691921957457459,"x0":5.0,"type":"line","y0":0.5691921957457459},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":0.32134256867177413,"x0":6.5,"type":"line","y0":0.5691921957457459},{"line":{"color":"#636efa","width":2},"x1":3.5,"y1":0.7143627928374615,"x0":3.5,"type":"line","y0":0.36997271836786055},{"line":{"color":"#636efa","width":2},"x1":5.75,"y1":0.7143627928374615,"x0":3.5,"type":"line","y0":0.7143627928374615},{"line":{"color":"#636efa","width":2},"x1":5.75,"y1":0.5691921957457459,"x0":5.75,"type":"line","y0":0.7143627928374615},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.9592837461787548,"x0":2.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":4.625,"y1":0.9592837461787548,"x0":2.0,"type":"line","y0":0.9592837461787548},{"line":{"color":"#636efa","width":2},"x1":4.625,"y1":0.7143627928374615,"x0":4.625,"type":"line","y0":0.9592837461787548},{"line":{"color":"#636efa","width":2},"x1":0.0,"y1":1.0708559822244967,"x0":0.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":1.0708559822244967,"x0":0.0,"type":"line","y0":1.0708559822244967},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.0,"x0":1.0,"type":"line","y0":1.0708559822244967},{"line":{"color":"#636efa","width":2},"x1":8.0,"y1":1.1049777545343544,"x0":8.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":9.5,"y1":1.1049777545343544,"x0":8.0,"type":"line","y0":1.1049777545343544},{"line":{"color":"#636efa","width":2},"x1":9.5,"y1":0.48088001126463087,"x0":9.5,"type":"line","y0":1.1049777545343544},{"line":{"color":"#636efa","width":2},"x1":3.3125,"y1":1.1405614865154885,"x0":3.3125,"type":"line","y0":0.9592837461787548},{"line":{"color":"#636efa","width":2},"x1":8.75,"y1":1.1405614865154885,"x0":3.3125,"type":"line","y0":1.1405614865154885},{"line":{"color":"#636efa","width":2},"x1":8.75,"y1":1.1049777545343544,"x0":8.75,"type":"line","y0":1.1405614865154885},{"line":{"color":"#636efa","width":2},"x1":0.5,"y1":1.3350762684627675,"x0":0.5,"type":"line","y0":1.0708559822244967},{"line":{"color":"#636efa","width":2},"x1":6.03125,"y1":1.3350762684627675,"x0":0.5,"type":"line","y0":1.3350762684627675},{"line":{"color":"#636efa","width":2},"x1":6.03125,"y1":1.1405614865154885,"x0":6.03125,"type":"line","y0":1.3350762684627675}]};
    const labels = ["customer_satisfaction","days_to_close","conversion_rate","revenue","marketing_spend","leads","units_sold","inventory_level","response_time_hours","avg_deal_size","cac"];
    const n = labels.length;

    // Load correlation data from external file
    loadDataset('sales_corr_data').then(function(corrDataRaw) {
        // Build correlation matrix for heatmap from loaded data
        const zValues = [];
        const textValues = [];
        const hoverText = [];

        for (let i = 0; i < n; i++) {
            zValues[i] = [];
            textValues[i] = [];
            hoverText[i] = [];
            for (let j = 0; j < n; j++) {
                // Get Pearson correlation (upper triangle)
                const pearsonItem = corrDataRaw.find(d =>
                    d.asset1 === labels[i] && d.asset2 === labels[j] &&
                    d.correlation_method === 'pearson');
                const pearsonCorr = pearsonItem ? pearsonItem.correlation : 0;

                // Get Spearman correlation (lower triangle)
                const spearmanItem = corrDataRaw.find(d =>
                    d.asset1 === labels[i] && d.asset2 === labels[j] &&
                    d.correlation_method === 'spearman');
                const spearmanCorr = spearmanItem ? spearmanItem.correlation : 0;

                // Use Pearson for upper triangle and diagonal, Spearman for lower
                let corr, type;
                if (i === j) {
                    corr = pearsonCorr;
                    type = 'diagonal';
                } else if (i < j) {
                    corr = pearsonCorr;
                    type = 'Pearson';
                } else {
                    corr = spearmanCorr;
                    type = 'Spearman';
                }

                zValues[i][j] = corr;

                if (type === 'diagonal') {
                    textValues[i][j] = '1.00';
                    hoverText[i][j] = labels[i];
                } else if (type === 'Pearson') {
                    textValues[i][j] = 'P: ' + corr.toFixed(2);
                    hoverText[i][j] = labels[i] + ' vs ' + labels[j] + '<br>Pearson: ' + corr.toFixed(3);
                } else {
                    textValues[i][j] = 'S: ' + corr.toFixed(2);
                    hoverText[i][j] = labels[i] + ' vs ' + labels[j] + '<br>Spearman: ' + corr.toFixed(3);
                }
            }
        }

    // Create correlation heatmap
    const heatmapTrace = {
        z: zValues,
        x: labels,
        y: labels,
        type: 'heatmap',
        colorscale: [
            [0, '#ff0000'],    // -1: red
            [0.5, '#ffffff'],  //  0: white
            [1, '#0000ff']     //  1: blue
        ],
        zmin: -1,
        zmax: 1,
        text: hoverText,
        hovertemplate: '%{text}<extra></extra>',
        colorbar: {
            title: 'Correlation',
            titleside: 'right'
        }
    };

    const heatmapLayout = {
        xaxis: { side: 'bottom', tickangle: -45 },
        yaxis: { autorange: 'reversed' },
        annotations: [],
        margin: { l: 150, r: 50, b: 150, t: 50 }
    };

    // Add text annotations to cells
    for (let i = 0; i < n; i++) {
        for (let j = 0; j < n; j++) {
            heatmapLayout.annotations.push({
                x: labels[j],
                y: labels[i],
                text: textValues[i][j],
                showarrow: false,
                font: {
                    size: 10,
                    color: Math.abs(zValues[i][j]) > 0.5 ? 'white' : 'black'
                }
            });
        }
    }

        Plotly.newPlot('corrmatrix_sales_corr', [heatmapTrace], heatmapLayout, {responsive: true});

        // Draw dendrogram
        if (dendroData.shapes && dendroData.shapes.length > 0) {
            const leafTrace = {
                x: dendroData.leafPositions,
                y: Array(n).fill(0),
                mode: 'text',
                type: 'scatter',
                text: dendroData.leafLabels,
                textposition: 'bottom center',
                textfont: { size: 10 },
                hoverinfo: 'text',
                showlegend: false
            };

            const dendroLayout = {
                title: 'Hierarchical Clustering Dendrogram',
                xaxis: {
                    visible: false,
                    range: [-0.5, n - 0.5]
                },
                yaxis: {
                    title: 'Height',
                    range: [0, dendroData.maxHeight * 1.15]
                },
                margin: { l: 80, r: 50, b: 120, t: 50 },
                showlegend: false,
                shapes: dendroData.shapes
            };

            Plotly.newPlot('dendrogram_sales_corr', [leafTrace], dendroLayout, {responsive: true});
        }
    }).catch(function(error) {
        console.error('Error loading correlation data:', error);
        document.getElementById('corrmatrix_sales_corr').innerHTML =
            '<p style="color: red;">Error loading correlation data: ' + error.message + '</p>';
    });
})();
(function() {
    const dendroData = {"maxHeight":1.0625747809732757,"leafLabels":["fluorescence","absorbance_280","absorbance_260","ph","heat_capacity","thermal_conductivity","conductivity","surface_tension","density","viscosity"],"leafPositions":[0,1,2,3,4,5,6,7,8,9],"shapes":[{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.09356626731689735,"x0":1.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.09356626731689735,"x0":1.0,"type":"line","y0":0.09356626731689735},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.0,"x0":2.0,"type":"line","y0":0.09356626731689735},{"line":{"color":"#636efa","width":2},"x1":0.0,"y1":0.5445807127792879,"x0":0.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":1.5,"y1":0.5445807127792879,"x0":0.0,"type":"line","y0":0.5445807127792879},{"line":{"color":"#636efa","width":2},"x1":1.5,"y1":0.09356626731689735,"x0":1.5,"type":"line","y0":0.5445807127792879},{"line":{"color":"#636efa","width":2},"x1":8.0,"y1":0.6621466881700483,"x0":8.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":9.0,"y1":0.6621466881700483,"x0":8.0,"type":"line","y0":0.6621466881700483},{"line":{"color":"#636efa","width":2},"x1":9.0,"y1":0.0,"x0":9.0,"type":"line","y0":0.6621466881700483},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.6656107043042376,"x0":4.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.6656107043042376,"x0":4.0,"type":"line","y0":0.6656107043042376},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.0,"x0":5.0,"type":"line","y0":0.6656107043042376},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.6960579040674573,"x0":7.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":8.5,"y1":0.6960579040674573,"x0":7.0,"type":"line","y0":0.6960579040674573},{"line":{"color":"#636efa","width":2},"x1":8.5,"y1":0.6621466881700483,"x0":8.5,"type":"line","y0":0.6960579040674573},{"line":{"color":"#636efa","width":2},"x1":6.0,"y1":1.0237837780035857,"x0":6.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":7.75,"y1":1.0237837780035857,"x0":6.0,"type":"line","y0":1.0237837780035857},{"line":{"color":"#636efa","width":2},"x1":7.75,"y1":0.6960579040674573,"x0":7.75,"type":"line","y0":1.0237837780035857},{"line":{"color":"#636efa","width":2},"x1":4.5,"y1":1.024353923509767,"x0":4.5,"type":"line","y0":0.6656107043042376},{"line":{"color":"#636efa","width":2},"x1":6.875,"y1":1.024353923509767,"x0":4.5,"type":"line","y0":1.024353923509767},{"line":{"color":"#636efa","width":2},"x1":6.875,"y1":1.0237837780035857,"x0":6.875,"type":"line","y0":1.024353923509767},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":1.0300300075472337,"x0":3.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":5.6875,"y1":1.0300300075472337,"x0":3.0,"type":"line","y0":1.0300300075472337},{"line":{"color":"#636efa","width":2},"x1":5.6875,"y1":1.024353923509767,"x0":5.6875,"type":"line","y0":1.0300300075472337},{"line":{"color":"#636efa","width":2},"x1":0.75,"y1":1.0625747809732757,"x0":0.75,"type":"line","y0":0.5445807127792879},{"line":{"color":"#636efa","width":2},"x1":4.34375,"y1":1.0625747809732757,"x0":0.75,"type":"line","y0":1.0625747809732757},{"line":{"color":"#636efa","width":2},"x1":4.34375,"y1":1.0300300075472337,"x0":4.34375,"type":"line","y0":1.0625747809732757}]};
    const labels = ["fluorescence","absorbance_280","absorbance_260","ph","heat_capacity","thermal_conductivity","conductivity","surface_tension","density","viscosity"];
    const n = labels.length;

    // Load correlation data from external file
    loadDataset('science_corr_data').then(function(corrDataRaw) {
        // Build correlation matrix for heatmap from loaded data
        const zValues = [];
        const textValues = [];
        const hoverText = [];

        for (let i = 0; i < n; i++) {
            zValues[i] = [];
            textValues[i] = [];
            hoverText[i] = [];
            for (let j = 0; j < n; j++) {
                // Get Pearson correlation (upper triangle)
                const pearsonItem = corrDataRaw.find(d =>
                    d.asset1 === labels[i] && d.asset2 === labels[j] &&
                    d.correlation_method === 'pearson');
                const pearsonCorr = pearsonItem ? pearsonItem.correlation : 0;

                // Get Spearman correlation (lower triangle)
                const spearmanItem = corrDataRaw.find(d =>
                    d.asset1 === labels[i] && d.asset2 === labels[j] &&
                    d.correlation_method === 'spearman');
                const spearmanCorr = spearmanItem ? spearmanItem.correlation : 0;

                // Use Pearson for upper triangle and diagonal, Spearman for lower
                let corr, type;
                if (i === j) {
                    corr = pearsonCorr;
                    type = 'diagonal';
                } else if (i < j) {
                    corr = pearsonCorr;
                    type = 'Pearson';
                } else {
                    corr = spearmanCorr;
                    type = 'Spearman';
                }

                zValues[i][j] = corr;

                if (type === 'diagonal') {
                    textValues[i][j] = '1.00';
                    hoverText[i][j] = labels[i];
                } else if (type === 'Pearson') {
                    textValues[i][j] = 'P: ' + corr.toFixed(2);
                    hoverText[i][j] = labels[i] + ' vs ' + labels[j] + '<br>Pearson: ' + corr.toFixed(3);
                } else {
                    textValues[i][j] = 'S: ' + corr.toFixed(2);
                    hoverText[i][j] = labels[i] + ' vs ' + labels[j] + '<br>Spearman: ' + corr.toFixed(3);
                }
            }
        }

    // Create correlation heatmap
    const heatmapTrace = {
        z: zValues,
        x: labels,
        y: labels,
        type: 'heatmap',
        colorscale: [
            [0, '#ff0000'],    // -1: red
            [0.5, '#ffffff'],  //  0: white
            [1, '#0000ff']     //  1: blue
        ],
        zmin: -1,
        zmax: 1,
        text: hoverText,
        hovertemplate: '%{text}<extra></extra>',
        colorbar: {
            title: 'Correlation',
            titleside: 'right'
        }
    };

    const heatmapLayout = {
        xaxis: { side: 'bottom', tickangle: -45 },
        yaxis: { autorange: 'reversed' },
        annotations: [],
        margin: { l: 150, r: 50, b: 150, t: 50 }
    };

    // Add text annotations to cells
    for (let i = 0; i < n; i++) {
        for (let j = 0; j < n; j++) {
            heatmapLayout.annotations.push({
                x: labels[j],
                y: labels[i],
                text: textValues[i][j],
                showarrow: false,
                font: {
                    size: 10,
                    color: Math.abs(zValues[i][j]) > 0.5 ? 'white' : 'black'
                }
            });
        }
    }

        Plotly.newPlot('corrmatrix_science_corr', [heatmapTrace], heatmapLayout, {responsive: true});

        // Draw dendrogram
        if (dendroData.shapes && dendroData.shapes.length > 0) {
            const leafTrace = {
                x: dendroData.leafPositions,
                y: Array(n).fill(0),
                mode: 'text',
                type: 'scatter',
                text: dendroData.leafLabels,
                textposition: 'bottom center',
                textfont: { size: 10 },
                hoverinfo: 'text',
                showlegend: false
            };

            const dendroLayout = {
                title: 'Hierarchical Clustering Dendrogram',
                xaxis: {
                    visible: false,
                    range: [-0.5, n - 0.5]
                },
                yaxis: {
                    title: 'Height',
                    range: [0, dendroData.maxHeight * 1.15]
                },
                margin: { l: 80, r: 50, b: 120, t: 50 },
                showlegend: false,
                shapes: dendroData.shapes
            };

            Plotly.newPlot('dendrogram_science_corr', [leafTrace], dendroLayout, {responsive: true});
        }
    }).catch(function(error) {
        console.error('Error loading correlation data:', error);
        document.getElementById('corrmatrix_science_corr').innerHTML =
            '<p style="color: red;">Error loading correlation data: ' + error.message + '</p>';
    });
})();
(function() {
    const dendroData = {"maxHeight":1.2778994468597278,"leafLabels":["glucose","hba1c","cardiovascular_risk","hdl","cholesterol_total","ldl","systolic_bp","diastolic_bp","heart_rate","triglycerides","bmi"],"leafPositions":[0,1,2,3,4,5,6,7,8,9,10],"shapes":[{"line":{"color":"#636efa","width":2},"x1":0.0,"y1":0.13416223367390762,"x0":0.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.13416223367390762,"x0":0.0,"type":"line","y0":0.13416223367390762},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.0,"x0":1.0,"type":"line","y0":0.13416223367390762},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.4118731640981628,"x0":4.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.4118731640981628,"x0":4.0,"type":"line","y0":0.4118731640981628},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.0,"x0":5.0,"type":"line","y0":0.4118731640981628},{"line":{"color":"#636efa","width":2},"x1":6.0,"y1":0.5236683485101521,"x0":6.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.5236683485101521,"x0":6.0,"type":"line","y0":0.5236683485101521},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.0,"x0":7.0,"type":"line","y0":0.5236683485101521},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.64320559239949,"x0":3.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":4.5,"y1":0.64320559239949,"x0":3.0,"type":"line","y0":0.64320559239949},{"line":{"color":"#636efa","width":2},"x1":4.5,"y1":0.4118731640981628,"x0":4.5,"type":"line","y0":0.64320559239949},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.8932592469253386,"x0":2.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":3.75,"y1":0.8932592469253386,"x0":2.0,"type":"line","y0":0.8932592469253386},{"line":{"color":"#636efa","width":2},"x1":3.75,"y1":0.64320559239949,"x0":3.75,"type":"line","y0":0.8932592469253386},{"line":{"color":"#636efa","width":2},"x1":9.0,"y1":0.9386988486775848,"x0":9.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":10.0,"y1":0.9386988486775848,"x0":9.0,"type":"line","y0":0.9386988486775848},{"line":{"color":"#636efa","width":2},"x1":10.0,"y1":0.0,"x0":10.0,"type":"line","y0":0.9386988486775848},{"line":{"color":"#636efa","width":2},"x1":8.0,"y1":1.05535880194232,"x0":8.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":9.5,"y1":1.05535880194232,"x0":8.0,"type":"line","y0":1.05535880194232},{"line":{"color":"#636efa","width":2},"x1":9.5,"y1":0.9386988486775848,"x0":9.5,"type":"line","y0":1.05535880194232},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":1.1061259771966674,"x0":6.5,"type":"line","y0":0.5236683485101521},{"line":{"color":"#636efa","width":2},"x1":8.75,"y1":1.1061259771966674,"x0":6.5,"type":"line","y0":1.1061259771966674},{"line":{"color":"#636efa","width":2},"x1":8.75,"y1":1.05535880194232,"x0":8.75,"type":"line","y0":1.1061259771966674},{"line":{"color":"#636efa","width":2},"x1":2.875,"y1":1.216349795288249,"x0":2.875,"type":"line","y0":0.8932592469253386},{"line":{"color":"#636efa","width":2},"x1":7.625,"y1":1.216349795288249,"x0":2.875,"type":"line","y0":1.216349795288249},{"line":{"color":"#636efa","width":2},"x1":7.625,"y1":1.1061259771966674,"x0":7.625,"type":"line","y0":1.216349795288249},{"line":{"color":"#636efa","width":2},"x1":0.5,"y1":1.2778994468597278,"x0":0.5,"type":"line","y0":0.13416223367390762},{"line":{"color":"#636efa","width":2},"x1":5.25,"y1":1.2778994468597278,"x0":0.5,"type":"line","y0":1.2778994468597278},{"line":{"color":"#636efa","width":2},"x1":5.25,"y1":1.216349795288249,"x0":5.25,"type":"line","y0":1.2778994468597278}]};
    const labels = ["glucose","hba1c","cardiovascular_risk","hdl","cholesterol_total","ldl","systolic_bp","diastolic_bp","heart_rate","triglycerides","bmi"];
    const n = labels.length;

    // Load correlation data from external file
    loadDataset('patient_corr_data').then(function(corrDataRaw) {
        // Build correlation matrix for heatmap from loaded data
        const zValues = [];
        const textValues = [];
        const hoverText = [];

        for (let i = 0; i < n; i++) {
            zValues[i] = [];
            textValues[i] = [];
            hoverText[i] = [];
            for (let j = 0; j < n; j++) {
                // Get Pearson correlation (upper triangle)
                const pearsonItem = corrDataRaw.find(d =>
                    d.asset1 === labels[i] && d.asset2 === labels[j] &&
                    d.correlation_method === 'pearson');
                const pearsonCorr = pearsonItem ? pearsonItem.correlation : 0;

                // Get Spearman correlation (lower triangle)
                const spearmanItem = corrDataRaw.find(d =>
                    d.asset1 === labels[i] && d.asset2 === labels[j] &&
                    d.correlation_method === 'spearman');
                const spearmanCorr = spearmanItem ? spearmanItem.correlation : 0;

                // Use Pearson for upper triangle and diagonal, Spearman for lower
                let corr, type;
                if (i === j) {
                    corr = pearsonCorr;
                    type = 'diagonal';
                } else if (i < j) {
                    corr = pearsonCorr;
                    type = 'Pearson';
                } else {
                    corr = spearmanCorr;
                    type = 'Spearman';
                }

                zValues[i][j] = corr;

                if (type === 'diagonal') {
                    textValues[i][j] = '1.00';
                    hoverText[i][j] = labels[i];
                } else if (type === 'Pearson') {
                    textValues[i][j] = 'P: ' + corr.toFixed(2);
                    hoverText[i][j] = labels[i] + ' vs ' + labels[j] + '<br>Pearson: ' + corr.toFixed(3);
                } else {
                    textValues[i][j] = 'S: ' + corr.toFixed(2);
                    hoverText[i][j] = labels[i] + ' vs ' + labels[j] + '<br>Spearman: ' + corr.toFixed(3);
                }
            }
        }

    // Create correlation heatmap
    const heatmapTrace = {
        z: zValues,
        x: labels,
        y: labels,
        type: 'heatmap',
        colorscale: [
            [0, '#ff0000'],    // -1: red
            [0.5, '#ffffff'],  //  0: white
            [1, '#0000ff']     //  1: blue
        ],
        zmin: -1,
        zmax: 1,
        text: hoverText,
        hovertemplate: '%{text}<extra></extra>',
        colorbar: {
            title: 'Correlation',
            titleside: 'right'
        }
    };

    const heatmapLayout = {
        xaxis: { side: 'bottom', tickangle: -45 },
        yaxis: { autorange: 'reversed' },
        annotations: [],
        margin: { l: 150, r: 50, b: 150, t: 50 }
    };

    // Add text annotations to cells
    for (let i = 0; i < n; i++) {
        for (let j = 0; j < n; j++) {
            heatmapLayout.annotations.push({
                x: labels[j],
                y: labels[i],
                text: textValues[i][j],
                showarrow: false,
                font: {
                    size: 10,
                    color: Math.abs(zValues[i][j]) > 0.5 ? 'white' : 'black'
                }
            });
        }
    }

        Plotly.newPlot('corrmatrix_patient_corr', [heatmapTrace], heatmapLayout, {responsive: true});

        // Draw dendrogram
        if (dendroData.shapes && dendroData.shapes.length > 0) {
            const leafTrace = {
                x: dendroData.leafPositions,
                y: Array(n).fill(0),
                mode: 'text',
                type: 'scatter',
                text: dendroData.leafLabels,
                textposition: 'bottom center',
                textfont: { size: 10 },
                hoverinfo: 'text',
                showlegend: false
            };

            const dendroLayout = {
                title: 'Hierarchical Clustering Dendrogram',
                xaxis: {
                    visible: false,
                    range: [-0.5, n - 0.5]
                },
                yaxis: {
                    title: 'Height',
                    range: [0, dendroData.maxHeight * 1.15]
                },
                margin: { l: 80, r: 50, b: 120, t: 50 },
                showlegend: false,
                shapes: dendroData.shapes
            };

            Plotly.newPlot('dendrogram_patient_corr', [leafTrace], dendroLayout, {responsive: true});
        }
    }).catch(function(error) {
        console.error('Error loading correlation data:', error);
        document.getElementById('corrmatrix_patient_corr').innerHTML =
            '<p style="color: red;">Error loading correlation data: ' + error.message + '</p>';
    });
})();
(function() {
    const scenarios = [{"name":"North America","allLabels":["GDP_Growth","Unemployment","Inflation","Interest_Rate","Manufacturing_Index","Consumer_Confidence","Exports","Imports"],"labels":["Unemployment","Inflation","Interest_Rate","Consumer_Confidence","GDP_Growth","Manufacturing_Index","Exports","Imports"],"dendroData":{"maxHeight":1.8913578228077605,"leafLabels":["Unemployment","Inflation","Interest_Rate","Consumer_Confidence","GDP_Growth","Manufacturing_Index","Exports","Imports"],"leafPositions":[0,1,2,3,4,5,6,7],"shapes":[{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.4860764605801094,"x0":4.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.4860764605801094,"x0":4.0,"type":"line","y0":0.4860764605801094},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.0,"x0":5.0,"type":"line","y0":0.4860764605801094},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.5513645712263624,"x0":1.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.5513645712263624,"x0":1.0,"type":"line","y0":0.5513645712263624},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.0,"x0":2.0,"type":"line","y0":0.5513645712263624},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.5976614270950351,"x0":3.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":4.5,"y1":0.5976614270950351,"x0":3.0,"type":"line","y0":0.5976614270950351},{"line":{"color":"#636efa","width":2},"x1":4.5,"y1":0.4860764605801094,"x0":4.5,"type":"line","y0":0.5976614270950351},{"line":{"color":"#636efa","width":2},"x1":6.0,"y1":0.7774750285099887,"x0":6.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.7774750285099887,"x0":6.0,"type":"line","y0":0.7774750285099887},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.0,"x0":7.0,"type":"line","y0":0.7774750285099887},{"line":{"color":"#636efa","width":2},"x1":3.75,"y1":0.9426190577770421,"x0":3.75,"type":"line","y0":0.5976614270950351},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":0.9426190577770421,"x0":3.75,"type":"line","y0":0.9426190577770421},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":0.7774750285099887,"x0":6.5,"type":"line","y0":0.9426190577770421},{"line":{"color":"#636efa","width":2},"x1":1.5,"y1":1.109286573659988,"x0":1.5,"type":"line","y0":0.5513645712263624},{"line":{"color":"#636efa","width":2},"x1":5.125,"y1":1.109286573659988,"x0":1.5,"type":"line","y0":1.109286573659988},{"line":{"color":"#636efa","width":2},"x1":5.125,"y1":0.9426190577770421,"x0":5.125,"type":"line","y0":1.109286573659988},{"line":{"color":"#636efa","width":2},"x1":0.0,"y1":1.8913578228077605,"x0":0.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":3.3125,"y1":1.8913578228077605,"x0":0.0,"type":"line","y0":1.8913578228077605},{"line":{"color":"#636efa","width":2},"x1":3.3125,"y1":1.109286573659988,"x0":3.3125,"type":"line","y0":1.8913578228077605}]}},{"name":"Europe","allLabels":["GDP_Growth","Unemployment","Inflation","Interest_Rate","Manufacturing_Index","Consumer_Confidence","Exports","Imports"],"labels":["Unemployment","Inflation","Interest_Rate","Consumer_Confidence","GDP_Growth","Manufacturing_Index","Exports","Imports"],"dendroData":{"maxHeight":1.6220118264266434,"leafLabels":["Unemployment","Inflation","Interest_Rate","Consumer_Confidence","GDP_Growth","Manufacturing_Index","Exports","Imports"],"leafPositions":[0,1,2,3,4,5,6,7],"shapes":[{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.537499581535805,"x0":1.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.537499581535805,"x0":1.0,"type":"line","y0":0.537499581535805},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.0,"x0":2.0,"type":"line","y0":0.537499581535805},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.6125244477565518,"x0":4.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.6125244477565518,"x0":4.0,"type":"line","y0":0.6125244477565518},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.0,"x0":5.0,"type":"line","y0":0.6125244477565518},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.7354057758400114,"x0":3.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":4.5,"y1":0.7354057758400114,"x0":3.0,"type":"line","y0":0.7354057758400114},{"line":{"color":"#636efa","width":2},"x1":4.5,"y1":0.6125244477565518,"x0":4.5,"type":"line","y0":0.7354057758400114},{"line":{"color":"#636efa","width":2},"x1":6.0,"y1":0.8277956002344412,"x0":6.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.8277956002344412,"x0":6.0,"type":"line","y0":0.8277956002344412},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.0,"x0":7.0,"type":"line","y0":0.8277956002344412},{"line":{"color":"#636efa","width":2},"x1":3.75,"y1":0.9116828231581758,"x0":3.75,"type":"line","y0":0.7354057758400114},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":0.9116828231581758,"x0":3.75,"type":"line","y0":0.9116828231581758},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":0.8277956002344412,"x0":6.5,"type":"line","y0":0.9116828231581758},{"line":{"color":"#636efa","width":2},"x1":1.5,"y1":1.2185712624836937,"x0":1.5,"type":"line","y0":0.537499581535805},{"line":{"color":"#636efa","width":2},"x1":5.125,"y1":1.2185712624836937,"x0":1.5,"type":"line","y0":1.2185712624836937},{"line":{"color":"#636efa","width":2},"x1":5.125,"y1":0.9116828231581758,"x0":5.125,"type":"line","y0":1.2185712624836937},{"line":{"color":"#636efa","width":2},"x1":0.0,"y1":1.6220118264266434,"x0":0.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":3.3125,"y1":1.6220118264266434,"x0":0.0,"type":"line","y0":1.6220118264266434},{"line":{"color":"#636efa","width":2},"x1":3.3125,"y1":1.2185712624836937,"x0":3.3125,"type":"line","y0":1.6220118264266434}]}},{"name":"Asia-Pacific","allLabels":["GDP_Growth","Unemployment","Inflation","Interest_Rate","Manufacturing_Index","Consumer_Confidence","Exports","Imports"],"labels":["Unemployment","Inflation","Interest_Rate","Consumer_Confidence","GDP_Growth","Manufacturing_Index","Exports","Imports"],"dendroData":{"maxHeight":1.4482258925966909,"leafLabels":["Unemployment","Inflation","Interest_Rate","Consumer_Confidence","GDP_Growth","Manufacturing_Index","Exports","Imports"],"leafPositions":[0,1,2,3,4,5,6,7],"shapes":[{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.6231863026887455,"x0":4.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.6231863026887455,"x0":4.0,"type":"line","y0":0.6231863026887455},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.0,"x0":5.0,"type":"line","y0":0.6231863026887455},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.6434186286044903,"x0":1.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.6434186286044903,"x0":1.0,"type":"line","y0":0.6434186286044903},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.0,"x0":2.0,"type":"line","y0":0.6434186286044903},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.7651054320757352,"x0":3.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":4.5,"y1":0.7651054320757352,"x0":3.0,"type":"line","y0":0.7651054320757352},{"line":{"color":"#636efa","width":2},"x1":4.5,"y1":0.6231863026887455,"x0":4.5,"type":"line","y0":0.7651054320757352},{"line":{"color":"#636efa","width":2},"x1":6.0,"y1":0.9211565346687233,"x0":6.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.9211565346687233,"x0":6.0,"type":"line","y0":0.9211565346687233},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.0,"x0":7.0,"type":"line","y0":0.9211565346687233},{"line":{"color":"#636efa","width":2},"x1":3.75,"y1":1.0205876711373065,"x0":3.75,"type":"line","y0":0.7651054320757352},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":1.0205876711373065,"x0":3.75,"type":"line","y0":1.0205876711373065},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":0.9211565346687233,"x0":6.5,"type":"line","y0":1.0205876711373065},{"line":{"color":"#636efa","width":2},"x1":1.5,"y1":1.1108047447224132,"x0":1.5,"type":"line","y0":0.6434186286044903},{"line":{"color":"#636efa","width":2},"x1":5.125,"y1":1.1108047447224132,"x0":1.5,"type":"line","y0":1.1108047447224132},{"line":{"color":"#636efa","width":2},"x1":5.125,"y1":1.0205876711373065,"x0":5.125,"type":"line","y0":1.1108047447224132},{"line":{"color":"#636efa","width":2},"x1":0.0,"y1":1.4482258925966909,"x0":0.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":3.3125,"y1":1.4482258925966909,"x0":0.0,"type":"line","y0":1.4482258925966909},{"line":{"color":"#636efa","width":2},"x1":3.3125,"y1":1.1108047447224132,"x0":3.3125,"type":"line","y0":1.4482258925966909}]}}];
    let currentScenario = scenarios[0];
    let selectedVars = ["GDP_Growth","Unemployment","Inflation","Interest_Rate"];
    let manualOrder = null;
    let corrDataRaw = null;

    // Load correlation data from external dataset
    loadDataset('econ_adv_data').then(function(data) {
        corrDataRaw = data;
        populateVarSelector();
        updateChart_econ_advanced();
    }).catch(function(error) {
        console.error('Failed to load correlation data:', error);
    });

    // Initialize variable selector
    function populateVarSelector() {
        const select = document.getElementById('var_select_econ_advanced');
        select.innerHTML = '';
        currentScenario.allLabels.forEach(v => {
            const option = document.createElement('option');
            option.value = v;
            option.text = v;
            option.selected = selectedVars.includes(v);
            select.appendChild(option);
        });
    }

    // Initialize sortable list
    function initializeSortable() {
        const container = document.getElementById('sortable_vars_econ_advanced');
        container.innerHTML = '';
        // Show all variables in the manual order list
        const orderToUse = manualOrder || currentScenario.allLabels;
        orderToUse.forEach(v => {
            const div = document.createElement('div');
            div.className = 'sortable-item';
            div.textContent = v;
            div.setAttribute('data-var', v);
            container.appendChild(div);
        });

        if (typeof Sortable !== 'undefined') {
            Sortable.create(container, {
                animation: 150,
                onEnd: function() {
                    manualOrder = Array.from(container.children).map(el => el.getAttribute('data-var'));
                    updateChart_econ_advanced();
                }
            });
        }
    }

    window.updateChart_econ_advanced = function() {
        if (!corrDataRaw) {
            console.warn('Correlation data not loaded yet');
            return;
        }

        // Check if scenario changed
        const scenarioSelect = document.getElementById('scenario_select_econ_advanced');
        let scenarioChanged = false;
        if (scenarioSelect) {
            const scenarioName = scenarioSelect.value;
            const newScenario = scenarios.find(s => s.name === scenarioName);
            if (newScenario !== currentScenario) {
                scenarioChanged = true;
                // Remember currently selected variables
                const varSelect = document.getElementById('var_select_econ_advanced');
                const previouslySelected = Array.from(varSelect.selectedOptions).map(opt => opt.value);

                // Update to new scenario
                currentScenario = newScenario;

                // Repopulate variable selector with new scenario's variables
                populateVarSelector();

                // Try to keep the same variables selected if they exist in new scenario
                const newVarSelect = document.getElementById('var_select_econ_advanced');
                const availableVars = Array.from(newVarSelect.options).map(opt => opt.value);
                const varsToSelect = previouslySelected.filter(v => availableVars.includes(v));

                // If none of the previous variables exist in new scenario, select all
                if (varsToSelect.length < 2) {
                    selectedVars = currentScenario.allLabels;
                    Array.from(newVarSelect.options).forEach(opt => opt.selected = true);
                } else {
                    selectedVars = varsToSelect;
                    Array.from(newVarSelect.options).forEach(opt => {
                        opt.selected = varsToSelect.includes(opt.value);
                    });
                }
            }
        }

        // Update selected variables (if scenario didn't change)
        if (!scenarioChanged) {
            const varSelect = document.getElementById('var_select_econ_advanced');
            selectedVars = Array.from(varSelect.selectedOptions).map(opt => opt.value);
        }

        if (selectedVars.length < 2) {
            console.warn('Select at least 2 variables');
            return;
        }

        // Check order mode
        const orderModeSelect = document.getElementById('order_mode_econ_advanced');
        const orderMode = orderModeSelect ? orderModeSelect.value : 'dendrogram';

        // Show/hide manual ordering UI
        const manualDiv = document.getElementById('manual_order_econ_advanced');
        if (manualDiv) {
            manualDiv.style.display = (orderMode === 'manual') ? 'block' : 'none';
        }

        if (orderMode === 'manual') {
            initializeSortable();
        }

        // Determine variable order
        let orderedVars;
        if (orderMode === 'manual' && manualOrder) {
            // Use manual order, filtered to selected vars
            orderedVars = manualOrder.filter(v => selectedVars.includes(v));
        } else if (orderMode === 'alphabetical') {
            // Use alphabetical order
            orderedVars = selectedVars.slice().sort();
        } else {
            // Use dendrogram order (default)
            orderedVars = currentScenario.labels.filter(v => selectedVars.includes(v));
        }

        const n = orderedVars.length;

        // Build correlation matrix for selected variables
        const zValues = [];
        const textValues = [];
        const hoverText = [];

        for (let i = 0; i < n; i++) {
            zValues[i] = [];
            textValues[i] = [];
            hoverText[i] = [];
            for (let j = 0; j < n; j++) {
                if (i === j) {
                    // Diagonal
                    zValues[i][j] = 1.0;
                    textValues[i][j] = '1.00';
                    hoverText[i][j] = orderedVars[i];
                } else {
                    // Find correlation values from external data
                    // Data can have either (node1, node2) or (node2, node1) ordering
                    let pearsonCorr = 0;
                    let spearmanCorr = 0;

                    const pearsonItem = corrDataRaw.find(d =>
                        d.scenario === currentScenario.name &&
                        d.correlation_method === 'pearson' &&
                        ((d.node1 === orderedVars[i] && d.node2 === orderedVars[j]) ||
                         (d.node1 === orderedVars[j] && d.node2 === orderedVars[i])));

                    const spearmanItem = corrDataRaw.find(d =>
                        d.scenario === currentScenario.name &&
                        d.correlation_method === 'spearman' &&
                        ((d.node1 === orderedVars[i] && d.node2 === orderedVars[j]) ||
                         (d.node1 === orderedVars[j] && d.node2 === orderedVars[i])));

                    pearsonCorr = pearsonItem ? pearsonItem.strength : 0;
                    spearmanCorr = spearmanItem ? spearmanItem.strength : 0;

                    if (i < j) {
                        // Upper-right triangle: always show Pearson
                        zValues[i][j] = pearsonCorr;
                        textValues[i][j] = 'P: ' + pearsonCorr.toFixed(2);
                        hoverText[i][j] = orderedVars[i] + ' vs ' + orderedVars[j] + '<br>Pearson: ' + pearsonCorr.toFixed(3);
                    } else {
                        // Lower-left triangle: always show Spearman
                        zValues[i][j] = spearmanCorr;
                        textValues[i][j] = 'S: ' + spearmanCorr.toFixed(2);
                        hoverText[i][j] = orderedVars[i] + ' vs ' + orderedVars[j] + '<br>Spearman: ' + spearmanCorr.toFixed(3);
                    }
                }
            }
        }

        // Create heatmap
        const heatmapTrace = {
            z: zValues,
            x: orderedVars,
            y: orderedVars,
            type: 'heatmap',
            colorscale: [
                [0, '#ff0000'],
                [0.5, '#ffffff'],
                [1, '#0000ff']
            ],
            zmin: -1,
            zmax: 1,
            text: hoverText,
            hovertemplate: '%{text}<extra></extra>',
            colorbar: {
                title: 'Correlation',
                titleside: 'right'
            }
        };

        const heatmapLayout = {
            xaxis: { side: 'bottom', tickangle: -45 },
            yaxis: { autorange: 'reversed' },
            annotations: [],
            margin: { l: 150, r: 50, b: 150, t: 50 }
        };

        // Add text annotations
        for (let i = 0; i < n; i++) {
            for (let j = 0; j < n; j++) {
                heatmapLayout.annotations.push({
                    x: orderedVars[j],
                    y: orderedVars[i],
                    text: textValues[i][j],
                    showarrow: false,
                    font: {
                        size: 10,
                        color: Math.abs(zValues[i][j]) > 0.5 ? 'white' : 'black'
                    }
                });
            }
        }

        Plotly.newPlot('corrmatrix_econ_advanced', [heatmapTrace], heatmapLayout, {responsive: true});

        // Draw dendrogram (only if using dendrogram order and all variables are selected)
        const dendroDiv = document.getElementById('dendrogram_econ_advanced');
        const allVarsSelected = selectedVars.length === currentScenario.allLabels.length;

        if (orderMode === 'dendrogram' && allVarsSelected && currentScenario.dendroData.shapes && currentScenario.dendroData.shapes.length > 0) {
            dendroDiv.style.display = 'block';

            // Show full dendrogram with all variables
            const selectedIndices = orderedVars.map(v => currentScenario.labels.indexOf(v));
            const leafTrace = {
                x: selectedIndices,
                y: Array(n).fill(0),
                mode: 'text',
                type: 'scatter',
                text: orderedVars,
                textposition: 'bottom center',
                textfont: { size: 10 },
                hoverinfo: 'text',
                showlegend: false
            };

            const dendroLayout = {
                title: 'Hierarchical Clustering Dendrogram',
                xaxis: {
                    visible: false,
                    range: [Math.min(...selectedIndices) - 0.5, Math.max(...selectedIndices) + 0.5]
                },
                yaxis: {
                    title: 'Height',
                    range: [0, currentScenario.dendroData.maxHeight * 1.15]
                },
                margin: { l: 80, r: 50, b: 120, t: 50 },
                showlegend: false,
                shapes: currentScenario.dendroData.shapes
            };

            Plotly.newPlot('dendrogram_econ_advanced', [leafTrace], dendroLayout, {responsive: true});
        } else {
            dendroDiv.style.display = 'none';
        }
    };

    // Note: populateVarSelector() and updateChart_econ_advanced() are called
    // after data loads in the loadDataset promise above
})();
(function() {
    const scenarios = [{"name":"Spring","allLabels":["Temperature","Humidity","Pressure","Wind_Speed","Precipitation","Cloud_Cover","Solar_Radiation","UV_Index"],"labels":["Precipitation","Cloud_Cover","Pressure","Solar_Radiation","UV_Index","Humidity","Temperature","Wind_Speed"],"dendroData":{"maxHeight":2.0816426914180752,"leafLabels":["Precipitation","Cloud_Cover","Pressure","Solar_Radiation","UV_Index","Humidity","Temperature","Wind_Speed"],"leafPositions":[0,1,2,3,4,5,6,7],"shapes":[{"line":{"color":"#636efa","width":2},"x1":0.0,"y1":0.32625715820271756,"x0":0.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.32625715820271756,"x0":0.0,"type":"line","y0":0.32625715820271756},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.0,"x0":1.0,"type":"line","y0":0.32625715820271756},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.5860717024288731,"x0":3.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.5860717024288731,"x0":3.0,"type":"line","y0":0.5860717024288731},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.0,"x0":4.0,"type":"line","y0":0.5860717024288731},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.8321884063167462,"x0":2.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":3.5,"y1":0.8321884063167462,"x0":2.0,"type":"line","y0":0.8321884063167462},{"line":{"color":"#636efa","width":2},"x1":3.5,"y1":0.5860717024288731,"x0":3.5,"type":"line","y0":0.8321884063167462},{"line":{"color":"#636efa","width":2},"x1":6.0,"y1":0.939765743192351,"x0":6.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.939765743192351,"x0":6.0,"type":"line","y0":0.939765743192351},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.0,"x0":7.0,"type":"line","y0":0.939765743192351},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":1.1522963306763043,"x0":5.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":1.1522963306763043,"x0":5.0,"type":"line","y0":1.1522963306763043},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":0.939765743192351,"x0":6.5,"type":"line","y0":1.1522963306763043},{"line":{"color":"#636efa","width":2},"x1":2.75,"y1":1.4488000167286421,"x0":2.75,"type":"line","y0":0.8321884063167462},{"line":{"color":"#636efa","width":2},"x1":5.75,"y1":1.4488000167286421,"x0":2.75,"type":"line","y0":1.4488000167286421},{"line":{"color":"#636efa","width":2},"x1":5.75,"y1":1.1522963306763043,"x0":5.75,"type":"line","y0":1.4488000167286421},{"line":{"color":"#636efa","width":2},"x1":0.5,"y1":2.0816426914180752,"x0":0.5,"type":"line","y0":0.32625715820271756},{"line":{"color":"#636efa","width":2},"x1":4.25,"y1":2.0816426914180752,"x0":0.5,"type":"line","y0":2.0816426914180752},{"line":{"color":"#636efa","width":2},"x1":4.25,"y1":1.4488000167286421,"x0":4.25,"type":"line","y0":2.0816426914180752}]}},{"name":"Summer","allLabels":["Temperature","Humidity","Pressure","Wind_Speed","Precipitation","Cloud_Cover","Solar_Radiation","UV_Index"],"labels":["Precipitation","Cloud_Cover","UV_Index","Pressure","Solar_Radiation","Wind_Speed","Temperature","Humidity"],"dendroData":{"maxHeight":2.0499108044128658,"leafLabels":["Precipitation","Cloud_Cover","UV_Index","Pressure","Solar_Radiation","Wind_Speed","Temperature","Humidity"],"leafPositions":[0,1,2,3,4,5,6,7],"shapes":[{"line":{"color":"#636efa","width":2},"x1":0.0,"y1":0.38934006241631147,"x0":0.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.38934006241631147,"x0":0.0,"type":"line","y0":0.38934006241631147},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.0,"x0":1.0,"type":"line","y0":0.38934006241631147},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.6470754482228002,"x0":3.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.6470754482228002,"x0":3.0,"type":"line","y0":0.6470754482228002},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.0,"x0":4.0,"type":"line","y0":0.6470754482228002},{"line":{"color":"#636efa","width":2},"x1":6.0,"y1":0.7724405053841289,"x0":6.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.7724405053841289,"x0":6.0,"type":"line","y0":0.7724405053841289},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.0,"x0":7.0,"type":"line","y0":0.7724405053841289},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.7836148923622821,"x0":2.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":3.5,"y1":0.7836148923622821,"x0":2.0,"type":"line","y0":0.7836148923622821},{"line":{"color":"#636efa","width":2},"x1":3.5,"y1":0.6470754482228002,"x0":3.5,"type":"line","y0":0.7836148923622821},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":1.0222616721171194,"x0":5.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":1.0222616721171194,"x0":5.0,"type":"line","y0":1.0222616721171194},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":0.7724405053841289,"x0":6.5,"type":"line","y0":1.0222616721171194},{"line":{"color":"#636efa","width":2},"x1":2.75,"y1":1.5536127332478036,"x0":2.75,"type":"line","y0":0.7836148923622821},{"line":{"color":"#636efa","width":2},"x1":5.75,"y1":1.5536127332478036,"x0":2.75,"type":"line","y0":1.5536127332478036},{"line":{"color":"#636efa","width":2},"x1":5.75,"y1":1.0222616721171194,"x0":5.75,"type":"line","y0":1.5536127332478036},{"line":{"color":"#636efa","width":2},"x1":0.5,"y1":2.0499108044128658,"x0":0.5,"type":"line","y0":0.38934006241631147},{"line":{"color":"#636efa","width":2},"x1":4.25,"y1":2.0499108044128658,"x0":0.5,"type":"line","y0":2.0499108044128658},{"line":{"color":"#636efa","width":2},"x1":4.25,"y1":1.5536127332478036,"x0":4.25,"type":"line","y0":2.0499108044128658}]}},{"name":"Fall","allLabels":["Temperature","Humidity","Pressure","Wind_Speed","Precipitation","Cloud_Cover","Solar_Radiation","UV_Index"],"labels":["Wind_Speed","UV_Index","Pressure","Solar_Radiation","Precipitation","Cloud_Cover","Temperature","Humidity"],"dendroData":{"maxHeight":2.070727548915098,"leafLabels":["Wind_Speed","UV_Index","Pressure","Solar_Radiation","Precipitation","Cloud_Cover","Temperature","Humidity"],"leafPositions":[0,1,2,3,4,5,6,7],"shapes":[{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.4211090620797432,"x0":4.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.4211090620797432,"x0":4.0,"type":"line","y0":0.4211090620797432},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":0.0,"x0":5.0,"type":"line","y0":0.4211090620797432},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.6485503638515833,"x0":2.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.6485503638515833,"x0":2.0,"type":"line","y0":0.6485503638515833},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.0,"x0":3.0,"type":"line","y0":0.6485503638515833},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.8452086596835814,"x0":1.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":2.5,"y1":0.8452086596835814,"x0":1.0,"type":"line","y0":0.8452086596835814},{"line":{"color":"#636efa","width":2},"x1":2.5,"y1":0.6485503638515833,"x0":2.5,"type":"line","y0":0.8452086596835814},{"line":{"color":"#636efa","width":2},"x1":6.0,"y1":1.018887989057053,"x0":6.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":1.018887989057053,"x0":6.0,"type":"line","y0":1.018887989057053},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.0,"x0":7.0,"type":"line","y0":1.018887989057053},{"line":{"color":"#636efa","width":2},"x1":0.0,"y1":1.0481782546107,"x0":0.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":1.75,"y1":1.0481782546107,"x0":0.0,"type":"line","y0":1.0481782546107},{"line":{"color":"#636efa","width":2},"x1":1.75,"y1":0.8452086596835814,"x0":1.75,"type":"line","y0":1.0481782546107},{"line":{"color":"#636efa","width":2},"x1":4.5,"y1":1.288472461553767,"x0":4.5,"type":"line","y0":0.4211090620797432},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":1.288472461553767,"x0":4.5,"type":"line","y0":1.288472461553767},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":1.018887989057053,"x0":6.5,"type":"line","y0":1.288472461553767},{"line":{"color":"#636efa","width":2},"x1":0.875,"y1":2.070727548915098,"x0":0.875,"type":"line","y0":1.0481782546107},{"line":{"color":"#636efa","width":2},"x1":5.5,"y1":2.070727548915098,"x0":0.875,"type":"line","y0":2.070727548915098},{"line":{"color":"#636efa","width":2},"x1":5.5,"y1":1.288472461553767,"x0":5.5,"type":"line","y0":2.070727548915098}]}},{"name":"Winter","allLabels":["Temperature","Humidity","Pressure","Wind_Speed","Precipitation","Cloud_Cover","Solar_Radiation","UV_Index"],"labels":["Precipitation","Cloud_Cover","UV_Index","Pressure","Solar_Radiation","Wind_Speed","Temperature","Humidity"],"dendroData":{"maxHeight":2.000348660245722,"leafLabels":["Precipitation","Cloud_Cover","UV_Index","Pressure","Solar_Radiation","Wind_Speed","Temperature","Humidity"],"leafPositions":[0,1,2,3,4,5,6,7],"shapes":[{"line":{"color":"#636efa","width":2},"x1":0.0,"y1":0.42993231149760064,"x0":0.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.42993231149760064,"x0":0.0,"type":"line","y0":0.42993231149760064},{"line":{"color":"#636efa","width":2},"x1":1.0,"y1":0.0,"x0":1.0,"type":"line","y0":0.42993231149760064},{"line":{"color":"#636efa","width":2},"x1":3.0,"y1":0.6237813280151311,"x0":3.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.6237813280151311,"x0":3.0,"type":"line","y0":0.6237813280151311},{"line":{"color":"#636efa","width":2},"x1":4.0,"y1":0.0,"x0":4.0,"type":"line","y0":0.6237813280151311},{"line":{"color":"#636efa","width":2},"x1":2.0,"y1":0.8128399098211179,"x0":2.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":3.5,"y1":0.8128399098211179,"x0":2.0,"type":"line","y0":0.8128399098211179},{"line":{"color":"#636efa","width":2},"x1":3.5,"y1":0.6237813280151311,"x0":3.5,"type":"line","y0":0.8128399098211179},{"line":{"color":"#636efa","width":2},"x1":6.0,"y1":0.9774290032343282,"x0":6.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.9774290032343282,"x0":6.0,"type":"line","y0":0.9774290032343282},{"line":{"color":"#636efa","width":2},"x1":7.0,"y1":0.0,"x0":7.0,"type":"line","y0":0.9774290032343282},{"line":{"color":"#636efa","width":2},"x1":5.0,"y1":1.036568968830495,"x0":5.0,"type":"line","y0":0.0},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":1.036568968830495,"x0":5.0,"type":"line","y0":1.036568968830495},{"line":{"color":"#636efa","width":2},"x1":6.5,"y1":0.9774290032343282,"x0":6.5,"type":"line","y0":1.036568968830495},{"line":{"color":"#636efa","width":2},"x1":2.75,"y1":1.4186381195066713,"x0":2.75,"type":"line","y0":0.8128399098211179},{"line":{"color":"#636efa","width":2},"x1":5.75,"y1":1.4186381195066713,"x0":2.75,"type":"line","y0":1.4186381195066713},{"line":{"color":"#636efa","width":2},"x1":5.75,"y1":1.036568968830495,"x0":5.75,"type":"line","y0":1.4186381195066713},{"line":{"color":"#636efa","width":2},"x1":0.5,"y1":2.000348660245722,"x0":0.5,"type":"line","y0":0.42993231149760064},{"line":{"color":"#636efa","width":2},"x1":4.25,"y1":2.000348660245722,"x0":0.5,"type":"line","y0":2.000348660245722},{"line":{"color":"#636efa","width":2},"x1":4.25,"y1":1.4186381195066713,"x0":4.25,"type":"line","y0":2.000348660245722}]}}];
    let currentScenario = scenarios[1];
    let selectedVars = ["Temperature","Humidity","Solar_Radiation","UV_Index"];
    let manualOrder = null;
    let corrDataRaw = null;

    // Load correlation data from external dataset
    loadDataset('climate_adv_data').then(function(data) {
        corrDataRaw = data;
        populateVarSelector();
        updateChart_climate_advanced();
    }).catch(function(error) {
        console.error('Failed to load correlation data:', error);
    });

    // Initialize variable selector
    function populateVarSelector() {
        const select = document.getElementById('var_select_climate_advanced');
        select.innerHTML = '';
        currentScenario.allLabels.forEach(v => {
            const option = document.createElement('option');
            option.value = v;
            option.text = v;
            option.selected = selectedVars.includes(v);
            select.appendChild(option);
        });
    }

    // Initialize sortable list
    function initializeSortable() {
        const container = document.getElementById('sortable_vars_climate_advanced');
        container.innerHTML = '';
        // Show all variables in the manual order list
        const orderToUse = manualOrder || currentScenario.allLabels;
        orderToUse.forEach(v => {
            const div = document.createElement('div');
            div.className = 'sortable-item';
            div.textContent = v;
            div.setAttribute('data-var', v);
            container.appendChild(div);
        });

        if (typeof Sortable !== 'undefined') {
            Sortable.create(container, {
                animation: 150,
                onEnd: function() {
                    manualOrder = Array.from(container.children).map(el => el.getAttribute('data-var'));
                    updateChart_climate_advanced();
                }
            });
        }
    }

    window.updateChart_climate_advanced = function() {
        if (!corrDataRaw) {
            console.warn('Correlation data not loaded yet');
            return;
        }

        // Check if scenario changed
        const scenarioSelect = document.getElementById('scenario_select_climate_advanced');
        let scenarioChanged = false;
        if (scenarioSelect) {
            const scenarioName = scenarioSelect.value;
            const newScenario = scenarios.find(s => s.name === scenarioName);
            if (newScenario !== currentScenario) {
                scenarioChanged = true;
                // Remember currently selected variables
                const varSelect = document.getElementById('var_select_climate_advanced');
                const previouslySelected = Array.from(varSelect.selectedOptions).map(opt => opt.value);

                // Update to new scenario
                currentScenario = newScenario;

                // Repopulate variable selector with new scenario's variables
                populateVarSelector();

                // Try to keep the same variables selected if they exist in new scenario
                const newVarSelect = document.getElementById('var_select_climate_advanced');
                const availableVars = Array.from(newVarSelect.options).map(opt => opt.value);
                const varsToSelect = previouslySelected.filter(v => availableVars.includes(v));

                // If none of the previous variables exist in new scenario, select all
                if (varsToSelect.length < 2) {
                    selectedVars = currentScenario.allLabels;
                    Array.from(newVarSelect.options).forEach(opt => opt.selected = true);
                } else {
                    selectedVars = varsToSelect;
                    Array.from(newVarSelect.options).forEach(opt => {
                        opt.selected = varsToSelect.includes(opt.value);
                    });
                }
            }
        }

        // Update selected variables (if scenario didn't change)
        if (!scenarioChanged) {
            const varSelect = document.getElementById('var_select_climate_advanced');
            selectedVars = Array.from(varSelect.selectedOptions).map(opt => opt.value);
        }

        if (selectedVars.length < 2) {
            console.warn('Select at least 2 variables');
            return;
        }

        // Check order mode
        const orderModeSelect = document.getElementById('order_mode_climate_advanced');
        const orderMode = orderModeSelect ? orderModeSelect.value : 'dendrogram';

        // Show/hide manual ordering UI
        const manualDiv = document.getElementById('manual_order_climate_advanced');
        if (manualDiv) {
            manualDiv.style.display = (orderMode === 'manual') ? 'block' : 'none';
        }

        if (orderMode === 'manual') {
            initializeSortable();
        }

        // Determine variable order
        let orderedVars;
        if (orderMode === 'manual' && manualOrder) {
            // Use manual order, filtered to selected vars
            orderedVars = manualOrder.filter(v => selectedVars.includes(v));
        } else if (orderMode === 'alphabetical') {
            // Use alphabetical order
            orderedVars = selectedVars.slice().sort();
        } else {
            // Use dendrogram order (default)
            orderedVars = currentScenario.labels.filter(v => selectedVars.includes(v));
        }

        const n = orderedVars.length;

        // Build correlation matrix for selected variables
        const zValues = [];
        const textValues = [];
        const hoverText = [];

        for (let i = 0; i < n; i++) {
            zValues[i] = [];
            textValues[i] = [];
            hoverText[i] = [];
            for (let j = 0; j < n; j++) {
                if (i === j) {
                    // Diagonal
                    zValues[i][j] = 1.0;
                    textValues[i][j] = '1.00';
                    hoverText[i][j] = orderedVars[i];
                } else {
                    // Find correlation values from external data
                    // Data can have either (node1, node2) or (node2, node1) ordering
                    let pearsonCorr = 0;
                    let spearmanCorr = 0;

                    const pearsonItem = corrDataRaw.find(d =>
                        d.scenario === currentScenario.name &&
                        d.correlation_method === 'pearson' &&
                        ((d.node1 === orderedVars[i] && d.node2 === orderedVars[j]) ||
                         (d.node1 === orderedVars[j] && d.node2 === orderedVars[i])));

                    const spearmanItem = corrDataRaw.find(d =>
                        d.scenario === currentScenario.name &&
                        d.correlation_method === 'spearman' &&
                        ((d.node1 === orderedVars[i] && d.node2 === orderedVars[j]) ||
                         (d.node1 === orderedVars[j] && d.node2 === orderedVars[i])));

                    pearsonCorr = pearsonItem ? pearsonItem.strength : 0;
                    spearmanCorr = spearmanItem ? spearmanItem.strength : 0;

                    if (i < j) {
                        // Upper-right triangle: always show Pearson
                        zValues[i][j] = pearsonCorr;
                        textValues[i][j] = 'P: ' + pearsonCorr.toFixed(2);
                        hoverText[i][j] = orderedVars[i] + ' vs ' + orderedVars[j] + '<br>Pearson: ' + pearsonCorr.toFixed(3);
                    } else {
                        // Lower-left triangle: always show Spearman
                        zValues[i][j] = spearmanCorr;
                        textValues[i][j] = 'S: ' + spearmanCorr.toFixed(2);
                        hoverText[i][j] = orderedVars[i] + ' vs ' + orderedVars[j] + '<br>Spearman: ' + spearmanCorr.toFixed(3);
                    }
                }
            }
        }

        // Create heatmap
        const heatmapTrace = {
            z: zValues,
            x: orderedVars,
            y: orderedVars,
            type: 'heatmap',
            colorscale: [
                [0, '#ff0000'],
                [0.5, '#ffffff'],
                [1, '#0000ff']
            ],
            zmin: -1,
            zmax: 1,
            text: hoverText,
            hovertemplate: '%{text}<extra></extra>',
            colorbar: {
                title: 'Correlation',
                titleside: 'right'
            }
        };

        const heatmapLayout = {
            xaxis: { side: 'bottom', tickangle: -45 },
            yaxis: { autorange: 'reversed' },
            annotations: [],
            margin: { l: 150, r: 50, b: 150, t: 50 }
        };

        // Add text annotations
        for (let i = 0; i < n; i++) {
            for (let j = 0; j < n; j++) {
                heatmapLayout.annotations.push({
                    x: orderedVars[j],
                    y: orderedVars[i],
                    text: textValues[i][j],
                    showarrow: false,
                    font: {
                        size: 10,
                        color: Math.abs(zValues[i][j]) > 0.5 ? 'white' : 'black'
                    }
                });
            }
        }

        Plotly.newPlot('corrmatrix_climate_advanced', [heatmapTrace], heatmapLayout, {responsive: true});

        // Draw dendrogram (only if using dendrogram order and all variables are selected)
        const dendroDiv = document.getElementById('dendrogram_climate_advanced');
        const allVarsSelected = selectedVars.length === currentScenario.allLabels.length;

        if (orderMode === 'dendrogram' && allVarsSelected && currentScenario.dendroData.shapes && currentScenario.dendroData.shapes.length > 0) {
            dendroDiv.style.display = 'block';

            // Show full dendrogram with all variables
            const selectedIndices = orderedVars.map(v => currentScenario.labels.indexOf(v));
            const leafTrace = {
                x: selectedIndices,
                y: Array(n).fill(0),
                mode: 'text',
                type: 'scatter',
                text: orderedVars,
                textposition: 'bottom center',
                textfont: { size: 10 },
                hoverinfo: 'text',
                showlegend: false
            };

            const dendroLayout = {
                title: 'Hierarchical Clustering Dendrogram',
                xaxis: {
                    visible: false,
                    range: [Math.min(...selectedIndices) - 0.5, Math.max(...selectedIndices) + 0.5]
                },
                yaxis: {
                    title: 'Height',
                    range: [0, currentScenario.dendroData.maxHeight * 1.15]
                },
                margin: { l: 80, r: 50, b: 120, t: 50 },
                showlegend: false,
                shapes: currentScenario.dendroData.shapes
            };

            Plotly.newPlot('dendrogram_climate_advanced', [leafTrace], dendroLayout, {responsive: true});
        } else {
            dendroDiv.style.display = 'none';
        }
    };

    // Note: populateVarSelector() and updateChart_climate_advanced() are called
    // after data loads in the loadDataset promise above
})();


});
</script>

<!-- DATASETS -->

<script type="text/plain" id="financial_corr_data" data-format="csv_embedded" data-src="">
asset1,asset2,correlation,scenario,correlation_method
price_to_book,price_to_book,1.0,default,pearson
price_to_book,price_to_book,1.0,default,spearman
price_to_book,profit_margin,0.6661511402364084,default,pearson
price_to_book,profit_margin,0.6625020634700838,default,spearman
price_to_book,roa,0.7144699190368703,default,pearson
price_to_book,roa,0.7180399581189179,default,spearman
price_to_book,roe,0.7577136645267524,default,pearson
price_to_book,roe,0.7733093309330933,default,spearman
price_to_book,revenue,-0.0007684997491234257,default,pearson
price_to_book,revenue,-0.01488753341600885,default,spearman
price_to_book,profit,0.4125614626307311,default,pearson
price_to_book,profit,0.38287428742874285,default,spearman
price_to_book,pe_ratio,0.4669927743015946,default,pearson
price_to_book,pe_ratio,0.5175196987882733,default,spearman
price_to_book,asset_turnover,-0.0151267110993677,default,pearson
price_to_book,asset_turnover,0.01099405593007371,default,spearman
price_to_book,debt_to_equity,-0.008624421396943477,default,pearson
price_to_book,debt_to_equity,0.008575475003932131,default,spearman
price_to_book,inventory_turnover,0.004717781671821615,default,pearson
price_to_book,inventory_turnover,-0.049794000849301266,default,spearman
profit_margin,price_to_book,0.6661511402364084,default,pearson
profit_margin,price_to_book,0.6625020634700838,default,spearman
profit_margin,profit_margin,1.0,default,pearson
profit_margin,profit_margin,1.0,default,spearman
profit_margin,roa,0.8546688664568541,default,pearson
profit_margin,roa,0.860413341933603,default,spearman
profit_margin,roe,0.7923273195506495,default,pearson
profit_margin,roe,0.8421621143593949,default,spearman
profit_margin,revenue,-0.09718559178713537,default,pearson
profit_margin,revenue,-0.09574116977758329,default,spearman
profit_margin,profit,0.5141382542398262,default,pearson
profit_margin,profit,0.4749268648763403,default,spearman
profit_margin,pe_ratio,0.0031929279153356054,default,pearson
profit_margin,pe_ratio,0.012074402806647632,default,spearman
profit_margin,asset_turnover,-0.08660605414722833,default,pearson
profit_margin,asset_turnover,-0.054564659049036575,default,spearman
profit_margin,debt_to_equity,0.06682947254966173,default,pearson
profit_margin,debt_to_equity,0.04948373798918439,default,spearman
profit_margin,inventory_turnover,-0.006928468225149619,default,pearson
profit_margin,inventory_turnover,-0.010893115481237472,default,spearman
roa,price_to_book,0.7144699190368703,default,pearson
roa,price_to_book,0.7180399581189179,default,spearman
roa,profit_margin,0.8546688664568541,default,pearson
roa,profit_margin,0.860413341933603,default,spearman
roa,roa,1.0,default,pearson
roa,roa,1.0,default,spearman
roa,roe,0.917544875888257,default,pearson
roa,roe,0.9468855292137706,default,spearman
roa,revenue,-0.08208254185486331,default,pearson
roa,revenue,-0.07643010159076861,default,spearman
roa,profit,0.4380372650279764,default,pearson
roa,profit,0.4338686884768657,default,spearman
roa,pe_ratio,-0.07210269499310294,default,pearson
roa,pe_ratio,-0.06178570043533327,default,spearman
roa,asset_turnover,-0.04305682078644137,default,pearson
roa,asset_turnover,-0.006928316404564613,default,spearman
roa,debt_to_equity,0.04007247664480117,default,pearson
roa,debt_to_equity,0.048710524457755804,default,spearman
roa,inventory_turnover,0.056229597238169046,default,pearson
roa,inventory_turnover,0.05668983285914997,default,spearman
roe,price_to_book,0.7577136645267524,default,pearson
roe,price_to_book,0.7733093309330933,default,spearman
roe,profit_margin,0.7923273195506495,default,pearson
roe,profit_margin,0.8421621143593949,default,spearman
roe,roa,0.917544875888257,default,pearson
roe,roa,0.9468855292137706,default,spearman
roe,roe,1.0,default,pearson
roe,roe,1.0,default,spearman
roe,revenue,-0.0997501266830351,default,pearson
roe,revenue,-0.09828412326513863,default,spearman
roe,profit,0.38957372296074716,default,pearson
roe,profit,0.41176117611761176,default,spearman
roe,pe_ratio,-0.06831970571601506,default,pearson
roe,pe_ratio,-0.036965692770590954,default,spearman
roe,asset_turnover,-0.050226532099913304,default,pearson
roe,asset_turnover,-0.010892036852119969,default,spearman
roe,debt_to_equity,0.007331899928226801,default,pearson
roe,debt_to_equity,0.04379553294520412,default,spearman
roe,inventory_turnover,0.020749139592516095,default,pearson
roe,inventory_turnover,0.024503905684909854,default,spearman
revenue,price_to_book,-0.0007684997491234257,default,pearson
revenue,price_to_book,-0.01488753341600885,default,spearman
revenue,profit_margin,-0.09718559178713537,default,pearson
revenue,profit_margin,-0.09574116977758329,default,spearman
revenue,roa,-0.08208254185486331,default,pearson
revenue,roa,-0.07643010159076861,default,spearman
revenue,roe,-0.0997501266830351,default,pearson
revenue,roe,-0.09828412326513863,default,spearman
revenue,revenue,1.0,default,pearson
revenue,revenue,1.0,default,spearman
revenue,profit,0.7282623929445865,default,pearson
revenue,profit,0.7555798247253472,default,spearman
revenue,pe_ratio,0.0013945099383474433,default,pearson
revenue,pe_ratio,-0.006493019412493259,default,spearman
revenue,asset_turnover,0.13216505111672594,default,pearson
revenue,asset_turnover,0.12380952424648985,default,spearman
revenue,debt_to_equity,0.011735206571527147,default,pearson
revenue,debt_to_equity,0.02108769039602734,default,spearman
revenue,inventory_turnover,-0.10798519256257348,default,pearson
revenue,inventory_turnover,-0.09877810279787734,default,spearman
profit,price_to_book,0.4125614626307311,default,pearson
profit,price_to_book,0.38287428742874285,default,spearman
profit,profit_margin,0.5141382542398262,default,pearson
profit,profit_margin,0.4749268648763403,default,spearman
profit,roa,0.4380372650279764,default,pearson
profit,roa,0.4338686884768657,default,spearman
profit,roe,0.38957372296074716,default,pearson
profit,roe,0.41176117611761176,default,spearman
profit,revenue,0.7282623929445865,default,pearson
profit,revenue,0.7555798247253472,default,spearman
profit,profit,1.0,default,pearson
profit,profit,1.0,default,spearman
profit,pe_ratio,0.03447998081105492,default,pearson
profit,pe_ratio,0.013904141258029096,default,spearman
profit,asset_turnover,0.07228385783495163,default,pearson
profit,asset_turnover,0.045134440311181426,default,spearman
profit,debt_to_equity,0.058409184038409924,default,pearson
profit,debt_to_equity,0.020031445460549652,default,spearman
profit,inventory_turnover,-0.07553640227440359,default,pearson
profit,inventory_turnover,-0.08387621500178795,default,spearman
pe_ratio,price_to_book,0.4669927743015946,default,pearson
pe_ratio,price_to_book,0.5175196987882733,default,spearman
pe_ratio,profit_margin,0.0031929279153356054,default,pearson
pe_ratio,profit_margin,0.012074402806647632,default,spearman
pe_ratio,roa,-0.07210269499310294,default,pearson
pe_ratio,roa,-0.06178570043533327,default,spearman
pe_ratio,roe,-0.06831970571601506,default,pearson
pe_ratio,roe,-0.036965692770590954,default,spearman
pe_ratio,revenue,0.0013945099383474433,default,pearson
pe_ratio,revenue,-0.006493019412493259,default,spearman
pe_ratio,profit,0.03447998081105492,default,pearson
pe_ratio,profit,0.013904141258029096,default,spearman
pe_ratio,pe_ratio,1.0,default,pearson
pe_ratio,pe_ratio,1.0,default,spearman
pe_ratio,asset_turnover,0.06443756015323122,default,pearson
pe_ratio,asset_turnover,0.04456674060875915,default,spearman
pe_ratio,debt_to_equity,0.025917068070692193,default,pearson
pe_ratio,debt_to_equity,0.03353557904629846,default,spearman
pe_ratio,inventory_turnover,-0.011469033170910246,default,pearson
pe_ratio,inventory_turnover,-0.02429216628101373,default,spearman
asset_turnover,price_to_book,-0.0151267110993677,default,pearson
asset_turnover,price_to_book,0.01099405593007371,default,spearman
asset_turnover,profit_margin,-0.08660605414722833,default,pearson
asset_turnover,profit_margin,-0.054564659049036575,default,spearman
asset_turnover,roa,-0.04305682078644137,default,pearson
asset_turnover,roa,-0.006928316404564613,default,spearman
asset_turnover,roe,-0.050226532099913304,default,pearson
asset_turnover,roe,-0.010892036852119969,default,spearman
asset_turnover,revenue,0.13216505111672594,default,pearson
asset_turnover,revenue,0.12380952424648985,default,spearman
asset_turnover,profit,0.07228385783495163,default,pearson
asset_turnover,profit,0.045134440311181426,default,spearman
asset_turnover,pe_ratio,0.06443756015323122,default,pearson
asset_turnover,pe_ratio,0.04456674060875915,default,spearman
asset_turnover,asset_turnover,1.0,default,pearson
asset_turnover,asset_turnover,1.0,default,spearman
asset_turnover,debt_to_equity,0.13809451635474748,default,pearson
asset_turnover,debt_to_equity,0.06275225284054717,default,spearman
asset_turnover,inventory_turnover,0.18998891073760957,default,pearson
asset_turnover,inventory_turnover,0.14009795233269495,default,spearman
debt_to_equity,price_to_book,-0.008624421396943477,default,pearson
debt_to_equity,price_to_book,0.008575475003932131,default,spearman
debt_to_equity,profit_margin,0.06682947254966173,default,pearson
debt_to_equity,profit_margin,0.04948373798918439,default,spearman
debt_to_equity,roa,0.04007247664480117,default,pearson
debt_to_equity,roa,0.048710524457755804,default,spearman
debt_to_equity,roe,0.007331899928226801,default,pearson
debt_to_equity,roe,0.04379553294520412,default,spearman
debt_to_equity,revenue,0.011735206571527147,default,pearson
debt_to_equity,revenue,0.02108769039602734,default,spearman
debt_to_equity,profit,0.058409184038409924,default,pearson
debt_to_equity,profit,0.020031445460549652,default,spearman
debt_to_equity,pe_ratio,0.025917068070692193,default,pearson
debt_to_equity,pe_ratio,0.03353557904629846,default,spearman
debt_to_equity,asset_turnover,0.13809451635474748,default,pearson
debt_to_equity,asset_turnover,0.06275225284054717,default,spearman
debt_to_equity,debt_to_equity,1.0,default,pearson
debt_to_equity,debt_to_equity,1.0,default,spearman
debt_to_equity,inventory_turnover,0.2869172667171785,default,pearson
debt_to_equity,inventory_turnover,0.30069111703565143,default,spearman
inventory_turnover,price_to_book,0.004717781671821615,default,pearson
inventory_turnover,price_to_book,-0.049794000849301266,default,spearman
inventory_turnover,profit_margin,-0.006928468225149619,default,pearson
inventory_turnover,profit_margin,-0.010893115481237472,default,spearman
inventory_turnover,roa,0.056229597238169046,default,pearson
inventory_turnover,roa,0.05668983285914997,default,spearman
inventory_turnover,roe,0.020749139592516095,default,pearson
inventory_turnover,roe,0.024503905684909854,default,spearman
inventory_turnover,revenue,-0.10798519256257348,default,pearson
inventory_turnover,revenue,-0.09877810279787734,default,spearman
inventory_turnover,profit,-0.07553640227440359,default,pearson
inventory_turnover,profit,-0.08387621500178795,default,spearman
inventory_turnover,pe_ratio,-0.011469033170910246,default,pearson
inventory_turnover,pe_ratio,-0.02429216628101373,default,spearman
inventory_turnover,asset_turnover,0.18998891073760957,default,pearson
inventory_turnover,asset_turnover,0.14009795233269495,default,spearman
inventory_turnover,debt_to_equity,0.2869172667171785,default,pearson
inventory_turnover,debt_to_equity,0.30069111703565143,default,spearman
inventory_turnover,inventory_turnover,1.0,default,pearson
inventory_turnover,inventory_turnover,1.0,default,spearman

</script><script type="text/plain" id="patient_corr_data" data-format="csv_embedded" data-src="">
asset1,asset2,correlation,scenario,correlation_method
glucose,glucose,1.0,default,pearson
glucose,glucose,1.0,default,spearman
glucose,hba1c,0.9821323167737177,default,pearson
glucose,hba1c,0.9895916397017288,default,spearman
glucose,cardiovascular_risk,0.4581997143204897,default,pearson
glucose,cardiovascular_risk,0.45443872719245526,default,spearman
glucose,hdl,0.08696236160543588,default,pearson
glucose,hdl,0.09985023619992421,default,spearman
glucose,cholesterol_total,0.07609173239973821,default,pearson
glucose,cholesterol_total,0.07547684331497666,default,spearman
glucose,ldl,0.11946491133194012,default,pearson
glucose,ldl,0.13082005760403914,default,spearman
glucose,systolic_bp,-0.02607799345418928,default,pearson
glucose,systolic_bp,-0.006866436119338504,default,spearman
glucose,diastolic_bp,-0.07553417418654,default,pearson
glucose,diastolic_bp,-0.06341323403854092,default,spearman
glucose,heart_rate,-0.13080550279902745,default,pearson
glucose,heart_rate,-0.1386464326624421,default,spearman
glucose,triglycerides,-0.0747839660052218,default,pearson
glucose,triglycerides,-0.06425982192083217,default,spearman
glucose,bmi,-0.09660834795719273,default,pearson
glucose,bmi,-0.11662025558774107,default,spearman
hba1c,glucose,0.9821323167737177,default,pearson
hba1c,glucose,0.9895916397017288,default,spearman
hba1c,hba1c,1.0,default,pearson
hba1c,hba1c,1.0,default,spearman
hba1c,cardiovascular_risk,0.45210926827249526,default,pearson
hba1c,cardiovascular_risk,0.44907149482638836,default,spearman
hba1c,hdl,0.10354684464844391,default,pearson
hba1c,hdl,0.10549982046590144,default,spearman
hba1c,cholesterol_total,0.08629368250795531,default,pearson
hba1c,cholesterol_total,0.08168652536910531,default,spearman
hba1c,ldl,0.13044962393279624,default,pearson
hba1c,ldl,0.13645155581958976,default,spearman
hba1c,systolic_bp,-0.04096030819698173,default,pearson
hba1c,systolic_bp,-0.012601942172756607,default,spearman
hba1c,diastolic_bp,-0.0748621122399873,default,pearson
hba1c,diastolic_bp,-0.06103220934482335,default,spearman
hba1c,heart_rate,-0.1442284830688832,default,pearson
hba1c,heart_rate,-0.15360122469817253,default,spearman
hba1c,triglycerides,-0.07672189318503733,default,pearson
hba1c,triglycerides,-0.06484077881434624,default,spearman
hba1c,bmi,-0.08887711763306776,default,pearson
hba1c,bmi,-0.11118174815732297,default,spearman
cardiovascular_risk,glucose,0.4581997143204897,default,pearson
cardiovascular_risk,glucose,0.45443872719245526,default,spearman
cardiovascular_risk,hba1c,0.45210926827249526,default,pearson
cardiovascular_risk,hba1c,0.44907149482638836,default,spearman
cardiovascular_risk,cardiovascular_risk,1.0,default,pearson
cardiovascular_risk,cardiovascular_risk,1.0,default,spearman
cardiovascular_risk,hdl,0.2978345712291631,default,pearson
cardiovascular_risk,hdl,0.28560846164100556,default,spearman
cardiovascular_risk,cholesterol_total,0.4295315991266672,default,pearson
cardiovascular_risk,cholesterol_total,0.426476604579989,default,spearman
cardiovascular_risk,ldl,0.49175794151441743,default,pearson
cardiovascular_risk,ldl,0.4980181970923712,default,spearman
cardiovascular_risk,systolic_bp,0.3134265867258845,default,pearson
cardiovascular_risk,systolic_bp,0.28356785852669925,default,spearman
cardiovascular_risk,diastolic_bp,0.2978286527381148,default,pearson
cardiovascular_risk,diastolic_bp,0.2813360858710943,default,spearman
cardiovascular_risk,heart_rate,-0.03203552194393171,default,pearson
cardiovascular_risk,heart_rate,-0.03585096005614263,default,spearman
cardiovascular_risk,triglycerides,-0.04354153826398101,default,pearson
cardiovascular_risk,triglycerides,-0.03540026955564472,default,spearman
cardiovascular_risk,bmi,0.2263987824772259,default,pearson
cardiovascular_risk,bmi,0.2197983890286374,default,spearman
hdl,glucose,0.08696236160543588,default,pearson
hdl,glucose,0.09985023619992421,default,spearman
hdl,hba1c,0.10354684464844391,default,pearson
hdl,hba1c,0.10549982046590144,default,spearman
hdl,cardiovascular_risk,0.2978345712291631,default,pearson
hdl,cardiovascular_risk,0.28560846164100556,default,spearman
hdl,hdl,1.0,default,pearson
hdl,hdl,1.0,default,spearman
hdl,cholesterol_total,0.6640148702858163,default,pearson
hdl,cholesterol_total,0.6520129091238603,default,spearman
hdl,ldl,0.6238139048750009,default,pearson
hdl,ldl,0.6021439109839107,default,spearman
hdl,systolic_bp,0.0922952301854813,default,pearson
hdl,systolic_bp,0.09320331009808552,default,spearman
hdl,diastolic_bp,0.04586854188252165,default,pearson
hdl,diastolic_bp,0.06573524207043702,default,spearman
hdl,heart_rate,0.021816924810687758,default,pearson
hdl,heart_rate,-0.006100755324199376,default,spearman
hdl,triglycerides,-0.19409767608409392,default,pearson
hdl,triglycerides,-0.18474973597672692,default,spearman
hdl,bmi,-0.03797199213610897,default,pearson
hdl,bmi,-0.029818540436314312,default,spearman
cholesterol_total,glucose,0.07609173239973821,default,pearson
cholesterol_total,glucose,0.07547684331497666,default,spearman
cholesterol_total,hba1c,0.08629368250795531,default,pearson
cholesterol_total,hba1c,0.08168652536910531,default,spearman
cholesterol_total,cardiovascular_risk,0.4295315991266672,default,pearson
cholesterol_total,cardiovascular_risk,0.426476604579989,default,spearman
cholesterol_total,hdl,0.6640148702858163,default,pearson
cholesterol_total,hdl,0.6520129091238603,default,spearman
cholesterol_total,cholesterol_total,1.0,default,pearson
cholesterol_total,cholesterol_total,1.0,default,spearman
cholesterol_total,ldl,0.8598430969826488,default,pearson
cholesterol_total,ldl,0.8663136438694536,default,spearman
cholesterol_total,systolic_bp,0.09116677428998059,default,pearson
cholesterol_total,systolic_bp,0.08227583875425894,default,spearman
cholesterol_total,diastolic_bp,0.05724298083961712,default,pearson
cholesterol_total,diastolic_bp,0.06406289729263041,default,spearman
cholesterol_total,heart_rate,-0.08174574881586451,default,pearson
cholesterol_total,heart_rate,-0.10180382336025096,default,spearman
cholesterol_total,triglycerides,0.36042486686830855,default,pearson
cholesterol_total,triglycerides,0.33531247927203744,default,spearman
cholesterol_total,bmi,0.06902250903720172,default,pearson
cholesterol_total,bmi,0.06759528394389606,default,spearman
ldl,glucose,0.11946491133194012,default,pearson
ldl,glucose,0.13082005760403914,default,spearman
ldl,hba1c,0.13044962393279624,default,pearson
ldl,hba1c,0.13645155581958976,default,spearman
ldl,cardiovascular_risk,0.49175794151441743,default,pearson
ldl,cardiovascular_risk,0.4980181970923712,default,spearman
ldl,hdl,0.6238139048750009,default,pearson
ldl,hdl,0.6021439109839107,default,spearman
ldl,cholesterol_total,0.8598430969826488,default,pearson
ldl,cholesterol_total,0.8663136438694536,default,spearman
ldl,ldl,1.0,default,pearson
ldl,ldl,1.0,default,spearman
ldl,systolic_bp,0.10275996039381681,default,pearson
ldl,systolic_bp,0.11388283745794074,default,spearman
ldl,diastolic_bp,0.07908148686027949,default,pearson
ldl,diastolic_bp,0.08488750017168128,default,spearman
ldl,heart_rate,-0.11782505623389404,default,pearson
ldl,heart_rate,-0.13537216207493308,default,spearman
ldl,triglycerides,-0.06353542801303395,default,pearson
ldl,triglycerides,-0.055229156088971935,default,spearman
ldl,bmi,0.01051338430735566,default,pearson
ldl,bmi,0.020751975144850197,default,spearman
systolic_bp,glucose,-0.02607799345418928,default,pearson
systolic_bp,glucose,-0.006866436119338504,default,spearman
systolic_bp,hba1c,-0.04096030819698173,default,pearson
systolic_bp,hba1c,-0.012601942172756607,default,spearman
systolic_bp,cardiovascular_risk,0.3134265867258845,default,pearson
systolic_bp,cardiovascular_risk,0.28356785852669925,default,spearman
systolic_bp,hdl,0.0922952301854813,default,pearson
systolic_bp,hdl,0.09320331009808552,default,spearman
systolic_bp,cholesterol_total,0.09116677428998059,default,pearson
systolic_bp,cholesterol_total,0.08227583875425894,default,spearman
systolic_bp,ldl,0.10275996039381681,default,pearson
systolic_bp,ldl,0.11388283745794074,default,spearman
systolic_bp,systolic_bp,1.0,default,pearson
systolic_bp,systolic_bp,1.0,default,spearman
systolic_bp,diastolic_bp,0.7271664517765722,default,pearson
systolic_bp,diastolic_bp,0.723693444370059,default,spearman
systolic_bp,heart_rate,-0.03520015935281128,default,pearson
systolic_bp,heart_rate,-0.038792003014271624,default,spearman
systolic_bp,triglycerides,-0.010040992795285105,default,pearson
systolic_bp,triglycerides,-0.02296734366586754,default,spearman
systolic_bp,bmi,0.06551214027934088,default,pearson
systolic_bp,bmi,0.06449797734709165,default,spearman
diastolic_bp,glucose,-0.07553417418654,default,pearson
diastolic_bp,glucose,-0.06341323403854092,default,spearman
diastolic_bp,hba1c,-0.0748621122399873,default,pearson
diastolic_bp,hba1c,-0.06103220934482335,default,spearman
diastolic_bp,cardiovascular_risk,0.2978286527381148,default,pearson
diastolic_bp,cardiovascular_risk,0.2813360858710943,default,spearman
diastolic_bp,hdl,0.04586854188252165,default,pearson
diastolic_bp,hdl,0.06573524207043702,default,spearman
diastolic_bp,cholesterol_total,0.05724298083961712,default,pearson
diastolic_bp,cholesterol_total,0.06406289729263041,default,spearman
diastolic_bp,ldl,0.07908148686027949,default,pearson
diastolic_bp,ldl,0.08488750017168128,default,spearman
diastolic_bp,systolic_bp,0.7271664517765722,default,pearson
diastolic_bp,systolic_bp,0.723693444370059,default,spearman
diastolic_bp,diastolic_bp,1.0,default,pearson
diastolic_bp,diastolic_bp,1.0,default,spearman
diastolic_bp,heart_rate,-0.043856918941407703,default,pearson
diastolic_bp,heart_rate,-0.035708332729157556,default,spearman
diastolic_bp,triglycerides,-0.06527858273144702,default,pearson
diastolic_bp,triglycerides,-0.051956950840529474,default,spearman
diastolic_bp,bmi,0.07934580983486744,default,pearson
diastolic_bp,bmi,0.0833417489839532,default,spearman
heart_rate,glucose,-0.13080550279902745,default,pearson
heart_rate,glucose,-0.1386464326624421,default,spearman
heart_rate,hba1c,-0.1442284830688832,default,pearson
heart_rate,hba1c,-0.15360122469817253,default,spearman
heart_rate,cardiovascular_risk,-0.03203552194393171,default,pearson
heart_rate,cardiovascular_risk,-0.03585096005614263,default,spearman
heart_rate,hdl,0.021816924810687758,default,pearson
heart_rate,hdl,-0.006100755324199376,default,spearman
heart_rate,cholesterol_total,-0.08174574881586451,default,pearson
heart_rate,cholesterol_total,-0.10180382336025096,default,spearman
heart_rate,ldl,-0.11782505623389404,default,pearson
heart_rate,ldl,-0.13537216207493308,default,spearman
heart_rate,systolic_bp,-0.03520015935281128,default,pearson
heart_rate,systolic_bp,-0.038792003014271624,default,spearman
heart_rate,diastolic_bp,-0.043856918941407703,default,pearson
heart_rate,diastolic_bp,-0.035708332729157556,default,spearman
heart_rate,heart_rate,1.0,default,pearson
heart_rate,heart_rate,1.0,default,spearman
heart_rate,triglycerides,-0.07809201453871832,default,pearson
heart_rate,triglycerides,-0.06381359743372478,default,spearman
heart_rate,bmi,0.13219691791578436,default,pearson
heart_rate,bmi,0.11918321430594661,default,spearman
triglycerides,glucose,-0.0747839660052218,default,pearson
triglycerides,glucose,-0.06425982192083217,default,spearman
triglycerides,hba1c,-0.07672189318503733,default,pearson
triglycerides,hba1c,-0.06484077881434624,default,spearman
triglycerides,cardiovascular_risk,-0.04354153826398101,default,pearson
triglycerides,cardiovascular_risk,-0.03540026955564472,default,spearman
triglycerides,hdl,-0.19409767608409392,default,pearson
triglycerides,hdl,-0.18474973597672692,default,spearman
triglycerides,cholesterol_total,0.36042486686830855,default,pearson
triglycerides,cholesterol_total,0.33531247927203744,default,spearman
triglycerides,ldl,-0.06353542801303395,default,pearson
triglycerides,ldl,-0.055229156088971935,default,spearman
triglycerides,systolic_bp,-0.010040992795285105,default,pearson
triglycerides,systolic_bp,-0.02296734366586754,default,spearman
triglycerides,diastolic_bp,-0.06527858273144702,default,pearson
triglycerides,diastolic_bp,-0.051956950840529474,default,spearman
triglycerides,heart_rate,-0.07809201453871832,default,pearson
triglycerides,heart_rate,-0.06381359743372478,default,spearman
triglycerides,triglycerides,1.0,default,pearson
triglycerides,triglycerides,1.0,default,spearman
triglycerides,bmi,0.15510266746883758,default,pearson
triglycerides,bmi,0.1522244914621984,default,spearman
bmi,glucose,-0.09660834795719273,default,pearson
bmi,glucose,-0.11662025558774107,default,spearman
bmi,hba1c,-0.08887711763306776,default,pearson
bmi,hba1c,-0.11118174815732297,default,spearman
bmi,cardiovascular_risk,0.2263987824772259,default,pearson
bmi,cardiovascular_risk,0.2197983890286374,default,spearman
bmi,hdl,-0.03797199213610897,default,pearson
bmi,hdl,-0.029818540436314312,default,spearman
bmi,cholesterol_total,0.06902250903720172,default,pearson
bmi,cholesterol_total,0.06759528394389606,default,spearman
bmi,ldl,0.01051338430735566,default,pearson
bmi,ldl,0.020751975144850197,default,spearman
bmi,systolic_bp,0.06551214027934088,default,pearson
bmi,systolic_bp,0.06449797734709165,default,spearman
bmi,diastolic_bp,0.07934580983486744,default,pearson
bmi,diastolic_bp,0.0833417489839532,default,spearman
bmi,heart_rate,0.13219691791578436,default,pearson
bmi,heart_rate,0.11918321430594661,default,spearman
bmi,triglycerides,0.15510266746883758,default,pearson
bmi,triglycerides,0.1522244914621984,default,spearman
bmi,bmi,1.0,default,pearson
bmi,bmi,1.0,default,spearman

</script><script type="text/plain" id="econ_adv_data" data-format="csv_embedded" data-src="">
node1,node2,strength,scenario,correlation_method
GDP_Growth,Unemployment,-0.5999497258645649,North America,pearson
GDP_Growth,Unemployment,-0.6081255642752968,North America,spearman
GDP_Growth,Inflation,0.5552807315368175,North America,pearson
GDP_Growth,Inflation,0.5848322800194458,North America,spearman
GDP_Growth,Interest_Rate,0.4049685575939098,North America,pearson
GDP_Growth,Interest_Rate,0.42693242586290714,North America,spearman
GDP_Growth,Manufacturing_Index,0.7929233681195408,North America,pearson
GDP_Growth,Manufacturing_Index,0.7981526494895479,North America,spearman
GDP_Growth,Consumer_Confidence,0.7487291749838413,North America,pearson
GDP_Growth,Consumer_Confidence,0.7564205847628308,North America,spearman
GDP_Growth,Exports,0.4787763601483099,North America,pearson
GDP_Growth,Exports,0.4554344051670255,North America,spearman
GDP_Growth,Imports,0.5653929404850088,North America,pearson
GDP_Growth,Imports,0.600006944926731,North America,spearman
Unemployment,Inflation,-0.4980680418188941,North America,pearson
Unemployment,Inflation,-0.5300020834780194,North America,spearman
Unemployment,Interest_Rate,-0.4278037391534723,North America,pearson
Unemployment,Interest_Rate,-0.4343009931245225,North America,spearman
Unemployment,Manufacturing_Index,-0.43615896149062783,North America,pearson
Unemployment,Manufacturing_Index,-0.4269740954232933,North America,spearman
Unemployment,Consumer_Confidence,-0.6134308245760026,North America,pearson
Unemployment,Consumer_Confidence,-0.6244253073130078,North America,spearman
Unemployment,Exports,-0.3912737354804842,North America,pearson
Unemployment,Exports,-0.4201541773734287,North America,spearman
Unemployment,Imports,-0.5305286530158944,North America,pearson
Unemployment,Imports,-0.5874782971039656,North America,spearman
Inflation,Interest_Rate,0.725856074778338,North America,pearson
Inflation,Interest_Rate,0.7102159872213348,North America,spearman
Inflation,Manufacturing_Index,0.40024774241390165,North America,pearson
Inflation,Manufacturing_Index,0.396972011945274,North America,spearman
Inflation,Consumer_Confidence,0.4470923552657276,North America,pearson
Inflation,Consumer_Confidence,0.47810959094381555,North America,spearman
Inflation,Exports,0.38573279107652797,North America,pearson
Inflation,Exports,0.3885964303076603,North America,spearman
Inflation,Imports,0.5201216341904962,North America,pearson
Inflation,Imports,0.530217376206681,North America,spearman
Interest_Rate,Manufacturing_Index,0.21552866030900794,North America,pearson
Interest_Rate,Manufacturing_Index,0.21720258351274394,North America,spearman
Interest_Rate,Consumer_Confidence,0.2656310183272161,North America,pearson
Interest_Rate,Consumer_Confidence,0.2805403152996736,North America,spearman
Interest_Rate,Exports,0.1953025518666449,North America,pearson
Interest_Rate,Exports,0.2164108618654073,North America,spearman
Interest_Rate,Imports,0.3725204699430973,North America,pearson
Interest_Rate,Imports,0.40245155913605113,North America,spearman
Manufacturing_Index,Consumer_Confidence,0.6267184046551381,North America,pearson
Manufacturing_Index,Consumer_Confidence,0.6083478019306896,North America,spearman
Manufacturing_Index,Exports,0.3401242989856073,North America,pearson
Manufacturing_Index,Exports,0.33709285367039377,North America,spearman
Manufacturing_Index,Imports,0.4303074990588517,North America,pearson
Manufacturing_Index,Imports,0.42764775331620253,North America,spearman
Consumer_Confidence,Exports,0.39292319782143775,North America,pearson
Consumer_Confidence,Exports,0.3940481977915133,North America,spearman
Consumer_Confidence,Imports,0.4418362508659992,North America,pearson
Consumer_Confidence,Imports,0.4875338565178137,North America,spearman
Exports,Imports,0.4109741503752356,North America,pearson
Exports,Imports,0.4124800333356483,North America,spearman
GDP_Growth,Unemployment,-0.38416589385630645,Europe,pearson
GDP_Growth,Unemployment,-0.41438988818667966,Europe,spearman
GDP_Growth,Inflation,0.4003127285863975,Europe,pearson
GDP_Growth,Inflation,0.4028126953260643,Europe,spearman
GDP_Growth,Interest_Rate,0.18451793224036006,Europe,pearson
GDP_Growth,Interest_Rate,0.1667338009583999,Europe,spearman
GDP_Growth,Manufacturing_Index,0.6556688039970322,Europe,pearson
GDP_Growth,Manufacturing_Index,0.661337592888395,Europe,spearman
GDP_Growth,Consumer_Confidence,0.647403942846377,Europe,pearson
GDP_Growth,Consumer_Confidence,0.619654142648795,Europe,spearman
GDP_Growth,Exports,0.4581889734214354,Europe,pearson
GDP_Growth,Exports,0.4651989721508438,Europe,spearman
GDP_Growth,Imports,0.4647898546917322,Europe,pearson
GDP_Growth,Imports,0.47544968400583376,Europe,spearman
Unemployment,Inflation,-0.3276802730413176,Europe,pearson
Unemployment,Inflation,-0.33584276685880965,Europe,spearman
Unemployment,Interest_Rate,-0.2160106390710461,Europe,pearson
Unemployment,Interest_Rate,-0.2062226543509966,Europe,spearman
Unemployment,Manufacturing_Index,-0.28399609068221404,Europe,pearson
Unemployment,Manufacturing_Index,-0.29931939718035977,Europe,spearman
Unemployment,Consumer_Confidence,-0.44511907788836014,Europe,pearson
Unemployment,Consumer_Confidence,-0.4593027293562053,Europe,spearman
Unemployment,Exports,-0.3775514912832587,Europe,pearson
Unemployment,Exports,-0.36986596291409124,Europe,spearman
Unemployment,Imports,-0.39021592637912805,Europe,pearson
Unemployment,Imports,-0.3849295089936801,Europe,spearman
Inflation,Interest_Rate,0.7388175193000253,Europe,pearson
Inflation,Interest_Rate,0.6975345510104869,Europe,spearman
Inflation,Manufacturing_Index,0.24111996746976602,Europe,pearson
Inflation,Manufacturing_Index,0.24417667893603723,Europe,spearman
Inflation,Consumer_Confidence,0.36640767020952003,Europe,pearson
Inflation,Consumer_Confidence,0.35941384818390165,Europe,spearman
Inflation,Exports,0.27265420873168145,Europe,pearson
Inflation,Exports,0.2591916105285089,Europe,spearman
Inflation,Imports,0.49446851449208723,Europe,pearson
Inflation,Imports,0.4799708313077297,Europe,spearman
Interest_Rate,Manufacturing_Index,0.07961559629885115,Europe,pearson
Interest_Rate,Manufacturing_Index,0.07906799083269672,Europe,spearman
Interest_Rate,Consumer_Confidence,0.21662663819445233,Europe,pearson
Interest_Rate,Consumer_Confidence,0.2018473505104521,Europe,spearman
Interest_Rate,Exports,0.17139019361236205,Europe,pearson
Interest_Rate,Exports,0.13406486561566774,Europe,spearman
Interest_Rate,Imports,0.2893459635878387,Europe,pearson
Interest_Rate,Imports,0.28417945690672963,Europe,spearman
Manufacturing_Index,Consumer_Confidence,0.3974848183981258,Europe,pearson
Manufacturing_Index,Consumer_Confidence,0.3774428779776373,Europe,spearman
Manufacturing_Index,Exports,0.3194691612815464,Europe,pearson
Manufacturing_Index,Exports,0.27388707549135355,Europe,spearman
Manufacturing_Index,Imports,0.3441741731609872,Europe,pearson
Manufacturing_Index,Imports,0.36545593443989166,Europe,spearman
Consumer_Confidence,Exports,0.1955007950527973,Europe,pearson
Consumer_Confidence,Exports,0.23956524758663797,Europe,spearman
Consumer_Confidence,Imports,0.4088564625804937,Europe,pearson
Consumer_Confidence,Imports,0.3973748176956733,Europe,spearman
Exports,Imports,0.3354176623976638,Europe,pearson
Exports,Imports,0.3303146051809153,Europe,spearman
GDP_Growth,Unemployment,-0.2664864982415516,Asia-Pacific,pearson
GDP_Growth,Unemployment,-0.3107299117994305,Asia-Pacific,spearman
GDP_Growth,Inflation,0.37720223466259356,Asia-Pacific,pearson
GDP_Growth,Inflation,0.36810195152441144,Asia-Pacific,spearman
GDP_Growth,Interest_Rate,0.3318825779019036,Asia-Pacific,pearson
GDP_Growth,Interest_Rate,0.28165150357663726,Asia-Pacific,spearman
GDP_Growth,Manufacturing_Index,0.6316872056967567,Asia-Pacific,pearson
GDP_Growth,Manufacturing_Index,0.5770539620807,Asia-Pacific,spearman
GDP_Growth,Consumer_Confidence,0.5772333320561741,Asia-Pacific,pearson
GDP_Growth,Consumer_Confidence,0.5623098826307382,Asia-Pacific,spearman
GDP_Growth,Exports,0.22900494978794728,Asia-Pacific,pearson
GDP_Growth,Exports,0.21570247933884298,Asia-Pacific,spearman
GDP_Growth,Imports,0.2709129495168229,Asia-Pacific,pearson
GDP_Growth,Imports,0.26110146537954027,Asia-Pacific,spearman
Unemployment,Inflation,-0.17181442096347707,Asia-Pacific,pearson
Unemployment,Inflation,-0.17363705812903674,Asia-Pacific,spearman
Unemployment,Interest_Rate,-0.1145458162781406,Asia-Pacific,pearson
Unemployment,Interest_Rate,-0.1371345232307799,Asia-Pacific,spearman
Unemployment,Manufacturing_Index,-0.20901629323612683,Asia-Pacific,pearson
Unemployment,Manufacturing_Index,-0.22698798527675534,Asia-Pacific,spearman
Unemployment,Consumer_Confidence,-0.46882532916467823,Asia-Pacific,pearson
Unemployment,Consumer_Confidence,-0.46432391138273493,Asia-Pacific,spearman
Unemployment,Exports,-0.1514125793707149,Asia-Pacific,pearson
Unemployment,Exports,-0.14507951941107022,Asia-Pacific,spearman
Unemployment,Imports,-0.3678570019425201,Asia-Pacific,pearson
Unemployment,Imports,-0.368574206542121,Asia-Pacific,spearman
Inflation,Interest_Rate,0.5908646523001205,Asia-Pacific,pearson
Inflation,Interest_Rate,0.5974095423293284,Asia-Pacific,spearman
Inflation,Manufacturing_Index,0.13567517496181972,Asia-Pacific,pearson
Inflation,Manufacturing_Index,0.09180498645739288,Asia-Pacific,spearman
Inflation,Consumer_Confidence,0.21124645710626502,Asia-Pacific,pearson
Inflation,Consumer_Confidence,0.18591568858948537,Asia-Pacific,spearman
Inflation,Exports,0.24158461787709157,Asia-Pacific,pearson
Inflation,Exports,0.28031807764428085,Asia-Pacific,spearman
Inflation,Imports,0.1786477140011456,Asia-Pacific,pearson
Inflation,Imports,0.15019098548510312,Asia-Pacific,spearman
Interest_Rate,Manufacturing_Index,0.2777420216281601,Asia-Pacific,pearson
Interest_Rate,Manufacturing_Index,0.1912146676852559,Asia-Pacific,spearman
Interest_Rate,Consumer_Confidence,0.2464312057340855,Asia-Pacific,pearson
Interest_Rate,Consumer_Confidence,0.21236196958122092,Asia-Pacific,spearman
Interest_Rate,Exports,0.17518353403402062,Asia-Pacific,pearson
Interest_Rate,Exports,0.18771442461282034,Asia-Pacific,spearman
Interest_Rate,Imports,0.16983509077246978,Asia-Pacific,pearson
Interest_Rate,Imports,0.17399819431904992,Asia-Pacific,spearman
Manufacturing_Index,Consumer_Confidence,0.3857145150065549,Asia-Pacific,pearson
Manufacturing_Index,Consumer_Confidence,0.3557191471629974,Asia-Pacific,spearman
Manufacturing_Index,Exports,0.18491890781191297,Asia-Pacific,pearson
Manufacturing_Index,Exports,0.1548024168345024,Asia-Pacific,spearman
Manufacturing_Index,Imports,0.293630758780037,Asia-Pacific,pearson
Manufacturing_Index,Imports,0.2722619626362942,Asia-Pacific,spearman
Consumer_Confidence,Exports,0.23951539932663518,Asia-Pacific,pearson
Consumer_Confidence,Exports,0.2739912493923189,Asia-Pacific,spearman
Consumer_Confidence,Imports,0.2330664777313144,Asia-Pacific,pearson
Consumer_Confidence,Imports,0.24442669629835406,Asia-Pacific,spearman
Exports,Imports,0.15900363352003957,Asia-Pacific,pearson
Exports,Imports,0.16596291409125632,Asia-Pacific,spearman

</script><script type="text/plain" id="science_corr_data" data-format="csv_embedded" data-src="">
asset1,asset2,correlation,scenario,correlation_method
fluorescence,fluorescence,1.0,default,pearson
fluorescence,fluorescence,1.0,default,spearman
fluorescence,absorbance_280,0.778205688248066,default,pearson
fluorescence,absorbance_280,0.806717364186848,default,spearman
fluorescence,absorbance_260,0.7720177364287472,default,pearson
fluorescence,absorbance_260,0.8038391244376868,default,spearman
fluorescence,ph,-0.022796339363081213,default,pearson
fluorescence,ph,-0.0050356201277139065,default,spearman
fluorescence,heat_capacity,-0.13783273189346124,default,pearson
fluorescence,heat_capacity,-0.10020801397225551,default,spearman
fluorescence,thermal_conductivity,-0.07106520609940112,default,pearson
fluorescence,thermal_conductivity,-0.04438269316772275,default,spearman
fluorescence,conductivity,0.038069985752841824,default,pearson
fluorescence,conductivity,0.0727163792750941,default,spearman
fluorescence,surface_tension,0.122432914639578,default,pearson
fluorescence,surface_tension,0.11409604185801706,default,spearman
fluorescence,density,0.09360050776272814,default,pearson
fluorescence,density,0.0953846372434768,default,spearman
fluorescence,viscosity,0.11617636381457752,default,pearson
fluorescence,viscosity,0.08991372911568118,default,spearman
absorbance_280,fluorescence,0.778205688248066,default,pearson
absorbance_280,fluorescence,0.806717364186848,default,spearman
absorbance_280,absorbance_280,1.0,default,pearson
absorbance_280,absorbance_280,1.0,default,spearman
absorbance_280,absorbance_260,0.9914248132288924,default,pearson
absorbance_280,absorbance_260,0.9924862713867492,default,spearman
absorbance_280,ph,0.021238864402401858,default,pearson
absorbance_280,ph,0.02490582083110829,default,spearman
absorbance_280,heat_capacity,-0.12460871993544487,default,pearson
absorbance_280,heat_capacity,-0.12267427004626208,default,spearman
absorbance_280,thermal_conductivity,-0.09597022576381764,default,pearson
absorbance_280,thermal_conductivity,-0.08679379820938259,default,spearman
absorbance_280,conductivity,0.031670350629487524,default,pearson
absorbance_280,conductivity,0.03959725346282037,default,spearman
absorbance_280,surface_tension,0.1327483449393051,default,pearson
absorbance_280,surface_tension,0.14122344071079582,default,spearman
absorbance_280,density,0.13412501526604434,default,pearson
absorbance_280,density,0.14161379117731582,default,spearman
absorbance_280,viscosity,0.08619211149984644,default,pearson
absorbance_280,viscosity,0.07829581079292575,default,spearman
absorbance_260,fluorescence,0.7720177364287472,default,pearson
absorbance_260,fluorescence,0.8038391244376868,default,spearman
absorbance_260,absorbance_280,0.9914248132288924,default,pearson
absorbance_260,absorbance_280,0.9924862713867492,default,spearman
absorbance_260,absorbance_260,1.0,default,pearson
absorbance_260,absorbance_260,1.0,default,spearman
absorbance_260,ph,0.038317546181879394,default,pearson
absorbance_260,ph,0.03701863058773075,default,spearman
absorbance_260,heat_capacity,-0.11406641606164437,default,pearson
absorbance_260,heat_capacity,-0.10875273192554878,default,spearman
absorbance_260,thermal_conductivity,-0.08977875265836328,default,pearson
absorbance_260,thermal_conductivity,-0.07875079670848072,default,spearman
absorbance_260,conductivity,0.019725383990122268,default,pearson
absorbance_260,conductivity,0.03484440114357866,default,spearman
absorbance_260,surface_tension,0.14690724746265857,default,pearson
absorbance_260,surface_tension,0.1511665014739429,default,spearman
absorbance_260,density,0.15068741208259082,default,pearson
absorbance_260,density,0.14923498384811373,default,spearman
absorbance_260,viscosity,0.09710094046676535,default,pearson
absorbance_260,viscosity,0.08316510258745285,default,spearman
ph,fluorescence,-0.022796339363081213,default,pearson
ph,fluorescence,-0.0050356201277139065,default,spearman
ph,absorbance_280,0.021238864402401858,default,pearson
ph,absorbance_280,0.02490582083110829,default,spearman
ph,absorbance_260,0.038317546181879394,default,pearson
ph,absorbance_260,0.03701863058773075,default,spearman
ph,ph,1.0,default,pearson
ph,ph,1.0,default,spearman
ph,heat_capacity,-0.12351286856145034,default,pearson
ph,heat_capacity,-0.12229606112357366,default,spearman
ph,thermal_conductivity,-0.10739516877730829,default,pearson
ph,thermal_conductivity,-0.13555491673640765,default,spearman
ph,conductivity,-0.0648516266924953,default,pearson
ph,conductivity,-0.053241191975308494,default,spearman
ph,surface_tension,0.0009360297082194271,default,pearson
ph,surface_tension,-0.005896222281086348,default,spearman
ph,density,0.033683080830148655,default,pearson
ph,density,0.03836573699748497,default,spearman
ph,viscosity,0.019149344107833,default,pearson
ph,viscosity,-0.0025427059264757673,default,spearman
heat_capacity,fluorescence,-0.13783273189346124,default,pearson
heat_capacity,fluorescence,-0.10020801397225551,default,spearman
heat_capacity,absorbance_280,-0.12460871993544487,default,pearson
heat_capacity,absorbance_280,-0.12267427004626208,default,spearman
heat_capacity,absorbance_260,-0.11406641606164437,default,pearson
heat_capacity,absorbance_260,-0.10875273192554878,default,spearman
heat_capacity,ph,-0.12351286856145034,default,pearson
heat_capacity,ph,-0.12229606112357366,default,spearman
heat_capacity,heat_capacity,1.0,default,pearson
heat_capacity,heat_capacity,1.0,default,spearman
heat_capacity,thermal_conductivity,0.5610416923276333,default,pearson
heat_capacity,thermal_conductivity,0.5150062477828794,default,spearman
heat_capacity,conductivity,0.04629587922803021,default,pearson
heat_capacity,conductivity,0.030388439409580966,default,spearman
heat_capacity,surface_tension,-0.08754857104257535,default,pearson
heat_capacity,surface_tension,-0.07069664875738452,default,spearman
heat_capacity,density,-0.10464592210977612,default,pearson
heat_capacity,density,-0.1033319702090203,default,spearman
heat_capacity,viscosity,-0.17763432716043653,default,pearson
heat_capacity,viscosity,-0.17157651953874078,default,spearman
thermal_conductivity,fluorescence,-0.07106520609940112,default,pearson
thermal_conductivity,fluorescence,-0.04438269316772275,default,spearman
thermal_conductivity,absorbance_280,-0.09597022576381764,default,pearson
thermal_conductivity,absorbance_280,-0.08679379820938259,default,spearman
thermal_conductivity,absorbance_260,-0.08977875265836328,default,pearson
thermal_conductivity,absorbance_260,-0.07875079670848072,default,spearman
thermal_conductivity,ph,-0.10739516877730829,default,pearson
thermal_conductivity,ph,-0.13555491673640765,default,spearman
thermal_conductivity,heat_capacity,0.5610416923276333,default,pearson
thermal_conductivity,heat_capacity,0.5150062477828794,default,spearman
thermal_conductivity,thermal_conductivity,1.0,default,pearson
thermal_conductivity,thermal_conductivity,1.0,default,spearman
thermal_conductivity,conductivity,-0.11620840808234444,default,pearson
thermal_conductivity,conductivity,-0.13689226920879333,default,spearman
thermal_conductivity,surface_tension,-0.08594463860343131,default,pearson
thermal_conductivity,surface_tension,-0.10224864526654405,default,spearman
thermal_conductivity,density,-0.06701474228243005,default,pearson
thermal_conductivity,density,-0.08115678087778719,default,spearman
thermal_conductivity,viscosity,-0.16128981769455325,default,pearson
thermal_conductivity,viscosity,-0.15286832565614208,default,spearman
conductivity,fluorescence,0.038069985752841824,default,pearson
conductivity,fluorescence,0.0727163792750941,default,spearman
conductivity,absorbance_280,0.031670350629487524,default,pearson
conductivity,absorbance_280,0.03959725346282037,default,spearman
conductivity,absorbance_260,0.019725383990122268,default,pearson
conductivity,absorbance_260,0.03484440114357866,default,spearman
conductivity,ph,-0.0648516266924953,default,pearson
conductivity,ph,-0.053241191975308494,default,spearman
conductivity,heat_capacity,0.04629587922803021,default,pearson
conductivity,heat_capacity,0.030388439409580966,default,spearman
conductivity,thermal_conductivity,-0.11620840808234444,default,pearson
conductivity,thermal_conductivity,-0.13689226920879333,default,spearman
conductivity,conductivity,1.0,default,pearson
conductivity,conductivity,1.0,default,spearman
conductivity,surface_tension,-0.001909810207915937,default,pearson
conductivity,surface_tension,-0.002977918070808068,default,spearman
conductivity,density,0.045379806774341114,default,pearson
conductivity,density,0.033270857136326125,default,spearman
conductivity,viscosity,0.03394342005868901,default,pearson
conductivity,viscosity,0.047225419909436454,default,spearman
surface_tension,fluorescence,0.122432914639578,default,pearson
surface_tension,fluorescence,0.11409604185801706,default,spearman
surface_tension,absorbance_280,0.1327483449393051,default,pearson
surface_tension,absorbance_280,0.14122344071079582,default,spearman
surface_tension,absorbance_260,0.14690724746265857,default,pearson
surface_tension,absorbance_260,0.1511665014739429,default,spearman
surface_tension,ph,0.0009360297082194271,default,pearson
surface_tension,ph,-0.005896222281086348,default,spearman
surface_tension,heat_capacity,-0.08754857104257535,default,pearson
surface_tension,heat_capacity,-0.07069664875738452,default,spearman
surface_tension,thermal_conductivity,-0.08594463860343131,default,pearson
surface_tension,thermal_conductivity,-0.10224864526654405,default,spearman
surface_tension,conductivity,-0.001909810207915937,default,pearson
surface_tension,conductivity,-0.002977918070808068,default,spearman
surface_tension,surface_tension,1.0,default,pearson
surface_tension,surface_tension,1.0,default,spearman
surface_tension,density,0.5254951674184954,default,pearson
surface_tension,density,0.5103865337744751,default,spearman
surface_tension,viscosity,0.37096647768161933,default,pearson
surface_tension,viscosity,0.35925457755362367,default,spearman
density,fluorescence,0.09360050776272814,default,pearson
density,fluorescence,0.0953846372434768,default,spearman
density,absorbance_280,0.13412501526604434,default,pearson
density,absorbance_280,0.14161379117731582,default,spearman
density,absorbance_260,0.15068741208259082,default,pearson
density,absorbance_260,0.14923498384811373,default,spearman
density,ph,0.033683080830148655,default,pearson
density,ph,0.03836573699748497,default,spearman
density,heat_capacity,-0.10464592210977612,default,pearson
density,heat_capacity,-0.1033319702090203,default,spearman
density,thermal_conductivity,-0.06701474228243005,default,pearson
density,thermal_conductivity,-0.08115678087778719,default,spearman
density,conductivity,0.045379806774341114,default,pearson
density,conductivity,0.033270857136326125,default,spearman
density,surface_tension,0.5254951674184954,default,pearson
density,surface_tension,0.5103865337744751,default,spearman
density,density,1.0,default,pearson
density,density,1.0,default,spearman
density,viscosity,0.5694274327608478,default,pearson
density,viscosity,0.5493008369594526,default,spearman
viscosity,fluorescence,0.11617636381457752,default,pearson
viscosity,fluorescence,0.08991372911568118,default,spearman
viscosity,absorbance_280,0.08619211149984644,default,pearson
viscosity,absorbance_280,0.07829581079292575,default,spearman
viscosity,absorbance_260,0.09710094046676535,default,pearson
viscosity,absorbance_260,0.08316510258745285,default,spearman
viscosity,ph,0.019149344107833,default,pearson
viscosity,ph,-0.0025427059264757673,default,spearman
viscosity,heat_capacity,-0.17763432716043653,default,pearson
viscosity,heat_capacity,-0.17157651953874078,default,spearman
viscosity,thermal_conductivity,-0.16128981769455325,default,pearson
viscosity,thermal_conductivity,-0.15286832565614208,default,spearman
viscosity,conductivity,0.03394342005868901,default,pearson
viscosity,conductivity,0.047225419909436454,default,spearman
viscosity,surface_tension,0.37096647768161933,default,pearson
viscosity,surface_tension,0.35925457755362367,default,spearman
viscosity,density,0.5694274327608478,default,pearson
viscosity,density,0.5493008369594526,default,spearman
viscosity,viscosity,1.0,default,pearson
viscosity,viscosity,1.0,default,spearman

</script><script type="text/plain" id="sales_corr_data" data-format="csv_embedded" data-src="">
asset1,asset2,correlation,scenario,correlation_method
customer_satisfaction,customer_satisfaction,1.0,default,pearson
customer_satisfaction,customer_satisfaction,1.0,default,spearman
customer_satisfaction,days_to_close,-0.0012825401272816889,default,pearson
customer_satisfaction,days_to_close,0.01550559653688966,default,spearman
customer_satisfaction,conversion_rate,0.07785682016077128,default,pearson
customer_satisfaction,conversion_rate,0.07627054977734635,default,spearman
customer_satisfaction,revenue,-0.1183721431287419,default,pearson
customer_satisfaction,revenue,-0.09434450227461934,default,spearman
customer_satisfaction,marketing_spend,-0.08789508001769161,default,pearson
customer_satisfaction,marketing_spend,-0.06677327983081222,default,spearman
customer_satisfaction,leads,-0.06634366539442396,default,pearson
customer_satisfaction,leads,-0.06213764490192476,default,spearman
customer_satisfaction,units_sold,-0.013133563024617923,default,pearson
customer_satisfaction,units_sold,-0.01718939166634197,default,spearman
customer_satisfaction,inventory_level,-0.08419640708263437,default,pearson
customer_satisfaction,inventory_level,-0.0744400474338191,default,spearman
customer_satisfaction,response_time_hours,-0.7217019492424982,default,pearson
customer_satisfaction,response_time_hours,-0.7226242204236484,default,spearman
customer_satisfaction,avg_deal_size,-0.13818145541089055,default,pearson
customer_satisfaction,avg_deal_size,-0.13862732764298694,default,spearman
customer_satisfaction,cac,-0.06492416187216306,default,pearson
customer_satisfaction,cac,-0.0765817376909347,default,spearman
days_to_close,customer_satisfaction,-0.0012825401272816889,default,pearson
days_to_close,customer_satisfaction,0.01550559653688966,default,spearman
days_to_close,days_to_close,1.0,default,pearson
days_to_close,days_to_close,1.0,default,spearman
days_to_close,conversion_rate,-0.735446694748632,default,pearson
days_to_close,conversion_rate,-0.7239337774416816,default,spearman
days_to_close,revenue,-0.33269835426286665,default,pearson
days_to_close,revenue,-0.33564090140999003,default,spearman
days_to_close,marketing_spend,-0.3070109991020815,default,pearson
days_to_close,marketing_spend,-0.2998175946220771,default,spearman
days_to_close,leads,-0.023013493926083425,default,pearson
days_to_close,leads,-0.010812493320738395,default,spearman
days_to_close,units_sold,-0.3976440857268535,default,pearson
days_to_close,units_sold,-0.38469759858305336,default,spearman
days_to_close,inventory_level,-0.3664332186404893,default,pearson
days_to_close,inventory_level,-0.37289975054641683,default,spearman
days_to_close,response_time_hours,-0.006369528054855589,default,pearson
days_to_close,response_time_hours,0.029179410869118683,default,spearman
days_to_close,avg_deal_size,-0.07908377628040017,default,pearson
days_to_close,avg_deal_size,-0.075075121520144,default,spearman
days_to_close,cac,-0.04433952693033581,default,pearson
days_to_close,cac,-0.04708867443273269,default,spearman
conversion_rate,customer_satisfaction,0.07785682016077128,default,pearson
conversion_rate,customer_satisfaction,0.07627054977734635,default,spearman
conversion_rate,days_to_close,-0.735446694748632,default,pearson
conversion_rate,days_to_close,-0.7239337774416816,default,spearman
conversion_rate,conversion_rate,1.0,default,pearson
conversion_rate,conversion_rate,1.0,default,spearman
conversion_rate,revenue,0.4155045497556449,default,pearson
conversion_rate,revenue,0.41359475707813115,default,spearman
conversion_rate,marketing_spend,0.3579316949702219,default,pearson
conversion_rate,marketing_spend,0.3425990652762782,default,spearman
conversion_rate,leads,-0.01628394779009665,default,pearson
conversion_rate,leads,-0.018050729707028756,default,spearman
conversion_rate,units_sold,0.499251776943622,default,pearson
conversion_rate,units_sold,0.47480018978294236,default,spearman
conversion_rate,inventory_level,0.4380431318542737,default,pearson
conversion_rate,inventory_level,0.4319077093583252,default,spearman
conversion_rate,response_time_hours,-0.07538857435843588,default,pearson
conversion_rate,response_time_hours,-0.08095782057144539,default,spearman
conversion_rate,avg_deal_size,0.07865640324365751,default,pearson
conversion_rate,avg_deal_size,0.08075309859286925,default,spearman
conversion_rate,cac,0.011931918642084836,default,pearson
conversion_rate,cac,0.022060538701017426,default,spearman
revenue,customer_satisfaction,-0.1183721431287419,default,pearson
revenue,customer_satisfaction,-0.09434450227461934,default,spearman
revenue,days_to_close,-0.33269835426286665,default,pearson
revenue,days_to_close,-0.33564090140999003,default,spearman
revenue,conversion_rate,0.4155045497556449,default,pearson
revenue,conversion_rate,0.41359475707813115,default,spearman
revenue,revenue,1.0,default,pearson
revenue,revenue,1.0,default,spearman
revenue,marketing_spend,0.8815206163328048,default,pearson
revenue,marketing_spend,0.924731118277957,default,spearman
revenue,leads,0.598259738914444,default,pearson
revenue,leads,0.6442982468491689,default,spearman
revenue,units_sold,0.7526223209376355,default,pearson
revenue,units_sold,0.7689207230180755,default,spearman
revenue,inventory_level,0.7239261299528268,default,pearson
revenue,inventory_level,0.7171829295732394,default,spearman
revenue,response_time_hours,0.06691147266196376,default,pearson
revenue,response_time_hours,0.08028848894460253,default,spearman
revenue,avg_deal_size,0.5626783314660481,default,pearson
revenue,avg_deal_size,0.602702486297043,default,spearman
revenue,cac,0.4116131264168149,default,pearson
revenue,cac,0.4957597658141092,default,spearman
marketing_spend,customer_satisfaction,-0.08789508001769161,default,pearson
marketing_spend,customer_satisfaction,-0.06677327983081222,default,spearman
marketing_spend,days_to_close,-0.3070109991020815,default,pearson
marketing_spend,days_to_close,-0.2998175946220771,default,spearman
marketing_spend,conversion_rate,0.3579316949702219,default,pearson
marketing_spend,conversion_rate,0.3425990652762782,default,spearman
marketing_spend,revenue,0.8815206163328048,default,pearson
marketing_spend,revenue,0.924731118277957,default,spearman
marketing_spend,marketing_spend,1.0,default,pearson
marketing_spend,marketing_spend,1.0,default,spearman
marketing_spend,leads,0.5431479388541582,default,pearson
marketing_spend,leads,0.6022125160680188,default,spearman
marketing_spend,units_sold,0.6714247860229485,default,pearson
marketing_spend,units_sold,0.6980049501237531,default,spearman
marketing_spend,inventory_level,0.6584392458593679,default,pearson
marketing_spend,inventory_level,0.6585134628365709,default,spearman
marketing_spend,response_time_hours,0.04226172461013114,default,pearson
marketing_spend,response_time_hours,0.07296076178492868,default,spearman
marketing_spend,avg_deal_size,0.5037747656376768,default,pearson
marketing_spend,avg_deal_size,0.5764181539513035,default,spearman
marketing_spend,cac,0.6175281588148219,default,pearson
marketing_spend,cac,0.680647026661128,default,spearman
leads,customer_satisfaction,-0.06634366539442396,default,pearson
leads,customer_satisfaction,-0.06213764490192476,default,spearman
leads,days_to_close,-0.023013493926083425,default,pearson
leads,days_to_close,-0.010812493320738395,default,spearman
leads,conversion_rate,-0.01628394779009665,default,pearson
leads,conversion_rate,-0.018050729707028756,default,spearman
leads,revenue,0.598259738914444,default,pearson
leads,revenue,0.6442982468491689,default,spearman
leads,marketing_spend,0.5431479388541582,default,pearson
leads,marketing_spend,0.6022125160680188,default,spearman
leads,leads,1.0,default,pearson
leads,leads,1.0,default,spearman
leads,units_sold,0.7895733377543582,default,pearson
leads,units_sold,0.8245884113056222,default,spearman
leads,inventory_level,0.7258781944597442,default,pearson
leads,inventory_level,0.7701969244486537,default,spearman
leads,response_time_hours,0.08877074564771417,default,pearson
leads,response_time_hours,0.08345155765893242,default,spearman
leads,avg_deal_size,0.00010587499224769132,default,pearson
leads,avg_deal_size,-0.0009193438188502013,default,spearman
leads,cac,-0.0033336046077816674,default,pearson
leads,cac,0.014709615966907294,default,spearman
units_sold,customer_satisfaction,-0.013133563024617923,default,pearson
units_sold,customer_satisfaction,-0.01718939166634197,default,spearman
units_sold,days_to_close,-0.3976440857268535,default,pearson
units_sold,days_to_close,-0.38469759858305336,default,spearman
units_sold,conversion_rate,0.499251776943622,default,pearson
units_sold,conversion_rate,0.47480018978294236,default,spearman
units_sold,revenue,0.7526223209376355,default,pearson
units_sold,revenue,0.7689207230180755,default,spearman
units_sold,marketing_spend,0.6714247860229485,default,pearson
units_sold,marketing_spend,0.6980049501237531,default,spearman
units_sold,leads,0.7895733377543582,default,pearson
units_sold,leads,0.8245884113056222,default,spearman
units_sold,units_sold,1.0,default,pearson
units_sold,units_sold,1.0,default,spearman
units_sold,inventory_level,0.9015061748069854,default,pearson
units_sold,inventory_level,0.9176929423235581,default,spearman
units_sold,response_time_hours,0.02632016838333842,default,pearson
units_sold,response_time_hours,0.024020994651266583,default,spearman
units_sold,avg_deal_size,-0.00459490383901312,default,pearson
units_sold,avg_deal_size,-0.0009872190583650104,default,spearman
units_sold,cac,-0.02105598430216381,default,pearson
units_sold,cac,-0.0053183869484654195,default,spearman
inventory_level,customer_satisfaction,-0.08419640708263437,default,pearson
inventory_level,customer_satisfaction,-0.0744400474338191,default,spearman
inventory_level,days_to_close,-0.3664332186404893,default,pearson
inventory_level,days_to_close,-0.37289975054641683,default,spearman
inventory_level,conversion_rate,0.4380431318542737,default,pearson
inventory_level,conversion_rate,0.4319077093583252,default,spearman
inventory_level,revenue,0.7239261299528268,default,pearson
inventory_level,revenue,0.7171829295732394,default,spearman
inventory_level,marketing_spend,0.6584392458593679,default,pearson
inventory_level,marketing_spend,0.6585134628365709,default,spearman
inventory_level,leads,0.7258781944597442,default,pearson
inventory_level,leads,0.7701969244486537,default,spearman
inventory_level,units_sold,0.9015061748069854,default,pearson
inventory_level,units_sold,0.9176929423235581,default,spearman
inventory_level,inventory_level,1.0,default,pearson
inventory_level,inventory_level,1.0,default,spearman
inventory_level,response_time_hours,0.07104123804055967,default,pearson
inventory_level,response_time_hours,0.0563672473856836,default,spearman
inventory_level,avg_deal_size,0.030951430658718162,default,pearson
inventory_level,avg_deal_size,0.008440872982312385,default,spearman
inventory_level,cac,0.02024611698873591,default,pearson
inventory_level,cac,0.012226814840485581,default,spearman
response_time_hours,customer_satisfaction,-0.7217019492424982,default,pearson
response_time_hours,customer_satisfaction,-0.7226242204236484,default,spearman
response_time_hours,days_to_close,-0.006369528054855589,default,pearson
response_time_hours,days_to_close,0.029179410869118683,default,spearman
response_time_hours,conversion_rate,-0.07538857435843588,default,pearson
response_time_hours,conversion_rate,-0.08095782057144539,default,spearman
response_time_hours,revenue,0.06691147266196376,default,pearson
response_time_hours,revenue,0.08028848894460253,default,spearman
response_time_hours,marketing_spend,0.04226172461013114,default,pearson
response_time_hours,marketing_spend,0.07296076178492868,default,spearman
response_time_hours,leads,0.08877074564771417,default,pearson
response_time_hours,leads,0.08345155765893242,default,spearman
response_time_hours,units_sold,0.02632016838333842,default,pearson
response_time_hours,units_sold,0.024020994651266583,default,spearman
response_time_hours,inventory_level,0.07104123804055967,default,pearson
response_time_hours,inventory_level,0.0563672473856836,default,spearman
response_time_hours,response_time_hours,1.0,default,pearson
response_time_hours,response_time_hours,1.0,default,spearman
response_time_hours,avg_deal_size,0.058115026098929656,default,pearson
response_time_hours,avg_deal_size,0.08046371213451466,default,spearman
response_time_hours,cac,0.00943062523703367,default,pearson
response_time_hours,cac,0.06656648848692687,default,spearman
avg_deal_size,customer_satisfaction,-0.13818145541089055,default,pearson
avg_deal_size,customer_satisfaction,-0.13862732764298694,default,spearman
avg_deal_size,days_to_close,-0.07908377628040017,default,pearson
avg_deal_size,days_to_close,-0.075075121520144,default,spearman
avg_deal_size,conversion_rate,0.07865640324365751,default,pearson
avg_deal_size,conversion_rate,0.08075309859286925,default,spearman
avg_deal_size,revenue,0.5626783314660481,default,pearson
avg_deal_size,revenue,0.602702486297043,default,spearman
avg_deal_size,marketing_spend,0.5037747656376768,default,pearson
avg_deal_size,marketing_spend,0.5764181539513035,default,spearman
avg_deal_size,leads,0.00010587499224769132,default,pearson
avg_deal_size,leads,-0.0009193438188502013,default,spearman
avg_deal_size,units_sold,-0.00459490383901312,default,pearson
avg_deal_size,units_sold,-0.0009872190583650104,default,spearman
avg_deal_size,inventory_level,0.030951430658718162,default,pearson
avg_deal_size,inventory_level,0.008440872982312385,default,spearman
avg_deal_size,response_time_hours,0.058115026098929656,default,pearson
avg_deal_size,response_time_hours,0.08046371213451466,default,spearman
avg_deal_size,avg_deal_size,1.0,default,pearson
avg_deal_size,avg_deal_size,1.0,default,spearman
avg_deal_size,cac,0.7797348675006982,default,pearson
avg_deal_size,cac,0.8148179145127,default,spearman
cac,customer_satisfaction,-0.06492416187216306,default,pearson
cac,customer_satisfaction,-0.0765817376909347,default,spearman
cac,days_to_close,-0.04433952693033581,default,pearson
cac,days_to_close,-0.04708867443273269,default,spearman
cac,conversion_rate,0.011931918642084836,default,pearson
cac,conversion_rate,0.022060538701017426,default,spearman
cac,revenue,0.4116131264168149,default,pearson
cac,revenue,0.4957597658141092,default,spearman
cac,marketing_spend,0.6175281588148219,default,pearson
cac,marketing_spend,0.680647026661128,default,spearman
cac,leads,-0.0033336046077816674,default,pearson
cac,leads,0.014709615966907294,default,spearman
cac,units_sold,-0.02105598430216381,default,pearson
cac,units_sold,-0.0053183869484654195,default,spearman
cac,inventory_level,0.02024611698873591,default,pearson
cac,inventory_level,0.012226814840485581,default,spearman
cac,response_time_hours,0.00943062523703367,default,pearson
cac,response_time_hours,0.06656648848692687,default,spearman
cac,avg_deal_size,0.7797348675006982,default,pearson
cac,avg_deal_size,0.8148179145127,default,spearman
cac,cac,1.0,default,pearson
cac,cac,1.0,default,spearman

</script><script type="text/plain" id="climate_adv_data" data-format="csv_embedded" data-src="">
node1,node2,strength,scenario,correlation_method
Temperature,Humidity,-0.3922354922118713,Spring,pearson
Temperature,Humidity,-0.3177758571016998,Spring,spearman
Temperature,Pressure,0.11879914425879164,Spring,pearson
Temperature,Pressure,0.10458081244598098,Spring,spearman
Temperature,Wind_Speed,0.145567353327316,Spring,pearson
Temperature,Wind_Speed,0.1329135284191464,Spring,spearman
Temperature,Precipitation,-0.011142073127685996,Spring,pearson
Temperature,Precipitation,0.003623661626014918,Spring,spearman
Temperature,Cloud_Cover,0.07216566352852335,Spring,pearson
Temperature,Cloud_Cover,0.06920114907466555,Spring,spearman
Temperature,Solar_Radiation,-0.03180050680336217,Spring,pearson
Temperature,Solar_Radiation,-0.07570481952504425,Spring,spearman
Temperature,UV_Index,-0.09023872217484441,Spring,pearson
Temperature,UV_Index,-0.05247561427336708,Spring,spearman
Humidity,Pressure,-0.2020273348876235,Spring,pearson
Humidity,Pressure,-0.19555500679096186,Spring,spearman
Humidity,Wind_Speed,0.014306825308936174,Spring,pearson
Humidity,Wind_Speed,-0.02331975140963905,Spring,spearman
Humidity,Precipitation,0.10626238275940363,Spring,pearson
Humidity,Precipitation,0.10510277141816725,Spring,spearman
Humidity,Cloud_Cover,0.06703603284785221,Spring,pearson
Humidity,Cloud_Cover,0.07803568900655092,Spring,spearman
Humidity,Solar_Radiation,0.00010683516947102294,Spring,pearson
Humidity,Solar_Radiation,0.02058690373297115,Spring,spearman
Humidity,UV_Index,0.08025045802896597,Spring,pearson
Humidity,UV_Index,0.022661233897188954,Spring,spearman
Pressure,Wind_Speed,-0.12662081912601664,Spring,pearson
Pressure,Wind_Speed,-0.11231839321726962,Spring,spearman
Pressure,Precipitation,-0.8316290157071292,Spring,pearson
Pressure,Precipitation,-0.8362034538952458,Spring,spearman
Pressure,Cloud_Cover,-0.719337211881726,Spring,pearson
Pressure,Cloud_Cover,-0.7177074753619713,Spring,spearman
Pressure,Solar_Radiation,0.5112520615970423,Spring,pearson
Pressure,Solar_Radiation,0.5293246079762933,Spring,spearman
Pressure,UV_Index,0.35210199200629816,Spring,pearson
Pressure,UV_Index,0.35350043215211757,Spring,spearman
Wind_Speed,Precipitation,0.016797158539982395,Spring,pearson
Wind_Speed,Precipitation,0.005646941801638809,Spring,spearman
Wind_Speed,Cloud_Cover,0.04391497305550895,Spring,pearson
Wind_Speed,Cloud_Cover,0.03494258331268095,Spring,spearman
Wind_Speed,Solar_Radiation,0.060464834136921025,Spring,pearson
Wind_Speed,Solar_Radiation,0.04536362513890604,Spring,spearman
Wind_Speed,UV_Index,0.049932217017185115,Spring,pearson
Wind_Speed,UV_Index,0.024982508128575543,Spring,spearman
Precipitation,Cloud_Cover,0.8964526252485241,Spring,pearson
Precipitation,Cloud_Cover,0.8942402145358515,Spring,spearman
Precipitation,Solar_Radiation,-0.657130012944353,Spring,pearson
Precipitation,Solar_Radiation,-0.6489090714082916,Spring,spearman
Precipitation,UV_Index,-0.5238810746105528,Spring,pearson
Precipitation,UV_Index,-0.5460534677261657,Spring,spearman
Cloud_Cover,Solar_Radiation,-0.7200776691985695,Spring,pearson
Cloud_Cover,Solar_Radiation,-0.7110568468871286,Spring,spearman
Cloud_Cover,UV_Index,-0.6040992856347008,Spring,pearson
Cloud_Cover,UV_Index,-0.6172063424614658,Spring,spearman
Solar_Radiation,UV_Index,0.6657803402129792,Spring,pearson
Solar_Radiation,UV_Index,0.6573074865209697,Spring,spearman
Temperature,Humidity,0.4112955279733273,Summer,pearson
Temperature,Humidity,0.2749722187924435,Summer,spearman
Temperature,Pressure,-0.04581938429940846,Summer,pearson
Temperature,Pressure,0.02883483557640861,Summer,spearman
Temperature,Wind_Speed,0.14403378711391016,Summer,pearson
Temperature,Wind_Speed,0.1236778203070338,Summer,spearman
Temperature,Precipitation,-0.030525435451724026,Summer,pearson
Temperature,Precipitation,-0.08555873536142009,Summer,spearman
Temperature,Cloud_Cover,0.020839129296002037,Summer,pearson
Temperature,Cloud_Cover,-0.02380893846360224,Summer,spearman
Temperature,Solar_Radiation,-0.12382946962958363,Summer,pearson
Temperature,Solar_Radiation,-0.09903280240358892,Summer,spearman
Temperature,UV_Index,-0.14898889961436676,Summer,pearson
Temperature,UV_Index,-0.09055438943079393,Summer,spearman
Humidity,Pressure,0.08881585028065903,Summer,pearson
Humidity,Pressure,0.13434580400872537,Summer,spearman
Humidity,Wind_Speed,0.03544619473422807,Summer,pearson
Humidity,Wind_Speed,0.03923941227312014,Summer,spearman
Humidity,Precipitation,-0.099241958649014,Summer,pearson
Humidity,Precipitation,-0.12626443233723275,Summer,spearman
Humidity,Cloud_Cover,-0.08239357266652893,Summer,pearson
Humidity,Cloud_Cover,-0.16448838738620808,Summer,spearman
Humidity,Solar_Radiation,-0.01728110767163211,Summer,pearson
Humidity,Solar_Radiation,0.044672181750833435,Summer,spearman
Humidity,UV_Index,-0.06245256062453391,Summer,pearson
Humidity,UV_Index,0.028077540437091,Summer,spearman
Pressure,Wind_Speed,-0.05117351490541702,Summer,pearson
Pressure,Wind_Speed,0.008124459809853069,Summer,spearman
Pressure,Precipitation,-0.8553381839584314,Summer,pearson
Pressure,Precipitation,-0.8822321446030835,Summer,spearman
Pressure,Cloud_Cover,-0.784880423385682,Summer,pearson
Pressure,Cloud_Cover,-0.7642002168291395,Summer,spearman
Pressure,Solar_Radiation,0.6093605546427744,Summer,pearson
Pressure,Solar_Radiation,0.6150471251594847,Summer,spearman
Pressure,UV_Index,0.33417495871552,Summer,pearson
Pressure,UV_Index,0.32455858747993577,Summer,spearman
Wind_Speed,Precipitation,-0.04242451359279507,Summer,pearson
Wind_Speed,Precipitation,-0.0859092149171774,Summer,spearman
Wind_Speed,Cloud_Cover,-0.005907756399883548,Summer,pearson
Wind_Speed,Cloud_Cover,-0.008606136525238443,Summer,spearman
Wind_Speed,Solar_Radiation,0.01835442875802853,Summer,pearson
Wind_Speed,Solar_Radiation,0.02605259908630695,Summer,spearman
Wind_Speed,UV_Index,0.009020358935212728,Summer,pearson
Wind_Speed,UV_Index,-0.03038235173066634,Summer,spearman
Precipitation,Cloud_Cover,0.8550736645748277,Summer,pearson
Precipitation,Cloud_Cover,0.8167120731751834,Summer,spearman
Precipitation,Solar_Radiation,-0.5683558870756701,Summer,pearson
Precipitation,Solar_Radiation,-0.572658559853453,Summer,spearman
Precipitation,UV_Index,-0.2405599139316685,Summer,pearson
Precipitation,UV_Index,-0.2671405242490141,Summer,spearman
Cloud_Cover,Solar_Radiation,-0.7331460433194208,Summer,pearson
Cloud_Cover,Solar_Radiation,-0.7189047614331477,Summer,spearman
Cloud_Cover,UV_Index,-0.4406222177573228,Summer,pearson
Cloud_Cover,UV_Index,-0.42710320223482384,Summer,spearman
Solar_Radiation,UV_Index,0.6149135963861587,Summer,pearson
Solar_Radiation,UV_Index,0.5437955303123843,Summer,spearman
Temperature,Humidity,-0.030947035047308346,Fall,pearson
Temperature,Humidity,-0.016866279787628103,Fall,spearman
Temperature,Pressure,-0.18184968964953874,Fall,pearson
Temperature,Pressure,-0.08829896695065234,Fall,spearman
Temperature,Wind_Speed,-0.07236312963997836,Fall,pearson
Temperature,Wind_Speed,-0.0662386302835741,Fall,spearman
Temperature,Precipitation,0.1837342172595569,Fall,pearson
Temperature,Precipitation,0.13207899447972118,Fall,spearman
Temperature,Cloud_Cover,0.1144351402616481,Fall,pearson
Temperature,Cloud_Cover,0.08665682731672317,Fall,spearman
Temperature,Solar_Radiation,-0.0649938100066459,Fall,pearson
Temperature,Solar_Radiation,-0.003514895088677975,Fall,spearman
Temperature,UV_Index,0.04464569088006234,Fall,pearson
Temperature,UV_Index,0.029985591472146578,Fall,spearman
Humidity,Pressure,-0.05305627980707684,Fall,pearson
Humidity,Pressure,-0.045149606947359755,Fall,spearman
Humidity,Wind_Speed,-0.08246231259531184,Fall,pearson
Humidity,Wind_Speed,-0.1356793019714368,Fall,spearman
Humidity,Precipitation,0.04615848780213267,Fall,pearson
Humidity,Precipitation,0.06022629289590005,Fall,spearman
Humidity,Cloud_Cover,0.08994960911023497,Fall,pearson
Humidity,Cloud_Cover,0.08980183124201098,Fall,spearman
Humidity,Solar_Radiation,-0.0171729712257327,Fall,pearson
Humidity,Solar_Radiation,-0.027929833807691734,Fall,spearman
Humidity,UV_Index,-0.09196709198831214,Fall,pearson
Humidity,UV_Index,-0.09091209674842793,Fall,spearman
Pressure,Wind_Speed,0.17342552073276132,Fall,pearson
Pressure,Wind_Speed,0.1512203152652591,Fall,spearman
Pressure,Precipitation,-0.8661832699721905,Fall,pearson
Pressure,Precipitation,-0.8688725194645021,Fall,spearman
Pressure,Cloud_Cover,-0.7018160243200264,Fall,pearson
Pressure,Cloud_Cover,-0.6936343302937938,Fall,spearman
Pressure,Solar_Radiation,0.5931113822842,Fall,pearson
Pressure,Solar_Radiation,0.5609756098321201,Fall,spearman
Pressure,UV_Index,0.2911582355582844,Fall,pearson
Pressure,UV_Index,0.2940004476693657,Fall,spearman
Wind_Speed,Precipitation,-0.20013079962044755,Fall,pearson
Wind_Speed,Precipitation,-0.1624040590274153,Fall,spearman
Wind_Speed,Cloud_Cover,-0.21152820438645314,Fall,pearson
Wind_Speed,Cloud_Cover,-0.1773666649413632,Fall,spearman
Wind_Speed,Solar_Radiation,0.18511927221518884,Fall,pearson
Wind_Speed,Solar_Radiation,0.14513141758426554,Fall,spearman
Wind_Speed,UV_Index,0.11722392464048882,Fall,pearson
Wind_Speed,UV_Index,0.12098827913136649,Fall,spearman
Precipitation,Cloud_Cover,0.826750033600407,Fall,pearson
Precipitation,Cloud_Cover,0.8563718590840498,Fall,spearman
Precipitation,Solar_Radiation,-0.6816418452665988,Fall,pearson
Precipitation,Solar_Radiation,-0.6715171844728176,Fall,spearman
Precipitation,UV_Index,-0.35530935410895187,Fall,pearson
Precipitation,UV_Index,-0.3607215271296646,Fall,spearman
Cloud_Cover,Solar_Radiation,-0.767819987250513,Fall,pearson
Cloud_Cover,Solar_Radiation,-0.7740634208436697,Fall,spearman
Cloud_Cover,UV_Index,-0.442148579603727,Fall,pearson
Cloud_Cover,UV_Index,-0.4568125522440842,Fall,spearman
Solar_Radiation,UV_Index,0.5023802451822036,Fall,pearson
Solar_Radiation,UV_Index,0.5052173558425788,Fall,spearman
Temperature,Humidity,0.05417591700864016,Winter,pearson
Temperature,Humidity,0.034777956126270736,Winter,spearman
Temperature,Pressure,-0.11519781509180524,Winter,pearson
Temperature,Pressure,-0.12292052516771618,Winter,spearman
Temperature,Wind_Speed,-0.06991180978894375,Winter,pearson
Temperature,Wind_Speed,-0.04798123225089517,Winter,spearman
Temperature,Precipitation,0.04844981728395278,Winter,pearson
Temperature,Precipitation,0.03928379833295426,Winter,spearman
Temperature,Cloud_Cover,-0.0020931527540041213,Winter,pearson
Temperature,Cloud_Cover,-0.004915319955738208,Winter,spearman
Temperature,Solar_Radiation,-0.14743329188865592,Winter,pearson
Temperature,Solar_Radiation,-0.15152550325478487,Winter,spearman
Temperature,UV_Index,-0.02195285509404094,Winter,pearson
Temperature,UV_Index,-0.03823688490988924,Winter,spearman
Humidity,Pressure,0.008529355495474815,Winter,pearson
Humidity,Pressure,0.023434991974317816,Winter,spearman
Humidity,Wind_Speed,0.005242627825673065,Winter,pearson
Humidity,Wind_Speed,0.036654731036753506,Winter,spearman
Humidity,Precipitation,-0.0986403290566933,Winter,pearson
Humidity,Precipitation,-0.05701012408801909,Winter,spearman
Humidity,Cloud_Cover,-0.016203753730490975,Winter,pearson
Humidity,Cloud_Cover,0.036020979575133436,Winter,spearman
Humidity,Solar_Radiation,-0.12006292789637073,Winter,pearson
Humidity,Solar_Radiation,-0.1017084484037441,Winter,spearman
Humidity,UV_Index,0.15678795675510035,Winter,pearson
Humidity,UV_Index,0.137071117053615,Winter,spearman
Pressure,Wind_Speed,0.05645285916935773,Winter,pearson
Pressure,Wind_Speed,0.03588097295962465,Winter,spearman
Pressure,Precipitation,-0.8485611983084717,Winter,pearson
Pressure,Precipitation,-0.8724792824170093,Winter,spearman
Pressure,Cloud_Cover,-0.7367516913456368,Winter,pearson
Pressure,Cloud_Cover,-0.7136764641262037,Winter,spearman
Pressure,Solar_Radiation,0.6180996193713925,Winter,pearson
Pressure,Solar_Radiation,0.6214949232259216,Winter,spearman
Pressure,UV_Index,0.4184063672634864,Winter,pearson
Pressure,UV_Index,0.37598367654876,Winter,spearman
Wind_Speed,Precipitation,-0.006509075723234838,Winter,pearson
Wind_Speed,Precipitation,-0.013130611670418391,Winter,spearman
Wind_Speed,Cloud_Cover,-0.041445012343972666,Winter,pearson
Wind_Speed,Cloud_Cover,-0.05515532392544431,Winter,spearman
Wind_Speed,Solar_Radiation,0.09744639682931343,Winter,pearson
Wind_Speed,Solar_Radiation,0.08864505348494015,Winter,spearman
Wind_Speed,UV_Index,-0.009588607733626815,Winter,pearson
Wind_Speed,UV_Index,-0.014887750707211775,Winter,spearman
Precipitation,Cloud_Cover,0.8183640536212702,Winter,pearson
Precipitation,Cloud_Cover,0.8357150666791296,Winter,spearman
Precipitation,Solar_Radiation,-0.6063174126953051,Winter,pearson
Precipitation,Solar_Radiation,-0.6634393509642756,Winter,spearman
Precipitation,UV_Index,-0.39755370687214386,Winter,pearson
Precipitation,UV_Index,-0.36487121069857903,Winter,spearman
Cloud_Cover,Solar_Radiation,-0.7184694599748054,Winter,pearson
Cloud_Cover,Solar_Radiation,-0.7248191925219867,Winter,spearman
Cloud_Cover,UV_Index,-0.36297815893580765,Winter,pearson
Cloud_Cover,UV_Index,-0.32692204222267895,Winter,spearman
Solar_Radiation,UV_Index,0.471081057698655,Winter,pearson
Solar_Radiation,UV_Index,0.45251698133836105,Winter,spearman

</script>

<!-- ACTUAL CONTENT -->

<h1></h1>
<p></p>

    <div class="textblock-content">
        <a href="https://github.com/s-baumann/JSPlots.jl/blob/main/examples/corrplot_examples.jl" style="color: blue; font-weight: bold;">See here for the example code that generated this page</a>
<h1>CorrPlot (Correlation Plot with Dendrogram) Examples</h1>
<p>This page demonstrates the interactive CorrPlot chart type in JSPlots.</p>
<ul>
    <li><strong>Hierarchical clustering:</strong> Dendrogram shows similarity grouping of variables</li>
    <li><strong>Dual correlation display:</strong> Pearson (upper right) and Spearman (lower left) correlations in one matrix</li>
    <li><strong>Julia-computed correlations:</strong> Use compute_correlations() convenience function</li>
    <li><strong>Flexible clustering:</strong> Use cluster_from_correlation() with different linkage methods</li>
    <li><strong>Automatic ordering:</strong> Variables reordered by clustering for clearer patterns</li>
</ul>

    </div>
<br>
<hr>
<br>
    <div class="textblock-content">
        <h2>Example 1: Financial Metrics Correlation Analysis</h2>
<p>Analyze correlations between various financial metrics for companies.</p>
<p>This example demonstrates:</p>
<ul>
    <li>10 financial metrics tracked for 100 companies</li>
    <li>Computing both Pearson and Spearman correlations in Julia</li>
    <li>Hierarchical clustering with Ward linkage</li>
    <li>Compare Pearson vs Spearman correlations to detect non-linear relationships</li>
    <li>Variables automatically reordered by clustering to reveal patterns</li>
</ul>

    </div>
<br>
<hr>
<br>
<div class="corrplot-container">
    <h2>Financial Metrics Correlation Analysis</h2>
    <p>This correlation plot shows relationships between financial metrics. The dendrogram groups similar metrics based on correlation patterns. Variables are automatically reordered by clustering to reveal correlation blocks. Top-right triangle shows Pearson correlations (linear relationships), while bottom-left shows Spearman correlations (rank-based, captures non-linear monotonic relationships).</p>
    <div id="dendrogram_financial_corr" style="width: 100%; height: 300px;"></div>
    <div id="corrmatrix_financial_corr" style="width: 100%; height: 600px;"></div>
</div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: financial_corr_data</p><br>
<hr>
<br>
    <div class="textblock-content">
        <h2>Example 2: Sales Performance Metrics</h2>
<p>Examine correlations between sales KPIs using average linkage clustering.</p>
<p>Features:</p>
<ul>
    <li>Multiple sales metrics: revenue, units, conversion rate, customer satisfaction, etc.</li>
    <li>Average linkage clustering (different from Ward linkage in Example 1)</li>
    <li>Identify which metrics move together</li>
    <li>Detect leading indicators through correlation patterns</li>
</ul>

    </div>
<br>
<hr>
<br>
<div class="corrplot-container">
    <h2>Sales Performance Metrics Correlation (Average Linkage)</h2>
    <p>Explore how different sales and operational metrics relate to each other. This example uses average linkage clustering (compare to Ward linkage in Example 1). The dendrogram reveals which metrics cluster together. For example, you might see that customer satisfaction groups with response time, while revenue metrics cluster separately.</p>
    <div id="dendrogram_sales_corr" style="width: 100%; height: 300px;"></div>
    <div id="corrmatrix_sales_corr" style="width: 100%; height: 600px;"></div>
</div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: sales_corr_data</p><br>
<hr>
<br>
    <div class="textblock-content">
        <h2>Example 3: Scientific Measurements - Single Linkage Clustering</h2>
<p>This example demonstrates single linkage clustering (nearest neighbor).</p>
<p>Features:</p>
<ul>
    <li>Physical and chemical measurements from laboratory experiments</li>
    <li>Demonstrates 'single' linkage clustering</li>
    <li>Single linkage tends to create elongated clusters</li>
    <li>Compare this dendrogram shape to Ward (Example 1) and average (Example 2) linkage</li>
</ul>

    </div>
<br>
<hr>
<br>
<div class="corrplot-container">
    <h2>Scientific Measurements Correlation (Single Linkage)</h2>
    <p>This correlation plot reveals clusters of related physical, thermal, chemical, and spectroscopic properties. Single linkage clustering creates elongated clusters by merging based on nearest neighbors. Notice how the dendrogram groups density-related properties together, thermal properties in another cluster, and spectroscopic measurements in a third cluster. The dual correlation display (Pearson vs Spearman) helps identify non-linear relationships.</p>
    <div id="dendrogram_science_corr" style="width: 100%; height: 300px;"></div>
    <div id="corrmatrix_science_corr" style="width: 100%; height: 600px;"></div>
</div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: science_corr_data</p><br>
<hr>
<br>
    <div class="textblock-content">
        <h2>Example 4: Healthcare Patient Metrics - Complete Linkage</h2>
<p>Analyze correlations between patient health indicators using complete linkage clustering.</p>
<p>This example includes:</p>
<ul>
    <li>Vital signs, lab results, and outcome metrics</li>
    <li>Complete linkage clustering (farthest neighbor)</li>
    <li>Identify risk factor correlations</li>
    <li>Compare linear (Pearson) vs monotonic (Spearman) relationships</li>
</ul>

    </div>
<br>
<hr>
<br>
<div class="corrplot-container">
    <h2>Patient Health Metrics Correlation (Complete Linkage)</h2>
    <p>This correlation analysis helps identify relationships between vital signs, lab results, and cardiovascular risk. Complete linkage clustering (farthest neighbor) tends to create compact, well-separated clusters. The dendrogram reveals natural groupings: blood pressure metrics cluster together, lipid panel values form another group, and glucose-related metrics cluster separately. Compare Pearson (upper right) vs Spearman (lower left) correlations to see if relationships are linear or non-linear.</p>
    <div id="dendrogram_patient_corr" style="width: 100%; height: 300px;"></div>
    <div id="corrmatrix_patient_corr" style="width: 100%; height: 600px;"></div>
</div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: patient_corr_data</p><br>
<hr>
<br>
    <div class="textblock-content">
        <h2>Example 5: Advanced CorrPlot - Economic Indicators Across Regions</h2>
<p>Compare economic indicator correlations across different geographic regions:</p>
<ul>
    <li><strong>Three regional scenarios:</strong> North America, Europe, Asia-Pacific</li>
    <li><strong>Variable selection:</strong> Choose which economic indicators to analyze</li>
    <li><strong>Compare patterns:</strong> See how indicator relationships vary by region</li>
    <li>Useful for international portfolio analysis and macroeconomic research</li>
</ul>
<p><strong>Insights to explore:</strong></p>
<ul>
    <li>How does GDP correlate with unemployment differently across regions?</li>
    <li>Are inflation-interest rate relationships similar globally?</li>
    <li>Which indicators cluster together in each region?</li>
</ul>

    </div>
<br>
<hr>
<br>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<div class="corrplot-container">
    <h2>Economic Indicators - Regional Comparison</h2>
    <p>Compare how economic indicators correlate across North America, Europe, and Asia-Pacific. Switch between regions to see different correlation patterns. Select specific indicators to focus your analysis. Notice how GDP Growth correlates differently with other indicators in each region, reflecting different economic structures and policies.</p>
    <div style="margin-bottom: 15px;">
    <label for="scenario_select_econ_advanced"><strong>Scenario:</strong></label>
    <select id="scenario_select_econ_advanced" onchange="updateChart_econ_advanced()">
        <option value="North America" selected>North America</option>
                <option value="Europe" >Europe</option>
                <option value="Asia-Pacific" >Asia-Pacific</option>
    </select>
</div>

    <div style="margin-bottom: 15px;">
        <label for="var_select_econ_advanced"><strong>Select Variables:</strong></label><br>
        <select id="var_select_econ_advanced" multiple size="8" style="width: 300px;" onchange="updateChart_econ_advanced()">
        </select>
    </div>
    <div style="margin-bottom: 15px;">
    <label for="order_mode_econ_advanced"><strong>Variable ordering:</strong></label>
    <select id="order_mode_econ_advanced" onchange="updateChart_econ_advanced()">
        <option value="dendrogram" selected>Order by dendrogram</option>
        <option value="alphabetical">Order alphabetically</option>
        <option value="manual">Order manually</option>
    </select>
</div>

    <div id="manual_order_econ_advanced" style="margin-bottom: 15px; display: none;">
    <label><strong>Drag to Reorder:</strong></label>
    <div id="sortable_vars_econ_advanced" style="padding: 10px; border: 1px solid #ccc; min-height: 50px;">
    </div>
</div>

    <div id="dendrogram_econ_advanced" style="width: 100%; height: 300px;"></div>
    <div id="corrmatrix_econ_advanced" style="width: 100%; height: 600px;"></div>
</div>
<style>
#sortable_vars_econ_advanced .sortable-item {
    padding: 5px 10px;
    margin: 2px;
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    cursor: move;
    display: inline-block;
}
#sortable_vars_econ_advanced .sortable-item:hover {
    background-color: #e0e0e0;
}
</style>

<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: econ_adv_data</p><br>
<hr>
<br>
    <div class="textblock-content">
        <h2>Example 6: Advanced CorrPlot - Climate Variables by Season</h2>
<p>Analyze how climate variable correlations change across seasons:</p>
<ul>
    <li><strong>Four seasonal scenarios:</strong> Spring, Summer, Fall, Winter</li>
    <li><strong>Interactive variable selection:</strong> Focus on specific climate factors</li>
    <li><strong>Seasonal patterns:</strong> See how temperature-humidity relationships vary</li>
    <li>Demonstrates that correlation structure can change with context (season)</li>
</ul>
<p><strong>Key observations:</strong></p>
<ul>
    <li>Temperature-humidity correlations differ by season</li>
    <li>Precipitation patterns cluster differently in summer vs winter</li>
    <li>Solar radiation shows different relationships across seasons</li>
</ul>

    </div>
<br>
<hr>
<br>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<div class="corrplot-container">
    <h2>Climate Variable Correlations - Seasonal Analysis</h2>
    <p>Explore how climate variable correlations change across seasons. Switch between Spring, Summer, Fall, and Winter to see seasonal patterns. Notice how Temperature-Humidity correlations flip between seasons (negative in Spring/Fall, positive in Summer/Winter). Use variable selection to focus on specific climate factors. Try manual ordering to group related variables by type (temperature-related, precipitation-related, etc.).</p>
    <div style="margin-bottom: 15px;">
    <label for="scenario_select_climate_advanced"><strong>Scenario:</strong></label>
    <select id="scenario_select_climate_advanced" onchange="updateChart_climate_advanced()">
        <option value="Spring" >Spring</option>
                <option value="Summer" selected>Summer</option>
                <option value="Fall" >Fall</option>
                <option value="Winter" >Winter</option>
    </select>
</div>

    <div style="margin-bottom: 15px;">
        <label for="var_select_climate_advanced"><strong>Select Variables:</strong></label><br>
        <select id="var_select_climate_advanced" multiple size="8" style="width: 300px;" onchange="updateChart_climate_advanced()">
        </select>
    </div>
    <div style="margin-bottom: 15px;">
    <label for="order_mode_climate_advanced"><strong>Variable ordering:</strong></label>
    <select id="order_mode_climate_advanced" onchange="updateChart_climate_advanced()">
        <option value="dendrogram" selected>Order by dendrogram</option>
        <option value="alphabetical">Order alphabetically</option>
        <option value="manual">Order manually</option>
    </select>
</div>

    <div id="manual_order_climate_advanced" style="margin-bottom: 15px; display: none;">
    <label><strong>Drag to Reorder:</strong></label>
    <div id="sortable_vars_climate_advanced" style="padding: 10px; border: 1px solid #ccc; min-height: 50px;">
    </div>
</div>

    <div id="dendrogram_climate_advanced" style="width: 100%; height: 300px;"></div>
    <div id="corrmatrix_climate_advanced" style="width: 100%; height: 600px;"></div>
</div>
<style>
#sortable_vars_climate_advanced .sortable-item {
    padding: 5px 10px;
    margin: 2px;
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    cursor: move;
    display: inline-block;
}
#sortable_vars_climate_advanced .sortable-item:hover {
    background-color: #e0e0e0;
}
</style>

<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: climate_adv_data</p><br>
<hr>
<br>
    <div class="textblock-content">
        <h2>Summary</h2>
<p>The CorrPlot chart type provides:</p>
<ul>
    <li><strong>Hierarchical clustering:</strong> Dendrogram shows which variables are most similar based on correlation patterns</li>
    <li><strong>Dual correlation display:</strong>
        <ul>
            <li>Top-right triangle: Pearson correlation (measures linear relationships)</li>
            <li>Bottom-left triangle: Spearman correlation (measures monotonic relationships, robust to outliers)</li>
        </ul>
    </li>
    <li><strong>Julia-computed correlations:</strong> Use compute_correlations() for both Pearson and Spearman</li>
    <li><strong>Flexible clustering:</strong> Use cluster_from_correlation() with different linkage methods (:ward, :average, :single, :complete)</li>
    <li><strong>Automatic ordering:</strong> Variables reordered by clustering results for clearer visualization of correlation blocks</li>
</ul>

<h3>Basic Workflow (Examples 1-4)</h3>
<pre><code>
# 1. Compute correlations
vars = [:var1, :var2, :var3, :var4]
cors = compute_correlations(df, vars)

# 2. Perform hierarchical clustering
hc = cluster_from_correlation(cors.pearson, linkage=:ward)

# 3. Create correlation plot
corrplot = CorrPlot(:my_corr, cors.pearson, cors.spearman, hc,
                    string.(vars);
                    title="My Correlation Analysis",
                    notes="Description...")
</code></pre>

<h3>Advanced Workflow with Multiple Scenarios (Examples 5-7)</h3>
<pre><code>
# 1. Create multiple correlation scenarios
scenario1 = CorrelationScenario("Short-term", pearson1, spearman1, hc1, labels1)
scenario2 = CorrelationScenario("Long-term", pearson2, spearman2, hc2, labels2)
scenario3 = CorrelationScenario("Volatility", pearson3, spearman3, hc3, labels3)

# 2. Create advanced CorrPlot with interactive features
corrplot = CorrPlot(:advanced, [scenario1, scenario2, scenario3];
                    title="Advanced Analysis",
                    default_scenario="Short-term",
                    default_variables=["var1", "var2", "var3"],
                    allow_manual_order=true)
</code></pre>

<h3>Advanced Features (Examples 5-7)</h3>
<ul>
    <li><strong>Multiple Scenarios:</strong> Switch between different correlation analyses using dropdown</li>
    <li><strong>Variable Selection:</strong> Multi-select box to choose which variables to display</li>
    <li><strong>Manual Ordering:</strong> Toggle "Order by Dendrogram" off to enable drag-drop reordering</li>
    <li><strong>Interactive Exploration:</strong> Compare different correlation contexts (time horizons, regions, seasons, etc.)</li>
</ul>

<h3>Linkage Methods</h3>
<ul>
    <li><strong>Ward (:ward):</strong> Minimizes within-cluster variance, creates compact clusters (Examples 1, 5-7)</li>
    <li><strong>Average (:average):</strong> Uses average distance between clusters, balanced approach (Example 2)</li>
    <li><strong>Single (:single):</strong> Nearest neighbor, can create elongated clusters (Example 3)</li>
    <li><strong>Complete (:complete):</strong> Farthest neighbor, creates compact, well-separated clusters (Example 4)</li>
</ul>

<h3>Use Cases</h3>
<ul>
    <li><strong>Financial analysis:</strong> Stock correlations across time horizons (Example 5), portfolio diversification</li>
    <li><strong>Economic research:</strong> Compare regional indicator relationships (Example 6)</li>
    <li><strong>Climate science:</strong> Seasonal correlation patterns (Example 7)</li>
    <li><strong>Scientific research:</strong> Discover relationships between experimental measurements (Example 3)</li>
    <li><strong>Healthcare:</strong> Analyze patient metrics and identify risk factor correlations (Example 4)</li>
    <li><strong>Feature selection:</strong> Identify redundant variables for machine learning</li>
</ul>

<h3>Interpretation Tips</h3>
<ul>
    <li><strong>Dendrogram:</strong> Variables that merge early (low height) are highly correlated</li>
    <li><strong>Pearson vs Spearman:</strong> If they differ significantly, the relationship may be non-linear</li>
    <li><strong>Clustering:</strong> Reveals natural groupings of related variables</li>
    <li><strong>Correlation blocks:</strong> After reordering, look for dark red/blue blocks indicating groups of correlated variables</li>
    <li><strong>Scenario switching:</strong> Compare how correlations change across contexts (time, region, season)</li>
    <li><strong>Variable selection:</strong> Focus analysis on specific subsets of interest</li>
    <li><strong>Manual ordering:</strong> Create custom groupings by sector, type, or hypothesis</li>
</ul>

    </div>


<hr><p align="right"><small>This page was created using <a href="https://github.com/s-baumann/JSPlots.jl">JSPlots.jl</a> v0.3.3.</small></p>
</body>
</html>
