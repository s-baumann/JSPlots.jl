<!DOCTYPE html>
<html>
<head>
    <title>PivotTable Examples</title>
    <meta charset="UTF-8">

    <!-- External JavaScript libraries (loaded based on chart types used) -->
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/pivot.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/pivot.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/d3_renderers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/c3_renderers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/export_renderers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #controls {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        #$div_id {
            width: 100%;
            height: 600px;
        }
    </style>
        <style>
        .textblock-content {
            padding: 20px;
            margin: 10px 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
        }

        .textblock-content h1 {
            font-size: 2em;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }

        .textblock-content h2 {
            font-size: 1.5em;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }

        .textblock-content h3 {
            font-size: 1.25em;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
            font-weight: 600;
        }

        .textblock-content p {
            margin: 0.5em 0;
        }

        .textblock-content ul, .textblock-content ol {
            margin: 0.5em 0;
            padding-left: 2em;
        }

        .textblock-content code {
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .textblock-content pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }

        .textblock-content pre code {
            background-color: transparent;
            padding: 0;
        }

        .textblock-content blockquote {
            border-left: 4px solid #ddd;
            padding-left: 1em;
            margin-left: 0;
            color: #666;
        }

        .textblock-content a {
            color: #0066cc;
            text-decoration: none;
        }

        .textblock-content a:hover {
            text-decoration: underline;
        }

        .textblock-content table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }

        .textblock-content th, .textblock-content td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .textblock-content th {
            background-color: #f5f5f5;
            font-weight: 600;
        }
    </style>


    <!-- Prism.js language components for CodeBlocks -->
    

</head>

<body>

<!-- Parquet support (loaded if using parquet dataformat) -->


<script>
// Helper function to wait for parquet-wasm to be loaded
function waitForParquet() {
    return new Promise(function(resolve) {
        if (window.parquetReady) {
            resolve();
            return;
        }
        var checkInterval = setInterval(function() {
            if (window.parquetReady) {
                clearInterval(checkInterval);
                resolve();
            }
        }, 50);
    });
}

// Centralized data loading function
// Centralized date parsing function
// Converts various date formats to JavaScript Date objects
// This is the ONLY place in the package where date parsing happens
// Handles: ISO strings, Date objects (from Arrow/Parquet), timestamps, and day counts
function parseDatesInData(data) {
    if (!data || data.length === 0) return data;

    // Regex patterns for ISO date formats
    var datePattern = /^\d{4}-\d{2}-\d{2}$/;  // YYYY-MM-DD
    var datetimePattern = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/;  // YYYY-MM-DDTHH:MM:SS
    var timePattern = /^\d{2}:\d{2}:\d{2}(\.\d+)?$/;  // HH:MM:SS or HH:MM:SS.sss

    // Timestamp range for reasonable dates (2000-01-01 to 2100-01-01 in milliseconds)
    // Using year 2000 as minimum to avoid false positives with regular numeric values
    var MIN_TIMESTAMP_MS = 946684800000;  // 2000-01-01
    var MAX_TIMESTAMP_MS = 4102444800000;  // 2100-01-01

    // Day count range (for dates stored as days since epoch, e.g., from some Parquet files)
    // Reasonable range: 0 (1970-01-01) to ~47500 (~2100-01-01)
    var MIN_DAYS = 0;
    var MAX_DAYS = 50000;
    var MS_PER_DAY = 86400000;

    // Scan multiple rows to better detect column types (some rows might have missing values)
    var rowsToCheck = Math.min(10, data.length);
    var dateColumns = [];
    var timeColumns = [];
    var timestampColumns = [];
    var dayCountColumns = [];
    var alreadyDateColumns = [];

    // Helper to check if a numeric value looks like a timestamp (milliseconds since epoch)
    function looksLikeTimestamp(value) {
        return typeof value === 'number' && value >= MIN_TIMESTAMP_MS && value <= MAX_TIMESTAMP_MS && value > MAX_DAYS;
    }

    // Helper to check if a numeric value looks like a day count since epoch
    // DISABLED: This was too aggressive and incorrectly converted normal numeric values
    // (like Month=1, Year=2022, Sales=120) to dates. Only enable for columns with
    // explicit date-like names if needed in the future.
    function looksLikeDayCount(value) {
        return false;  // Disabled - too many false positives
    }

    // Build list of keys from first row
    var keys = Object.keys(data[0]);

    // Check each column across multiple rows
    keys.forEach(function(key) {
        var stringDateCount = 0;
        var timeCount = 0;
        var timestampCount = 0;
        var dayCountCount = 0;
        var alreadyDateCount = 0;
        var nonNullCount = 0;

        for (var i = 0; i < rowsToCheck; i++) {
            var value = data[i][key];
            if (value === null || value === undefined) continue;
            nonNullCount++;

            if (value instanceof Date) {
                alreadyDateCount++;
            } else if (typeof value === 'string') {
                if (datetimePattern.test(value) || datePattern.test(value)) {
                    stringDateCount++;
                } else if (timePattern.test(value)) {
                    timeCount++;
                }
            } else if (typeof value === 'number') {
                if (looksLikeTimestamp(value)) {
                    timestampCount++;
                } else if (looksLikeDayCount(value)) {
                    dayCountCount++;
                }
            }
        }

        // Classify column if majority of non-null values match a pattern
        var threshold = nonNullCount * 0.5;
        if (alreadyDateCount > threshold) {
            alreadyDateColumns.push(key);
        } else if (stringDateCount > threshold) {
            dateColumns.push(key);
        } else if (timeCount > threshold) {
            timeColumns.push(key);
        } else if (timestampCount > threshold) {
            timestampColumns.push(key);
        } else if (dayCountCount > threshold && dayCountCount >= 3) {
            // Be more conservative with day counts - require at least 3 matches
            dayCountColumns.push(key);
        }
    });

    // If no date/time columns found, return data unchanged
    if (dateColumns.length === 0 && timeColumns.length === 0 &&
        timestampColumns.length === 0 && dayCountColumns.length === 0 &&
        alreadyDateColumns.length === 0) {
        return data;
    }

    // Convert values in all rows
    return data.map(function(row) {
        var newRow = {};
        for (var key in row) {
            if (row.hasOwnProperty(key)) {
                var value = row[key];

                if (alreadyDateColumns.indexOf(key) !== -1) {
                    // Already a Date object - keep as is
                    newRow[key] = value;
                } else if (dateColumns.indexOf(key) !== -1 && typeof value === 'string') {
                    // ISO date string - convert to Date
                    newRow[key] = new Date(value);
                } else if (timeColumns.indexOf(key) !== -1 && typeof value === 'string') {
                    // Convert HH:MM:SS or HH:MM:SS.sss to milliseconds since midnight
                    var parts = value.split(':');
                    var hours = parseInt(parts[0], 10);
                    var minutes = parseInt(parts[1], 10);
                    var seconds = parseFloat(parts[2]);
                    newRow[key] = (hours * 3600 + minutes * 60 + seconds) * 1000;
                } else if (timestampColumns.indexOf(key) !== -1 && typeof value === 'number') {
                    // Timestamp in milliseconds - convert to Date
                    newRow[key] = new Date(value);
                } else if (dayCountColumns.indexOf(key) !== -1 && typeof value === 'number') {
                    // Day count since epoch - convert to Date
                    newRow[key] = new Date(value * MS_PER_DAY);
                } else {
                    newRow[key] = value;
                }
            }
        }
        return newRow;
    });
}

// Helper function to convert temporal values back to string format for categorical filtering
// Takes a value and returns the appropriate string representation
function temporalValueToString(value) {
    if (value instanceof Date) {
        // Convert Date to ISO string
        var year = value.getFullYear();
        var month = String(value.getMonth() + 1).padStart(2, '0');
        var day = String(value.getDate()).padStart(2, '0');
        var hours = String(value.getHours()).padStart(2, '0');
        var minutes = String(value.getMinutes()).padStart(2, '0');
        var seconds = String(value.getSeconds()).padStart(2, '0');

        // Check if this is a date-only value (time is midnight UTC)
        if (hours === '00' && minutes === '00' && seconds === '00') {
            return year + '-' + month + '-' + day;
        } else {
            return year + '-' + month + '-' + day + 'T' + hours + ':' + minutes + ':' + seconds;
        }
    } else if (typeof value === 'number' && value >= 0 && value < 86400000) {
        // Likely a Time value (milliseconds since midnight, less than 24 hours)
        var totalSeconds = Math.floor(value / 1000);
        var hours = Math.floor(totalSeconds / 3600);
        var minutes = Math.floor((totalSeconds % 3600) / 60);
        var seconds = totalSeconds % 60;
        var milliseconds = value % 1000;

        var timeStr = String(hours).padStart(2, '0') + ':' +
                      String(minutes).padStart(2, '0') + ':' +
                      String(seconds).padStart(2, '0');

        // Add decimal part if there are milliseconds
        if (milliseconds > 0) {
            timeStr += '.' + String(milliseconds);
        }

        return timeStr;
    } else {
        // Return as-is for other types
        return String(value);
    }
}

// Centralized observation counting and filtering function
// Applies filters incrementally while updating observation count displays
// Returns filtered data
// Now supports optional choice filters (single-select) in addition to categorical filters (multi-select)
function applyFiltersWithCounting(allData, chartTitle, categoricalFilters, continuousFilters, filters, rangeFilters, choiceFilters, choices) {
    var totalObs = allData.length;

    // Update total observation count
    var totalObsElement = document.getElementById(chartTitle + '_total_obs');
    if (totalObsElement) {
        totalObsElement.textContent = totalObs + ' observations';
    }

    // Apply filters incrementally to track observation counts
    var currentData = allData;

    // Apply choice filters first (single-select, exact match)
    if (choiceFilters && choices) {
        choiceFilters.forEach(function(col) {
            if (choices[col] !== undefined && choices[col] !== null && choices[col] !== '') {
                currentData = currentData.filter(function(row) {
                    var rowValueStr = temporalValueToString(row[col]);
                    return rowValueStr === choices[col];
                });
            }
        });
    }

    // Apply categorical filters and update counts
    categoricalFilters.forEach(function(col) {
        if (filters[col] && filters[col].length > 0) {
            currentData = currentData.filter(function(row) {
                var rowValueStr = temporalValueToString(row[col]);
                return filters[col].includes(rowValueStr);
            });
        }

        var countElement = document.getElementById(col + '_select_' + chartTitle + '_obs_count');
        if (countElement) {
            var pct = totalObs > 0 ? Math.round((currentData.length / totalObs) * 100) : 100;
            countElement.textContent = pct + '% (' + currentData.length + ') remaining';
        }
    });

    // Apply continuous filters and update counts
    continuousFilters.forEach(function(col) {
        if (rangeFilters[col]) {
            var range = rangeFilters[col];
            currentData = currentData.filter(function(row) {
                var rawValue = row[col];
                var value;
                if (rawValue instanceof Date) {
                    value = rawValue.getTime();
                } else {
                    value = parseFloat(rawValue);
                }
                return value >= range.min && value <= range.max;
            });
        }

        var countElement = document.getElementById(col + '_range_' + chartTitle + '_obs_count');
        if (countElement) {
            var pct = totalObs > 0 ? Math.round((currentData.length / totalObs) * 100) : 100;
            countElement.textContent = pct + '% (' + currentData.length + ') remaining';
        }
    });

    return currentData;
}

// Axis transformation functions
// These transform data values according to selected transformation type
function applyAxisTransform(values, transformType) {
    if (!values || values.length === 0) return [];

    switch(transformType) {
        case 'identity':
            return values;

        case 'log':
            return values.map(function(v) {
                return v > 0 ? Math.log(v) : NaN;
            });

        case 'z_score':
            // Z-score standardization: (x - mean) / std
            var numericVals = values.filter(function(v) { return !isNaN(v) && isFinite(v); });
            if (numericVals.length === 0) return values;

            var mean = numericVals.reduce(function(a, b) { return a + b; }, 0) / numericVals.length;
            var variance = numericVals.reduce(function(sum, v) {
                return sum + Math.pow(v - mean, 2);
            }, 0) / numericVals.length;
            var std = Math.sqrt(variance);

            if (std === 0) return values;

            return values.map(function(v) {
                if (isNaN(v) || !isFinite(v)) return NaN;
                return (v - mean) / std;
            });

        case 'quantile':
            // Rank-based transformation to [0, 1]
            // Create array of {value, originalIndex} pairs
            var indexedValues = values.map(function(v, i) {
                return { value: v, index: i };
            });

            // Filter out invalid values and sort
            var validValues = indexedValues.filter(function(item) {
                return !isNaN(item.value) && isFinite(item.value);
            }).sort(function(a, b) {
                return a.value - b.value;
            });

            if (validValues.length === 0) return values;

            // Assign ranks (0 to 1)
            var ranks = new Array(values.length).fill(NaN);
            validValues.forEach(function(item, rank) {
                // Map rank to [0, 1] where lowest = 0, highest = 1
                ranks[item.index] = validValues.length === 1 ? 0.5 : rank / (validValues.length - 1);
            });

            return ranks;

        case 'inverse_cdf':
            // Z-score followed by normal CDF transformation to [0, 1]
            var numericVals2 = values.filter(function(v) { return !isNaN(v) && isFinite(v); });
            if (numericVals2.length === 0) return values;

            var mean2 = numericVals2.reduce(function(a, b) { return a + b; }, 0) / numericVals2.length;
            var variance2 = numericVals2.reduce(function(sum, v) {
                return sum + Math.pow(v - mean2, 2);
            }, 0) / numericVals2.length;
            var std2 = Math.sqrt(variance2);

            if (std2 === 0) return values.map(function() { return 0.5; });

            return values.map(function(v) {
                if (isNaN(v) || !isFinite(v)) return NaN;
                var zscore = (v - mean2) / std2;
                return normalCDF(zscore);
            });

        case 'cumulative':
        case 'cumprod':
            // These are handled specially in chart code (computed per group)
            // Here they act as identity
            return values;

        default:
            return values;
    }
}

// Compute cumulative sum of values
// Returns array of same length: [y[0], y[0]+y[1], y[0]+y[1]+y[2], ...]
function computeCumulativeSum(values) {
    if (!values || values.length === 0) return [];
    var result = [];
    var sum = 0;
    for (var i = 0; i < values.length; i++) {
        var v = parseFloat(values[i]);  // Explicitly convert to number
        if (!isNaN(v) && isFinite(v)) {
            sum += v;
        }
        result.push(sum);
    }
    return result;
}

// Compute cumulative product of values for returns data
// For returns r_i, computes: cumprod(1 + r_i) - 1
// This converts returns to growth factors, compounds them, then converts back to cumulative return
// Example: returns [0.1, 0.2, -0.1] -> (1+r): [1.1, 1.2, 0.9] -> cumprod: [1.1, 1.32, 1.188] -> result: [0.1, 0.32, 0.188]
function computeCumulativeProduct(values) {
    if (!values || values.length === 0) return [];
    var result = [];
    var product = 1;
    for (var i = 0; i < values.length; i++) {
        var v = parseFloat(values[i]);  // Explicitly convert to number
        if (!isNaN(v) && isFinite(v)) {
            product *= (1 + v);  // Convert return to growth factor and multiply
        }
        result.push(product - 1);  // Convert back to cumulative return
    }
    return result;
}

// Compute quantile transformation of values (rank-based, maps to [0, 1])
function computeQuantileTransform(values) {
    if (!values || values.length === 0) return [];

    var indexedValues = values.map(function(v, i) {
        return { value: parseFloat(v), index: i };  // Explicitly convert to number
    });

    var validValues = indexedValues.filter(function(item) {
        return !isNaN(item.value) && isFinite(item.value);
    }).sort(function(a, b) {
        return a.value - b.value;
    });

    if (validValues.length === 0) return values;

    var ranks = new Array(values.length).fill(NaN);
    validValues.forEach(function(item, rank) {
        ranks[item.index] = validValues.length === 1 ? 0.5 : rank / (validValues.length - 1);
    });

    return ranks;
}

// Normal CDF (cumulative distribution function) for standard normal
function normalCDF(x) {
    // Using error function approximation
    var t = 1 / (1 + 0.2316419 * Math.abs(x));
    var d = 0.3989423 * Math.exp(-x * x / 2);
    var prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
    return x > 0 ? 1 - prob : prob;
}

// Inverse normal CDF (quantile function) for standard normal
function inverseNormalCDF(p) {
    // Rational approximation for inverse normal CDF
    // Valid for 0 < p < 1
    if (p <= 0 || p >= 1) {
        return NaN;
    }

    var a = [0, -3.969683028665376e+01, 2.209460984245205e+02,
             -2.759285104469687e+02, 1.383577518672690e+02,
             -3.066479806614716e+01, 2.506628277459239e+00];
    var b = [0, -5.447609879822406e+01, 1.615858368580409e+02,
             -1.556989798598866e+02, 6.680131188771972e+01,
             -1.328068155288572e+01];
    var c = [0, -7.784894002430293e-03, -3.223964580411365e-01,
             -2.400758277161838e+00, -2.549732539343734e+00,
             4.374664141464968e+00, 2.938163982698783e+00];
    var d = [0, 7.784695709041462e-03, 3.224671290700398e-01,
             2.445134137142996e+00, 3.754408661907416e+00];

    var q, r, result;

    if (p < 0.02425) {
        q = Math.sqrt(-2 * Math.log(p));
        result = (((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q + c[6]) /
                 ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1);
    } else if (p > 0.97575) {
        q = Math.sqrt(-2 * Math.log(1 - p));
        result = -(((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q + c[6]) /
                  ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1);
    } else {
        q = p - 0.5;
        r = q * q;
        result = (((((a[1] * r + a[2]) * r + a[3]) * r + a[4]) * r + a[5]) * r + a[6]) * q /
                 (((((b[1] * r + b[2]) * r + b[3]) * r + b[4]) * r + b[5]) * r + 1);
    }

    return result;
}

// Get axis label with transformation applied
function getAxisLabel(originalLabel, transformType) {
    switch(transformType) {
        case 'log':
            return 'log(' + originalLabel + ')';
        case 'z_score':
            return 'z(' + originalLabel + ')';
        case 'quantile':
            return 'quantile(' + originalLabel + ')';
        case 'inverse_cdf':
            return 'Î¦(' + originalLabel + ')';
        case 'cumulative':
            return 'cumulative(' + originalLabel + ')';
        case 'cumprod':
            return 'cumprod(' + originalLabel + ')';
        default:
            return originalLabel;
    }
}

// =============================================================================
// Expression Parser for ScatterTwo
// Supports: +, -, *, /, variable references (:var or var), and functions:
//   z(expr, [groups]) - z-score within groups
//   q(expr, [groups]) - quantile within groups
//   PCA1(var1, var2) - projection on first principal component
//   PCA2(var1, var2) - projection on second principal component
// =============================================================================

// Tokenizer for expression parsing
function tokenizeExpression(expr) {
    var tokens = [];
    var i = 0;
    while (i < expr.length) {
        var ch = expr[i];

        // Skip whitespace
        if (/\s/.test(ch)) { i++; continue; }

        // Operators and punctuation
        if ('+-*/(),[]'.indexOf(ch) !== -1) {
            tokens.push({ type: 'punct', value: ch });
            i++;
            continue;
        }

        // Numbers
        if (/[0-9.]/.test(ch)) {
            var num = '';
            while (i < expr.length && /[0-9.]/.test(expr[i])) {
                num += expr[i++];
            }
            tokens.push({ type: 'number', value: parseFloat(num) });
            continue;
        }

        // Variable with colon prefix :varname
        if (ch === ':') {
            i++; // skip colon
            var name = '';
            while (i < expr.length && /[a-zA-Z0-9_]/.test(expr[i])) {
                name += expr[i++];
            }
            tokens.push({ type: 'variable', value: name });
            continue;
        }

        // Identifiers (function names or variable names without colon)
        if (/[a-zA-Z_]/.test(ch)) {
            var ident = '';
            while (i < expr.length && /[a-zA-Z0-9_]/.test(expr[i])) {
                ident += expr[i++];
            }
            // Check if it's a function (followed by open paren)
            var j = i;
            while (j < expr.length && /\s/.test(expr[j])) j++;
            if (j < expr.length && expr[j] === '(') {
                tokens.push({ type: 'function', value: ident });
            } else {
                tokens.push({ type: 'variable', value: ident });
            }
            continue;
        }

        // Unknown character - skip
        i++;
    }
    return tokens;
}

// Simple recursive descent parser
function parseExpression(tokens, pos) {
    return parseAddSub(tokens, pos);
}

function parseAddSub(tokens, pos) {
    var result = parseMulDiv(tokens, pos);
    var node = result.node;
    pos = result.pos;

    while (pos < tokens.length && tokens[pos].type === 'punct' &&
           (tokens[pos].value === '+' || tokens[pos].value === '-')) {
        var op = tokens[pos].value;
        pos++;
        var right = parseMulDiv(tokens, pos);
        node = { type: 'binary', op: op, left: node, right: right.node };
        pos = right.pos;
    }
    return { node: node, pos: pos };
}

function parseMulDiv(tokens, pos) {
    var result = parseUnary(tokens, pos);
    var node = result.node;
    pos = result.pos;

    while (pos < tokens.length && tokens[pos].type === 'punct' &&
           (tokens[pos].value === '*' || tokens[pos].value === '/')) {
        var op = tokens[pos].value;
        pos++;
        var right = parseUnary(tokens, pos);
        node = { type: 'binary', op: op, left: node, right: right.node };
        pos = right.pos;
    }
    return { node: node, pos: pos };
}

function parseUnary(tokens, pos) {
    if (pos < tokens.length && tokens[pos].type === 'punct' && tokens[pos].value === '-') {
        pos++;
        var result = parseUnary(tokens, pos);
        return { node: { type: 'unary', op: '-', arg: result.node }, pos: result.pos };
    }
    return parsePrimary(tokens, pos);
}

function parsePrimary(tokens, pos) {
    if (pos >= tokens.length) {
        return { node: { type: 'number', value: 0 }, pos: pos };
    }

    var token = tokens[pos];

    // Number literal
    if (token.type === 'number') {
        return { node: { type: 'number', value: token.value }, pos: pos + 1 };
    }

    // Variable reference
    if (token.type === 'variable') {
        return { node: { type: 'variable', name: token.value }, pos: pos + 1 };
    }

    // Function call
    if (token.type === 'function') {
        var funcName = token.value;
        pos++; // skip function name
        if (pos < tokens.length && tokens[pos].value === '(') {
            pos++; // skip (
            var args = [];
            while (pos < tokens.length && tokens[pos].value !== ')') {
                // Check for array literal [...]
                if (tokens[pos].value === '[') {
                    pos++; // skip [
                    var arrayItems = [];
                    while (pos < tokens.length && tokens[pos].value !== ']') {
                        if (tokens[pos].type === 'variable') {
                            arrayItems.push(tokens[pos].value);
                        }
                        pos++;
                        if (pos < tokens.length && tokens[pos].value === ',') pos++;
                    }
                    if (pos < tokens.length && tokens[pos].value === ']') pos++;
                    args.push({ type: 'array', items: arrayItems });
                } else {
                    var argResult = parseExpression(tokens, pos);
                    args.push(argResult.node);
                    pos = argResult.pos;
                }
                if (pos < tokens.length && tokens[pos].value === ',') pos++;
            }
            if (pos < tokens.length && tokens[pos].value === ')') pos++;
            return { node: { type: 'function', name: funcName, args: args }, pos: pos };
        }
    }

    // Parenthesized expression
    if (token.type === 'punct' && token.value === '(') {
        pos++; // skip (
        var result = parseExpression(tokens, pos);
        pos = result.pos;
        if (pos < tokens.length && tokens[pos].value === ')') pos++;
        return { node: result.node, pos: pos };
    }

    // Default: return 0
    return { node: { type: 'number', value: 0 }, pos: pos + 1 };
}

// Evaluate parsed expression against data
// Returns an array of values, one per data row
function evaluateExpression(node, data) {
    if (!node) return data.map(function() { return 0; });

    switch (node.type) {
        case 'number':
            return data.map(function() { return node.value; });

        case 'variable':
            return data.map(function(row) {
                var val = row[node.name];
                return (typeof val === 'number') ? val : parseFloat(val) || 0;
            });

        case 'binary':
            var left = evaluateExpression(node.left, data);
            var right = evaluateExpression(node.right, data);
            return left.map(function(l, i) {
                var r = right[i];
                switch (node.op) {
                    case '+': return l + r;
                    case '-': return l - r;
                    case '*': return l * r;
                    case '/': return r !== 0 ? l / r : NaN;
                    default: return 0;
                }
            });

        case 'unary':
            var arg = evaluateExpression(node.arg, data);
            if (node.op === '-') {
                return arg.map(function(v) { return -v; });
            }
            return arg;

        case 'function':
            return evaluateFunction(node.name, node.args, data);

        default:
            return data.map(function() { return 0; });
    }
}

// Evaluate function calls
function evaluateFunction(name, args, data) {
    var lowerName = name.toLowerCase();

    // z(expr, [groups]) - z-score within groups
    if (lowerName === 'z') {
        var values = evaluateExpression(args[0], data);
        var groupCols = (args.length > 1 && args[1].type === 'array') ? args[1].items : [];
        return computeGroupedZScore(values, data, groupCols);
    }

    // q(expr, [groups]) - quantile within groups
    if (lowerName === 'q') {
        var values = evaluateExpression(args[0], data);
        var groupCols = (args.length > 1 && args[1].type === 'array') ? args[1].items : [];
        return computeGroupedQuantile(values, data, groupCols);
    }

    // PCA1(var1, var2) - first principal component
    if (lowerName === 'pca1') {
        if (args.length >= 2) {
            var v1 = evaluateExpression(args[0], data);
            var v2 = evaluateExpression(args[1], data);
            return computePCA(v1, v2, 1);
        }
        return data.map(function() { return 0; });
    }

    // PCA2(var1, var2) - second principal component
    if (lowerName === 'pca2') {
        if (args.length >= 2) {
            var v1 = evaluateExpression(args[0], data);
            var v2 = evaluateExpression(args[1], data);
            return computePCA(v1, v2, 2);
        }
        return data.map(function() { return 0; });
    }

    // r(y, x) - OLS residual (y - fitted)
    if (lowerName === 'r') {
        if (args.length >= 2) {
            var y = evaluateExpression(args[0], data);
            var x = evaluateExpression(args[1], data);
            return computeOLSResidual(y, x);
        }
        return data.map(function() { return 0; });
    }

    // f(y, x) - OLS fitted value
    if (lowerName === 'f') {
        if (args.length >= 2) {
            var y = evaluateExpression(args[0], data);
            var x = evaluateExpression(args[1], data);
            return computeOLSFitted(y, x);
        }
        return data.map(function() { return 0; });
    }

    // c(expr, min, max) - clamp values between min and max
    // Use Infinity or -Infinity to only set one bound
    if (lowerName === 'c') {
        if (args.length >= 3) {
            var values = evaluateExpression(args[0], data);
            var minVal = evaluateExpression(args[1], data);
            var maxVal = evaluateExpression(args[2], data);

            // Get min/max bounds (they're arrays from evaluateExpression, but should be constant)
            var lo = minVal[0];
            var hi = maxVal[0];

            return values.map(function(v) {
                if (isNaN(v)) return v;
                if (v < lo) return lo;
                if (v > hi) return hi;
                return v;
            });
        }
        return data.map(function() { return 0; });
    }

    // Unknown function - return zeros
    return data.map(function() { return 0; });
}

// Compute z-score within groups
function computeGroupedZScore(values, data, groupCols) {
    if (groupCols.length === 0) {
        // No grouping - compute global z-score
        var validVals = values.filter(function(v) { return !isNaN(v) && isFinite(v); });
        if (validVals.length === 0) return values;
        var mean = validVals.reduce(function(a, b) { return a + b; }, 0) / validVals.length;
        var variance = validVals.reduce(function(a, b) { return a + (b - mean) * (b - mean); }, 0) / validVals.length;
        var std = Math.sqrt(variance);
        if (std === 0) return values.map(function() { return 0; });
        return values.map(function(v) { return (v - mean) / std; });
    }

    // Group by specified columns
    var groups = {};
    data.forEach(function(row, i) {
        var key = groupCols.map(function(col) { return row[col]; }).join('|');
        if (!groups[key]) groups[key] = { indices: [], values: [] };
        groups[key].indices.push(i);
        groups[key].values.push(values[i]);
    });

    // Compute z-score within each group
    var result = new Array(values.length);
    Object.keys(groups).forEach(function(key) {
        var g = groups[key];
        var validVals = g.values.filter(function(v) { return !isNaN(v) && isFinite(v); });
        if (validVals.length === 0) {
            g.indices.forEach(function(i) { result[i] = NaN; });
            return;
        }
        var mean = validVals.reduce(function(a, b) { return a + b; }, 0) / validVals.length;
        var variance = validVals.reduce(function(a, b) { return a + (b - mean) * (b - mean); }, 0) / validVals.length;
        var std = Math.sqrt(variance);
        g.indices.forEach(function(idx, j) {
            result[idx] = std === 0 ? 0 : (g.values[j] - mean) / std;
        });
    });
    return result;
}

// Compute quantile within groups
function computeGroupedQuantile(values, data, groupCols) {
    if (groupCols.length === 0) {
        // No grouping - compute global quantile
        return computeQuantileTransform(values);
    }

    // Group by specified columns
    var groups = {};
    data.forEach(function(row, i) {
        var key = groupCols.map(function(col) { return row[col]; }).join('|');
        if (!groups[key]) groups[key] = { indices: [], values: [] };
        groups[key].indices.push(i);
        groups[key].values.push(values[i]);
    });

    // Compute quantile within each group
    var result = new Array(values.length);
    Object.keys(groups).forEach(function(key) {
        var g = groups[key];
        var quantiles = computeQuantileTransform(g.values);
        g.indices.forEach(function(idx, j) {
            result[idx] = quantiles[j];
        });
    });
    return result;
}

// Compute PCA projection
// component: 1 for first PC, 2 for second PC
function computePCA(v1, v2, component) {
    var n = v1.length;
    if (n === 0) return [];

    // Filter valid pairs
    var validIndices = [];
    for (var i = 0; i < n; i++) {
        if (!isNaN(v1[i]) && isFinite(v1[i]) && !isNaN(v2[i]) && isFinite(v2[i])) {
            validIndices.push(i);
        }
    }

    if (validIndices.length < 2) {
        return v1.map(function() { return 0; });
    }

    // Compute means
    var mean1 = 0, mean2 = 0;
    validIndices.forEach(function(i) {
        mean1 += v1[i];
        mean2 += v2[i];
    });
    mean1 /= validIndices.length;
    mean2 /= validIndices.length;

    // Compute covariance matrix elements
    var cov11 = 0, cov12 = 0, cov22 = 0;
    validIndices.forEach(function(i) {
        var d1 = v1[i] - mean1;
        var d2 = v2[i] - mean2;
        cov11 += d1 * d1;
        cov12 += d1 * d2;
        cov22 += d2 * d2;
    });
    cov11 /= validIndices.length;
    cov12 /= validIndices.length;
    cov22 /= validIndices.length;

    // Compute eigenvalues and eigenvectors of 2x2 covariance matrix
    // Using closed-form solution for 2x2 symmetric matrix
    var trace = cov11 + cov22;
    var det = cov11 * cov22 - cov12 * cov12;
    var discriminant = Math.sqrt(Math.max(0, trace * trace / 4 - det));
    var lambda1 = trace / 2 + discriminant; // larger eigenvalue
    var lambda2 = trace / 2 - discriminant; // smaller eigenvalue

    // Eigenvector for lambda1 (first PC)
    var ev1_x, ev1_y;
    if (Math.abs(cov12) > 1e-10) {
        ev1_x = lambda1 - cov22;
        ev1_y = cov12;
    } else {
        ev1_x = 1;
        ev1_y = 0;
    }
    var norm1 = Math.sqrt(ev1_x * ev1_x + ev1_y * ev1_y);
    if (norm1 > 0) { ev1_x /= norm1; ev1_y /= norm1; }

    // Eigenvector for lambda2 (second PC) - perpendicular to first
    var ev2_x = -ev1_y;
    var ev2_y = ev1_x;

    // Choose eigenvector based on component
    var ev_x = component === 1 ? ev1_x : ev2_x;
    var ev_y = component === 1 ? ev1_y : ev2_y;

    // Project all points onto the principal component
    var result = new Array(n);
    for (var i = 0; i < n; i++) {
        if (!isNaN(v1[i]) && isFinite(v1[i]) && !isNaN(v2[i]) && isFinite(v2[i])) {
            result[i] = (v1[i] - mean1) * ev_x + (v2[i] - mean2) * ev_y;
        } else {
            result[i] = NaN;
        }
    }
    return result;
}

// Compute OLS regression coefficients (y = alpha + beta * x)
// Returns {alpha, beta} or null if regression fails
function computeOLSCoefficients(y, x) {
    var n = y.length;
    if (n === 0 || n !== x.length) return null;

    // Filter to valid pairs only
    var validPairs = [];
    for (var i = 0; i < n; i++) {
        if (!isNaN(y[i]) && isFinite(y[i]) && !isNaN(x[i]) && isFinite(x[i])) {
            validPairs.push({ y: y[i], x: x[i] });
        }
    }

    if (validPairs.length < 2) return null;

    // Compute means
    var sumX = 0, sumY = 0;
    validPairs.forEach(function(p) {
        sumX += p.x;
        sumY += p.y;
    });
    var meanX = sumX / validPairs.length;
    var meanY = sumY / validPairs.length;

    // Compute beta = Cov(x,y) / Var(x)
    var covXY = 0, varX = 0;
    validPairs.forEach(function(p) {
        var dx = p.x - meanX;
        var dy = p.y - meanY;
        covXY += dx * dy;
        varX += dx * dx;
    });

    if (varX === 0) return null; // x has no variance

    var beta = covXY / varX;
    var alpha = meanY - beta * meanX;

    return { alpha: alpha, beta: beta };
}

// Compute OLS residuals: r(y, x) = y - fitted = y - (alpha + beta * x)
function computeOLSResidual(y, x) {
    var coef = computeOLSCoefficients(y, x);
    if (!coef) {
        return y.map(function() { return NaN; });
    }

    return y.map(function(yi, i) {
        if (isNaN(yi) || !isFinite(yi) || isNaN(x[i]) || !isFinite(x[i])) {
            return NaN;
        }
        var fitted = coef.alpha + coef.beta * x[i];
        return yi - fitted;
    });
}

// Compute OLS fitted values: f(y, x) = alpha + beta * x
function computeOLSFitted(y, x) {
    var coef = computeOLSCoefficients(y, x);
    if (!coef) {
        return y.map(function() { return NaN; });
    }

    return x.map(function(xi, i) {
        if (isNaN(y[i]) || !isFinite(y[i]) || isNaN(xi) || !isFinite(xi)) {
            return NaN;
        }
        return coef.alpha + coef.beta * xi;
    });
}

// Main function to evaluate an expression string against data
function evaluateExpressionString(exprString, data) {
    if (!exprString || exprString.trim() === '') {
        return data.map(function() { return 0; });
    }
    try {
        var tokens = tokenizeExpression(exprString);
        var parseResult = parseExpression(tokens, 0);
        return evaluateExpression(parseResult.node, data);
    } catch (e) {
        console.error('Expression parsing error:', e);
        return data.map(function() { return 0; });
    }
}

// =============================================================================
// End Expression Parser
// =============================================================================

// Setup aspect ratio control for a chart
// This should be called after the chart is first rendered
// Uses logarithmic scale for better precision at smaller aspect ratios
function setupAspectRatioControl(chartId, updateCallback) {
    var slider = document.getElementById(chartId + '_aspect_ratio_slider');
    var label = document.getElementById(chartId + '_aspect_ratio_label');

    if (!slider || !label) return; // Not all charts have aspect ratio control

    slider.addEventListener('input', function() {
        // Convert from log space to linear space
        var logValue = parseFloat(this.value);
        var aspectRatio = Math.exp(logValue);
        label.textContent = aspectRatio.toFixed(2);

        // Get current width of chart div
        var chartDiv = document.getElementById(chartId);
        if (!chartDiv) return;

        var width = chartDiv.offsetWidth;
        var height = width * aspectRatio;

        // Update chart layout with new height
        Plotly.relayout(chartId, { height: height });

        // Call the optional callback if provided
        if (updateCallback && typeof updateCallback === 'function') {
            updateCallback(height);
        }
    });

    // Trigger initial sizing
    var initialLogValue = parseFloat(slider.value);
    var initialAspectRatio = Math.exp(initialLogValue);
    label.textContent = initialAspectRatio.toFixed(2);
    var chartDiv = document.getElementById(chartId);
    if (chartDiv) {
        var width = chartDiv.offsetWidth;
        var height = width * initialAspectRatio;
        Plotly.relayout(chartId, { height: height });
    }
}

// This function parses data from embedded or external sources and returns a Promise
// Supports CSV (embedded/external), JSON (embedded/external), and Parquet (external) formats
// Usage: loadDataset('dataLabel').then(function(data) { /* use data */ });
// Note: Data elements have IDs prefixed with "data_" to avoid collisions with chart container IDs
function loadDataset(dataLabel) {
    return new Promise(function(resolve, reject) {
        // Sanitize the label: replace spaces and special chars with underscores
        var sanitizedLabel = dataLabel.replace(/[\s\-\.:/\\]/g, '_');
        var dataElementId = 'data_' + sanitizedLabel;
        var dataElement = document.getElementById(dataElementId);
        if (!dataElement) {
            reject(new Error('Data element not found: ' + dataElementId + ' (from label: ' + dataLabel + ')'));
            return;
        }

        var format = dataElement.getAttribute('data-format') || 'csv_embedded';
        var dataSrc = dataElement.getAttribute('data-src');

        // Handle external JSON files
        if (format === 'json_external' && dataSrc) {
            fetch(dataSrc)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.json();
                })
                .then(function(data) {
                    // Parse dates in JSON data (centralized)
                    resolve(parseDatesInData(data));
                })
                .catch(function(error) {
                    console.error('Error loading external JSON:', error);
                    reject(error);
                });
            return;
        }

        // Handle external Parquet files
        if (format === 'parquet' && dataSrc) {
            // Wait for parquet-wasm to be loaded first
            waitForParquet()
                .then(function() {
                    return fetch(dataSrc);
                })
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.arrayBuffer();
                })
                .then(function(arrayBuffer) {
                    // Use parquet-wasm to read the file
                    var uint8Array = new Uint8Array(arrayBuffer);

                    // readParquet returns an Arrow Table
                    var wasmTable = window.parquetWasm.readParquet(uint8Array);

                    // Convert to Arrow IPC stream
                    var ipcStream = wasmTable.intoIPCStream();

                    // Use Apache Arrow JS to read the IPC stream
                    var arrowTable = window.Arrow.tableFromIPC(ipcStream);

                    // Convert Arrow Table to array of JavaScript objects
                    var data = [];
                    for (var i = 0; i < arrowTable.numRows; i++) {
                        var row = {};
                        arrowTable.schema.fields.forEach(function(field) {
                            var column = arrowTable.getChild(field.name);
                            var value = column.get(i);

                            // Convert BigInt to Number (Arrow returns BigInt for Int64)
                            if (typeof value === 'bigint') {
                                value = Number(value);
                            }

                            row[field.name] = value;
                        });
                        data.push(row);
                    }

                    // Parse dates in Parquet data (centralized date handling)
                    resolve(parseDatesInData(data));
                })
                .catch(function(error) {
                    console.error('Error loading external Parquet:', error);
                    reject(error);
                });
            return;
        }

        // Handle external CSV files
        if (format === 'csv_external' && dataSrc) {
            fetch(dataSrc)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.text();
                })
                .then(function(csvText) {
                    Papa.parse(csvText, {
                        header: true,
                        dynamicTyping: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            // Check for fatal errors only (not warnings)
                            var fatalErrors = results.errors.filter(function(err) {
                                return err.type !== 'Delimiter';
                            });

                            if (fatalErrors.length > 0) {
                                console.error('CSV parsing errors:', fatalErrors);
                                reject(fatalErrors);
                            } else if (results.data && results.data.length > 0) {
                                // Parse dates in CSV data (centralized)
                                resolve(parseDatesInData(results.data));
                            } else {
                                reject(new Error('No data parsed from CSV'));
                            }
                        },
                        error: function(error) {
                            console.error('CSV parsing error:', error);
                            reject(error);
                        }
                    });
                })
                .catch(function(error) {
                    console.error('Error loading external CSV:', error);
                    reject(error);
                });
            return;
        }

        // Handle embedded data
        var dataText = dataElement.textContent.trim();

        if (format === 'json_embedded') {
            // Parse JSON data
            try {
                var data = JSON.parse(dataText);
                // Parse dates in JSON data (centralized)
                resolve(parseDatesInData(data));
            } catch (error) {
                console.error('JSON parsing error:', error);
                reject(error);
            }
        } else if (format === 'csv_embedded') {
            // Parse CSV data using PapaParse
            Papa.parse(dataText, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    // Check for fatal errors only (not warnings)
                    // PapaParse includes non-fatal warnings in errors array
                    var fatalErrors = results.errors.filter(function(err) {
                        // Filter out delimiter detection warnings - these aren't fatal
                        // (common for single-column CSVs)
                        return err.type !== 'Delimiter';
                    });

                    if (fatalErrors.length > 0) {
                        console.error('CSV parsing errors:', fatalErrors);
                        reject(fatalErrors);
                    } else if (results.data && results.data.length > 0) {
                        // Parse dates in CSV data (centralized)
                        resolve(parseDatesInData(results.data));
                    } else {
                        reject(new Error('No data parsed from CSV'));
                    }
                },
                error: function(error) {
                    console.error('CSV parsing error:', error);
                    reject(error);
                }
            });
        } else {
            reject(new Error('Unsupported data format: ' + format));
        }
    });
}

$(function(){

// Global fix for PivotTable.js filter box positioning issue
// See: https://github.com/nicolaskruchten/pivottable/issues/865
// The library calculates position incorrectly - we fix it by repositioning after creation
(function() {
    if (window._pvtFilterBoxFixApplied) return; // Only apply once
    window._pvtFilterBoxFixApplied = true;

    var lastClickedTriangle = null;

    // Helper function to reposition the filter box
    function repositionFilterBox($box, triangle) {
        if (!triangle || !$box.length) return;

        // Get triangle position relative to viewport
        var triangleRect = triangle.getBoundingClientRect();

        // Get box dimensions (use defaults if not yet rendered)
        var boxWidth = $box.outerWidth() || 300;
        var boxHeight = $box.outerHeight() || 400;

        // Calculate position relative to viewport (for position:fixed)
        var newLeft = triangleRect.left;
        var newTop = triangleRect.bottom + 5;

        // Adjust if it would go off the right edge
        if (newLeft + boxWidth > window.innerWidth - 20) {
            newLeft = triangleRect.right - boxWidth;
        }

        // Adjust if it would go off the bottom edge
        if (newTop + boxHeight > window.innerHeight - 20) {
            newTop = triangleRect.top - boxHeight - 5;
        }

        // Ensure minimum positions
        if (newLeft < 10) newLeft = 10;
        if (newTop < 10) newTop = 10;

        // Use position:fixed for viewport-relative positioning
        $box.css({
            'position': 'fixed',
            'left': newLeft + 'px',
            'top': newTop + 'px'
        });
    }

    // Capture which triangle was clicked
    $(document).on('click', '.pvtTriangle', function(e) {
        lastClickedTriangle = this;
    });

    // Watch for filter box creation and fix position
    var observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            mutation.addedNodes.forEach(function(node) {
                if (node.nodeType === 1 && $(node).hasClass('pvtFilterBox')) {
                    var $box = $(node);
                    var triangle = lastClickedTriangle;

                    // Apply the fix multiple times to ensure it sticks after PivotTable.js finishes
                    // The library may set position after initial render
                    var timings = [0, 10, 50, 100, 200];
                    timings.forEach(function(delay) {
                        setTimeout(function() {
                            repositionFilterBox($box, triangle);
                        }, delay);
                    });

                    // Also reposition on any style changes to the box (in case library updates position)
                    var styleObserver = new MutationObserver(function(styleMutations) {
                        repositionFilterBox($box, triangle);
                    });
                    styleObserver.observe(node, { attributes: true, attributeFilter: ['style'] });

                    // Disconnect the style observer when the filter box is removed
                    var removalObserver = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            mutation.removedNodes.forEach(function(removedNode) {
                                if (removedNode === node) {
                                    styleObserver.disconnect();
                                    removalObserver.disconnect();
                                    lastClickedTriangle = null;
                                }
                            });
                        });
                    });
                    removalObserver.observe(document.body, { childList: true, subtree: true });
                }
            });
        });
    });

    observer.observe(document.body, { childList: true, subtree: true });
})();

    // Store current data and settings for this pivot table
    window.pivotTableDatasales_pivot = {};
    window.pivotTableConfigsales_pivot = {"rendererName":"Table","rows":["Region"],"aggregatorName":"Sum","vals":["Sales"],"rendererOptions":{ heatmap: { colorScaleGenerator: function(values) { return d3.scale.linear().domain([-2.5, -1.0, 0.0, 1.0, 2.5]).range(["#FF9999", "#FFFF99", "#FFFFFF", "#99FF99", "#99CCFF"]).clamp(true)}}},"cols":["Month"]};

    // Helper function to convert values to strings suitable for PivotTable.js
    // PivotTable.js expects string values, not Date objects
    function valueToStringsales_pivot(value) {
        if (value === null || value === undefined) {
            return '';
        }
        if (value instanceof Date) {
            // Check if this is a date-only value (time is midnight)
            var hours = value.getHours();
            var minutes = value.getMinutes();
            var seconds = value.getSeconds();
            var ms = value.getMilliseconds();

            var year = value.getFullYear();
            var month = String(value.getMonth() + 1).padStart(2, '0');
            var day = String(value.getDate()).padStart(2, '0');

            if (hours === 0 && minutes === 0 && seconds === 0 && ms === 0) {
                // Date only: YYYY-MM-DD
                return year + '-' + month + '-' + day;
            } else {
                // DateTime: YYYY-MM-DD HH:MM:SS
                var h = String(hours).padStart(2, '0');
                var m = String(minutes).padStart(2, '0');
                var s = String(seconds).padStart(2, '0');
                return year + '-' + month + '-' + day + ' ' + h + ':' + m + ':' + s;
            }
        }
        return value;
    }

    // Function to load and render the pivot table with a specific dataset
    function loadPivotTablesales_pivot(datasetName) {
        loadDataset(datasetName).then(function(data) {
            console.log('Loaded data for pivot table sales_pivot from dataset:', datasetName, data);

            // Validate data
            if (!data || data.length === 0) {
                throw new Error('No data loaded for pivot table sales_pivot');
            }

            // Store the data
            window.pivotTableDatasales_pivot[datasetName] = data;

            // Convert data to array format expected by pivotUI
            // First row is headers
            var headers = Object.keys(data[0]);
            var arrayData = [headers];

            // Add data rows - convert Date objects to strings for proper display
            data.forEach(function(row) {
                var rowArray = headers.map(function(header) {
                    return valueToStringsales_pivot(row[header]);
                });
                arrayData.push(rowArray);
            });

            console.log('Converted array data for sales_pivot (showing first 3 of ' + arrayData.length + ' rows):', arrayData.slice(0, 3));

            // Save current pivot state if exists
            var currentConfig = window.pivotTableConfigsales_pivot;
            var pivotEl = $("#sales_pivot");
            if (pivotEl.data('pivotUIOptions')) {
                // Preserve current user selections
                var opts = pivotEl.data('pivotUIOptions');
                currentConfig = {
                    rows: opts.rows,
                    cols: opts.cols,
                    vals: opts.vals,
                    aggregatorName: opts.aggregatorName,
                    rendererName: opts.rendererName,
                    inclusions: opts.inclusions,
                    exclusions: opts.exclusions,
                    rendererOptions: opts.rendererOptions
                };
            }

            // Render the pivot table
            pivotEl.pivotUI(
                arrayData,
                $.extend({
                    renderers: $.extend(
                        $.pivotUtilities.renderers,
                        $.pivotUtilities.c3_renderers,
                        $.pivotUtilities.d3_renderers,
                        $.pivotUtilities.export_renderers
                    ),
                    hiddenAttributes: [""]
                }, currentConfig)
            );

            // Initialize totals visibility based on checkbox state
            setTimeout(function() {
                if (window.toggleTotals_sales_pivot) {
                    window.toggleTotals_sales_pivot();
                }
            }, 100);
        }).catch(function(error) {
            console.error('Error loading data for pivot table sales_pivot:', error);
            $("#sales_pivot").html('<div style="color: red; padding: 20px;">Error loading pivot table: ' + error.message + '</div>');
        });
    }

    // Setup toggle for showing/hiding totals
    window.toggleTotals_sales_pivot = function() {
        const checkbox = document.getElementById('show_totals_checkbox_sales_pivot');
        const showTotals = checkbox.checked;

        // Find all total cells in the pivot table
        const pivotContainer = document.getElementById('sales_pivot');
        const totalCells = pivotContainer.querySelectorAll('.pvtTotal, .pvtGrandTotal');

        totalCells.forEach(function(cell) {
            cell.style.display = showTotals ? '' : 'none';
        });

        // Also hide/show total row headers (typically have "Totals" text)
        const allCells = pivotContainer.querySelectorAll('th, td');
        allCells.forEach(function(cell) {
            if (cell.textContent.trim() === 'Totals' || cell.textContent.trim() === 'Total') {
                cell.style.display = showTotals ? '' : 'none';
            }
        });
    };

    // Make dataset change handler global
    window.changeDataset_sales_pivot = function() {
        var select = document.getElementById('dataset_select_sales_pivot');
        if (select) {
            loadPivotTablesales_pivot(select.value);
        }
    };

    // Load the initial dataset
    loadPivotTablesales_pivot('sales_data');
    // Store current data and settings for this pivot table
    window.pivotTableDataperformance_heatmap = {};
    window.pivotTableConfigperformance_heatmap = {"rendererName":"Heatmap","rows":["Employee"],"aggregatorName":"Average","vals":["Score"],"rendererOptions":{ heatmap: { colorScaleGenerator: function(values) { return d3.scale.linear().domain([50.0, 65.0, 75.0, 85.0, 100.0]).range(["#d73027", "#fee08b", "#ffffbf", "#d9ef8b", "#1a9850"]).clamp(true)}}},"cols":["Quarter"]};

    // Helper function to convert values to strings suitable for PivotTable.js
    // PivotTable.js expects string values, not Date objects
    function valueToStringperformance_heatmap(value) {
        if (value === null || value === undefined) {
            return '';
        }
        if (value instanceof Date) {
            // Check if this is a date-only value (time is midnight)
            var hours = value.getHours();
            var minutes = value.getMinutes();
            var seconds = value.getSeconds();
            var ms = value.getMilliseconds();

            var year = value.getFullYear();
            var month = String(value.getMonth() + 1).padStart(2, '0');
            var day = String(value.getDate()).padStart(2, '0');

            if (hours === 0 && minutes === 0 && seconds === 0 && ms === 0) {
                // Date only: YYYY-MM-DD
                return year + '-' + month + '-' + day;
            } else {
                // DateTime: YYYY-MM-DD HH:MM:SS
                var h = String(hours).padStart(2, '0');
                var m = String(minutes).padStart(2, '0');
                var s = String(seconds).padStart(2, '0');
                return year + '-' + month + '-' + day + ' ' + h + ':' + m + ':' + s;
            }
        }
        return value;
    }

    // Function to load and render the pivot table with a specific dataset
    function loadPivotTableperformance_heatmap(datasetName) {
        loadDataset(datasetName).then(function(data) {
            console.log('Loaded data for pivot table performance_heatmap from dataset:', datasetName, data);

            // Validate data
            if (!data || data.length === 0) {
                throw new Error('No data loaded for pivot table performance_heatmap');
            }

            // Store the data
            window.pivotTableDataperformance_heatmap[datasetName] = data;

            // Convert data to array format expected by pivotUI
            // First row is headers
            var headers = Object.keys(data[0]);
            var arrayData = [headers];

            // Add data rows - convert Date objects to strings for proper display
            data.forEach(function(row) {
                var rowArray = headers.map(function(header) {
                    return valueToStringperformance_heatmap(row[header]);
                });
                arrayData.push(rowArray);
            });

            console.log('Converted array data for performance_heatmap (showing first 3 of ' + arrayData.length + ' rows):', arrayData.slice(0, 3));

            // Save current pivot state if exists
            var currentConfig = window.pivotTableConfigperformance_heatmap;
            var pivotEl = $("#performance_heatmap");
            if (pivotEl.data('pivotUIOptions')) {
                // Preserve current user selections
                var opts = pivotEl.data('pivotUIOptions');
                currentConfig = {
                    rows: opts.rows,
                    cols: opts.cols,
                    vals: opts.vals,
                    aggregatorName: opts.aggregatorName,
                    rendererName: opts.rendererName,
                    inclusions: opts.inclusions,
                    exclusions: opts.exclusions,
                    rendererOptions: opts.rendererOptions
                };
            }

            // Render the pivot table
            pivotEl.pivotUI(
                arrayData,
                $.extend({
                    renderers: $.extend(
                        $.pivotUtilities.renderers,
                        $.pivotUtilities.c3_renderers,
                        $.pivotUtilities.d3_renderers,
                        $.pivotUtilities.export_renderers
                    ),
                    hiddenAttributes: [""]
                }, currentConfig)
            );

            // Initialize totals visibility based on checkbox state
            setTimeout(function() {
                if (window.toggleTotals_performance_heatmap) {
                    window.toggleTotals_performance_heatmap();
                }
            }, 100);
        }).catch(function(error) {
            console.error('Error loading data for pivot table performance_heatmap:', error);
            $("#performance_heatmap").html('<div style="color: red; padding: 20px;">Error loading pivot table: ' + error.message + '</div>');
        });
    }

    // Setup toggle for showing/hiding totals
    window.toggleTotals_performance_heatmap = function() {
        const checkbox = document.getElementById('show_totals_checkbox_performance_heatmap');
        const showTotals = checkbox.checked;

        // Find all total cells in the pivot table
        const pivotContainer = document.getElementById('performance_heatmap');
        const totalCells = pivotContainer.querySelectorAll('.pvtTotal, .pvtGrandTotal');

        totalCells.forEach(function(cell) {
            cell.style.display = showTotals ? '' : 'none';
        });

        // Also hide/show total row headers (typically have "Totals" text)
        const allCells = pivotContainer.querySelectorAll('th, td');
        allCells.forEach(function(cell) {
            if (cell.textContent.trim() === 'Totals' || cell.textContent.trim() === 'Total') {
                cell.style.display = showTotals ? '' : 'none';
            }
        });
    };

    // Make dataset change handler global
    window.changeDataset_performance_heatmap = function() {
        var select = document.getElementById('dataset_select_performance_heatmap');
        if (select) {
            loadPivotTableperformance_heatmap(select.value);
        }
    };

    // Load the initial dataset
    loadPivotTableperformance_heatmap('performance_data');
    // Store current data and settings for this pivot table
    window.pivotTableDatarevenue_by_category = {};
    window.pivotTableConfigrevenue_by_category = {"rendererName":"Bar Chart","rows":["Category"],"aggregatorName":"Sum","vals":["Revenue"],"rendererOptions":{ heatmap: { colorScaleGenerator: function(values) { return d3.scale.linear().domain([-2.5, -1.0, 0.0, 1.0, 2.5]).range(["#FF9999", "#FFFF99", "#FFFFFF", "#99FF99", "#99CCFF"]).clamp(true)}}},"cols":["Quarter"]};

    // Helper function to convert values to strings suitable for PivotTable.js
    // PivotTable.js expects string values, not Date objects
    function valueToStringrevenue_by_category(value) {
        if (value === null || value === undefined) {
            return '';
        }
        if (value instanceof Date) {
            // Check if this is a date-only value (time is midnight)
            var hours = value.getHours();
            var minutes = value.getMinutes();
            var seconds = value.getSeconds();
            var ms = value.getMilliseconds();

            var year = value.getFullYear();
            var month = String(value.getMonth() + 1).padStart(2, '0');
            var day = String(value.getDate()).padStart(2, '0');

            if (hours === 0 && minutes === 0 && seconds === 0 && ms === 0) {
                // Date only: YYYY-MM-DD
                return year + '-' + month + '-' + day;
            } else {
                // DateTime: YYYY-MM-DD HH:MM:SS
                var h = String(hours).padStart(2, '0');
                var m = String(minutes).padStart(2, '0');
                var s = String(seconds).padStart(2, '0');
                return year + '-' + month + '-' + day + ' ' + h + ':' + m + ':' + s;
            }
        }
        return value;
    }

    // Function to load and render the pivot table with a specific dataset
    function loadPivotTablerevenue_by_category(datasetName) {
        loadDataset(datasetName).then(function(data) {
            console.log('Loaded data for pivot table revenue_by_category from dataset:', datasetName, data);

            // Validate data
            if (!data || data.length === 0) {
                throw new Error('No data loaded for pivot table revenue_by_category');
            }

            // Store the data
            window.pivotTableDatarevenue_by_category[datasetName] = data;

            // Convert data to array format expected by pivotUI
            // First row is headers
            var headers = Object.keys(data[0]);
            var arrayData = [headers];

            // Add data rows - convert Date objects to strings for proper display
            data.forEach(function(row) {
                var rowArray = headers.map(function(header) {
                    return valueToStringrevenue_by_category(row[header]);
                });
                arrayData.push(rowArray);
            });

            console.log('Converted array data for revenue_by_category (showing first 3 of ' + arrayData.length + ' rows):', arrayData.slice(0, 3));

            // Save current pivot state if exists
            var currentConfig = window.pivotTableConfigrevenue_by_category;
            var pivotEl = $("#revenue_by_category");
            if (pivotEl.data('pivotUIOptions')) {
                // Preserve current user selections
                var opts = pivotEl.data('pivotUIOptions');
                currentConfig = {
                    rows: opts.rows,
                    cols: opts.cols,
                    vals: opts.vals,
                    aggregatorName: opts.aggregatorName,
                    rendererName: opts.rendererName,
                    inclusions: opts.inclusions,
                    exclusions: opts.exclusions,
                    rendererOptions: opts.rendererOptions
                };
            }

            // Render the pivot table
            pivotEl.pivotUI(
                arrayData,
                $.extend({
                    renderers: $.extend(
                        $.pivotUtilities.renderers,
                        $.pivotUtilities.c3_renderers,
                        $.pivotUtilities.d3_renderers,
                        $.pivotUtilities.export_renderers
                    ),
                    hiddenAttributes: [""]
                }, currentConfig)
            );

            // Initialize totals visibility based on checkbox state
            setTimeout(function() {
                if (window.toggleTotals_revenue_by_category) {
                    window.toggleTotals_revenue_by_category();
                }
            }, 100);
        }).catch(function(error) {
            console.error('Error loading data for pivot table revenue_by_category:', error);
            $("#revenue_by_category").html('<div style="color: red; padding: 20px;">Error loading pivot table: ' + error.message + '</div>');
        });
    }

    // Setup toggle for showing/hiding totals
    window.toggleTotals_revenue_by_category = function() {
        const checkbox = document.getElementById('show_totals_checkbox_revenue_by_category');
        const showTotals = checkbox.checked;

        // Find all total cells in the pivot table
        const pivotContainer = document.getElementById('revenue_by_category');
        const totalCells = pivotContainer.querySelectorAll('.pvtTotal, .pvtGrandTotal');

        totalCells.forEach(function(cell) {
            cell.style.display = showTotals ? '' : 'none';
        });

        // Also hide/show total row headers (typically have "Totals" text)
        const allCells = pivotContainer.querySelectorAll('th, td');
        allCells.forEach(function(cell) {
            if (cell.textContent.trim() === 'Totals' || cell.textContent.trim() === 'Total') {
                cell.style.display = showTotals ? '' : 'none';
            }
        });
    };

    // Make dataset change handler global
    window.changeDataset_revenue_by_category = function() {
        var select = document.getElementById('dataset_select_revenue_by_category');
        if (select) {
            loadPivotTablerevenue_by_category(select.value);
        }
    };

    // Load the initial dataset
    loadPivotTablerevenue_by_category('product_data');
    // Store current data and settings for this pivot table
    window.pivotTableDatacustomer_revenue = {};
    window.pivotTableConfigcustomer_revenue = {"rendererName":"Heatmap","rows":["Country"],"aggregatorName":"Sum","vals":["Revenue"],"rendererOptions":{ heatmap: { colorScaleGenerator: function(values) { return d3.scale.linear().domain([-2.5, -1.0, 0.0, 1.0, 2.5]).range(["#FF9999", "#FFFF99", "#FFFFFF", "#99FF99", "#99CCFF"]).clamp(true)}}},"cols":["ProductType"],"exclusions":{"Country":["Test"]}};

    // Helper function to convert values to strings suitable for PivotTable.js
    // PivotTable.js expects string values, not Date objects
    function valueToStringcustomer_revenue(value) {
        if (value === null || value === undefined) {
            return '';
        }
        if (value instanceof Date) {
            // Check if this is a date-only value (time is midnight)
            var hours = value.getHours();
            var minutes = value.getMinutes();
            var seconds = value.getSeconds();
            var ms = value.getMilliseconds();

            var year = value.getFullYear();
            var month = String(value.getMonth() + 1).padStart(2, '0');
            var day = String(value.getDate()).padStart(2, '0');

            if (hours === 0 && minutes === 0 && seconds === 0 && ms === 0) {
                // Date only: YYYY-MM-DD
                return year + '-' + month + '-' + day;
            } else {
                // DateTime: YYYY-MM-DD HH:MM:SS
                var h = String(hours).padStart(2, '0');
                var m = String(minutes).padStart(2, '0');
                var s = String(seconds).padStart(2, '0');
                return year + '-' + month + '-' + day + ' ' + h + ':' + m + ':' + s;
            }
        }
        return value;
    }

    // Function to load and render the pivot table with a specific dataset
    function loadPivotTablecustomer_revenue(datasetName) {
        loadDataset(datasetName).then(function(data) {
            console.log('Loaded data for pivot table customer_revenue from dataset:', datasetName, data);

            // Validate data
            if (!data || data.length === 0) {
                throw new Error('No data loaded for pivot table customer_revenue');
            }

            // Store the data
            window.pivotTableDatacustomer_revenue[datasetName] = data;

            // Convert data to array format expected by pivotUI
            // First row is headers
            var headers = Object.keys(data[0]);
            var arrayData = [headers];

            // Add data rows - convert Date objects to strings for proper display
            data.forEach(function(row) {
                var rowArray = headers.map(function(header) {
                    return valueToStringcustomer_revenue(row[header]);
                });
                arrayData.push(rowArray);
            });

            console.log('Converted array data for customer_revenue (showing first 3 of ' + arrayData.length + ' rows):', arrayData.slice(0, 3));

            // Save current pivot state if exists
            var currentConfig = window.pivotTableConfigcustomer_revenue;
            var pivotEl = $("#customer_revenue");
            if (pivotEl.data('pivotUIOptions')) {
                // Preserve current user selections
                var opts = pivotEl.data('pivotUIOptions');
                currentConfig = {
                    rows: opts.rows,
                    cols: opts.cols,
                    vals: opts.vals,
                    aggregatorName: opts.aggregatorName,
                    rendererName: opts.rendererName,
                    inclusions: opts.inclusions,
                    exclusions: opts.exclusions,
                    rendererOptions: opts.rendererOptions
                };
            }

            // Render the pivot table
            pivotEl.pivotUI(
                arrayData,
                $.extend({
                    renderers: $.extend(
                        $.pivotUtilities.renderers,
                        $.pivotUtilities.c3_renderers,
                        $.pivotUtilities.d3_renderers,
                        $.pivotUtilities.export_renderers
                    ),
                    hiddenAttributes: [""]
                }, currentConfig)
            );

            // Initialize totals visibility based on checkbox state
            setTimeout(function() {
                if (window.toggleTotals_customer_revenue) {
                    window.toggleTotals_customer_revenue();
                }
            }, 100);
        }).catch(function(error) {
            console.error('Error loading data for pivot table customer_revenue:', error);
            $("#customer_revenue").html('<div style="color: red; padding: 20px;">Error loading pivot table: ' + error.message + '</div>');
        });
    }

    // Setup toggle for showing/hiding totals
    window.toggleTotals_customer_revenue = function() {
        const checkbox = document.getElementById('show_totals_checkbox_customer_revenue');
        const showTotals = checkbox.checked;

        // Find all total cells in the pivot table
        const pivotContainer = document.getElementById('customer_revenue');
        const totalCells = pivotContainer.querySelectorAll('.pvtTotal, .pvtGrandTotal');

        totalCells.forEach(function(cell) {
            cell.style.display = showTotals ? '' : 'none';
        });

        // Also hide/show total row headers (typically have "Totals" text)
        const allCells = pivotContainer.querySelectorAll('th, td');
        allCells.forEach(function(cell) {
            if (cell.textContent.trim() === 'Totals' || cell.textContent.trim() === 'Total') {
                cell.style.display = showTotals ? '' : 'none';
            }
        });
    };

    // Make dataset change handler global
    window.changeDataset_customer_revenue = function() {
        var select = document.getElementById('dataset_select_customer_revenue');
        if (select) {
            loadPivotTablecustomer_revenue(select.value);
        }
    };

    // Load the initial dataset
    loadPivotTablecustomer_revenue('customer_data');
    // Store current data and settings for this pivot table
    window.pivotTableDatasurvey_results = {};
    window.pivotTableConfigsurvey_results = {"rendererName":"Table Barchart","rows":["Age_Group","Gender"],"aggregatorName":"Average","vals":["Satisfaction"],"inclusions":{"Age_Group":["18-25","26-35","36-45"]},"rendererOptions":{ heatmap: { colorScaleGenerator: function(values) { return d3.scale.linear().domain([-2.5, -1.0, 0.0, 1.0, 2.5]).range(["#FF9999", "#FFFF99", "#FFFFFF", "#99FF99", "#99CCFF"]).clamp(true)}}},"cols":["Product"]};

    // Helper function to convert values to strings suitable for PivotTable.js
    // PivotTable.js expects string values, not Date objects
    function valueToStringsurvey_results(value) {
        if (value === null || value === undefined) {
            return '';
        }
        if (value instanceof Date) {
            // Check if this is a date-only value (time is midnight)
            var hours = value.getHours();
            var minutes = value.getMinutes();
            var seconds = value.getSeconds();
            var ms = value.getMilliseconds();

            var year = value.getFullYear();
            var month = String(value.getMonth() + 1).padStart(2, '0');
            var day = String(value.getDate()).padStart(2, '0');

            if (hours === 0 && minutes === 0 && seconds === 0 && ms === 0) {
                // Date only: YYYY-MM-DD
                return year + '-' + month + '-' + day;
            } else {
                // DateTime: YYYY-MM-DD HH:MM:SS
                var h = String(hours).padStart(2, '0');
                var m = String(minutes).padStart(2, '0');
                var s = String(seconds).padStart(2, '0');
                return year + '-' + month + '-' + day + ' ' + h + ':' + m + ':' + s;
            }
        }
        return value;
    }

    // Function to load and render the pivot table with a specific dataset
    function loadPivotTablesurvey_results(datasetName) {
        loadDataset(datasetName).then(function(data) {
            console.log('Loaded data for pivot table survey_results from dataset:', datasetName, data);

            // Validate data
            if (!data || data.length === 0) {
                throw new Error('No data loaded for pivot table survey_results');
            }

            // Store the data
            window.pivotTableDatasurvey_results[datasetName] = data;

            // Convert data to array format expected by pivotUI
            // First row is headers
            var headers = Object.keys(data[0]);
            var arrayData = [headers];

            // Add data rows - convert Date objects to strings for proper display
            data.forEach(function(row) {
                var rowArray = headers.map(function(header) {
                    return valueToStringsurvey_results(row[header]);
                });
                arrayData.push(rowArray);
            });

            console.log('Converted array data for survey_results (showing first 3 of ' + arrayData.length + ' rows):', arrayData.slice(0, 3));

            // Save current pivot state if exists
            var currentConfig = window.pivotTableConfigsurvey_results;
            var pivotEl = $("#survey_results");
            if (pivotEl.data('pivotUIOptions')) {
                // Preserve current user selections
                var opts = pivotEl.data('pivotUIOptions');
                currentConfig = {
                    rows: opts.rows,
                    cols: opts.cols,
                    vals: opts.vals,
                    aggregatorName: opts.aggregatorName,
                    rendererName: opts.rendererName,
                    inclusions: opts.inclusions,
                    exclusions: opts.exclusions,
                    rendererOptions: opts.rendererOptions
                };
            }

            // Render the pivot table
            pivotEl.pivotUI(
                arrayData,
                $.extend({
                    renderers: $.extend(
                        $.pivotUtilities.renderers,
                        $.pivotUtilities.c3_renderers,
                        $.pivotUtilities.d3_renderers,
                        $.pivotUtilities.export_renderers
                    ),
                    hiddenAttributes: [""]
                }, currentConfig)
            );

            // Initialize totals visibility based on checkbox state
            setTimeout(function() {
                if (window.toggleTotals_survey_results) {
                    window.toggleTotals_survey_results();
                }
            }, 100);
        }).catch(function(error) {
            console.error('Error loading data for pivot table survey_results:', error);
            $("#survey_results").html('<div style="color: red; padding: 20px;">Error loading pivot table: ' + error.message + '</div>');
        });
    }

    // Setup toggle for showing/hiding totals
    window.toggleTotals_survey_results = function() {
        const checkbox = document.getElementById('show_totals_checkbox_survey_results');
        const showTotals = checkbox.checked;

        // Find all total cells in the pivot table
        const pivotContainer = document.getElementById('survey_results');
        const totalCells = pivotContainer.querySelectorAll('.pvtTotal, .pvtGrandTotal');

        totalCells.forEach(function(cell) {
            cell.style.display = showTotals ? '' : 'none';
        });

        // Also hide/show total row headers (typically have "Totals" text)
        const allCells = pivotContainer.querySelectorAll('th, td');
        allCells.forEach(function(cell) {
            if (cell.textContent.trim() === 'Totals' || cell.textContent.trim() === 'Total') {
                cell.style.display = showTotals ? '' : 'none';
            }
        });
    };

    // Make dataset change handler global
    window.changeDataset_survey_results = function() {
        var select = document.getElementById('dataset_select_survey_results');
        if (select) {
            loadPivotTablesurvey_results(select.value);
        }
    };

    // Load the initial dataset
    loadPivotTablesurvey_results('survey_data');
    // Store current data and settings for this pivot table
    window.pivotTableDatatransaction_analysis = {};
    window.pivotTableConfigtransaction_analysis = {"rendererName":"Heatmap","rows":["Customer_Type"],"aggregatorName":"Count","vals":["Amount"],"rendererOptions":{ heatmap: { colorScaleGenerator: function(values) { return d3.scale.linear().domain([0.0, 50.0, 100.0, 150.0]).range(["#f7fbff", "#9ecae1", "#4292c6", "#08519c"]).clamp(true)}}},"cols":["Transaction_Type"]};

    // Helper function to convert values to strings suitable for PivotTable.js
    // PivotTable.js expects string values, not Date objects
    function valueToStringtransaction_analysis(value) {
        if (value === null || value === undefined) {
            return '';
        }
        if (value instanceof Date) {
            // Check if this is a date-only value (time is midnight)
            var hours = value.getHours();
            var minutes = value.getMinutes();
            var seconds = value.getSeconds();
            var ms = value.getMilliseconds();

            var year = value.getFullYear();
            var month = String(value.getMonth() + 1).padStart(2, '0');
            var day = String(value.getDate()).padStart(2, '0');

            if (hours === 0 && minutes === 0 && seconds === 0 && ms === 0) {
                // Date only: YYYY-MM-DD
                return year + '-' + month + '-' + day;
            } else {
                // DateTime: YYYY-MM-DD HH:MM:SS
                var h = String(hours).padStart(2, '0');
                var m = String(minutes).padStart(2, '0');
                var s = String(seconds).padStart(2, '0');
                return year + '-' + month + '-' + day + ' ' + h + ':' + m + ':' + s;
            }
        }
        return value;
    }

    // Function to load and render the pivot table with a specific dataset
    function loadPivotTabletransaction_analysis(datasetName) {
        loadDataset(datasetName).then(function(data) {
            console.log('Loaded data for pivot table transaction_analysis from dataset:', datasetName, data);

            // Validate data
            if (!data || data.length === 0) {
                throw new Error('No data loaded for pivot table transaction_analysis');
            }

            // Store the data
            window.pivotTableDatatransaction_analysis[datasetName] = data;

            // Convert data to array format expected by pivotUI
            // First row is headers
            var headers = Object.keys(data[0]);
            var arrayData = [headers];

            // Add data rows - convert Date objects to strings for proper display
            data.forEach(function(row) {
                var rowArray = headers.map(function(header) {
                    return valueToStringtransaction_analysis(row[header]);
                });
                arrayData.push(rowArray);
            });

            console.log('Converted array data for transaction_analysis (showing first 3 of ' + arrayData.length + ' rows):', arrayData.slice(0, 3));

            // Save current pivot state if exists
            var currentConfig = window.pivotTableConfigtransaction_analysis;
            var pivotEl = $("#transaction_analysis");
            if (pivotEl.data('pivotUIOptions')) {
                // Preserve current user selections
                var opts = pivotEl.data('pivotUIOptions');
                currentConfig = {
                    rows: opts.rows,
                    cols: opts.cols,
                    vals: opts.vals,
                    aggregatorName: opts.aggregatorName,
                    rendererName: opts.rendererName,
                    inclusions: opts.inclusions,
                    exclusions: opts.exclusions,
                    rendererOptions: opts.rendererOptions
                };
            }

            // Render the pivot table
            pivotEl.pivotUI(
                arrayData,
                $.extend({
                    renderers: $.extend(
                        $.pivotUtilities.renderers,
                        $.pivotUtilities.c3_renderers,
                        $.pivotUtilities.d3_renderers,
                        $.pivotUtilities.export_renderers
                    ),
                    hiddenAttributes: [""]
                }, currentConfig)
            );

            // Initialize totals visibility based on checkbox state
            setTimeout(function() {
                if (window.toggleTotals_transaction_analysis) {
                    window.toggleTotals_transaction_analysis();
                }
            }, 100);
        }).catch(function(error) {
            console.error('Error loading data for pivot table transaction_analysis:', error);
            $("#transaction_analysis").html('<div style="color: red; padding: 20px;">Error loading pivot table: ' + error.message + '</div>');
        });
    }

    // Setup toggle for showing/hiding totals
    window.toggleTotals_transaction_analysis = function() {
        const checkbox = document.getElementById('show_totals_checkbox_transaction_analysis');
        const showTotals = checkbox.checked;

        // Find all total cells in the pivot table
        const pivotContainer = document.getElementById('transaction_analysis');
        const totalCells = pivotContainer.querySelectorAll('.pvtTotal, .pvtGrandTotal');

        totalCells.forEach(function(cell) {
            cell.style.display = showTotals ? '' : 'none';
        });

        // Also hide/show total row headers (typically have "Totals" text)
        const allCells = pivotContainer.querySelectorAll('th, td');
        allCells.forEach(function(cell) {
            if (cell.textContent.trim() === 'Totals' || cell.textContent.trim() === 'Total') {
                cell.style.display = showTotals ? '' : 'none';
            }
        });
    };

    // Make dataset change handler global
    window.changeDataset_transaction_analysis = function() {
        var select = document.getElementById('dataset_select_transaction_analysis');
        if (select) {
            loadPivotTabletransaction_analysis(select.value);
        }
    };

    // Load the initial dataset
    loadPivotTabletransaction_analysis('transaction_data');
    // Store current data and settings for this pivot table
    window.pivotTableDataReturns_Over_Last_Few_Days = {};
    window.pivotTableConfigReturns_Over_Last_Few_Days = {"rendererName":"Heatmap","rows":["Symbol"],"aggregatorName":"Average","vals":["Return"],"rendererOptions":{ heatmap: { colorScaleGenerator: function(values) { return d3.scale.linear().domain([-2.5, -1.0, 0.0, 1.0, 2.5]).range(["#FF9999", "#FFFF99", "#FFFFFF", "#99FF99", "#99CCFF"]).clamp(true)}}},"cols":["Date"],"exclusions":{"Symbol":["MSFT"]}};

    // Helper function to convert values to strings suitable for PivotTable.js
    // PivotTable.js expects string values, not Date objects
    function valueToStringReturns_Over_Last_Few_Days(value) {
        if (value === null || value === undefined) {
            return '';
        }
        if (value instanceof Date) {
            // Check if this is a date-only value (time is midnight)
            var hours = value.getHours();
            var minutes = value.getMinutes();
            var seconds = value.getSeconds();
            var ms = value.getMilliseconds();

            var year = value.getFullYear();
            var month = String(value.getMonth() + 1).padStart(2, '0');
            var day = String(value.getDate()).padStart(2, '0');

            if (hours === 0 && minutes === 0 && seconds === 0 && ms === 0) {
                // Date only: YYYY-MM-DD
                return year + '-' + month + '-' + day;
            } else {
                // DateTime: YYYY-MM-DD HH:MM:SS
                var h = String(hours).padStart(2, '0');
                var m = String(minutes).padStart(2, '0');
                var s = String(seconds).padStart(2, '0');
                return year + '-' + month + '-' + day + ' ' + h + ':' + m + ':' + s;
            }
        }
        return value;
    }

    // Function to load and render the pivot table with a specific dataset
    function loadPivotTableReturns_Over_Last_Few_Days(datasetName) {
        loadDataset(datasetName).then(function(data) {
            console.log('Loaded data for pivot table Returns_Over_Last_Few_Days from dataset:', datasetName, data);

            // Validate data
            if (!data || data.length === 0) {
                throw new Error('No data loaded for pivot table Returns_Over_Last_Few_Days');
            }

            // Store the data
            window.pivotTableDataReturns_Over_Last_Few_Days[datasetName] = data;

            // Convert data to array format expected by pivotUI
            // First row is headers
            var headers = Object.keys(data[0]);
            var arrayData = [headers];

            // Add data rows - convert Date objects to strings for proper display
            data.forEach(function(row) {
                var rowArray = headers.map(function(header) {
                    return valueToStringReturns_Over_Last_Few_Days(row[header]);
                });
                arrayData.push(rowArray);
            });

            console.log('Converted array data for Returns_Over_Last_Few_Days (showing first 3 of ' + arrayData.length + ' rows):', arrayData.slice(0, 3));

            // Save current pivot state if exists
            var currentConfig = window.pivotTableConfigReturns_Over_Last_Few_Days;
            var pivotEl = $("#Returns_Over_Last_Few_Days");
            if (pivotEl.data('pivotUIOptions')) {
                // Preserve current user selections
                var opts = pivotEl.data('pivotUIOptions');
                currentConfig = {
                    rows: opts.rows,
                    cols: opts.cols,
                    vals: opts.vals,
                    aggregatorName: opts.aggregatorName,
                    rendererName: opts.rendererName,
                    inclusions: opts.inclusions,
                    exclusions: opts.exclusions,
                    rendererOptions: opts.rendererOptions
                };
            }

            // Render the pivot table
            pivotEl.pivotUI(
                arrayData,
                $.extend({
                    renderers: $.extend(
                        $.pivotUtilities.renderers,
                        $.pivotUtilities.c3_renderers,
                        $.pivotUtilities.d3_renderers,
                        $.pivotUtilities.export_renderers
                    ),
                    hiddenAttributes: [""]
                }, currentConfig)
            );

            // Initialize totals visibility based on checkbox state
            setTimeout(function() {
                if (window.toggleTotals_Returns_Over_Last_Few_Days) {
                    window.toggleTotals_Returns_Over_Last_Few_Days();
                }
            }, 100);
        }).catch(function(error) {
            console.error('Error loading data for pivot table Returns_Over_Last_Few_Days:', error);
            $("#Returns_Over_Last_Few_Days").html('<div style="color: red; padding: 20px;">Error loading pivot table: ' + error.message + '</div>');
        });
    }

    // Setup toggle for showing/hiding totals
    window.toggleTotals_Returns_Over_Last_Few_Days = function() {
        const checkbox = document.getElementById('show_totals_checkbox_Returns_Over_Last_Few_Days');
        const showTotals = checkbox.checked;

        // Find all total cells in the pivot table
        const pivotContainer = document.getElementById('Returns_Over_Last_Few_Days');
        const totalCells = pivotContainer.querySelectorAll('.pvtTotal, .pvtGrandTotal');

        totalCells.forEach(function(cell) {
            cell.style.display = showTotals ? '' : 'none';
        });

        // Also hide/show total row headers (typically have "Totals" text)
        const allCells = pivotContainer.querySelectorAll('th, td');
        allCells.forEach(function(cell) {
            if (cell.textContent.trim() === 'Totals' || cell.textContent.trim() === 'Total') {
                cell.style.display = showTotals ? '' : 'none';
            }
        });
    };

    // Make dataset change handler global
    window.changeDataset_Returns_Over_Last_Few_Days = function() {
        var select = document.getElementById('dataset_select_Returns_Over_Last_Few_Days');
        if (select) {
            loadPivotTableReturns_Over_Last_Few_Days(select.value);
        }
    };

    // Load the initial dataset
    loadPivotTableReturns_Over_Last_Few_Days('stockReturns');
    // Store current data and settings for this pivot table
    window.pivotTableDataCorrelation_Matrix = {};
    window.pivotTableConfigCorrelation_Matrix = {"rendererName":"Heatmap","rows":["Symbol1"],"aggregatorName":"Average","vals":["Correlation"],"rendererOptions":{ heatmap: { colorScaleGenerator: function(values) { return d3.scale.linear().domain([-1.0, 0.0, 1.0]).range(["#FF4545", "#ffffff", "#4F92FF"]).clamp(true)}}},"cols":["Symbol2"]};

    // Helper function to convert values to strings suitable for PivotTable.js
    // PivotTable.js expects string values, not Date objects
    function valueToStringCorrelation_Matrix(value) {
        if (value === null || value === undefined) {
            return '';
        }
        if (value instanceof Date) {
            // Check if this is a date-only value (time is midnight)
            var hours = value.getHours();
            var minutes = value.getMinutes();
            var seconds = value.getSeconds();
            var ms = value.getMilliseconds();

            var year = value.getFullYear();
            var month = String(value.getMonth() + 1).padStart(2, '0');
            var day = String(value.getDate()).padStart(2, '0');

            if (hours === 0 && minutes === 0 && seconds === 0 && ms === 0) {
                // Date only: YYYY-MM-DD
                return year + '-' + month + '-' + day;
            } else {
                // DateTime: YYYY-MM-DD HH:MM:SS
                var h = String(hours).padStart(2, '0');
                var m = String(minutes).padStart(2, '0');
                var s = String(seconds).padStart(2, '0');
                return year + '-' + month + '-' + day + ' ' + h + ':' + m + ':' + s;
            }
        }
        return value;
    }

    // Function to load and render the pivot table with a specific dataset
    function loadPivotTableCorrelation_Matrix(datasetName) {
        loadDataset(datasetName).then(function(data) {
            console.log('Loaded data for pivot table Correlation_Matrix from dataset:', datasetName, data);

            // Validate data
            if (!data || data.length === 0) {
                throw new Error('No data loaded for pivot table Correlation_Matrix');
            }

            // Store the data
            window.pivotTableDataCorrelation_Matrix[datasetName] = data;

            // Convert data to array format expected by pivotUI
            // First row is headers
            var headers = Object.keys(data[0]);
            var arrayData = [headers];

            // Add data rows - convert Date objects to strings for proper display
            data.forEach(function(row) {
                var rowArray = headers.map(function(header) {
                    return valueToStringCorrelation_Matrix(row[header]);
                });
                arrayData.push(rowArray);
            });

            console.log('Converted array data for Correlation_Matrix (showing first 3 of ' + arrayData.length + ' rows):', arrayData.slice(0, 3));

            // Save current pivot state if exists
            var currentConfig = window.pivotTableConfigCorrelation_Matrix;
            var pivotEl = $("#Correlation_Matrix");
            if (pivotEl.data('pivotUIOptions')) {
                // Preserve current user selections
                var opts = pivotEl.data('pivotUIOptions');
                currentConfig = {
                    rows: opts.rows,
                    cols: opts.cols,
                    vals: opts.vals,
                    aggregatorName: opts.aggregatorName,
                    rendererName: opts.rendererName,
                    inclusions: opts.inclusions,
                    exclusions: opts.exclusions,
                    rendererOptions: opts.rendererOptions
                };
            }

            // Render the pivot table
            pivotEl.pivotUI(
                arrayData,
                $.extend({
                    renderers: $.extend(
                        $.pivotUtilities.renderers,
                        $.pivotUtilities.c3_renderers,
                        $.pivotUtilities.d3_renderers,
                        $.pivotUtilities.export_renderers
                    ),
                    hiddenAttributes: [""]
                }, currentConfig)
            );

            // Initialize totals visibility based on checkbox state
            setTimeout(function() {
                if (window.toggleTotals_Correlation_Matrix) {
                    window.toggleTotals_Correlation_Matrix();
                }
            }, 100);
        }).catch(function(error) {
            console.error('Error loading data for pivot table Correlation_Matrix:', error);
            $("#Correlation_Matrix").html('<div style="color: red; padding: 20px;">Error loading pivot table: ' + error.message + '</div>');
        });
    }

    // Setup toggle for showing/hiding totals
    window.toggleTotals_Correlation_Matrix = function() {
        const checkbox = document.getElementById('show_totals_checkbox_Correlation_Matrix');
        const showTotals = checkbox.checked;

        // Find all total cells in the pivot table
        const pivotContainer = document.getElementById('Correlation_Matrix');
        const totalCells = pivotContainer.querySelectorAll('.pvtTotal, .pvtGrandTotal');

        totalCells.forEach(function(cell) {
            cell.style.display = showTotals ? '' : 'none';
        });

        // Also hide/show total row headers (typically have "Totals" text)
        const allCells = pivotContainer.querySelectorAll('th, td');
        allCells.forEach(function(cell) {
            if (cell.textContent.trim() === 'Totals' || cell.textContent.trim() === 'Total') {
                cell.style.display = showTotals ? '' : 'none';
            }
        });
    };

    // Make dataset change handler global
    window.changeDataset_Correlation_Matrix = function() {
        var select = document.getElementById('dataset_select_Correlation_Matrix');
        if (select) {
            loadPivotTableCorrelation_Matrix(select.value);
        }
    };

    // Load the initial dataset
    loadPivotTableCorrelation_Matrix('correlations');
    // Store current data and settings for this pivot table
    window.pivotTableDatadataset_selector_demo = {};
    window.pivotTableConfigdataset_selector_demo = {"rendererName":"Heatmap","rows":["Category"],"aggregatorName":"Sum","rendererOptions":{ heatmap: { colorScaleGenerator: function(values) { return d3.scale.linear().domain([-2.5, -1.0, 0.0, 1.0, 2.5]).range(["#FF9999", "#FFFF99", "#FFFFFF", "#99FF99", "#99CCFF"]).clamp(true)}}}};

    // Helper function to convert values to strings suitable for PivotTable.js
    // PivotTable.js expects string values, not Date objects
    function valueToStringdataset_selector_demo(value) {
        if (value === null || value === undefined) {
            return '';
        }
        if (value instanceof Date) {
            // Check if this is a date-only value (time is midnight)
            var hours = value.getHours();
            var minutes = value.getMinutes();
            var seconds = value.getSeconds();
            var ms = value.getMilliseconds();

            var year = value.getFullYear();
            var month = String(value.getMonth() + 1).padStart(2, '0');
            var day = String(value.getDate()).padStart(2, '0');

            if (hours === 0 && minutes === 0 && seconds === 0 && ms === 0) {
                // Date only: YYYY-MM-DD
                return year + '-' + month + '-' + day;
            } else {
                // DateTime: YYYY-MM-DD HH:MM:SS
                var h = String(hours).padStart(2, '0');
                var m = String(minutes).padStart(2, '0');
                var s = String(seconds).padStart(2, '0');
                return year + '-' + month + '-' + day + ' ' + h + ':' + m + ':' + s;
            }
        }
        return value;
    }

    // Function to load and render the pivot table with a specific dataset
    function loadPivotTabledataset_selector_demo(datasetName) {
        loadDataset(datasetName).then(function(data) {
            console.log('Loaded data for pivot table dataset_selector_demo from dataset:', datasetName, data);

            // Validate data
            if (!data || data.length === 0) {
                throw new Error('No data loaded for pivot table dataset_selector_demo');
            }

            // Store the data
            window.pivotTableDatadataset_selector_demo[datasetName] = data;

            // Convert data to array format expected by pivotUI
            // First row is headers
            var headers = Object.keys(data[0]);
            var arrayData = [headers];

            // Add data rows - convert Date objects to strings for proper display
            data.forEach(function(row) {
                var rowArray = headers.map(function(header) {
                    return valueToStringdataset_selector_demo(row[header]);
                });
                arrayData.push(rowArray);
            });

            console.log('Converted array data for dataset_selector_demo (showing first 3 of ' + arrayData.length + ' rows):', arrayData.slice(0, 3));

            // Save current pivot state if exists
            var currentConfig = window.pivotTableConfigdataset_selector_demo;
            var pivotEl = $("#dataset_selector_demo");
            if (pivotEl.data('pivotUIOptions')) {
                // Preserve current user selections
                var opts = pivotEl.data('pivotUIOptions');
                currentConfig = {
                    rows: opts.rows,
                    cols: opts.cols,
                    vals: opts.vals,
                    aggregatorName: opts.aggregatorName,
                    rendererName: opts.rendererName,
                    inclusions: opts.inclusions,
                    exclusions: opts.exclusions,
                    rendererOptions: opts.rendererOptions
                };
            }

            // Render the pivot table
            pivotEl.pivotUI(
                arrayData,
                $.extend({
                    renderers: $.extend(
                        $.pivotUtilities.renderers,
                        $.pivotUtilities.c3_renderers,
                        $.pivotUtilities.d3_renderers,
                        $.pivotUtilities.export_renderers
                    ),
                    hiddenAttributes: [""]
                }, currentConfig)
            );

            // Initialize totals visibility based on checkbox state
            setTimeout(function() {
                if (window.toggleTotals_dataset_selector_demo) {
                    window.toggleTotals_dataset_selector_demo();
                }
            }, 100);
        }).catch(function(error) {
            console.error('Error loading data for pivot table dataset_selector_demo:', error);
            $("#dataset_selector_demo").html('<div style="color: red; padding: 20px;">Error loading pivot table: ' + error.message + '</div>');
        });
    }

    // Setup toggle for showing/hiding totals
    window.toggleTotals_dataset_selector_demo = function() {
        const checkbox = document.getElementById('show_totals_checkbox_dataset_selector_demo');
        const showTotals = checkbox.checked;

        // Find all total cells in the pivot table
        const pivotContainer = document.getElementById('dataset_selector_demo');
        const totalCells = pivotContainer.querySelectorAll('.pvtTotal, .pvtGrandTotal');

        totalCells.forEach(function(cell) {
            cell.style.display = showTotals ? '' : 'none';
        });

        // Also hide/show total row headers (typically have "Totals" text)
        const allCells = pivotContainer.querySelectorAll('th, td');
        allCells.forEach(function(cell) {
            if (cell.textContent.trim() === 'Totals' || cell.textContent.trim() === 'Total') {
                cell.style.display = showTotals ? '' : 'none';
            }
        });
    };

    // Make dataset change handler global
    window.changeDataset_dataset_selector_demo = function() {
        var select = document.getElementById('dataset_select_dataset_selector_demo');
        if (select) {
            loadPivotTabledataset_selector_demo(select.value);
        }
    };

    // Load the initial dataset
    loadPivotTabledataset_selector_demo('multi_data.aa');
    // Store current data and settings for this pivot table
    window.pivotTableDataboxing_matches = {};
    window.pivotTableConfigboxing_matches = {"rendererName":"Heatmap","rows":["city"],"aggregatorName":"Sum","vals":["ticketsales"],"rendererOptions":{ heatmap: { colorScaleGenerator: function(values) { return d3.scale.linear().domain([0.0, 2.5e7, 5.0e7, 7.5e7, 1.0e8]).range(["#f7fbff", "#9ecae1", "#4292c6", "#2171b5", "#084594"]).clamp(true)}}},"cols":["boxer1"]};

    // Helper function to convert values to strings suitable for PivotTable.js
    // PivotTable.js expects string values, not Date objects
    function valueToStringboxing_matches(value) {
        if (value === null || value === undefined) {
            return '';
        }
        if (value instanceof Date) {
            // Check if this is a date-only value (time is midnight)
            var hours = value.getHours();
            var minutes = value.getMinutes();
            var seconds = value.getSeconds();
            var ms = value.getMilliseconds();

            var year = value.getFullYear();
            var month = String(value.getMonth() + 1).padStart(2, '0');
            var day = String(value.getDate()).padStart(2, '0');

            if (hours === 0 && minutes === 0 && seconds === 0 && ms === 0) {
                // Date only: YYYY-MM-DD
                return year + '-' + month + '-' + day;
            } else {
                // DateTime: YYYY-MM-DD HH:MM:SS
                var h = String(hours).padStart(2, '0');
                var m = String(minutes).padStart(2, '0');
                var s = String(seconds).padStart(2, '0');
                return year + '-' + month + '-' + day + ' ' + h + ':' + m + ':' + s;
            }
        }
        return value;
    }

    // Function to load and render the pivot table with a specific dataset
    function loadPivotTableboxing_matches(datasetName) {
        loadDataset(datasetName).then(function(data) {
            console.log('Loaded data for pivot table boxing_matches from dataset:', datasetName, data);

            // Validate data
            if (!data || data.length === 0) {
                throw new Error('No data loaded for pivot table boxing_matches');
            }

            // Store the data
            window.pivotTableDataboxing_matches[datasetName] = data;

            // Convert data to array format expected by pivotUI
            // First row is headers
            var headers = Object.keys(data[0]);
            var arrayData = [headers];

            // Add data rows - convert Date objects to strings for proper display
            data.forEach(function(row) {
                var rowArray = headers.map(function(header) {
                    return valueToStringboxing_matches(row[header]);
                });
                arrayData.push(rowArray);
            });

            console.log('Converted array data for boxing_matches (showing first 3 of ' + arrayData.length + ' rows):', arrayData.slice(0, 3));

            // Save current pivot state if exists
            var currentConfig = window.pivotTableConfigboxing_matches;
            var pivotEl = $("#boxing_matches");
            if (pivotEl.data('pivotUIOptions')) {
                // Preserve current user selections
                var opts = pivotEl.data('pivotUIOptions');
                currentConfig = {
                    rows: opts.rows,
                    cols: opts.cols,
                    vals: opts.vals,
                    aggregatorName: opts.aggregatorName,
                    rendererName: opts.rendererName,
                    inclusions: opts.inclusions,
                    exclusions: opts.exclusions,
                    rendererOptions: opts.rendererOptions
                };
            }

            // Render the pivot table
            pivotEl.pivotUI(
                arrayData,
                $.extend({
                    renderers: $.extend(
                        $.pivotUtilities.renderers,
                        $.pivotUtilities.c3_renderers,
                        $.pivotUtilities.d3_renderers,
                        $.pivotUtilities.export_renderers
                    ),
                    hiddenAttributes: [""]
                }, currentConfig)
            );

            // Initialize totals visibility based on checkbox state
            setTimeout(function() {
                if (window.toggleTotals_boxing_matches) {
                    window.toggleTotals_boxing_matches();
                }
            }, 100);
        }).catch(function(error) {
            console.error('Error loading data for pivot table boxing_matches:', error);
            $("#boxing_matches").html('<div style="color: red; padding: 20px;">Error loading pivot table: ' + error.message + '</div>');
        });
    }

    // Setup toggle for showing/hiding totals
    window.toggleTotals_boxing_matches = function() {
        const checkbox = document.getElementById('show_totals_checkbox_boxing_matches');
        const showTotals = checkbox.checked;

        // Find all total cells in the pivot table
        const pivotContainer = document.getElementById('boxing_matches');
        const totalCells = pivotContainer.querySelectorAll('.pvtTotal, .pvtGrandTotal');

        totalCells.forEach(function(cell) {
            cell.style.display = showTotals ? '' : 'none';
        });

        // Also hide/show total row headers (typically have "Totals" text)
        const allCells = pivotContainer.querySelectorAll('th, td');
        allCells.forEach(function(cell) {
            if (cell.textContent.trim() === 'Totals' || cell.textContent.trim() === 'Total') {
                cell.style.display = showTotals ? '' : 'none';
            }
        });
    };

    // Make dataset change handler global
    window.changeDataset_boxing_matches = function() {
        var select = document.getElementById('dataset_select_boxing_matches');
        if (select) {
            loadPivotTableboxing_matches(select.value);
        }
    };

    // Load the initial dataset
    loadPivotTableboxing_matches('boxing_data');


});
</script>

<!-- DATASETS -->

<script type="text/plain" id="data_stockReturns" data-format="csv_embedded" data-src="">
Symbol,Date,Return
RTX,2023-01-01,10.01
RTX,2023-01-02,-10.005
RTX,2023-01-03,-0.5
GOOG,2023-01-01,1.0
GOOG,2023-01-02,0.01
GOOG,2023-01-03,-0.003
MSFT,2023-01-01,0.008
MSFT,2023-01-02,0.004
MSFT,2023-01-03,-0.002

</script><script type="text/plain" id="data_standalone_data" data-format="csv_embedded" data-src="">
Region,Product,Revenue,Profit
North,Widget,23165,9564
South,Widget,48727,4977
East,Widget,21807,3829
West,Widget,32791,9520
North,Gadget,45873,6042
South,Gadget,14523,5324
East,Gadget,11106,3462
West,Gadget,32312,8471
North,Gizmo,31766,6164
South,Gizmo,16586,5711
East,Gizmo,28994,5726
West,Gizmo,46568,6473
North,Thingamajig,41275,3025
South,Thingamajig,29951,9073
East,Thingamajig,45728,5264
West,Thingamajig,11780,8689

</script><script type="text/plain" id="data_sales_data" data-format="csv_embedded" data-src="">
Region,Month,Product,Sales,Units
North,Jan,Gadget,13440,125
North,Feb,Gizmo,13974,63
North,Mar,Widget,21708,171
North,Apr,Gadget,26155,159
North,May,Gadget,20072,141
North,Jun,Widget,36916,103
North,Jul,Gizmo,14981,71
North,Aug,Gadget,13179,99
North,Sep,Gizmo,10670,55
North,Oct,Widget,45452,103
North,Nov,Widget,36199,79
North,Dec,Widget,49056,102
South,Jan,Widget,37192,131
South,Feb,Gadget,26399,177
South,Mar,Gizmo,39692,158
South,Apr,Gadget,11463,157
South,May,Gizmo,47417,154
South,Jun,Gadget,47718,191
South,Jul,Gadget,13803,137
South,Aug,Widget,47885,56
South,Sep,Gizmo,43812,200
South,Oct,Gadget,31079,146
South,Nov,Gizmo,22968,136
South,Dec,Gizmo,30167,167
East,Jan,Gizmo,14379,158
East,Feb,Gadget,46661,113
East,Mar,Widget,15487,135
East,Apr,Gadget,49385,73
East,May,Gizmo,16469,125
East,Jun,Gizmo,16835,87
East,Jul,Widget,39483,138
East,Aug,Gizmo,42963,189
East,Sep,Gizmo,32181,56
East,Oct,Gadget,18796,79
East,Nov,Gadget,22398,78
East,Dec,Gizmo,44427,54
West,Jan,Gadget,31035,87
West,Feb,Gizmo,34873,168
West,Mar,Widget,30939,188
West,Apr,Gadget,10910,60
West,May,Gizmo,48954,143
West,Jun,Gadget,12884,105
West,Jul,Gadget,24764,128
West,Aug,Widget,32691,174
West,Sep,Gadget,30228,103
West,Oct,Gizmo,45956,178
West,Nov,Gizmo,49998,140
West,Dec,Widget,14319,115

</script><script type="text/plain" id="data_multi_data_aa" data-format="csv_embedded" data-src="">
Category,Quarter,Sales,Units
Electronics,Q1,7006,471
Clothing,Q1,15995,139
Food,Q1,6832,199
Sports,Q1,8070,379
Electronics,Q2,15798,351
Clothing,Q2,13305,484
Food,Q2,6743,226
Sports,Q2,17107,430
Electronics,Q3,9180,393
Clothing,Q3,8766,175
Food,Q3,8243,357
Sports,Q3,14856,388

</script><script type="text/plain" id="data_performance_data" data-format="csv_embedded" data-src="">
Employee,Quarter,Score,Department
Alice,Q1,71.86597523842131,Sales
Alice,Q2,82.1810789062282,Sales
Alice,Q3,82.98332075498706,Sales
Alice,Q4,72.77225925354385,Sales
Bob,Q1,70.78145705547773,Engineering
Bob,Q2,81.00057834152507,Engineering
Bob,Q3,74.64965959025935,Engineering
Bob,Q4,60.092303128355084,Engineering
Charlie,Q1,75.28355195772488,Sales
Charlie,Q2,58.1227670248406,Sales
Charlie,Q3,67.56818040108985,Sales
Charlie,Q4,63.220523233538216,Sales
Diana,Q1,89.024885734013,Marketing
Diana,Q2,105.95512192739508,Marketing
Diana,Q3,89.34213333030542,Marketing
Diana,Q4,91.70765864074795,Marketing
Eve,Q1,64.74262558759463,Engineering
Eve,Q2,59.14071212211398,Engineering
Eve,Q3,91.44220987535252,Engineering
Eve,Q4,70.46725862427758,Engineering

</script><script type="text/plain" id="data_product_data" data-format="csv_embedded" data-src="">
Category,Brand,Revenue,Quarter
Electronics,Brand A,2651,Q1
Clothing,Brand B,9493,Q2
Home,Brand B,3239,Q3
Sports,Brand D,3577,Q4
Books,Brand A,7374,Q1
Electronics,Brand A,4649,Q2
Clothing,Brand C,5920,Q3
Home,Brand D,2313,Q4
Sports,Brand C,9404,Q1
Books,Brand C,7841,Q2
Electronics,Brand D,8621,Q3
Clothing,Brand D,9082,Q4
Home,Brand B,2221,Q1
Sports,Brand B,1191,Q2
Books,Brand C,9831,Q3
Electronics,Brand A,6608,Q4
Clothing,Brand D,2099,Q1
Home,Brand D,1504,Q2
Sports,Brand B,4720,Q3
Books,Brand A,5018,Q4
Electronics,Brand A,4698,Q1
Clothing,Brand A,8817,Q2
Home,Brand B,2536,Q3
Sports,Brand C,5289,Q4
Books,Brand A,2553,Q1
Electronics,Brand D,5372,Q2
Clothing,Brand A,7229,Q3
Home,Brand C,4613,Q4
Sports,Brand A,5211,Q1
Books,Brand A,6563,Q2
Electronics,Brand A,5442,Q3
Clothing,Brand C,5407,Q4
Home,Brand A,8034,Q1
Sports,Brand A,5512,Q2
Books,Brand A,5033,Q3
Electronics,Brand B,2214,Q4
Clothing,Brand D,3787,Q1
Home,Brand D,8915,Q2
Sports,Brand B,5484,Q3
Books,Brand C,7547,Q4
Electronics,Brand C,3404,Q1
Clothing,Brand A,7259,Q2
Home,Brand C,4975,Q3
Sports,Brand C,9476,Q4
Books,Brand B,4896,Q1
Electronics,Brand A,1070,Q2
Clothing,Brand D,1269,Q3
Home,Brand C,1543,Q4
Sports,Brand D,8416,Q1
Books,Brand B,1126,Q2
Electronics,Brand A,3393,Q3
Clothing,Brand C,6439,Q4
Home,Brand C,1075,Q1
Sports,Brand D,3957,Q2
Books,Brand B,4930,Q3
Electronics,Brand D,6540,Q4
Clothing,Brand D,7221,Q1
Home,Brand C,5124,Q2
Sports,Brand D,7953,Q3
Books,Brand C,9923,Q4
Electronics,Brand A,4848,Q1
Clothing,Brand A,6058,Q2
Home,Brand A,1749,Q3
Sports,Brand D,6560,Q4
Books,Brand B,4484,Q1
Electronics,Brand C,1519,Q2
Clothing,Brand C,9671,Q3
Home,Brand B,7695,Q4
Sports,Brand B,6522,Q1
Books,Brand C,4684,Q2
Electronics,Brand D,5906,Q3
Clothing,Brand B,5720,Q4
Home,Brand C,5531,Q1
Sports,Brand C,7384,Q2
Books,Brand A,7136,Q3
Electronics,Brand B,9734,Q4
Clothing,Brand B,3682,Q1
Home,Brand A,5534,Q2
Sports,Brand B,4455,Q3
Books,Brand A,5349,Q4
Electronics,Brand C,3616,Q1
Clothing,Brand C,6984,Q2
Home,Brand C,6219,Q3
Sports,Brand A,6586,Q4
Books,Brand A,7668,Q1
Electronics,Brand C,1298,Q2
Clothing,Brand A,8187,Q3
Home,Brand C,6649,Q4
Sports,Brand A,1280,Q1
Books,Brand A,9133,Q2
Electronics,Brand D,5805,Q3
Clothing,Brand A,8108,Q4
Home,Brand C,3546,Q1
Sports,Brand C,3699,Q2
Books,Brand B,3265,Q3
Electronics,Brand B,6347,Q4
Clothing,Brand C,7867,Q1
Home,Brand D,5449,Q2
Sports,Brand B,1920,Q3
Books,Brand A,3207,Q4

</script><script type="text/plain" id="data_customer_data" data-format="csv_embedded" data-src="">
Country,ProductType,Channel,Revenue,Year
UK,Standard,Wholesale,2302,2022
USA,Budget,Online,2832,2023
USA,Budget,Online,1162,2024
Japan,Premium,Wholesale,2455,2022
Japan,Standard,Wholesale,1522,2023
Test,Standard,Retail,3820,2024
Japan,Budget,Wholesale,3481,2022
Germany,Budget,Retail,4701,2023
Japan,Premium,Wholesale,1388,2024
USA,Budget,Retail,3625,2022
USA,Standard,Wholesale,836,2023
Test,Standard,Wholesale,805,2024
Test,Premium,Retail,3239,2022
Test,Budget,Wholesale,2722,2023
USA,Standard,Wholesale,2943,2024
Germany,Standard,Online,4505,2022
France,Budget,Wholesale,784,2023
France,Standard,Wholesale,2461,2024
France,Premium,Online,4104,2022
UK,Premium,Online,1367,2023
Test,Premium,Wholesale,4907,2024
France,Premium,Online,793,2022
Japan,Premium,Online,2633,2023
USA,Premium,Retail,1534,2024
Germany,Budget,Online,1117,2022
UK,Standard,Retail,1470,2023
USA,Premium,Retail,2309,2024
USA,Premium,Wholesale,2991,2022
Germany,Budget,Wholesale,1898,2023
Germany,Budget,Wholesale,4334,2024
France,Premium,Wholesale,4446,2022
UK,Standard,Online,2277,2023
Japan,Standard,Retail,1508,2024
UK,Premium,Wholesale,4839,2022
Test,Premium,Wholesale,4903,2023
Test,Premium,Retail,1359,2024
Test,Standard,Online,2590,2022
Japan,Budget,Wholesale,2973,2023
USA,Premium,Retail,3685,2024
USA,Standard,Retail,4106,2022
Test,Budget,Online,3642,2023
UK,Premium,Wholesale,1395,2024
USA,Budget,Online,859,2022
Japan,Premium,Wholesale,4641,2023
UK,Budget,Retail,3226,2024
USA,Budget,Retail,1109,2022
France,Budget,Retail,3787,2023
France,Premium,Online,2931,2024
France,Standard,Retail,4433,2022
USA,Premium,Wholesale,4670,2023
France,Standard,Online,4295,2024
France,Standard,Online,1804,2022
USA,Budget,Online,628,2023
UK,Premium,Online,590,2024
USA,Budget,Wholesale,4070,2022
USA,Standard,Wholesale,3464,2023
Japan,Premium,Retail,2104,2024
France,Budget,Online,2881,2022
USA,Standard,Online,1001,2023
UK,Budget,Online,3180,2024
Germany,Budget,Retail,3198,2022
UK,Standard,Retail,3372,2023
Japan,Premium,Retail,960,2024
USA,Budget,Retail,3353,2022
France,Standard,Wholesale,2349,2023
UK,Budget,Wholesale,1425,2024
France,Premium,Wholesale,2434,2022
USA,Premium,Wholesale,2042,2023
France,Standard,Wholesale,4505,2024
Test,Budget,Wholesale,809,2022
France,Budget,Retail,1523,2023
UK,Standard,Wholesale,2929,2024
Japan,Standard,Online,2475,2022
Japan,Budget,Retail,2417,2023
Japan,Standard,Online,2739,2024
Germany,Standard,Online,3643,2022
USA,Budget,Retail,4903,2023
USA,Standard,Online,4778,2024
USA,Standard,Online,1796,2022
Test,Premium,Online,1406,2023
Japan,Standard,Retail,4188,2024
Japan,Premium,Online,1087,2022
Japan,Standard,Retail,3613,2023
UK,Budget,Retail,4177,2024
UK,Premium,Wholesale,928,2022
UK,Premium,Online,1506,2023
UK,Standard,Online,3027,2024
France,Premium,Wholesale,2367,2022
Japan,Budget,Retail,4741,2023
UK,Standard,Retail,2896,2024
Test,Premium,Wholesale,1165,2022
Japan,Premium,Wholesale,3250,2023
USA,Premium,Online,2840,2024
Japan,Standard,Retail,572,2022
Germany,Premium,Retail,2107,2023
Test,Standard,Wholesale,3447,2024
USA,Premium,Online,2054,2022
Test,Premium,Wholesale,2444,2023
Germany,Premium,Wholesale,2945,2024
UK,Standard,Retail,2868,2022
UK,Premium,Online,4518,2023
UK,Standard,Online,4745,2024
France,Premium,Online,1751,2022
France,Premium,Wholesale,4147,2023
France,Premium,Wholesale,3610,2024
Test,Standard,Wholesale,3949,2022
France,Budget,Wholesale,2274,2023
France,Premium,Wholesale,1930,2024
USA,Premium,Wholesale,4890,2022
France,Premium,Online,2284,2023
UK,Budget,Online,2300,2024
Germany,Budget,Wholesale,2769,2022
Germany,Budget,Wholesale,588,2023
USA,Standard,Online,1325,2024
USA,Standard,Wholesale,1579,2022
Test,Standard,Wholesale,4361,2023
USA,Budget,Wholesale,502,2024
UK,Budget,Online,2986,2022
Test,Budget,Retail,2749,2023
Test,Premium,Wholesale,1340,2024

</script><script type="text/plain" id="data_survey_data" data-format="csv_embedded" data-src="">
Age_Group,Gender,Satisfaction,Product,Region
18-25,Other,1,Product B,West
46-55,Female,9,Product C,South
46-55,Female,5,Product B,South
18-25,Other,8,Product B,South
46-55,Prefer not to say,6,Product B,East
56+,Other,3,Product C,North
46-55,Female,10,Product A,North
26-35,Male,4,Product A,East
18-25,Prefer not to say,6,Product B,South
26-35,Female,5,Product C,North
36-45,Female,1,Product B,East
18-25,Male,10,Product A,West
56+,Prefer not to say,3,Product A,West
36-45,Prefer not to say,8,Product A,North
18-25,Male,3,Product A,East
36-45,Male,7,Product A,South
46-55,Prefer not to say,4,Product A,West
18-25,Male,7,Product A,East
56+,Prefer not to say,9,Product C,West
26-35,Prefer not to say,9,Product A,South
56+,Male,1,Product C,East
46-55,Other,3,Product A,North
26-35,Female,9,Product C,East
46-55,Male,4,Product B,South
36-45,Other,3,Product A,South
36-45,Male,10,Product B,North
18-25,Prefer not to say,10,Product C,North
56+,Male,9,Product C,South
36-45,Prefer not to say,9,Product B,North
46-55,Other,8,Product C,South
56+,Male,9,Product A,North
18-25,Prefer not to say,3,Product A,South
36-45,Male,1,Product B,East
36-45,Other,1,Product A,South
46-55,Female,9,Product C,South
46-55,Prefer not to say,4,Product C,East
18-25,Female,8,Product B,South
18-25,Male,9,Product A,North
56+,Other,4,Product A,South
46-55,Female,6,Product C,South
36-45,Female,10,Product C,West
18-25,Female,10,Product B,North
46-55,Female,3,Product B,North
18-25,Female,4,Product B,West
36-45,Female,10,Product C,South
46-55,Female,3,Product C,East
36-45,Male,8,Product C,East
46-55,Other,9,Product A,North
18-25,Other,10,Product C,West
36-45,Other,2,Product A,East
56+,Other,8,Product B,West
18-25,Male,5,Product C,East
18-25,Male,1,Product C,West
26-35,Male,9,Product B,South
46-55,Prefer not to say,3,Product A,West
56+,Male,6,Product A,South
36-45,Male,9,Product C,South
46-55,Prefer not to say,1,Product C,East
36-45,Female,2,Product C,South
26-35,Male,6,Product A,West
18-25,Male,5,Product B,South
26-35,Male,9,Product C,North
26-35,Other,2,Product C,North
18-25,Other,2,Product C,North
56+,Prefer not to say,3,Product C,North
36-45,Male,2,Product B,North
56+,Other,2,Product A,North
18-25,Male,2,Product B,West
18-25,Male,3,Product C,North
18-25,Other,2,Product A,East
46-55,Other,10,Product A,West
56+,Prefer not to say,4,Product C,West
26-35,Other,8,Product B,West
36-45,Prefer not to say,1,Product C,West
18-25,Female,4,Product A,East
46-55,Female,1,Product B,East
26-35,Prefer not to say,9,Product C,East
46-55,Female,5,Product A,South
18-25,Prefer not to say,2,Product C,East
56+,Other,2,Product C,North
46-55,Male,2,Product C,West
36-45,Male,7,Product A,West
46-55,Female,9,Product C,South
18-25,Male,1,Product B,South
46-55,Prefer not to say,4,Product A,West
26-35,Prefer not to say,1,Product C,South
18-25,Male,9,Product B,East
18-25,Prefer not to say,2,Product A,East
18-25,Female,9,Product A,East
26-35,Other,4,Product A,East
36-45,Prefer not to say,3,Product B,North
46-55,Male,5,Product C,South
26-35,Female,2,Product A,North
56+,Prefer not to say,9,Product C,East
56+,Female,3,Product C,South
36-45,Female,3,Product A,North
46-55,Other,4,Product A,South
18-25,Other,8,Product A,East
36-45,Male,6,Product B,East
36-45,Male,8,Product B,West
56+,Male,3,Product C,East
26-35,Other,5,Product A,West
46-55,Prefer not to say,9,Product A,East
26-35,Male,1,Product B,West
18-25,Male,7,Product A,East
18-25,Prefer not to say,6,Product C,East
18-25,Female,5,Product C,East
18-25,Male,5,Product A,East
56+,Prefer not to say,8,Product A,East
36-45,Prefer not to say,6,Product A,West
26-35,Female,6,Product C,South
18-25,Male,4,Product A,West
56+,Male,10,Product B,North
46-55,Male,4,Product B,North
18-25,Prefer not to say,8,Product A,South
36-45,Prefer not to say,5,Product B,West
36-45,Prefer not to say,5,Product A,South
56+,Female,2,Product B,West
36-45,Prefer not to say,6,Product B,East
18-25,Male,9,Product C,South
46-55,Other,3,Product B,West
36-45,Other,6,Product C,South
56+,Female,2,Product A,West
56+,Other,4,Product B,West
26-35,Male,6,Product A,North
18-25,Female,5,Product B,East
26-35,Prefer not to say,6,Product C,South
26-35,Male,5,Product A,West
26-35,Prefer not to say,7,Product A,South
26-35,Male,5,Product B,South
56+,Other,9,Product A,West
26-35,Prefer not to say,10,Product B,East
26-35,Prefer not to say,3,Product A,East
36-45,Prefer not to say,8,Product C,South
56+,Male,6,Product A,North
36-45,Female,3,Product C,East
56+,Other,9,Product C,East
26-35,Male,6,Product C,West
36-45,Female,2,Product B,South
56+,Prefer not to say,1,Product B,South
56+,Prefer not to say,6,Product A,West
18-25,Female,3,Product C,West
18-25,Other,3,Product A,North
18-25,Female,6,Product A,North
26-35,Other,10,Product B,South
46-55,Prefer not to say,6,Product C,West
26-35,Female,5,Product B,South
18-25,Female,5,Product B,East
36-45,Prefer not to say,6,Product C,East
26-35,Prefer not to say,3,Product A,South
56+,Other,2,Product A,East
26-35,Female,3,Product A,South
36-45,Prefer not to say,2,Product A,West
56+,Male,1,Product C,South
46-55,Other,4,Product A,North
26-35,Prefer not to say,4,Product C,North
36-45,Other,7,Product A,South
36-45,Female,4,Product C,West
36-45,Female,1,Product C,West
56+,Male,2,Product B,North
26-35,Prefer not to say,10,Product A,North
26-35,Prefer not to say,2,Product C,West
46-55,Prefer not to say,8,Product B,South
36-45,Male,4,Product A,East
36-45,Other,8,Product A,East
26-35,Other,1,Product B,North
26-35,Other,6,Product C,North
56+,Prefer not to say,2,Product C,South
18-25,Other,6,Product C,West
18-25,Female,10,Product B,North
56+,Other,7,Product A,East
18-25,Male,6,Product B,North
56+,Other,6,Product A,East
46-55,Male,7,Product B,East
56+,Prefer not to say,8,Product B,South
36-45,Other,3,Product C,East
36-45,Other,9,Product B,North
18-25,Other,6,Product B,East
56+,Prefer not to say,7,Product B,East
26-35,Other,2,Product B,West
26-35,Prefer not to say,10,Product A,South
56+,Other,4,Product A,East
46-55,Female,9,Product A,East
26-35,Female,6,Product B,South
36-45,Prefer not to say,9,Product A,West
36-45,Male,10,Product A,South
56+,Other,10,Product A,North
36-45,Prefer not to say,4,Product C,South
36-45,Female,1,Product A,North
26-35,Male,2,Product C,North
56+,Female,2,Product B,South
46-55,Prefer not to say,7,Product C,East
18-25,Other,8,Product C,West
56+,Prefer not to say,1,Product A,East
56+,Female,9,Product C,West
18-25,Other,10,Product B,North
36-45,Prefer not to say,7,Product A,North
56+,Other,5,Product C,North
18-25,Male,5,Product C,West
26-35,Female,2,Product A,East

</script><script type="text/plain" id="data_correlations" data-format="csv_embedded" data-src="">
Symbol1,Symbol2,Correlation
RTX,GOOG,-0.85
RTX,MSFT,-0.75
GOOG,MSFT,0.8
RTX,RTX,1.0
GOOG,GOOG,1.0
MSFT,MSFT,1.0
GOOG,RTX,-0.85
MSFT,RTX,-0.75
MSFT,GOOG,0.8

</script><script type="text/plain" id="data_multi_data_bb" data-format="csv_embedded" data-src="">
Department,Month,Headcount,Budget
HR,Jan,32,123281
Engineering,Jan,26,167112
Sales,Jan,31,186924
Marketing,Jan,43,109581
HR,Feb,88,114698
Engineering,Feb,32,138637
Sales,Feb,39,175779
Marketing,Feb,61,99496
HR,Mar,52,57926
Engineering,Mar,80,199150
Sales,Mar,63,113178
Marketing,Mar,22,170410

</script><script type="text/plain" id="data_transaction_data" data-format="csv_embedded" data-src="">
Transaction_Type,Customer_Type,Payment_Method,Store,Amount
Refund,VIP,Cash,Store 2,161
Exchange,Returning,PayPal,Store 1,185
Exchange,New,Bank Transfer,Store 1,46
Purchase,New,Cash,Store 3,228
Purchase,VIP,Cash,Store 1,17
Refund,VIP,Bank Transfer,Store 3,88
Purchase,New,Credit Card,Store 1,71
Exchange,New,Bank Transfer,Store 1,77
Refund,VIP,Credit Card,Store 2,285
Refund,New,Credit Card,Store 2,335
Purchase,New,Bank Transfer,Store 2,480
Refund,New,Cash,Store 3,81
Cancel,Returning,Credit Card,Store 2,274
Refund,New,Credit Card,Store 3,488
Cancel,New,Credit Card,Store 2,46
Exchange,Returning,Bank Transfer,Store 1,14
Purchase,VIP,Cash,Store 1,88
Cancel,Returning,PayPal,Store 2,35
Purchase,New,PayPal,Store 3,35
Purchase,VIP,PayPal,Store 1,405
Cancel,Returning,Cash,Store 1,252
Purchase,New,PayPal,Store 1,274
Exchange,New,Bank Transfer,Store 1,394
Purchase,Returning,Credit Card,Store 2,271
Purchase,Returning,Cash,Store 1,72
Exchange,Returning,Cash,Store 1,66
Purchase,VIP,Bank Transfer,Store 3,186
Purchase,Returning,Cash,Store 2,99
Exchange,VIP,Credit Card,Store 3,236
Refund,Returning,Bank Transfer,Store 2,15
Refund,New,Credit Card,Store 3,189
Cancel,New,Credit Card,Store 3,458
Cancel,Returning,PayPal,Store 3,166
Exchange,VIP,Bank Transfer,Store 1,409
Refund,New,PayPal,Store 3,156
Cancel,VIP,Bank Transfer,Store 1,166
Purchase,New,PayPal,Store 1,379
Exchange,Returning,Bank Transfer,Store 1,91
Purchase,Returning,Bank Transfer,Store 2,310
Exchange,New,Credit Card,Store 1,489
Refund,VIP,Bank Transfer,Store 2,473
Cancel,Returning,Bank Transfer,Store 1,306
Cancel,New,PayPal,Store 3,42
Cancel,New,PayPal,Store 1,182
Purchase,New,Bank Transfer,Store 3,154
Purchase,Returning,Credit Card,Store 2,243
Cancel,New,PayPal,Store 3,406
Refund,Returning,Bank Transfer,Store 2,28
Purchase,New,Cash,Store 1,487
Refund,VIP,Cash,Store 1,181
Refund,New,Cash,Store 1,29
Refund,VIP,Cash,Store 2,48
Purchase,VIP,Bank Transfer,Store 2,173
Purchase,VIP,Credit Card,Store 3,234
Refund,VIP,PayPal,Store 3,60
Refund,VIP,Credit Card,Store 1,493
Refund,Returning,Cash,Store 3,74
Refund,Returning,Bank Transfer,Store 1,402
Purchase,New,Bank Transfer,Store 2,245
Cancel,New,Cash,Store 2,273
Purchase,VIP,Credit Card,Store 1,220
Exchange,New,PayPal,Store 1,459
Purchase,VIP,PayPal,Store 2,68
Refund,New,PayPal,Store 2,492
Refund,New,Credit Card,Store 1,63
Exchange,Returning,Cash,Store 3,243
Exchange,Returning,Cash,Store 3,292
Exchange,New,Bank Transfer,Store 3,424
Exchange,VIP,Bank Transfer,Store 2,96
Cancel,Returning,PayPal,Store 1,108
Exchange,VIP,Cash,Store 2,413
Refund,New,PayPal,Store 2,142
Refund,New,Cash,Store 2,313
Refund,New,Cash,Store 1,261
Purchase,VIP,Cash,Store 2,241
Cancel,New,Cash,Store 2,295
Purchase,Returning,PayPal,Store 3,339
Purchase,New,Cash,Store 1,402
Exchange,Returning,Cash,Store 3,495
Cancel,New,PayPal,Store 1,69
Cancel,New,Credit Card,Store 1,39
Exchange,Returning,Cash,Store 1,384
Exchange,VIP,PayPal,Store 2,325
Exchange,Returning,PayPal,Store 2,442
Cancel,VIP,Bank Transfer,Store 1,256
Purchase,VIP,PayPal,Store 2,253
Exchange,VIP,Bank Transfer,Store 2,434
Purchase,New,Bank Transfer,Store 2,332
Refund,New,Credit Card,Store 1,15
Exchange,VIP,Cash,Store 2,71
Refund,New,Credit Card,Store 1,359
Refund,New,Bank Transfer,Store 1,238
Exchange,New,Cash,Store 2,398
Cancel,New,PayPal,Store 1,305
Purchase,New,Cash,Store 3,450
Purchase,VIP,Cash,Store 3,367
Cancel,VIP,Bank Transfer,Store 3,55
Purchase,VIP,Bank Transfer,Store 1,429
Refund,VIP,Bank Transfer,Store 3,37
Refund,New,Bank Transfer,Store 3,306
Refund,Returning,Bank Transfer,Store 1,474
Exchange,VIP,PayPal,Store 1,44
Cancel,New,PayPal,Store 3,101
Cancel,VIP,Cash,Store 2,84
Refund,Returning,PayPal,Store 1,46
Exchange,VIP,PayPal,Store 1,381
Cancel,Returning,PayPal,Store 3,26
Purchase,Returning,Credit Card,Store 3,22
Purchase,New,Cash,Store 1,93
Exchange,New,Bank Transfer,Store 3,474
Cancel,Returning,PayPal,Store 2,210
Refund,VIP,Cash,Store 1,188
Exchange,VIP,Bank Transfer,Store 3,400
Purchase,New,Bank Transfer,Store 1,454
Refund,Returning,Credit Card,Store 3,192
Refund,New,PayPal,Store 3,69
Purchase,Returning,PayPal,Store 1,97
Exchange,Returning,Cash,Store 1,426
Exchange,New,Cash,Store 2,484
Purchase,VIP,PayPal,Store 1,301
Purchase,VIP,Credit Card,Store 1,104
Cancel,New,Cash,Store 2,260
Purchase,Returning,PayPal,Store 1,39
Exchange,New,PayPal,Store 3,89
Cancel,New,Credit Card,Store 3,276
Exchange,Returning,Cash,Store 2,139
Exchange,Returning,Credit Card,Store 3,500
Purchase,VIP,Bank Transfer,Store 1,213
Cancel,New,Cash,Store 3,231
Cancel,VIP,Bank Transfer,Store 1,354
Exchange,VIP,PayPal,Store 3,386
Refund,Returning,Cash,Store 1,332
Purchase,VIP,Cash,Store 1,37
Refund,Returning,Bank Transfer,Store 1,178
Purchase,VIP,Bank Transfer,Store 3,244
Refund,VIP,Bank Transfer,Store 1,429
Exchange,New,Bank Transfer,Store 3,347
Purchase,Returning,Bank Transfer,Store 2,91
Exchange,Returning,Credit Card,Store 2,472
Exchange,Returning,Cash,Store 1,198
Cancel,Returning,Cash,Store 2,430
Cancel,Returning,Bank Transfer,Store 3,460
Refund,Returning,PayPal,Store 2,107
Purchase,Returning,PayPal,Store 2,441
Purchase,New,PayPal,Store 3,207
Refund,Returning,Cash,Store 3,100
Purchase,VIP,Cash,Store 1,180
Exchange,Returning,Credit Card,Store 3,34
Cancel,VIP,Credit Card,Store 3,302
Purchase,VIP,Credit Card,Store 1,367
Cancel,VIP,PayPal,Store 1,371
Refund,VIP,Bank Transfer,Store 1,452
Refund,New,Cash,Store 3,370
Purchase,VIP,Bank Transfer,Store 1,144
Purchase,VIP,Bank Transfer,Store 3,275
Exchange,VIP,Credit Card,Store 2,101
Exchange,VIP,Cash,Store 3,150
Exchange,New,PayPal,Store 2,157
Purchase,New,Credit Card,Store 1,299
Cancel,Returning,Credit Card,Store 3,12
Exchange,VIP,Credit Card,Store 2,339
Exchange,VIP,PayPal,Store 3,358
Purchase,New,PayPal,Store 1,361
Cancel,VIP,PayPal,Store 3,232
Refund,VIP,Cash,Store 2,399
Refund,New,Cash,Store 1,216
Purchase,Returning,Cash,Store 3,308
Exchange,Returning,Credit Card,Store 1,30
Purchase,VIP,Credit Card,Store 1,293
Purchase,VIP,Bank Transfer,Store 2,458
Exchange,Returning,Credit Card,Store 3,203
Exchange,New,Bank Transfer,Store 2,482
Exchange,Returning,PayPal,Store 3,413
Refund,VIP,Credit Card,Store 1,473
Exchange,Returning,Credit Card,Store 3,271
Purchase,Returning,PayPal,Store 2,464
Refund,VIP,Cash,Store 1,289
Refund,VIP,Credit Card,Store 3,440
Exchange,VIP,Bank Transfer,Store 3,231
Refund,New,Bank Transfer,Store 2,377
Refund,Returning,Cash,Store 1,304
Exchange,Returning,Bank Transfer,Store 1,348
Purchase,Returning,Credit Card,Store 1,248
Exchange,Returning,PayPal,Store 3,330
Purchase,New,Credit Card,Store 3,445
Cancel,New,PayPal,Store 1,25
Exchange,New,Cash,Store 3,363
Cancel,New,PayPal,Store 2,62
Refund,Returning,Bank Transfer,Store 1,81
Exchange,New,Cash,Store 1,271
Refund,VIP,Bank Transfer,Store 1,321
Cancel,New,Credit Card,Store 2,206
Refund,Returning,Credit Card,Store 1,227
Exchange,Returning,Cash,Store 3,441
Exchange,New,PayPal,Store 3,208
Cancel,VIP,Credit Card,Store 1,452
Purchase,Returning,Cash,Store 3,189
Exchange,VIP,Credit Card,Store 2,29
Cancel,VIP,PayPal,Store 1,79
Refund,Returning,Bank Transfer,Store 1,96
Refund,VIP,Credit Card,Store 1,290
Purchase,VIP,PayPal,Store 3,360
Refund,VIP,Cash,Store 3,292
Refund,New,Bank Transfer,Store 3,429
Cancel,New,Credit Card,Store 3,119
Exchange,Returning,Bank Transfer,Store 3,183
Purchase,New,PayPal,Store 2,425
Refund,VIP,Cash,Store 2,304
Refund,Returning,Credit Card,Store 3,70
Refund,VIP,PayPal,Store 2,425
Refund,Returning,PayPal,Store 1,472
Exchange,VIP,Bank Transfer,Store 3,311
Exchange,VIP,Cash,Store 3,211
Cancel,Returning,Bank Transfer,Store 2,419
Purchase,VIP,Credit Card,Store 2,456
Cancel,VIP,PayPal,Store 3,87
Cancel,VIP,Credit Card,Store 2,285
Cancel,VIP,Credit Card,Store 3,206
Exchange,VIP,Credit Card,Store 2,277
Exchange,Returning,Bank Transfer,Store 3,346
Exchange,New,Bank Transfer,Store 2,300
Cancel,New,Credit Card,Store 2,155
Refund,VIP,Credit Card,Store 3,299
Refund,New,Cash,Store 2,79
Cancel,New,Bank Transfer,Store 2,34
Cancel,New,Bank Transfer,Store 2,499
Refund,New,Bank Transfer,Store 1,194
Purchase,VIP,Credit Card,Store 1,105
Exchange,New,Bank Transfer,Store 3,120
Refund,New,Cash,Store 3,68
Purchase,VIP,PayPal,Store 1,259
Cancel,Returning,Credit Card,Store 2,18
Exchange,VIP,PayPal,Store 3,163
Refund,VIP,PayPal,Store 2,360
Purchase,VIP,Cash,Store 3,59
Exchange,VIP,PayPal,Store 1,96
Refund,New,Cash,Store 1,174
Cancel,VIP,Cash,Store 1,474
Purchase,New,PayPal,Store 2,259
Refund,Returning,Credit Card,Store 3,126
Purchase,Returning,Cash,Store 2,327
Refund,New,Cash,Store 3,380
Exchange,New,PayPal,Store 1,500
Exchange,VIP,Bank Transfer,Store 1,222
Refund,VIP,Credit Card,Store 1,299
Purchase,New,PayPal,Store 3,478
Exchange,New,PayPal,Store 1,92
Exchange,New,Credit Card,Store 3,298
Purchase,VIP,PayPal,Store 1,262
Cancel,Returning,Cash,Store 2,277
Cancel,VIP,Credit Card,Store 1,223
Refund,New,Bank Transfer,Store 3,84
Cancel,New,Credit Card,Store 2,336
Purchase,VIP,Credit Card,Store 3,47
Refund,VIP,Bank Transfer,Store 2,148
Purchase,VIP,Bank Transfer,Store 2,347
Purchase,Returning,Cash,Store 2,162
Exchange,Returning,Cash,Store 1,214
Purchase,VIP,PayPal,Store 3,394
Refund,VIP,PayPal,Store 1,353
Exchange,New,Credit Card,Store 2,50
Purchase,Returning,Bank Transfer,Store 1,54
Cancel,New,Cash,Store 1,419
Exchange,Returning,PayPal,Store 1,333
Cancel,VIP,Bank Transfer,Store 2,471
Exchange,New,Bank Transfer,Store 2,292
Refund,New,PayPal,Store 3,10
Exchange,Returning,Bank Transfer,Store 1,138
Purchase,New,Cash,Store 2,28
Exchange,New,Cash,Store 3,14
Purchase,Returning,Cash,Store 2,468
Cancel,VIP,PayPal,Store 1,313
Refund,New,Cash,Store 2,217
Purchase,VIP,Bank Transfer,Store 3,262
Exchange,Returning,Bank Transfer,Store 2,191
Purchase,New,Bank Transfer,Store 1,98
Exchange,VIP,Cash,Store 3,146
Cancel,Returning,Cash,Store 1,397
Cancel,New,Bank Transfer,Store 1,272
Refund,VIP,PayPal,Store 1,329
Refund,New,PayPal,Store 3,237
Purchase,VIP,Bank Transfer,Store 3,129
Cancel,New,Cash,Store 1,79
Refund,VIP,Credit Card,Store 1,371
Cancel,Returning,Cash,Store 3,290
Refund,New,Credit Card,Store 2,151
Purchase,VIP,Cash,Store 1,264
Purchase,Returning,Credit Card,Store 3,297
Cancel,New,Cash,Store 2,292
Purchase,VIP,Bank Transfer,Store 2,406
Purchase,VIP,Cash,Store 3,344
Exchange,Returning,PayPal,Store 3,301
Exchange,New,Credit Card,Store 2,260
Exchange,Returning,Cash,Store 3,14
Exchange,New,PayPal,Store 1,223
Purchase,VIP,Bank Transfer,Store 1,192
Purchase,New,Bank Transfer,Store 1,103
Exchange,Returning,Cash,Store 1,292
Cancel,VIP,Credit Card,Store 3,183
Exchange,VIP,Bank Transfer,Store 3,422
Cancel,VIP,Bank Transfer,Store 1,92
Purchase,VIP,PayPal,Store 2,144
Refund,VIP,Bank Transfer,Store 2,135
Cancel,Returning,Credit Card,Store 2,260
Exchange,VIP,Credit Card,Store 2,483
Purchase,New,PayPal,Store 3,21
Purchase,VIP,Cash,Store 2,301
Exchange,VIP,PayPal,Store 2,159
Exchange,VIP,Cash,Store 3,54
Exchange,Returning,Bank Transfer,Store 1,440
Refund,Returning,PayPal,Store 1,98
Refund,New,Credit Card,Store 1,118
Cancel,VIP,PayPal,Store 1,461
Cancel,VIP,Credit Card,Store 2,465
Exchange,New,Credit Card,Store 1,261
Purchase,New,Bank Transfer,Store 3,124
Refund,New,PayPal,Store 2,117
Purchase,Returning,Cash,Store 1,58
Refund,VIP,Bank Transfer,Store 1,77
Cancel,New,Credit Card,Store 3,128
Cancel,New,Bank Transfer,Store 1,224
Cancel,New,Bank Transfer,Store 1,286
Refund,New,Bank Transfer,Store 2,462
Purchase,Returning,Cash,Store 3,207
Exchange,Returning,PayPal,Store 1,162
Cancel,Returning,PayPal,Store 3,358
Purchase,VIP,Credit Card,Store 2,21
Exchange,New,Bank Transfer,Store 1,163
Purchase,VIP,PayPal,Store 3,277
Exchange,Returning,Credit Card,Store 2,30
Cancel,New,Credit Card,Store 3,14
Exchange,Returning,Credit Card,Store 1,387
Exchange,Returning,Credit Card,Store 2,276
Cancel,VIP,Bank Transfer,Store 1,266
Cancel,Returning,PayPal,Store 1,242
Purchase,New,Credit Card,Store 2,179
Purchase,Returning,PayPal,Store 3,106
Refund,VIP,Credit Card,Store 2,404
Exchange,VIP,Bank Transfer,Store 1,348
Purchase,VIP,Bank Transfer,Store 1,345
Cancel,New,Credit Card,Store 1,487
Purchase,Returning,Credit Card,Store 1,26
Refund,New,Bank Transfer,Store 3,464
Cancel,New,Cash,Store 1,180
Purchase,Returning,Credit Card,Store 2,240
Cancel,Returning,Bank Transfer,Store 2,272
Exchange,Returning,Bank Transfer,Store 2,217
Refund,Returning,Cash,Store 3,301
Cancel,Returning,Credit Card,Store 3,385
Cancel,VIP,Credit Card,Store 3,423
Cancel,Returning,Cash,Store 3,412
Exchange,New,Bank Transfer,Store 1,345
Purchase,VIP,Credit Card,Store 3,442
Exchange,Returning,Bank Transfer,Store 3,407
Cancel,VIP,Cash,Store 1,138
Cancel,Returning,PayPal,Store 1,95
Refund,VIP,Bank Transfer,Store 3,12
Purchase,New,Cash,Store 2,77
Purchase,New,PayPal,Store 3,392
Purchase,VIP,Credit Card,Store 3,182
Cancel,VIP,Bank Transfer,Store 1,58
Purchase,VIP,Cash,Store 2,378
Purchase,New,PayPal,Store 1,314
Exchange,VIP,Credit Card,Store 1,105
Purchase,New,Cash,Store 3,361
Refund,New,Credit Card,Store 2,87
Purchase,VIP,PayPal,Store 1,328
Cancel,VIP,Credit Card,Store 1,421
Purchase,VIP,Credit Card,Store 1,482
Refund,Returning,PayPal,Store 2,379
Refund,Returning,Bank Transfer,Store 3,193
Exchange,New,Credit Card,Store 2,82
Purchase,VIP,PayPal,Store 3,473
Exchange,Returning,Bank Transfer,Store 2,65
Purchase,Returning,Bank Transfer,Store 1,418
Cancel,VIP,Bank Transfer,Store 1,136
Purchase,Returning,Cash,Store 2,401
Exchange,New,Cash,Store 3,478
Cancel,VIP,Cash,Store 2,82
Cancel,Returning,PayPal,Store 1,340
Refund,Returning,Bank Transfer,Store 2,421
Cancel,New,PayPal,Store 2,151
Purchase,New,PayPal,Store 1,359
Purchase,VIP,PayPal,Store 3,311
Cancel,Returning,Cash,Store 3,245
Exchange,New,PayPal,Store 1,90
Purchase,Returning,PayPal,Store 3,33
Refund,VIP,Credit Card,Store 3,362
Refund,Returning,Cash,Store 3,450
Refund,VIP,Cash,Store 2,446
Refund,VIP,Credit Card,Store 1,301
Purchase,Returning,Credit Card,Store 3,169
Cancel,Returning,Bank Transfer,Store 2,251
Exchange,New,PayPal,Store 1,305
Exchange,VIP,PayPal,Store 2,260
Cancel,Returning,Bank Transfer,Store 3,41
Refund,New,Credit Card,Store 2,160
Purchase,New,Bank Transfer,Store 1,413
Purchase,Returning,Credit Card,Store 1,18
Purchase,Returning,Bank Transfer,Store 2,190
Cancel,VIP,Bank Transfer,Store 3,99
Refund,New,Cash,Store 2,426
Refund,VIP,PayPal,Store 1,21
Purchase,VIP,PayPal,Store 1,169
Refund,VIP,Bank Transfer,Store 3,162
Cancel,Returning,Bank Transfer,Store 2,400
Cancel,Returning,PayPal,Store 1,178
Refund,Returning,Credit Card,Store 1,31
Purchase,VIP,Credit Card,Store 1,228
Purchase,New,Cash,Store 1,136
Exchange,Returning,PayPal,Store 2,491
Cancel,VIP,Cash,Store 3,128
Cancel,VIP,PayPal,Store 3,416
Cancel,New,Cash,Store 2,367
Cancel,New,PayPal,Store 1,265
Purchase,Returning,PayPal,Store 2,35
Refund,Returning,Bank Transfer,Store 1,101
Refund,Returning,PayPal,Store 1,16
Cancel,Returning,PayPal,Store 3,452
Exchange,New,Cash,Store 2,221
Purchase,Returning,Bank Transfer,Store 1,409
Purchase,Returning,PayPal,Store 2,322
Cancel,VIP,PayPal,Store 3,294
Refund,Returning,Cash,Store 3,37
Refund,VIP,PayPal,Store 2,88
Cancel,New,Bank Transfer,Store 1,238
Cancel,Returning,PayPal,Store 1,365
Purchase,Returning,Cash,Store 3,10
Refund,Returning,Credit Card,Store 1,373
Purchase,New,PayPal,Store 1,164
Refund,New,Credit Card,Store 3,77
Exchange,Returning,Credit Card,Store 3,416
Purchase,VIP,Bank Transfer,Store 2,270
Exchange,VIP,Credit Card,Store 1,93
Exchange,New,Bank Transfer,Store 2,413
Purchase,Returning,Cash,Store 2,114
Refund,VIP,Credit Card,Store 1,69
Exchange,Returning,Cash,Store 2,130
Refund,Returning,Cash,Store 3,405
Exchange,Returning,PayPal,Store 1,328
Exchange,Returning,Cash,Store 1,417
Exchange,VIP,PayPal,Store 3,259
Cancel,New,Credit Card,Store 3,358
Refund,Returning,PayPal,Store 1,459
Cancel,Returning,Cash,Store 3,81
Cancel,New,Bank Transfer,Store 3,317
Refund,Returning,PayPal,Store 1,312
Purchase,VIP,Cash,Store 2,47
Exchange,New,Cash,Store 2,250
Exchange,Returning,Bank Transfer,Store 3,406
Exchange,Returning,Credit Card,Store 1,446
Purchase,Returning,Cash,Store 2,49
Exchange,VIP,Bank Transfer,Store 1,433
Exchange,New,Cash,Store 3,394
Refund,VIP,Bank Transfer,Store 1,287
Exchange,New,Cash,Store 3,426
Purchase,New,Cash,Store 2,82
Purchase,New,PayPal,Store 2,368
Refund,Returning,Bank Transfer,Store 2,223
Refund,Returning,Credit Card,Store 2,427
Exchange,New,Bank Transfer,Store 1,251
Cancel,New,Cash,Store 1,295
Purchase,Returning,Bank Transfer,Store 1,343
Purchase,Returning,Bank Transfer,Store 3,179
Exchange,New,Credit Card,Store 2,361
Purchase,VIP,Bank Transfer,Store 2,391
Purchase,Returning,Cash,Store 3,288
Refund,VIP,Bank Transfer,Store 2,349
Purchase,VIP,Credit Card,Store 2,268
Refund,Returning,Bank Transfer,Store 1,271
Purchase,Returning,Bank Transfer,Store 3,342
Exchange,Returning,PayPal,Store 2,384
Refund,New,PayPal,Store 3,481
Exchange,VIP,Bank Transfer,Store 1,134
Cancel,New,PayPal,Store 2,75
Exchange,New,Cash,Store 2,331
Cancel,VIP,PayPal,Store 1,184
Purchase,VIP,Cash,Store 3,122
Exchange,New,Cash,Store 1,240
Purchase,New,Bank Transfer,Store 2,298
Refund,VIP,PayPal,Store 3,302
Cancel,New,PayPal,Store 2,274
Cancel,Returning,Credit Card,Store 2,263
Cancel,Returning,Credit Card,Store 1,478
Exchange,Returning,Bank Transfer,Store 2,158
Purchase,New,PayPal,Store 2,431
Cancel,New,Cash,Store 2,168
Refund,Returning,Cash,Store 2,192
Refund,New,Bank Transfer,Store 2,218
Cancel,Returning,Bank Transfer,Store 2,149
Cancel,Returning,PayPal,Store 2,249
Purchase,New,Bank Transfer,Store 3,174
Exchange,New,Credit Card,Store 2,46
Refund,VIP,Cash,Store 3,460
Refund,VIP,Credit Card,Store 3,494
Exchange,VIP,PayPal,Store 2,321
Refund,Returning,Bank Transfer,Store 1,184
Exchange,VIP,Credit Card,Store 2,329
Exchange,VIP,Credit Card,Store 3,51
Cancel,New,PayPal,Store 2,261

</script><script type="text/plain" id="data_boxing_data" data-format="csv_embedded" data-src="">
boxer1,boxer2,city,ticketsales,date_announced,datetime_fight_starts,time_of_stoppage
Tyson Fury,Anthony Joshua,Riyadh,8.55e7,2024-08-15,2024-12-21T22:00:00.0,2024-12-21T20:45:32.0
Canelo Alvarez,Jermall Charlo,Las Vegas,2.53e7,2024-06-01,2024-09-14T20:00:00.0,2024-09-15T07:12:18.0
Oleksandr Usyk,Daniel Dubois,London,3.21e7,2024-07-20,2024-09-21T21:00:00.0,2024-09-21T22:28:45.0
Naoya Inoue,Luis Nery,Tokyo,1.87e7,2024-03-10,2024-05-06T17:00:00.0,2024-05-06T09:52:11.0
Terence Crawford,Errol Spence,Las Vegas,4.52e7,2024-05-05,2024-07-29T21:00:00.0,2024-07-30T06:18:33.0
Tyson Fury,Deontay Wilder,Las Vegas,3.89e7,2023-08-01,2024-03-09T20:00:00.0,2024-03-10T05:45:00.0
Canelo Alvarez,Dmitry Bivol,Las Vegas,2.84e7,2022-03-15,2022-05-07T21:00:00.0,2022-05-08T07:35:22.0
Oleksandr Usyk,Tyson Fury,Riyadh,9.23e7,2024-10-01,2024-12-21T22:00:00.0,2024-12-21T21:15:00.0
Naoya Inoue,Stephen Fulton,Tokyo,1.52e7,2024-01-08,2024-05-06T18:00:00.0,2024-05-06T10:28:44.0
Terence Crawford,Israil Madrimov,Los Angeles,2.28e7,2024-06-25,2024-08-03T21:00:00.0,2024-08-04T07:05:17.0
Gervonta Davis,Frank Martin,Las Vegas,1.95e7,2024-04-15,2024-06-15T22:00:00.0,2024-06-16T08:22:08.0
Shakur Stevenson,Edwin De Los Santos,Newark,8.7e6,2024-02-28,2024-04-13T21:00:00.0,2024-04-14T04:08:55.0
Devin Haney,Ryan Garcia,Las Vegas,3.56e7,2023-11-01,2023-04-22T21:00:00.0,2023-04-23T07:45:00.0
Ryan Garcia,Devin Haney,Las Vegas,4.21e7,2024-01-20,2024-04-20T21:00:00.0,2024-04-21T07:32:19.0
Tank Davis,Rolando Romero,Brooklyn,1.63e7,2023-03-10,2023-05-28T21:00:00.0,2023-05-29T04:18:42.0

</script>

<!-- ACTUAL CONTENT -->

<h1></h1>
<p></p>

    <div class="textblock-content">
        <a href="https://github.com/s-baumann/JSPlots.jl/blob/main/examples/pivottable_examples.jl" style="color: blue; font-weight: bold;">See here for the example code that generated this page</a>
<h1>PivotTable Examples</h1>
<p>This page demonstrates the key features of interactive PivotTable plots in JSPlots.</p>
<ul>
    <li><strong>Basic pivot:</strong> Simple data aggregation with drag-and-drop</li>
    <li><strong>Custom heatmaps:</strong> Color-coded matrices with custom color scales</li>
    <li><strong>Different renderers:</strong> Table, Bar Chart, Line Chart, and more</li>
    <li><strong>Data filtering:</strong> Inclusions and exclusions to focus on specific data</li>
    <li><strong>Aggregations:</strong> Sum, Average, Count, and other aggregation functions</li>
    <li><strong>Combined with other plots:</strong> Mix PivotTables with LineCharts and 3D plots</li>
</ul>
<p><em>Tip: Drag and drop fields between Rows, Columns, and Values to reorganize!</em></p>

    </div>
<br>
<hr>
<br>
    <style>
    .pvtFilterBox {
        z-index: 10000 !important;
        position: fixed !important;
    }
</style>

    <h2>sales_pivot</h2>
    <p>Basic pivot table - drag fields to reorganize rows and columns</p>
    
    <div style="margin-bottom: 10px;">
        <label>
            <input type="checkbox" id="show_totals_checkbox_sales_pivot"  onchange="toggleTotals_sales_pivot()" />
            Show Totals
        </label>
    </div>
    <div id="sales_pivot"></div>
    <div class="jsplots-datasource" style="text-align: right; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic;">
        Data: sales_data
    </div>
<br>
<hr>
<br>
    <style>
    .pvtFilterBox {
        z-index: 10000 !important;
        position: fixed !important;
    }
</style>

    <h2>performance_heatmap</h2>
    <p>Custom color scale heatmap - green indicates good performance, red needs improvement</p>
    
    <div style="margin-bottom: 10px;">
        <label>
            <input type="checkbox" id="show_totals_checkbox_performance_heatmap"  onchange="toggleTotals_performance_heatmap()" />
            Show Totals
        </label>
    </div>
    <div id="performance_heatmap"></div>
    <div class="jsplots-datasource" style="text-align: right; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic;">
        Data: performance_data
    </div>
<br>
<hr>
<br>
    <style>
    .pvtFilterBox {
        z-index: 10000 !important;
        position: fixed !important;
    }
</style>

    <h2>revenue_by_category</h2>
    <p>Bar chart renderer - switch renderer in the dropdown to see other visualizations</p>
    
    <div style="margin-bottom: 10px;">
        <label>
            <input type="checkbox" id="show_totals_checkbox_revenue_by_category"  onchange="toggleTotals_revenue_by_category()" />
            Show Totals
        </label>
    </div>
    <div id="revenue_by_category"></div>
    <div class="jsplots-datasource" style="text-align: right; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic;">
        Data: product_data
    </div>
<br>
<hr>
<br>
    <style>
    .pvtFilterBox {
        z-index: 10000 !important;
        position: fixed !important;
    }
</style>

    <h2>customer_revenue</h2>
    <p>Exclusions feature - 'Test' country data is automatically filtered out</p>
    
    <div style="margin-bottom: 10px;">
        <label>
            <input type="checkbox" id="show_totals_checkbox_customer_revenue"  onchange="toggleTotals_customer_revenue()" />
            Show Totals
        </label>
    </div>
    <div id="customer_revenue"></div>
    <div class="jsplots-datasource" style="text-align: right; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic;">
        Data: customer_data
    </div>
<br>
<hr>
<br>
    <style>
    .pvtFilterBox {
        z-index: 10000 !important;
        position: fixed !important;
    }
</style>

    <h2>survey_results</h2>
    <p>Inclusions feature - only showing ages 18-45, filtering out older demographics</p>
    
    <div style="margin-bottom: 10px;">
        <label>
            <input type="checkbox" id="show_totals_checkbox_survey_results"  onchange="toggleTotals_survey_results()" />
            Show Totals
        </label>
    </div>
    <div id="survey_results"></div>
    <div class="jsplots-datasource" style="text-align: right; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic;">
        Data: survey_data
    </div>
<br>
<hr>
<br>
    <style>
    .pvtFilterBox {
        z-index: 10000 !important;
        position: fixed !important;
    }
</style>

    <h2>transaction_analysis</h2>
    <p>Count aggregation - showing transaction counts rather than sums or averages</p>
    
    <div style="margin-bottom: 10px;">
        <label>
            <input type="checkbox" id="show_totals_checkbox_transaction_analysis"  onchange="toggleTotals_transaction_analysis()" />
            Show Totals
        </label>
    </div>
    <div id="transaction_analysis"></div>
    <div class="jsplots-datasource" style="text-align: right; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic;">
        Data: transaction_data
    </div>
<br>
<hr>
<br>
    <style>
    .pvtFilterBox {
        z-index: 10000 !important;
        position: fixed !important;
    }
</style>

    <h2>Returns_Over_Last_Few_Days</h2>
    <p>Stock returns heatmap with MSFT excluded</p>
    
    <div style="margin-bottom: 10px;">
        <label>
            <input type="checkbox" id="show_totals_checkbox_Returns_Over_Last_Few_Days"  onchange="toggleTotals_Returns_Over_Last_Few_Days()" />
            Show Totals
        </label>
    </div>
    <div id="Returns_Over_Last_Few_Days"></div>
    <div class="jsplots-datasource" style="text-align: right; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic;">
        Data: stockReturns
    </div>
<br>
<hr>
<br>
    <style>
    .pvtFilterBox {
        z-index: 10000 !important;
        position: fixed !important;
    }
</style>

    <h2>Correlation_Matrix</h2>
    <p>Correlation matrix with custom red-white-blue color scale</p>
    
    <div style="margin-bottom: 10px;">
        <label>
            <input type="checkbox" id="show_totals_checkbox_Correlation_Matrix"  onchange="toggleTotals_Correlation_Matrix()" />
            Show Totals
        </label>
    </div>
    <div id="Correlation_Matrix"></div>
    <div class="jsplots-datasource" style="text-align: right; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic;">
        Data: correlations
    </div>
<br>
<hr>
<br>
    <div class="textblock-content">
        <h2>Dataset Selection Feature</h2>
<p>This example demonstrates the new <strong>dataset selection</strong> feature in PivotTable. When multiple datasets are provided, a dropdown appears allowing you to switch between them dynamically.</p>
<h3>How it works:</h3>
<ul>
    <li><strong>Struct with DataFrames:</strong> We defined a struct <code>ExampleFrame</code> with fields <code>aa::DataFrame</code> and <code>bb::Union{Missing,DataFrame}</code></li>
    <li><strong>Automatic extraction:</strong> When you pass the struct to JSPlotPage, the DataFrames are automatically extracted with dot-prefixed names (e.g., <code>Symbol("multi_data.aa")</code>, <code>Symbol("multi_data.bb")</code>)</li>
    <li><strong>Multiple datasets:</strong> The PivotTable accepts a <code>Vector{Symbol}</code> of dataset labels instead of a single Symbol</li>
    <li><strong>Dynamic switching:</strong> Changing the dataset reloads the pivot table while preserving your current configuration</li>
</ul>
<p><em>Try switching between the three datasets using the dropdown above the pivot table!</em></p>

    </div>
<br>
<hr>
<br>
    <style>
    .pvtFilterBox {
        z-index: 10000 !important;
        position: fixed !important;
    }
</style>

    <h2>dataset_selector_demo</h2>
    <p>Dataset selection demo - use the dropdown above to switch between three different datasets. The pivot table will reload with the new data while preserving your row/column selections where possible.</p>
        <div style="margin-bottom: 10px;">
        <label for="dataset_select_dataset_selector_demo"><strong>Dataset:</strong></label>
        <select id="dataset_select_dataset_selector_demo" onchange="changeDataset_dataset_selector_demo()">
            <option value="multi_data.aa">multi_data.aa</option>
            <option value="multi_data.bb">multi_data.bb</option>
            <option value="standalone_data">standalone_data</option>
        </select>
    </div>

    <div style="margin-bottom: 10px;">
        <label>
            <input type="checkbox" id="show_totals_checkbox_dataset_selector_demo"  onchange="toggleTotals_dataset_selector_demo()" />
            Show Totals
        </label>
    </div>
    <div id="dataset_selector_demo"></div>
    <div class="jsplots-datasource" style="text-align: right; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic;">
        Data: multi_data.aa, multi_data.bb, standalone_data
    </div>
<br>
<hr>
<br>
    <div class="textblock-content">
        <h2>Temporal Data in PivotTables</h2>
<p>This example demonstrates handling of different temporal column types in PivotTable:</p>
<ul>
    <li><strong>Date</strong> (<code>date_announced</code>): Simple date without time component</li>
    <li><strong>DateTime</strong> (<code>datetime_fight_starts</code>): Date with time, no timezone</li>
    <li><strong>ZonedDateTime</strong> (<code>time_of_stoppage</code>): Date with time and timezone information</li>
</ul>
<p>Try dragging the temporal columns into the Rows or Columns area to see how they are displayed and aggregated.</p>

    </div>
<br>
<hr>
<br>
    <style>
    .pvtFilterBox {
        z-index: 10000 !important;
        position: fixed !important;
    }
</style>

    <h2>boxing_matches</h2>
    <p>Boxing match data with Date, DateTime, and ZonedDateTime columns. Drag date_announced, datetime_fight_starts, or time_of_stoppage into rows/cols to pivot by temporal data.</p>
    
    <div style="margin-bottom: 10px;">
        <label>
            <input type="checkbox" id="show_totals_checkbox_boxing_matches"  onchange="toggleTotals_boxing_matches()" />
            Show Totals
        </label>
    </div>
    <div id="boxing_matches"></div>
    <div class="jsplots-datasource" style="text-align: right; font-size: 0.85em; color: #666; margin-top: 8px; font-style: italic;">
        Data: boxing_data
    </div>
<br>
<hr>
<br>
    <div class="textblock-content">
        <h2>Key Features Summary</h2>
<ul>
    <li><strong>Drag-and-drop interface:</strong> Reorganize data dynamically by dragging fields</li>
    <li><strong>Multiple renderers:</strong> Table, Heatmap, Bar Chart, Line Chart, and more</li>
    <li><strong>Custom color scales:</strong> Define your own color gradients for heatmaps</li>
    <li><strong>Aggregation functions:</strong> Sum, Average, Count, Median, Min, Max, etc.</li>
    <li><strong>Data filtering:</strong> Include or exclude specific values</li>
    <li><strong>Multi-level grouping:</strong> Use multiple row or column dimensions</li>
    <li><strong>Dataset selection:</strong> Switch between multiple datasets with a dropdown</li>
    <li><strong>Struct support:</strong> Automatically extract DataFrames from structs</li>
    <li><strong>Integration:</strong> Combine PivotTables with LineCharts, 3D plots, and more</li>
</ul>
<p><strong>Tip:</strong> Try dragging unused fields from the top into Rows or Columns!</p>

    </div>


<hr><p align="right"><small>This page was created using <a href="https://github.com/s-baumann/JSPlots.jl">JSPlots.jl</a> v0.6.0.</small></p>
</body>
</html>
