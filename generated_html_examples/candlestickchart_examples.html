<!DOCTYPE html>
<html>
<head>
    <title>JSPlots.jl</title>
    <meta charset="UTF-8">

    <!-- External JavaScript libraries (loaded based on chart types used) -->
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #controls {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        #$div_id {
            width: 100%;
            height: 600px;
        }
    </style>
    

    <!-- Prism.js language components for CodeBlocks -->
    

</head>

<body>

<!-- Parquet support (loaded if using parquet dataformat) -->


<script>
// Helper function to wait for parquet-wasm to be loaded
function waitForParquet() {
    return new Promise(function(resolve) {
        if (window.parquetReady) {
            resolve();
            return;
        }
        var checkInterval = setInterval(function() {
            if (window.parquetReady) {
                clearInterval(checkInterval);
                resolve();
            }
        }, 50);
    });
}

// Centralized data loading function
// Centralized date parsing function
// Converts various date formats to JavaScript Date objects
// This is the ONLY place in the package where date parsing happens
// Handles: ISO strings, Date objects (from Arrow/Parquet), timestamps, and day counts
function parseDatesInData(data) {
    if (!data || data.length === 0) return data;

    // Regex patterns for ISO date formats
    var datePattern = /^\d{4}-\d{2}-\d{2}$/;  // YYYY-MM-DD
    var datetimePattern = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/;  // YYYY-MM-DDTHH:MM:SS
    var timePattern = /^\d{2}:\d{2}:\d{2}(\.\d+)?$/;  // HH:MM:SS or HH:MM:SS.sss

    // Timestamp range for reasonable dates (1970-01-01 to 2100-01-01 in milliseconds)
    var MIN_TIMESTAMP_MS = 0;
    var MAX_TIMESTAMP_MS = 4102444800000;  // 2100-01-01

    // Day count range (for dates stored as days since epoch, e.g., from some Parquet files)
    // Reasonable range: 0 (1970-01-01) to ~47500 (~2100-01-01)
    var MIN_DAYS = 0;
    var MAX_DAYS = 50000;
    var MS_PER_DAY = 86400000;

    // Scan multiple rows to better detect column types (some rows might have missing values)
    var rowsToCheck = Math.min(10, data.length);
    var dateColumns = [];
    var timeColumns = [];
    var timestampColumns = [];
    var dayCountColumns = [];
    var alreadyDateColumns = [];

    // Helper to check if a numeric value looks like a timestamp (milliseconds since epoch)
    function looksLikeTimestamp(value) {
        return typeof value === 'number' && value >= MIN_TIMESTAMP_MS && value <= MAX_TIMESTAMP_MS && value > MAX_DAYS;
    }

    // Helper to check if a numeric value looks like a day count since epoch
    function looksLikeDayCount(value) {
        return typeof value === 'number' && value >= MIN_DAYS && value <= MAX_DAYS && Number.isInteger(value);
    }

    // Build list of keys from first row
    var keys = Object.keys(data[0]);

    // Check each column across multiple rows
    keys.forEach(function(key) {
        var stringDateCount = 0;
        var timeCount = 0;
        var timestampCount = 0;
        var dayCountCount = 0;
        var alreadyDateCount = 0;
        var nonNullCount = 0;

        for (var i = 0; i < rowsToCheck; i++) {
            var value = data[i][key];
            if (value === null || value === undefined) continue;
            nonNullCount++;

            if (value instanceof Date) {
                alreadyDateCount++;
            } else if (typeof value === 'string') {
                if (datetimePattern.test(value) || datePattern.test(value)) {
                    stringDateCount++;
                } else if (timePattern.test(value)) {
                    timeCount++;
                }
            } else if (typeof value === 'number') {
                if (looksLikeTimestamp(value)) {
                    timestampCount++;
                } else if (looksLikeDayCount(value)) {
                    dayCountCount++;
                }
            }
        }

        // Classify column if majority of non-null values match a pattern
        var threshold = nonNullCount * 0.5;
        if (alreadyDateCount > threshold) {
            alreadyDateColumns.push(key);
        } else if (stringDateCount > threshold) {
            dateColumns.push(key);
        } else if (timeCount > threshold) {
            timeColumns.push(key);
        } else if (timestampCount > threshold) {
            timestampColumns.push(key);
        } else if (dayCountCount > threshold && dayCountCount >= 3) {
            // Be more conservative with day counts - require at least 3 matches
            dayCountColumns.push(key);
        }
    });

    // If no date/time columns found, return data unchanged
    if (dateColumns.length === 0 && timeColumns.length === 0 &&
        timestampColumns.length === 0 && dayCountColumns.length === 0 &&
        alreadyDateColumns.length === 0) {
        return data;
    }

    // Convert values in all rows
    return data.map(function(row) {
        var newRow = {};
        for (var key in row) {
            if (row.hasOwnProperty(key)) {
                var value = row[key];

                if (alreadyDateColumns.indexOf(key) !== -1) {
                    // Already a Date object - keep as is
                    newRow[key] = value;
                } else if (dateColumns.indexOf(key) !== -1 && typeof value === 'string') {
                    // ISO date string - convert to Date
                    newRow[key] = new Date(value);
                } else if (timeColumns.indexOf(key) !== -1 && typeof value === 'string') {
                    // Convert HH:MM:SS or HH:MM:SS.sss to milliseconds since midnight
                    var parts = value.split(':');
                    var hours = parseInt(parts[0], 10);
                    var minutes = parseInt(parts[1], 10);
                    var seconds = parseFloat(parts[2]);
                    newRow[key] = (hours * 3600 + minutes * 60 + seconds) * 1000;
                } else if (timestampColumns.indexOf(key) !== -1 && typeof value === 'number') {
                    // Timestamp in milliseconds - convert to Date
                    newRow[key] = new Date(value);
                } else if (dayCountColumns.indexOf(key) !== -1 && typeof value === 'number') {
                    // Day count since epoch - convert to Date
                    newRow[key] = new Date(value * MS_PER_DAY);
                } else {
                    newRow[key] = value;
                }
            }
        }
        return newRow;
    });
}

// Helper function to convert temporal values back to string format for categorical filtering
// Takes a value and returns the appropriate string representation
function temporalValueToString(value) {
    if (value instanceof Date) {
        // Convert Date to ISO string
        var year = value.getFullYear();
        var month = String(value.getMonth() + 1).padStart(2, '0');
        var day = String(value.getDate()).padStart(2, '0');
        var hours = String(value.getHours()).padStart(2, '0');
        var minutes = String(value.getMinutes()).padStart(2, '0');
        var seconds = String(value.getSeconds()).padStart(2, '0');

        // Check if this is a date-only value (time is midnight UTC)
        if (hours === '00' && minutes === '00' && seconds === '00') {
            return year + '-' + month + '-' + day;
        } else {
            return year + '-' + month + '-' + day + 'T' + hours + ':' + minutes + ':' + seconds;
        }
    } else if (typeof value === 'number' && value >= 0 && value < 86400000) {
        // Likely a Time value (milliseconds since midnight, less than 24 hours)
        var totalSeconds = Math.floor(value / 1000);
        var hours = Math.floor(totalSeconds / 3600);
        var minutes = Math.floor((totalSeconds % 3600) / 60);
        var seconds = totalSeconds % 60;
        var milliseconds = value % 1000;

        var timeStr = String(hours).padStart(2, '0') + ':' +
                      String(minutes).padStart(2, '0') + ':' +
                      String(seconds).padStart(2, '0');

        // Add decimal part if there are milliseconds
        if (milliseconds > 0) {
            timeStr += '.' + String(milliseconds);
        }

        return timeStr;
    } else {
        // Return as-is for other types
        return String(value);
    }
}

// Centralized observation counting and filtering function
// Applies filters incrementally while updating observation count displays
// Returns filtered data
function applyFiltersWithCounting(allData, chartTitle, categoricalFilters, continuousFilters, filters, rangeFilters) {
    var totalObs = allData.length;

    // Update total observation count
    var totalObsElement = document.getElementById(chartTitle + '_total_obs');
    if (totalObsElement) {
        totalObsElement.textContent = totalObs + ' observations';
    }

    // Apply filters incrementally to track observation counts
    var currentData = allData;

    // Apply categorical filters and update counts
    categoricalFilters.forEach(function(col) {
        if (filters[col] && filters[col].length > 0) {
            currentData = currentData.filter(function(row) {
                var rowValueStr = temporalValueToString(row[col]);
                return filters[col].includes(rowValueStr);
            });
        }

        var countElement = document.getElementById(col + '_select_' + chartTitle + '_obs_count');
        if (countElement) {
            var pct = totalObs > 0 ? Math.round((currentData.length / totalObs) * 100) : 100;
            countElement.textContent = pct + '% (' + currentData.length + ') remaining';
        }
    });

    // Apply continuous filters and update counts
    continuousFilters.forEach(function(col) {
        if (rangeFilters[col]) {
            var range = rangeFilters[col];
            currentData = currentData.filter(function(row) {
                var rawValue = row[col];
                var value;
                if (rawValue instanceof Date) {
                    value = rawValue.getTime();
                } else {
                    value = parseFloat(rawValue);
                }
                return value >= range.min && value <= range.max;
            });
        }

        var countElement = document.getElementById(col + '_range_' + chartTitle + '_obs_count');
        if (countElement) {
            var pct = totalObs > 0 ? Math.round((currentData.length / totalObs) * 100) : 100;
            countElement.textContent = pct + '% (' + currentData.length + ') remaining';
        }
    });

    return currentData;
}

// Axis transformation functions
// These transform data values according to selected transformation type
function applyAxisTransform(values, transformType) {
    if (!values || values.length === 0) return [];

    switch(transformType) {
        case 'identity':
            return values;

        case 'log':
            return values.map(function(v) {
                return v > 0 ? Math.log(v) : NaN;
            });

        case 'z_score':
            // Z-score standardization: (x - mean) / std
            var numericVals = values.filter(function(v) { return !isNaN(v) && isFinite(v); });
            if (numericVals.length === 0) return values;

            var mean = numericVals.reduce(function(a, b) { return a + b; }, 0) / numericVals.length;
            var variance = numericVals.reduce(function(sum, v) {
                return sum + Math.pow(v - mean, 2);
            }, 0) / numericVals.length;
            var std = Math.sqrt(variance);

            if (std === 0) return values;

            return values.map(function(v) {
                if (isNaN(v) || !isFinite(v)) return NaN;
                return (v - mean) / std;
            });

        case 'quantile':
            // Rank-based transformation to [0, 1]
            // Create array of {value, originalIndex} pairs
            var indexedValues = values.map(function(v, i) {
                return { value: v, index: i };
            });

            // Filter out invalid values and sort
            var validValues = indexedValues.filter(function(item) {
                return !isNaN(item.value) && isFinite(item.value);
            }).sort(function(a, b) {
                return a.value - b.value;
            });

            if (validValues.length === 0) return values;

            // Assign ranks (0 to 1)
            var ranks = new Array(values.length).fill(NaN);
            validValues.forEach(function(item, rank) {
                // Map rank to [0, 1] where lowest = 0, highest = 1
                ranks[item.index] = validValues.length === 1 ? 0.5 : rank / (validValues.length - 1);
            });

            return ranks;

        case 'inverse_cdf':
            // Z-score followed by normal CDF transformation to [0, 1]
            var numericVals2 = values.filter(function(v) { return !isNaN(v) && isFinite(v); });
            if (numericVals2.length === 0) return values;

            var mean2 = numericVals2.reduce(function(a, b) { return a + b; }, 0) / numericVals2.length;
            var variance2 = numericVals2.reduce(function(sum, v) {
                return sum + Math.pow(v - mean2, 2);
            }, 0) / numericVals2.length;
            var std2 = Math.sqrt(variance2);

            if (std2 === 0) return values.map(function() { return 0.5; });

            return values.map(function(v) {
                if (isNaN(v) || !isFinite(v)) return NaN;
                var zscore = (v - mean2) / std2;
                return normalCDF(zscore);
            });

        default:
            return values;
    }
}

// Normal CDF (cumulative distribution function) for standard normal
function normalCDF(x) {
    // Using error function approximation
    var t = 1 / (1 + 0.2316419 * Math.abs(x));
    var d = 0.3989423 * Math.exp(-x * x / 2);
    var prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
    return x > 0 ? 1 - prob : prob;
}

// Inverse normal CDF (quantile function) for standard normal
function inverseNormalCDF(p) {
    // Rational approximation for inverse normal CDF
    // Valid for 0 < p < 1
    if (p <= 0 || p >= 1) {
        return NaN;
    }

    var a = [0, -3.969683028665376e+01, 2.209460984245205e+02,
             -2.759285104469687e+02, 1.383577518672690e+02,
             -3.066479806614716e+01, 2.506628277459239e+00];
    var b = [0, -5.447609879822406e+01, 1.615858368580409e+02,
             -1.556989798598866e+02, 6.680131188771972e+01,
             -1.328068155288572e+01];
    var c = [0, -7.784894002430293e-03, -3.223964580411365e-01,
             -2.400758277161838e+00, -2.549732539343734e+00,
             4.374664141464968e+00, 2.938163982698783e+00];
    var d = [0, 7.784695709041462e-03, 3.224671290700398e-01,
             2.445134137142996e+00, 3.754408661907416e+00];

    var q, r, result;

    if (p < 0.02425) {
        q = Math.sqrt(-2 * Math.log(p));
        result = (((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q + c[6]) /
                 ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1);
    } else if (p > 0.97575) {
        q = Math.sqrt(-2 * Math.log(1 - p));
        result = -(((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q + c[6]) /
                  ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1);
    } else {
        q = p - 0.5;
        r = q * q;
        result = (((((a[1] * r + a[2]) * r + a[3]) * r + a[4]) * r + a[5]) * r + a[6]) * q /
                 (((((b[1] * r + b[2]) * r + b[3]) * r + b[4]) * r + b[5]) * r + 1);
    }

    return result;
}

// Get axis label with transformation applied
function getAxisLabel(originalLabel, transformType) {
    switch(transformType) {
        case 'log':
            return 'log(' + originalLabel + ')';
        case 'z_score':
            return 'z(' + originalLabel + ')';
        case 'quantile':
            return 'quantile(' + originalLabel + ')';
        case 'inverse_cdf':
            return 'Î¦(' + originalLabel + ')';
        default:
            return originalLabel;
    }
}

// Setup aspect ratio control for a chart
// This should be called after the chart is first rendered
// Uses logarithmic scale for better precision at smaller aspect ratios
function setupAspectRatioControl(chartId, updateCallback) {
    var slider = document.getElementById(chartId + '_aspect_ratio_slider');
    var label = document.getElementById(chartId + '_aspect_ratio_label');

    if (!slider || !label) return; // Not all charts have aspect ratio control

    slider.addEventListener('input', function() {
        // Convert from log space to linear space
        var logValue = parseFloat(this.value);
        var aspectRatio = Math.exp(logValue);
        label.textContent = aspectRatio.toFixed(2);

        // Get current width of chart div
        var chartDiv = document.getElementById(chartId);
        if (!chartDiv) return;

        var width = chartDiv.offsetWidth;
        var height = width * aspectRatio;

        // Update chart layout with new height
        Plotly.relayout(chartId, { height: height });

        // Call the optional callback if provided
        if (updateCallback && typeof updateCallback === 'function') {
            updateCallback(height);
        }
    });

    // Trigger initial sizing
    var initialLogValue = parseFloat(slider.value);
    var initialAspectRatio = Math.exp(initialLogValue);
    label.textContent = initialAspectRatio.toFixed(2);
    var chartDiv = document.getElementById(chartId);
    if (chartDiv) {
        var width = chartDiv.offsetWidth;
        var height = width * initialAspectRatio;
        Plotly.relayout(chartId, { height: height });
    }
}

// This function parses data from embedded or external sources and returns a Promise
// Supports CSV (embedded/external), JSON (embedded/external), and Parquet (external) formats
// Usage: loadDataset('dataLabel').then(function(data) { /* use data */ });
function loadDataset(dataLabel) {
    return new Promise(function(resolve, reject) {
        var dataElement = document.getElementById(dataLabel);
        if (!dataElement) {
            reject(new Error('Data element not found: ' + dataLabel));
            return;
        }

        var format = dataElement.getAttribute('data-format') || 'csv_embedded';
        var dataSrc = dataElement.getAttribute('data-src');

        // Handle external JSON files
        if (format === 'json_external' && dataSrc) {
            fetch(dataSrc)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.json();
                })
                .then(function(data) {
                    // Parse dates in JSON data (centralized)
                    resolve(parseDatesInData(data));
                })
                .catch(function(error) {
                    console.error('Error loading external JSON:', error);
                    reject(error);
                });
            return;
        }

        // Handle external Parquet files
        if (format === 'parquet' && dataSrc) {
            // Wait for parquet-wasm to be loaded first
            waitForParquet()
                .then(function() {
                    return fetch(dataSrc);
                })
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.arrayBuffer();
                })
                .then(function(arrayBuffer) {
                    // Use parquet-wasm to read the file
                    var uint8Array = new Uint8Array(arrayBuffer);

                    // readParquet returns an Arrow Table
                    var wasmTable = window.parquetWasm.readParquet(uint8Array);

                    // Convert to Arrow IPC stream
                    var ipcStream = wasmTable.intoIPCStream();

                    // Use Apache Arrow JS to read the IPC stream
                    var arrowTable = window.Arrow.tableFromIPC(ipcStream);

                    // Convert Arrow Table to array of JavaScript objects
                    var data = [];
                    for (var i = 0; i < arrowTable.numRows; i++) {
                        var row = {};
                        arrowTable.schema.fields.forEach(function(field) {
                            var column = arrowTable.getChild(field.name);
                            var value = column.get(i);

                            // Convert BigInt to Number (Arrow returns BigInt for Int64)
                            if (typeof value === 'bigint') {
                                value = Number(value);
                            }

                            row[field.name] = value;
                        });
                        data.push(row);
                    }

                    // Parse dates in Parquet data (centralized date handling)
                    resolve(parseDatesInData(data));
                })
                .catch(function(error) {
                    console.error('Error loading external Parquet:', error);
                    reject(error);
                });
            return;
        }

        // Handle external CSV files
        if (format === 'csv_external' && dataSrc) {
            fetch(dataSrc)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.text();
                })
                .then(function(csvText) {
                    Papa.parse(csvText, {
                        header: true,
                        dynamicTyping: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            // Check for fatal errors only (not warnings)
                            var fatalErrors = results.errors.filter(function(err) {
                                return err.type !== 'Delimiter';
                            });

                            if (fatalErrors.length > 0) {
                                console.error('CSV parsing errors:', fatalErrors);
                                reject(fatalErrors);
                            } else if (results.data && results.data.length > 0) {
                                // Parse dates in CSV data (centralized)
                                resolve(parseDatesInData(results.data));
                            } else {
                                reject(new Error('No data parsed from CSV'));
                            }
                        },
                        error: function(error) {
                            console.error('CSV parsing error:', error);
                            reject(error);
                        }
                    });
                })
                .catch(function(error) {
                    console.error('Error loading external CSV:', error);
                    reject(error);
                });
            return;
        }

        // Handle embedded data
        var dataText = dataElement.textContent.trim();

        if (format === 'json_embedded') {
            // Parse JSON data
            try {
                var data = JSON.parse(dataText);
                // Parse dates in JSON data (centralized)
                resolve(parseDatesInData(data));
            } catch (error) {
                console.error('JSON parsing error:', error);
                reject(error);
            }
        } else if (format === 'csv_embedded') {
            // Parse CSV data using PapaParse
            Papa.parse(dataText, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    // Check for fatal errors only (not warnings)
                    // PapaParse includes non-fatal warnings in errors array
                    var fatalErrors = results.errors.filter(function(err) {
                        // Filter out delimiter detection warnings - these aren't fatal
                        // (common for single-column CSVs)
                        return err.type !== 'Delimiter';
                    });

                    if (fatalErrors.length > 0) {
                        console.error('CSV parsing errors:', fatalErrors);
                        reject(fatalErrors);
                    } else if (results.data && results.data.length > 0) {
                        // Parse dates in CSV data (centralized)
                        resolve(parseDatesInData(results.data));
                    } else {
                        reject(new Error('No data parsed from CSV'));
                    }
                },
                error: function(error) {
                    console.error('CSV parsing error:', error);
                    reject(error);
                }
            });
        } else {
            reject(new Error('Unsupported data format: ' + format));
        }
    });
}

$(function(){

// Global fix for PivotTable.js filter box positioning issue
// See: https://github.com/nicolaskruchten/pivottable/issues/865
// The library calculates position incorrectly - we fix it by repositioning after creation
(function() {
    if (window._pvtFilterBoxFixApplied) return; // Only apply once
    window._pvtFilterBoxFixApplied = true;

    var lastClickedTriangle = null;

    // Helper function to reposition the filter box
    function repositionFilterBox($box, triangle) {
        if (!triangle || !$box.length) return;

        // Get triangle position relative to viewport
        var triangleRect = triangle.getBoundingClientRect();

        // Get box dimensions (use defaults if not yet rendered)
        var boxWidth = $box.outerWidth() || 300;
        var boxHeight = $box.outerHeight() || 400;

        // Calculate position relative to viewport (for position:fixed)
        var newLeft = triangleRect.left;
        var newTop = triangleRect.bottom + 5;

        // Adjust if it would go off the right edge
        if (newLeft + boxWidth > window.innerWidth - 20) {
            newLeft = triangleRect.right - boxWidth;
        }

        // Adjust if it would go off the bottom edge
        if (newTop + boxHeight > window.innerHeight - 20) {
            newTop = triangleRect.top - boxHeight - 5;
        }

        // Ensure minimum positions
        if (newLeft < 10) newLeft = 10;
        if (newTop < 10) newTop = 10;

        // Use position:fixed for viewport-relative positioning
        $box.css({
            'position': 'fixed',
            'left': newLeft + 'px',
            'top': newTop + 'px'
        });
    }

    // Capture which triangle was clicked
    $(document).on('click', '.pvtTriangle', function(e) {
        lastClickedTriangle = this;
    });

    // Watch for filter box creation and fix position
    var observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            mutation.addedNodes.forEach(function(node) {
                if (node.nodeType === 1 && $(node).hasClass('pvtFilterBox')) {
                    var $box = $(node);
                    var triangle = lastClickedTriangle;

                    // Apply the fix multiple times to ensure it sticks after PivotTable.js finishes
                    // The library may set position after initial render
                    var timings = [0, 10, 50, 100, 200];
                    timings.forEach(function(delay) {
                        setTimeout(function() {
                            repositionFilterBox($box, triangle);
                        }, delay);
                    });

                    // Also reposition on any style changes to the box (in case library updates position)
                    var styleObserver = new MutationObserver(function(styleMutations) {
                        repositionFilterBox($box, triangle);
                    });
                    styleObserver.observe(node, { attributes: true, attributeFilter: ['style'] });

                    // Disconnect the style observer when the filter box is removed
                    var removalObserver = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            mutation.removedNodes.forEach(function(removedNode) {
                                if (removedNode === node) {
                                    styleObserver.disconnect();
                                    removalObserver.disconnect();
                                    lastClickedTriangle = null;
                                }
                            });
                        });
                    });
                    removalObserver.observe(document.body, { childList: true, subtree: true });
                }
            });
        });
    });

    observer.observe(document.body, { childList: true, subtree: true });
})();

(function() {
    // Configuration
    const TIME_FROM_COL = 'time_from';
    const TIME_TO_COL = 'time_to';
    const SYMBOL_COL = 'symbol';
    const OPEN_COL = 'open';
    const HIGH_COL = 'high';
    const LOW_COL = 'low';
    const CLOSE_COL = 'close';
    const VOLUME_COL = 'volume';
    const HAS_VOLUME = true;
    const CATEGORICAL_FILTERS = [];
    const CONTINUOUS_FILTERS = [];

    let allData = [];
    let firstBarOpenPrices = {};  // Store first bar open prices for renormalization

    // Make it global so inline onchange can see it
    window.updateChart_example1_candlestick = function() {
        // Get current control values
        const renormalizeCheckbox = document.getElementById('renormalize_checkbox_example1_candlestick');
        const RENORMALIZE = renormalizeCheckbox ? renormalizeCheckbox.checked : false;

        const showVolumeCheckbox = document.getElementById('show_volume_checkbox_example1_candlestick');
        const SHOW_VOLUME = HAS_VOLUME && showVolumeCheckbox ? showVolumeCheckbox.checked : false;

        const logVolumeCheckbox = document.getElementById('log_volume_checkbox_example1_candlestick');
        const LOG_VOLUME = SHOW_VOLUME && logVolumeCheckbox ? logVolumeCheckbox.checked : false;

        const chartTypeSelect = document.getElementById('chart_type_select_example1_candlestick');
        const CHART_TYPE = chartTypeSelect ? chartTypeSelect.value : 'candlestick';

        const displayModeSelect = document.getElementById('display_mode_select_example1_candlestick');
        const DISPLAY_MODE = displayModeSelect ? displayModeSelect.value : 'Overlay';

        // Get current filter values
        const filters = {};
        const rangeFilters = {};

        // Read categorical filters (dropdowns)
        CATEGORICAL_FILTERS.forEach(col => {
            const select = document.getElementById(col + '_select_example1_candlestick');
            if (select) {
                filters[col] = Array.from(select.selectedOptions).map(opt => opt.value);
            }
        });

        // Read continuous filters (range sliders)
        CONTINUOUS_FILTERS.forEach(col => {
            const slider = $('#' + col + '_range_example1_candlestick' + '_slider');
            if (slider.length > 0) {
                rangeFilters[col] = {
                    min: slider.slider("values", 0),
                    max: slider.slider("values", 1)
                };
            }
        });

        // Apply filters with observation counting
        const filteredData = applyFiltersWithCounting(
            allData,
            'example1_candlestick',
            CATEGORICAL_FILTERS,
            CONTINUOUS_FILTERS,
            filters,
            rangeFilters
        );

        // Group data by symbol
        const symbolData = {};
        filteredData.forEach(row => {
            const symbol = String(row[SYMBOL_COL]);
            if (!symbolData[symbol]) {
                symbolData[symbol] = [];
            }
            symbolData[symbol].push(row);
        });

        // Sort each symbol's data by time
        for (let symbol in symbolData) {
            symbolData[symbol].sort((a, b) => {
                const aTime = a[TIME_FROM_COL];
                const bTime = b[TIME_FROM_COL];
                if (aTime instanceof Date && bTime instanceof Date) {
                    return aTime - bTime;
                }
                return aTime < bTime ? -1 : (aTime > bTime ? 1 : 0);
            });
        }

        // Calculate first bar open prices for renormalization (only once)
        if (Object.keys(firstBarOpenPrices).length === 0 || !RENORMALIZE) {
            firstBarOpenPrices = {};
            for (let symbol in symbolData) {
                if (symbolData[symbol].length > 0) {
                    firstBarOpenPrices[symbol] = symbolData[symbol][0][OPEN_COL];
                }
            }
        }

        // Route to appropriate rendering function
        if (DISPLAY_MODE === 'Overlay') {
            renderOverlay(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        } else {
            renderFaceted(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        }
    };

    // Render overlay mode (all symbols on same chart)
    function renderOverlay(symbolData, renormalize, showVolume, logVolume, chartType) {
        const traces = [];
        const symbols = Object.keys(symbolData).sort();
        const colorPalette = ['#636efa', '#EF553B', '#00cc96', '#ab63fa', '#FFA15A',
                             '#19d3f3', '#FF6692', '#B6E880', '#FF97FF', '#FECB52'];

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];
            const color = colorPalette[idx % colorPalette.length];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: 'x',
                yaxis: 'y',
                increasing: {line: {color: color}},
                decreasing: {line: {color: color}}
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: 'x',
                    yaxis: 'y2',
                    marker: {color: color},
                    showlegend: false
                };
                traces.push(volumeTrace);
            }
        });

        // Layout configuration
        const layout = {
            xaxis: {
                title: TIME_FROM_COL,
                anchor: 'y'
            },
            hovermode: 'closest',
            showlegend: true
        };

        if (showVolume && HAS_VOLUME) {
            // Two subplots: Candlestick on top, volume on bottom
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price',
                domain: [0.3, 1]
            };
            layout.yaxis2 = {
                title: logVolume ? 'log(Volume)' : 'Volume',
                domain: [0, 0.25],
                anchor: 'x'
            };
            layout.barmode = 'group';  // Dodge volume bars
        } else {
            // Single plot: Candlestick only
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price'
            };
        }

        Plotly.newPlot('example1_candlestick', traces, layout, {responsive: true});
    }

    // Render faceted mode (one subplot per symbol)
    function renderFaceted(symbolData, renormalize, showVolume, logVolume, chartType) {
        const symbols = Object.keys(symbolData).sort();
        const nSymbols = symbols.length;

        // Calculate grid dimensions (prefer wider grids)
        const nCols = Math.ceil(Math.sqrt(nSymbols * 1.5));
        const nRows = Math.ceil(nSymbols / nCols);

        const traces = [];
        const layout = {
            hovermode: 'closest',
            showlegend: false,
            grid: {rows: nRows, columns: nCols, pattern: 'independent'}
        };

        if (showVolume && HAS_VOLUME) {
            layout.barmode = 'group';
        }

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            const row = Math.floor(idx / nCols) + 1;
            const col = (idx % nCols) + 1;
            const xaxis = idx === 0 ? 'x' : 'x' + (idx + 1);
            const yaxis = idx === 0 ? 'y' : 'y' + (idx + 1);

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: xaxis,
                yaxis: yaxis
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const yaxis_vol = idx === 0 ? 'y' + (nSymbols + 1) : 'y' + (nSymbols + idx + 1);

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: xaxis,
                    yaxis: yaxis_vol,
                    showlegend: false
                };
                traces.push(volumeTrace);

                // Configure volume yaxis
                layout[yaxis_vol] = {
                    title: row === nRows ? (logVolume ? 'log(Vol)' : 'Vol') : '',
                    anchor: xaxis
                };
            }

            // Add axis configuration
            layout[xaxis] = {
                title: row === nRows ? TIME_FROM_COL : '',
                anchor: yaxis
            };
            layout[yaxis] = {
                title: col === 1 ? (renormalize ? 'Norm Price' : 'Price') : '',
                anchor: xaxis
            };

            // Add annotation for symbol label
            if (!layout.annotations) layout.annotations = [];
            layout.annotations.push({
                text: symbol,
                showarrow: false,
                xref: xaxis === 'x' ? 'x domain' : xaxis + ' domain',
                yref: yaxis === 'y' ? 'y domain' : yaxis + ' domain',
                x: 0.5,
                y: 1.05,
                xanchor: 'center',
                yanchor: 'bottom',
                font: {size: 10}
            });
        });

        Plotly.newPlot('example1_candlestick', traces, layout, {responsive: true});
    }

    // Load and parse CSV data using centralized parser
    loadDataset('stock_data_1').then(function(data) {
        allData = data;
        window.updateChart_example1_candlestick();

        // Setup aspect ratio control after initial render
        setupAspectRatioControl('example1_candlestick');
    }).catch(function(error) {
        console.error('Error loading data for chart example1_candlestick:', error);
    });
})();
(function() {
    // Configuration
    const TIME_FROM_COL = 'time_from';
    const TIME_TO_COL = 'time_to';
    const SYMBOL_COL = 'symbol';
    const OPEN_COL = 'open';
    const HIGH_COL = 'high';
    const LOW_COL = 'low';
    const CLOSE_COL = 'close';
    const VOLUME_COL = 'volume';
    const HAS_VOLUME = true;
    const CATEGORICAL_FILTERS = [];
    const CONTINUOUS_FILTERS = [];

    let allData = [];
    let firstBarOpenPrices = {};  // Store first bar open prices for renormalization

    // Make it global so inline onchange can see it
    window.updateChart_example2_candlestick = function() {
        // Get current control values
        const renormalizeCheckbox = document.getElementById('renormalize_checkbox_example2_candlestick');
        const RENORMALIZE = renormalizeCheckbox ? renormalizeCheckbox.checked : false;

        const showVolumeCheckbox = document.getElementById('show_volume_checkbox_example2_candlestick');
        const SHOW_VOLUME = HAS_VOLUME && showVolumeCheckbox ? showVolumeCheckbox.checked : false;

        const logVolumeCheckbox = document.getElementById('log_volume_checkbox_example2_candlestick');
        const LOG_VOLUME = SHOW_VOLUME && logVolumeCheckbox ? logVolumeCheckbox.checked : false;

        const chartTypeSelect = document.getElementById('chart_type_select_example2_candlestick');
        const CHART_TYPE = chartTypeSelect ? chartTypeSelect.value : 'candlestick';

        const displayModeSelect = document.getElementById('display_mode_select_example2_candlestick');
        const DISPLAY_MODE = displayModeSelect ? displayModeSelect.value : 'Overlay';

        // Get current filter values
        const filters = {};
        const rangeFilters = {};

        // Read categorical filters (dropdowns)
        CATEGORICAL_FILTERS.forEach(col => {
            const select = document.getElementById(col + '_select_example2_candlestick');
            if (select) {
                filters[col] = Array.from(select.selectedOptions).map(opt => opt.value);
            }
        });

        // Read continuous filters (range sliders)
        CONTINUOUS_FILTERS.forEach(col => {
            const slider = $('#' + col + '_range_example2_candlestick' + '_slider');
            if (slider.length > 0) {
                rangeFilters[col] = {
                    min: slider.slider("values", 0),
                    max: slider.slider("values", 1)
                };
            }
        });

        // Apply filters with observation counting
        const filteredData = applyFiltersWithCounting(
            allData,
            'example2_candlestick',
            CATEGORICAL_FILTERS,
            CONTINUOUS_FILTERS,
            filters,
            rangeFilters
        );

        // Group data by symbol
        const symbolData = {};
        filteredData.forEach(row => {
            const symbol = String(row[SYMBOL_COL]);
            if (!symbolData[symbol]) {
                symbolData[symbol] = [];
            }
            symbolData[symbol].push(row);
        });

        // Sort each symbol's data by time
        for (let symbol in symbolData) {
            symbolData[symbol].sort((a, b) => {
                const aTime = a[TIME_FROM_COL];
                const bTime = b[TIME_FROM_COL];
                if (aTime instanceof Date && bTime instanceof Date) {
                    return aTime - bTime;
                }
                return aTime < bTime ? -1 : (aTime > bTime ? 1 : 0);
            });
        }

        // Calculate first bar open prices for renormalization (only once)
        if (Object.keys(firstBarOpenPrices).length === 0 || !RENORMALIZE) {
            firstBarOpenPrices = {};
            for (let symbol in symbolData) {
                if (symbolData[symbol].length > 0) {
                    firstBarOpenPrices[symbol] = symbolData[symbol][0][OPEN_COL];
                }
            }
        }

        // Route to appropriate rendering function
        if (DISPLAY_MODE === 'Overlay') {
            renderOverlay(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        } else {
            renderFaceted(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        }
    };

    // Render overlay mode (all symbols on same chart)
    function renderOverlay(symbolData, renormalize, showVolume, logVolume, chartType) {
        const traces = [];
        const symbols = Object.keys(symbolData).sort();
        const colorPalette = ['#636efa', '#EF553B', '#00cc96', '#ab63fa', '#FFA15A',
                             '#19d3f3', '#FF6692', '#B6E880', '#FF97FF', '#FECB52'];

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];
            const color = colorPalette[idx % colorPalette.length];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: 'x',
                yaxis: 'y',
                increasing: {line: {color: color}},
                decreasing: {line: {color: color}}
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: 'x',
                    yaxis: 'y2',
                    marker: {color: color},
                    showlegend: false
                };
                traces.push(volumeTrace);
            }
        });

        // Layout configuration
        const layout = {
            xaxis: {
                title: TIME_FROM_COL,
                anchor: 'y'
            },
            hovermode: 'closest',
            showlegend: true
        };

        if (showVolume && HAS_VOLUME) {
            // Two subplots: Candlestick on top, volume on bottom
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price',
                domain: [0.3, 1]
            };
            layout.yaxis2 = {
                title: logVolume ? 'log(Volume)' : 'Volume',
                domain: [0, 0.25],
                anchor: 'x'
            };
            layout.barmode = 'group';  // Dodge volume bars
        } else {
            // Single plot: Candlestick only
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price'
            };
        }

        Plotly.newPlot('example2_candlestick', traces, layout, {responsive: true});
    }

    // Render faceted mode (one subplot per symbol)
    function renderFaceted(symbolData, renormalize, showVolume, logVolume, chartType) {
        const symbols = Object.keys(symbolData).sort();
        const nSymbols = symbols.length;

        // Calculate grid dimensions (prefer wider grids)
        const nCols = Math.ceil(Math.sqrt(nSymbols * 1.5));
        const nRows = Math.ceil(nSymbols / nCols);

        const traces = [];
        const layout = {
            hovermode: 'closest',
            showlegend: false,
            grid: {rows: nRows, columns: nCols, pattern: 'independent'}
        };

        if (showVolume && HAS_VOLUME) {
            layout.barmode = 'group';
        }

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            const row = Math.floor(idx / nCols) + 1;
            const col = (idx % nCols) + 1;
            const xaxis = idx === 0 ? 'x' : 'x' + (idx + 1);
            const yaxis = idx === 0 ? 'y' : 'y' + (idx + 1);

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: xaxis,
                yaxis: yaxis
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const yaxis_vol = idx === 0 ? 'y' + (nSymbols + 1) : 'y' + (nSymbols + idx + 1);

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: xaxis,
                    yaxis: yaxis_vol,
                    showlegend: false
                };
                traces.push(volumeTrace);

                // Configure volume yaxis
                layout[yaxis_vol] = {
                    title: row === nRows ? (logVolume ? 'log(Vol)' : 'Vol') : '',
                    anchor: xaxis
                };
            }

            // Add axis configuration
            layout[xaxis] = {
                title: row === nRows ? TIME_FROM_COL : '',
                anchor: yaxis
            };
            layout[yaxis] = {
                title: col === 1 ? (renormalize ? 'Norm Price' : 'Price') : '',
                anchor: xaxis
            };

            // Add annotation for symbol label
            if (!layout.annotations) layout.annotations = [];
            layout.annotations.push({
                text: symbol,
                showarrow: false,
                xref: xaxis === 'x' ? 'x domain' : xaxis + ' domain',
                yref: yaxis === 'y' ? 'y domain' : yaxis + ' domain',
                x: 0.5,
                y: 1.05,
                xanchor: 'center',
                yanchor: 'bottom',
                font: {size: 10}
            });
        });

        Plotly.newPlot('example2_candlestick', traces, layout, {responsive: true});
    }

    // Load and parse CSV data using centralized parser
    loadDataset('stock_data_2').then(function(data) {
        allData = data;
        window.updateChart_example2_candlestick();

        // Setup aspect ratio control after initial render
        setupAspectRatioControl('example2_candlestick');
    }).catch(function(error) {
        console.error('Error loading data for chart example2_candlestick:', error);
    });
})();
(function() {
    // Configuration
    const TIME_FROM_COL = 'quarter';
    const TIME_TO_COL = 'quarter_end';
    const SYMBOL_COL = 'company';
    const OPEN_COL = 'open_price';
    const HIGH_COL = 'high_price';
    const LOW_COL = 'low_price';
    const CLOSE_COL = 'close_price';
    const VOLUME_COL = '';
    const HAS_VOLUME = false;
    const CATEGORICAL_FILTERS = [];
    const CONTINUOUS_FILTERS = [];

    let allData = [];
    let firstBarOpenPrices = {};  // Store first bar open prices for renormalization

    // Make it global so inline onchange can see it
    window.updateChart_example3_candlestick = function() {
        // Get current control values
        const renormalizeCheckbox = document.getElementById('renormalize_checkbox_example3_candlestick');
        const RENORMALIZE = renormalizeCheckbox ? renormalizeCheckbox.checked : false;

        const showVolumeCheckbox = document.getElementById('show_volume_checkbox_example3_candlestick');
        const SHOW_VOLUME = HAS_VOLUME && showVolumeCheckbox ? showVolumeCheckbox.checked : false;

        const logVolumeCheckbox = document.getElementById('log_volume_checkbox_example3_candlestick');
        const LOG_VOLUME = SHOW_VOLUME && logVolumeCheckbox ? logVolumeCheckbox.checked : false;

        const chartTypeSelect = document.getElementById('chart_type_select_example3_candlestick');
        const CHART_TYPE = chartTypeSelect ? chartTypeSelect.value : 'candlestick';

        const displayModeSelect = document.getElementById('display_mode_select_example3_candlestick');
        const DISPLAY_MODE = displayModeSelect ? displayModeSelect.value : 'Faceted';

        // Get current filter values
        const filters = {};
        const rangeFilters = {};

        // Read categorical filters (dropdowns)
        CATEGORICAL_FILTERS.forEach(col => {
            const select = document.getElementById(col + '_select_example3_candlestick');
            if (select) {
                filters[col] = Array.from(select.selectedOptions).map(opt => opt.value);
            }
        });

        // Read continuous filters (range sliders)
        CONTINUOUS_FILTERS.forEach(col => {
            const slider = $('#' + col + '_range_example3_candlestick' + '_slider');
            if (slider.length > 0) {
                rangeFilters[col] = {
                    min: slider.slider("values", 0),
                    max: slider.slider("values", 1)
                };
            }
        });

        // Apply filters with observation counting
        const filteredData = applyFiltersWithCounting(
            allData,
            'example3_candlestick',
            CATEGORICAL_FILTERS,
            CONTINUOUS_FILTERS,
            filters,
            rangeFilters
        );

        // Group data by symbol
        const symbolData = {};
        filteredData.forEach(row => {
            const symbol = String(row[SYMBOL_COL]);
            if (!symbolData[symbol]) {
                symbolData[symbol] = [];
            }
            symbolData[symbol].push(row);
        });

        // Sort each symbol's data by time
        for (let symbol in symbolData) {
            symbolData[symbol].sort((a, b) => {
                const aTime = a[TIME_FROM_COL];
                const bTime = b[TIME_FROM_COL];
                if (aTime instanceof Date && bTime instanceof Date) {
                    return aTime - bTime;
                }
                return aTime < bTime ? -1 : (aTime > bTime ? 1 : 0);
            });
        }

        // Calculate first bar open prices for renormalization (only once)
        if (Object.keys(firstBarOpenPrices).length === 0 || !RENORMALIZE) {
            firstBarOpenPrices = {};
            for (let symbol in symbolData) {
                if (symbolData[symbol].length > 0) {
                    firstBarOpenPrices[symbol] = symbolData[symbol][0][OPEN_COL];
                }
            }
        }

        // Route to appropriate rendering function
        if (DISPLAY_MODE === 'Overlay') {
            renderOverlay(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        } else {
            renderFaceted(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        }
    };

    // Render overlay mode (all symbols on same chart)
    function renderOverlay(symbolData, renormalize, showVolume, logVolume, chartType) {
        const traces = [];
        const symbols = Object.keys(symbolData).sort();
        const colorPalette = ['#636efa', '#EF553B', '#00cc96', '#ab63fa', '#FFA15A',
                             '#19d3f3', '#FF6692', '#B6E880', '#FF97FF', '#FECB52'];

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];
            const color = colorPalette[idx % colorPalette.length];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: 'x',
                yaxis: 'y',
                increasing: {line: {color: color}},
                decreasing: {line: {color: color}}
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: 'x',
                    yaxis: 'y2',
                    marker: {color: color},
                    showlegend: false
                };
                traces.push(volumeTrace);
            }
        });

        // Layout configuration
        const layout = {
            xaxis: {
                title: TIME_FROM_COL,
                anchor: 'y'
            },
            hovermode: 'closest',
            showlegend: true
        };

        if (showVolume && HAS_VOLUME) {
            // Two subplots: Candlestick on top, volume on bottom
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price',
                domain: [0.3, 1]
            };
            layout.yaxis2 = {
                title: logVolume ? 'log(Volume)' : 'Volume',
                domain: [0, 0.25],
                anchor: 'x'
            };
            layout.barmode = 'group';  // Dodge volume bars
        } else {
            // Single plot: Candlestick only
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price'
            };
        }

        Plotly.newPlot('example3_candlestick', traces, layout, {responsive: true});
    }

    // Render faceted mode (one subplot per symbol)
    function renderFaceted(symbolData, renormalize, showVolume, logVolume, chartType) {
        const symbols = Object.keys(symbolData).sort();
        const nSymbols = symbols.length;

        // Calculate grid dimensions (prefer wider grids)
        const nCols = Math.ceil(Math.sqrt(nSymbols * 1.5));
        const nRows = Math.ceil(nSymbols / nCols);

        const traces = [];
        const layout = {
            hovermode: 'closest',
            showlegend: false,
            grid: {rows: nRows, columns: nCols, pattern: 'independent'}
        };

        if (showVolume && HAS_VOLUME) {
            layout.barmode = 'group';
        }

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            const row = Math.floor(idx / nCols) + 1;
            const col = (idx % nCols) + 1;
            const xaxis = idx === 0 ? 'x' : 'x' + (idx + 1);
            const yaxis = idx === 0 ? 'y' : 'y' + (idx + 1);

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: xaxis,
                yaxis: yaxis
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const yaxis_vol = idx === 0 ? 'y' + (nSymbols + 1) : 'y' + (nSymbols + idx + 1);

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: xaxis,
                    yaxis: yaxis_vol,
                    showlegend: false
                };
                traces.push(volumeTrace);

                // Configure volume yaxis
                layout[yaxis_vol] = {
                    title: row === nRows ? (logVolume ? 'log(Vol)' : 'Vol') : '',
                    anchor: xaxis
                };
            }

            // Add axis configuration
            layout[xaxis] = {
                title: row === nRows ? TIME_FROM_COL : '',
                anchor: yaxis
            };
            layout[yaxis] = {
                title: col === 1 ? (renormalize ? 'Norm Price' : 'Price') : '',
                anchor: xaxis
            };

            // Add annotation for symbol label
            if (!layout.annotations) layout.annotations = [];
            layout.annotations.push({
                text: symbol,
                showarrow: false,
                xref: xaxis === 'x' ? 'x domain' : xaxis + ' domain',
                yref: yaxis === 'y' ? 'y domain' : yaxis + ' domain',
                x: 0.5,
                y: 1.05,
                xanchor: 'center',
                yanchor: 'bottom',
                font: {size: 10}
            });
        });

        Plotly.newPlot('example3_candlestick', traces, layout, {responsive: true});
    }

    // Load and parse CSV data using centralized parser
    loadDataset('company_data').then(function(data) {
        allData = data;
        window.updateChart_example3_candlestick();

        // Setup aspect ratio control after initial render
        setupAspectRatioControl('example3_candlestick');
    }).catch(function(error) {
        console.error('Error loading data for chart example3_candlestick:', error);
    });
})();


});
</script>

<!-- DATASETS -->

<script type="text/plain" id="company_data" data-format="csv_embedded" data-src="">
quarter,quarter_end,company,open_price,high_price,low_price,close_price
1,1,CompanyA,80.37601146056777,81.56087413677913,78.16269174180013,79.70495980329572
2,2,CompanyA,76.83352923394098,80.06817896094935,73.39461812833451,76.76772279845666
3,3,CompanyA,81.27771742102071,84.95626470869378,78.02712258547572,80.541562594229
4,4,CompanyA,82.3672692972589,86.07614448873066,81.39563667131735,81.39563667131735
5,5,CompanyA,84.25146733429074,85.53562538509702,82.69389938299356,84.60366924808497
6,6,CompanyA,84.403151642101,84.77613130725396,81.76058176343213,84.24882860380333
7,7,CompanyA,85.61978267418617,89.51983000234227,83.529570596707,85.15654740156569
8,8,CompanyA,84.84490753008956,86.87488536755053,84.0654423033392,84.0654423033392
9,9,CompanyA,80.69460839323276,83.515225827723,78.8396024477311,80.4877125894237
10,10,CompanyA,83.71151313468619,86.57229728768294,80.23666605228004,83.30601003160518
11,11,CompanyA,83.5037101536,84.98825729783582,81.06448071796399,82.50981349758105
12,12,CompanyA,83.66176182382985,86.93816400246136,82.60609249580172,83.6342048906692
1,1,CompanyB,52.41363493230874,55.78266890684156,51.0202784507375,54.053050554739016
2,2,CompanyB,58.67523024442315,60.24064510972025,58.48541169456271,58.99500080184767
3,3,CompanyB,59.77244564131954,60.75280675799684,59.00759909927537,59.00759909927537
4,4,CompanyB,60.454720623014,60.7356990637593,57.54290374527676,59.640766499522435
5,5,CompanyB,59.155085774083744,59.388986820765204,56.59696277415572,57.82046400713659
6,6,CompanyB,57.014046163495074,60.1482568507105,55.10046451883734,55.10046451883734
7,7,CompanyB,55.92353454266582,57.50602175877166,53.17763185520668,55.598238594311916
8,8,CompanyB,56.38426530101856,58.68808473077555,54.67481105519045,54.67481105519045
9,9,CompanyB,53.55630006160451,54.78296079543418,50.21525476764679,52.12411699095533
10,10,CompanyB,57.19054702392288,61.040071874113075,53.58063217722546,57.1146656306695
11,11,CompanyB,53.21854597734342,54.749156429816736,51.97657716039345,54.32817013735961
12,12,CompanyB,53.167242055844895,55.159081900679986,49.97775880330451,53.95277358698318

</script><script type="text/plain" id="stock_data_1" data-format="csv_embedded" data-src="">
time_from,time_to,symbol,open,high,low,close,volume
2024-01-01,2024-01-01,AAPL,150.12362759963506,153.7691962794704,147.80386700193878,148.96942907965678,1017336
2024-01-02,2024-01-02,AAPL,151.05801739133216,151.87509367291958,147.5980168193932,147.5980168193932,2661542
2024-01-03,2024-01-03,AAPL,150.2107030155144,150.2107030155144,146.45969213182235,148.9536253110485,2728409
2024-01-04,2024-01-04,AAPL,150.40123683486792,150.40123683486792,146.850249685133,146.850249685133,4348845
2024-01-05,2024-01-05,AAPL,151.6618137903485,151.6618137903485,145.40073048684184,145.9346162205318,1398478
2024-01-06,2024-01-06,AAPL,150.85066517415441,150.85066517415441,144.2261140311347,146.2682547958813,1938953
2024-01-07,2024-01-07,AAPL,150.81275534581633,150.81275534581633,144.85148536215056,145.23224845034085,3401131
2024-01-08,2024-01-08,AAPL,150.52216263669166,150.52216263669166,145.37601642665032,145.37601642665032,4730375
2024-01-09,2024-01-09,AAPL,149.89482597333512,149.89482597333512,144.14221474624412,144.14221474624412,1897416
2024-01-10,2024-01-10,AAPL,147.97849891764804,150.09663716041175,144.2516628921041,147.13070476041867,3362140
2024-01-11,2024-01-11,AAPL,148.58612214798688,149.0589387891829,141.30355977455483,146.47834923016822,2690309
2024-01-12,2024-01-12,AAPL,149.56411988975825,149.56411988975825,140.88242373436955,148.65182234281352,1133330
2024-01-13,2024-01-13,AAPL,151.55588272615353,151.55588272615353,140.10116968397082,149.45043780461242,2233395
2024-01-14,2024-01-14,AAPL,152.5242309660824,152.5242309660824,137.6447526224116,146.51804337839388,4238737
2024-01-15,2024-01-15,AAPL,151.73232828548473,151.73232828548473,137.34384643629528,147.6003514990759,3194880
2024-01-16,2024-01-16,AAPL,151.8843899968145,151.8843899968145,139.48158846402384,146.14227614557797,4908534
2024-01-17,2024-01-17,AAPL,150.89442484497616,150.89442484497616,133.77831113159144,143.63183885654328,4834151
2024-01-18,2024-01-18,AAPL,150.29189315182842,150.29189315182842,135.73922322993317,143.49856762439873,4724729
2024-01-19,2024-01-19,AAPL,151.89186683747678,151.89186683747678,135.43870321978736,143.84778380173682,1593938
2024-01-20,2024-01-20,AAPL,151.7787027056398,151.7787027056398,132.57593714565564,139.61263296475312,3407741
2024-01-21,2024-01-21,AAPL,150.80739699235735,150.80739699235735,137.52353458009165,144.72746259047292,3551029
2024-01-22,2024-01-22,AAPL,151.28434088031196,151.28434088031196,138.81859520543838,144.00691380476428,2851237
2024-01-23,2024-01-23,AAPL,150.4261383001714,150.4261383001714,138.2400882147711,143.37016936656715,2026486
2024-01-24,2024-01-24,AAPL,149.30453616829263,149.30453616829263,138.41165013908704,145.01810042939832,3947900
2024-01-25,2024-01-25,AAPL,148.16479951894243,148.16479951894243,136.5290878973494,145.4559244364681,4839265
2024-01-26,2024-01-26,AAPL,146.88967617375806,150.38556383144447,135.38476802406615,140.86974194391686,3446948
2024-01-27,2024-01-27,AAPL,145.4100697708048,149.66595020170584,134.579804006352,142.33267965933797,3784132
2024-01-28,2024-01-28,AAPL,144.6580803249499,149.5554605422631,135.3274020803569,141.8481489105958,2725219
2024-01-29,2024-01-29,AAPL,145.12015593834406,148.05423547551186,135.1324202823462,141.3792328675058,2543790
2024-01-30,2024-01-30,AAPL,144.235381407621,147.3447363981664,136.1751194607403,141.19358695003638,3379051
2024-01-31,2024-01-31,AAPL,144.5868675697688,147.10476084029878,131.4491052639142,140.00816423132756,4023853
2024-02-01,2024-02-01,AAPL,144.99830317386895,151.02302792193214,131.22160218075322,140.4451210794444,2689477
2024-02-02,2024-02-02,AAPL,146.15705089116284,152.48361310132157,134.89392791818597,141.28173466889277,1154919
2024-02-03,2024-02-03,AAPL,146.8534148627807,150.35717632485185,134.39738141804983,141.62663472769518,2096491
2024-02-04,2024-02-04,AAPL,146.12209199911922,149.9437868188154,131.45312707346093,143.309530055468,2435981
2024-02-05,2024-02-05,AAPL,145.65058173673657,148.78542932840836,134.26019546064865,142.82661998884683,2484518
2024-02-06,2024-02-06,AAPL,145.5074865767246,145.5074865767246,134.56617316843284,143.33357612882756,3686071
2024-02-07,2024-02-07,AAPL,145.38135724518634,145.38135724518634,133.2422676449657,143.7492883027938,4197753
2024-02-08,2024-02-08,AAPL,144.96429191202944,145.27406926899062,131.39233349610672,145.27406926899062,2556868
2024-02-09,2024-02-09,AAPL,142.6485807820905,146.20701962613197,130.13267876696386,146.20701962613197,2213813
2024-02-10,2024-02-10,AAPL,143.14892617919327,146.25413890224158,130.95526724471702,146.25413890224158,2124274
2024-02-11,2024-02-11,AAPL,144.0310355311302,147.0125104641816,129.84119431826554,147.0125104641816,3293145
2024-02-12,2024-02-12,AAPL,142.531250449348,145.97324784521717,131.69413655514055,145.97324784521717,2187127
2024-02-13,2024-02-13,AAPL,142.6085631407399,148.34381273748465,131.7644136142188,148.34381273748465,3960127
2024-02-14,2024-02-14,AAPL,143.6445449709994,144.92639788106092,130.99549218378647,144.92639788106092,2060531
2024-02-15,2024-02-15,AAPL,144.6120617989972,144.6120617989972,132.12066624650967,144.22964387801997,3964983
2024-02-16,2024-02-16,AAPL,145.68229737554162,145.68229737554162,131.83304686643513,144.40192440526656,3614286
2024-02-17,2024-02-17,AAPL,146.06462148702826,147.48229200441122,132.172662084764,147.48229200441122,1194112
2024-02-18,2024-02-18,AAPL,147.7238187076735,147.7238187076735,134.3157603444495,146.9112304522925,2597312
2024-02-19,2024-02-19,AAPL,146.07344414325334,149.8047536695033,132.60670563277915,149.8047536695033,1468437
2024-02-20,2024-02-20,AAPL,146.67104776373344,151.2908629941183,131.78258501600197,151.2908629941183,4262588
2024-02-21,2024-02-21,AAPL,146.11504656062377,152.08132462799526,128.86004067034557,152.08132462799526,4901890
2024-02-22,2024-02-22,AAPL,144.27330168931215,154.28384346031123,130.74968850363618,154.28384346031123,1259492
2024-02-23,2024-02-23,AAPL,142.7556247568487,153.08286181552864,129.23108450688812,153.08286181552864,4471020
2024-02-24,2024-02-24,AAPL,142.66781651790234,156.22334995366,131.01314037737743,156.22334995366,3477908
2024-02-25,2024-02-25,AAPL,142.06793933699038,155.21065807446453,130.18479213792716,155.21065807446453,3845309
2024-02-26,2024-02-26,AAPL,141.2276373305369,155.8748630352972,127.701947259809,155.8748630352972,2252888
2024-02-27,2024-02-27,AAPL,142.1272202041368,156.85539259782644,129.57006530698712,156.85539259782644,2148791
2024-02-28,2024-02-28,AAPL,142.6305514690004,156.66361609552828,130.42017200167257,156.66361609552828,2354196
2024-02-29,2024-02-29,AAPL,141.77040109616794,156.37864435248161,130.3278648789901,156.37864435248161,3877558
2024-03-01,2024-03-01,AAPL,142.2836589180428,157.40347423231745,132.0301702142549,157.40347423231745,3179353
2024-03-02,2024-03-02,AAPL,142.96496786762629,155.2443018315649,132.58424492778093,155.2443018315649,2285946
2024-03-03,2024-03-03,AAPL,144.64357515935012,158.34620600296304,131.48150420450898,158.34620600296304,3428478
2024-03-04,2024-03-04,AAPL,144.62452719400744,155.76009947466366,133.0163568639642,155.76009947466366,1727597
2024-03-05,2024-03-05,AAPL,143.21221408635986,157.2320533346171,134.87890834747776,157.2320533346171,4361047
2024-03-06,2024-03-06,AAPL,143.62793281274858,157.1832360102153,131.85268050671672,157.1832360102153,1853862
2024-03-07,2024-03-07,AAPL,144.46132933602573,159.16446829101332,133.8408050128782,159.16446829101332,1340986
2024-03-08,2024-03-08,AAPL,144.75566779046176,159.81830456832068,133.5183186160446,159.81830456832068,2760490
2024-03-09,2024-03-09,AAPL,144.179693912023,160.29281125178596,129.95900945582343,160.29281125178596,1509432
2024-03-10,2024-03-10,AAPL,142.7903551013437,159.42412537773012,131.18127794704222,159.42412537773012,3937107
2024-03-11,2024-03-11,AAPL,143.683832593144,159.94905310915684,130.80926781919914,159.94905310915684,3770968
2024-03-12,2024-03-12,AAPL,142.1056190587976,158.3594233185062,133.29721525240262,158.3594233185062,3367911
2024-03-13,2024-03-13,AAPL,141.71329357475358,162.28730086793266,133.1474857146601,162.28730086793266,4015873
2024-03-14,2024-03-14,AAPL,141.28547575099282,160.96073186409257,134.97042968109974,160.96073186409257,3687637
2024-03-15,2024-03-15,AAPL,139.89814951622012,161.64607228466136,134.82048419079806,161.64607228466136,4095737
2024-03-16,2024-03-16,AAPL,140.35769804149587,164.04576963037317,134.50434161341278,164.04576963037317,1583709
2024-03-17,2024-03-17,AAPL,141.0499727085207,163.1501662020707,130.84701753357805,163.1501662020707,4611800
2024-03-18,2024-03-18,AAPL,139.98529449459716,161.15130705861517,134.03651506183064,161.15130705861517,2808948
2024-03-19,2024-03-19,AAPL,139.32610915132096,162.4787640963906,129.73898634437393,162.4787640963906,3134177
2024-03-20,2024-03-20,AAPL,139.9535673983025,165.20933748447356,130.07628759199076,165.20933748447356,3117000
2024-03-21,2024-03-21,AAPL,139.72337419401384,164.49251200631767,132.4615585437766,164.49251200631767,2123292
2024-03-22,2024-03-22,AAPL,140.65559998995462,162.7720440336558,131.6137642732106,162.7720440336558,3147084
2024-03-23,2024-03-23,AAPL,140.4983696965966,161.2127152054926,131.09487220149302,161.2127152054926,1335000
2024-03-24,2024-03-24,AAPL,139.7591685111968,160.48608413099373,131.2868647965014,160.48608413099373,1363570
2024-03-25,2024-03-25,AAPL,139.87009344572917,162.4761822811133,127.07075369057057,162.4761822811133,2923654
2024-03-26,2024-03-26,AAPL,140.89278491186556,163.17064372928854,128.80512870691476,163.17064372928854,2521506
2024-03-27,2024-03-27,AAPL,140.61437772456998,161.60161883105968,126.23139295262827,161.60161883105968,4518295
2024-03-28,2024-03-28,AAPL,140.5367935073379,159.36905936209158,128.59559830059652,159.36905936209158,4062078
2024-03-29,2024-03-29,AAPL,141.69273054406142,160.81178367340388,131.52547298874867,160.81178367340388,1097204
2024-03-30,2024-03-30,AAPL,141.0852592602642,159.76248952229264,132.30773687616121,159.76248952229264,2339941
2024-03-31,2024-03-31,AAPL,141.4823216033836,162.35350830367676,130.1820155080705,162.35350830367676,1524616

</script><script type="text/plain" id="stock_data_2" data-format="csv_embedded" data-src="">
time_from,time_to,symbol,open,high,low,close,volume
2024-01-01,2024-01-01,AAPL,152.0073503003221,152.23809684394107,151.21270421075204,151.36867512119053,3225309
2024-01-02,2024-01-02,AAPL,155.40029636262966,158.78750083624254,154.01568736592648,154.58848591826248,1595749
2024-01-03,2024-01-03,AAPL,157.08727095702523,158.007830101317,155.28804244503146,158.007830101317,3161285
2024-01-04,2024-01-04,AAPL,154.96268562616297,158.10960937645933,154.06870537264035,155.26927238285225,2933044
2024-01-05,2024-01-05,AAPL,155.79905921525867,157.519724908387,155.162470208269,156.54184805314344,2930271
2024-01-06,2024-01-06,AAPL,155.11720023516912,159.1781922031065,151.80005222135512,154.631611074146,4233243
2024-01-07,2024-01-07,AAPL,154.9116954932317,159.86442253482318,151.89509486209838,154.26900221112825,4921365
2024-01-08,2024-01-08,AAPL,154.3575333362702,157.2805180386408,150.69272098731957,153.33633811487252,1397882
2024-01-09,2024-01-09,AAPL,155.39965185506003,157.6033184298712,154.5289227766197,154.56168112828135,2038509
2024-01-10,2024-01-10,AAPL,157.93051221605526,161.2267401116263,155.89010822227735,158.21701801547025,3853153
2024-01-11,2024-01-11,AAPL,157.22164540269358,161.13178954149106,152.82375563023518,155.89197180890827,1066140
2024-01-12,2024-01-12,AAPL,159.0563816041884,159.864430061676,157.21568440036611,158.1503545461466,4224239
2024-01-13,2024-01-13,AAPL,161.91330888875524,163.90559969764948,158.73675159986243,162.0773741678768,4394297
2024-01-14,2024-01-14,AAPL,164.63950634692446,166.0903638917364,162.3946959784811,162.77288820547264,2352154
2024-01-15,2024-01-15,AAPL,166.77459365369955,167.4324599955788,162.28665465040777,167.4324599955788,4286351
2024-01-16,2024-01-16,AAPL,169.25168380476924,173.43371663711966,165.34642537858215,170.21291965314498,4767722
2024-01-17,2024-01-17,AAPL,171.11169251265343,173.82061219809336,166.66173617307416,171.3116861699122,2596879
2024-01-18,2024-01-18,AAPL,170.3581070250784,173.1653544269709,166.95209893106133,170.73637510627137,4593391
2024-01-19,2024-01-19,AAPL,168.91031794713666,172.77699893589622,166.3674743154362,168.71311981766272,3251364
2024-01-20,2024-01-20,AAPL,169.49661693029628,171.87077763896067,167.12811443807212,168.10555581287971,3302733
2024-01-21,2024-01-21,AAPL,168.2217788886878,168.936455064235,164.670821135857,168.61041207626295,3521404
2024-01-22,2024-01-22,AAPL,167.4732740860083,169.70718527754408,164.2915166676882,167.5767835765154,1361748
2024-01-23,2024-01-23,AAPL,165.67561735179515,168.46891818053035,161.65032408166263,164.5348812185196,2388358
2024-01-24,2024-01-24,AAPL,163.92642380778102,166.33404633019208,162.44644379811578,162.44644379811578,4154435
2024-01-25,2024-01-25,AAPL,163.09534558410184,165.82382237783145,161.00933174200694,163.91755769488026,1037668
2024-01-26,2024-01-26,AAPL,163.5387586729192,164.32244307560802,162.69019394368368,164.2255661189821,2712554
2024-01-27,2024-01-27,AAPL,163.6435860667598,168.45100737391448,161.38868275345806,166.07954431499127,4436282
2024-01-28,2024-01-28,AAPL,164.51091235804077,165.91268665474843,164.48165341699038,165.91268665474843,4663257
2024-01-29,2024-01-29,AAPL,166.36276265597684,167.88733462694765,163.7573412269956,165.98013645895765,2610768
2024-01-30,2024-01-30,AAPL,169.1049481893275,171.41054828508095,167.55370648634698,167.61106934616475,2977356
2024-01-31,2024-01-31,AAPL,170.70551446567697,172.8700292565122,168.92423101231702,170.6121918020737,2016376
2024-02-01,2024-02-01,AAPL,168.10371116359715,170.65130648734234,164.4090774836813,167.8440175249674,2814432
2024-02-02,2024-02-02,AAPL,166.40032168069132,166.84103549152704,166.139911097414,166.139911097414,4102490
2024-02-03,2024-02-03,AAPL,171.02039764402187,172.70365450287656,170.1183590914036,171.25435496645684,4007092
2024-02-04,2024-02-04,AAPL,169.89046214060852,171.28575597215993,169.02795994546867,169.52997388525426,1082671
2024-02-05,2024-02-05,AAPL,166.757289531877,169.7835609175129,162.10199416693652,166.16448136568897,4756719
2024-02-06,2024-02-06,AAPL,167.53036641537327,168.77262880543944,163.26107595838747,168.3336306814409,4998301
2024-02-07,2024-02-07,AAPL,168.18727901039634,171.52743820325787,164.1449199585909,169.3759761806886,2160118
2024-02-08,2024-02-08,AAPL,166.6505880784768,167.79659981780367,163.80876985450604,166.58449727601968,4896937
2024-02-09,2024-02-09,AAPL,166.31361322505128,168.55066480521,164.42429344084215,165.5389774868852,3746463
2024-02-10,2024-02-10,AAPL,167.0131411135987,168.83049800736822,165.36147381311963,165.36147381311963,1404633
2024-02-11,2024-02-11,AAPL,166.2118522574992,170.94692446571048,162.8258240293698,165.06092787093482,4796225
2024-02-12,2024-02-12,AAPL,163.3311572064683,163.774732743579,158.40778921433002,162.8664095035153,1550051
2024-02-13,2024-02-13,AAPL,162.91269928375567,164.03852280628735,160.49409289614235,164.03852280628735,4364262
2024-02-14,2024-02-14,AAPL,165.01339784672228,166.89989831970962,164.13179162805847,165.25787935102244,2164316
2024-02-15,2024-02-15,AAPL,167.24037011140965,167.7764327111069,164.3810438592734,167.15715004663403,2278005
2024-02-16,2024-02-16,AAPL,165.99501947747746,168.34895834973202,161.6198399474075,166.10073674090927,3880767
2024-02-17,2024-02-17,AAPL,162.93576507437513,167.0341184794826,162.68993212194405,163.03056346830348,2799153
2024-02-18,2024-02-18,AAPL,164.24390750488664,165.78925539928986,160.90906689551616,164.2159362148611,1550238
2024-02-19,2024-02-19,AAPL,165.24565878499126,169.95807472933336,162.90209743018684,164.86391289389329,4998978
2024-02-20,2024-02-20,AAPL,165.44169896786752,170.42557338371475,163.6852724235389,166.46123016966484,2033010
2024-02-21,2024-02-21,AAPL,169.041923799161,173.6574195643297,169.02655307101335,169.59153205979996,1271620
2024-02-22,2024-02-22,AAPL,171.3994665525758,174.18201391009032,168.7796751604439,172.20088883841788,3477799
2024-02-23,2024-02-23,AAPL,171.94922808839314,174.40395032219857,170.82849518007393,170.82849518007393,1903601
2024-02-24,2024-02-24,AAPL,172.7933646981272,176.8658598426794,167.9906716429446,173.12499516599166,2704303
2024-02-25,2024-02-25,AAPL,171.15690012226398,173.68551268283855,170.50867892871,171.896170828059,1190756
2024-02-26,2024-02-26,AAPL,166.3022704887764,168.31881860470125,162.96643223213775,166.55010858613693,3706186
2024-02-27,2024-02-27,AAPL,164.27257458492613,165.56976392656642,163.22344623725814,165.28419416101298,4070684
2024-02-28,2024-02-28,AAPL,164.83725925177265,169.24045441934447,164.40948193805744,167.19879979516176,3341481
2024-02-29,2024-02-29,AAPL,165.48866548708926,168.05634679507983,163.85260834480695,167.26165947395637,1392988
2024-01-01,2024-01-01,GOOGL,2796.529340977578,2799.712426663468,2795.0146207307776,2795.0146207307776,2930307
2024-01-02,2024-01-02,GOOGL,2794.00441224373,2796.388470579618,2792.8584592411034,2792.8584592411034,3822023
2024-01-03,2024-01-03,GOOGL,2793.9811071493723,2796.538049845236,2790.1580590483964,2794.369517728228,4682899
2024-01-04,2024-01-04,GOOGL,2795.31334006008,2797.855022254226,2791.079570246319,2794.5542995683422,2928437
2024-01-05,2024-01-05,GOOGL,2795.338368344066,2798.972612630649,2790.8808877703605,2795.8140167152224,3342641
2024-01-06,2024-01-06,GOOGL,2795.8844745035167,2799.746430582621,2795.519594871576,2797.4338078588585,1624179
2024-01-07,2024-01-07,GOOGL,2793.98421039085,2794.7139461598663,2791.1409759869375,2793.017728100232,3116584
2024-01-08,2024-01-08,GOOGL,2791.8336838995037,2793.979313061505,2787.999895284764,2792.2951126145517,4668268
2024-01-09,2024-01-09,GOOGL,2791.1159919019433,2794.9245192744343,2790.3554164811167,2790.704838738177,4105086
2024-01-10,2024-01-10,GOOGL,2788.6501958616764,2792.023500701082,2784.301034396175,2788.090238718201,4951411
2024-01-11,2024-01-11,GOOGL,2789.642230288281,2791.7283042868485,2784.6643735786215,2791.6238677186752,3907626
2024-01-12,2024-01-12,GOOGL,2791.393255602887,2794.4160479215298,2790.537884506051,2791.274691525732,3859849
2024-01-13,2024-01-13,GOOGL,2794.5220732411667,2797.3720795127233,2794.4317440929044,2794.7367255701415,3443408
2024-01-14,2024-01-14,GOOGL,2794.2942877885926,2795.2965387001964,2791.2435455093746,2794.890788374559,1819158
2024-01-15,2024-01-15,GOOGL,2794.69678323192,2796.754582533421,2792.7462669734364,2794.5171546200104,2966824
2024-01-16,2024-01-16,GOOGL,2792.5424065815546,2795.087367055195,2788.439884016402,2793.4968492738913,2133275
2024-01-17,2024-01-17,GOOGL,2793.0777010944585,2797.717526799309,2791.8421104333383,2792.797074818002,4029719
2024-01-18,2024-01-18,GOOGL,2794.434760563703,2795.7570690704024,2794.1881691888193,2795.7570690704024,2777591
2024-01-19,2024-01-19,GOOGL,2794.70409254729,2798.8842372054837,2790.776657634578,2794.854628454025,3563240
2024-01-20,2024-01-20,GOOGL,2795.6039162784277,2795.7354242112174,2792.7455552585075,2794.656620460217,2320353
2024-01-21,2024-01-21,GOOGL,2793.5454980428967,2793.711838761827,2793.040774349465,2793.040774349465,4611840
2024-01-22,2024-01-22,GOOGL,2791.69713210513,2793.7497256284337,2789.220493610716,2790.1854156892373,3763184
2024-01-23,2024-01-23,GOOGL,2792.4645842752693,2797.169516053134,2789.859505533774,2792.6544407622323,1675634
2024-01-24,2024-01-24,GOOGL,2793.8272597644586,2796.1808831117296,2790.768376030075,2794.4435751069195,1499555
2024-01-25,2024-01-25,GOOGL,2796.5172793614256,2801.2365008280112,2791.709369077426,2796.6877055851205,2585106
2024-01-26,2024-01-26,GOOGL,2798.40647979733,2798.6719206271237,2797.4241256049954,2798.6719206271237,1399613
2024-01-27,2024-01-27,GOOGL,2798.5644433640728,2801.1057622270173,2794.753653890972,2798.33271634938,1342001
2024-01-28,2024-01-28,GOOGL,2800.1373898711,2802.5764956768153,2796.0362216078966,2801.3381197770236,3562867
2024-01-29,2024-01-29,GOOGL,2798.7803988416304,2803.41852080483,2795.001739734708,2798.362121212367,4702360
2024-01-30,2024-01-30,GOOGL,2795.6152401051713,2796.8967002187946,2794.909000632969,2796.8967002187946,1108391
2024-01-31,2024-01-31,GOOGL,2795.024469918978,2798.55216221458,2793.2417081134563,2796.1398367152974,3326202
2024-02-01,2024-02-01,GOOGL,2796.4875048801655,2800.9192891140215,2791.640972286371,2798.225146195712,3366360
2024-02-02,2024-02-02,GOOGL,2796.7542784788834,2797.099147113361,2793.767658496207,2796.216880485771,4702987
2024-02-03,2024-02-03,GOOGL,2798.1996765948106,2799.5742283631275,2796.7899382364785,2796.7899382364785,3113860
2024-02-04,2024-02-04,GOOGL,2801.4620736918796,2804.980398663016,2798.824156995047,2801.096542764107,4001642
2024-02-05,2024-02-05,GOOGL,2803.284729385415,2806.925270970086,2800.546712604819,2802.913629463298,3620419
2024-02-06,2024-02-06,GOOGL,2802.4743997819605,2806.5834224738664,2802.2505271038995,2803.285090125868,2633137
2024-02-07,2024-02-07,GOOGL,2802.087322015625,2804.1426126846463,2797.6978194568774,2803.409106741257,1780170
2024-02-08,2024-02-08,GOOGL,2802.038236288682,2805.6947956606414,2800.741739675549,2802.7389955015806,4283684
2024-02-09,2024-02-09,GOOGL,2799.2072450674154,2800.1505095290454,2796.251458179737,2798.195077910978,4994932
2024-02-10,2024-02-10,GOOGL,2800.522276559689,2805.059571036477,2795.7635772314566,2801.6549263237494,3578020
2024-02-11,2024-02-11,GOOGL,2801.8764676177857,2805.908475473141,2801.6596287726893,2803.8904213972232,1448040
2024-02-12,2024-02-12,GOOGL,2800.678259646761,2801.344942323963,2797.6863752515983,2800.8983457336503,4232883
2024-02-13,2024-02-13,GOOGL,2798.9386290790494,2800.4314424486965,2796.221870470566,2800.4314424486965,3979790
2024-02-14,2024-02-14,GOOGL,2801.480293637447,2803.983412693436,2800.3560502254604,2800.3560502254604,4791186
2024-02-15,2024-02-15,GOOGL,2801.5975117426924,2804.708622305944,2800.861003117876,2803.401908955418,2396708
2024-02-16,2024-02-16,GOOGL,2805.478674226465,2806.1259579542966,2801.0590328454637,2805.707614522014,2792844
2024-02-17,2024-02-17,GOOGL,2805.0234813082775,2809.957209372383,2802.490636835482,2804.4155196090082,1009612
2024-02-18,2024-02-18,GOOGL,2806.1863971345524,2809.0337305510207,2803.5993274783423,2803.5993274783423,2349849
2024-02-19,2024-02-19,GOOGL,2809.3755802893893,2811.869989625347,2804.575983661397,2809.942321797647,3662887
2024-02-20,2024-02-20,GOOGL,2809.825062195676,2810.3124412414973,2805.3697097074755,2810.3124412414973,4552452
2024-02-21,2024-02-21,GOOGL,2808.2810949853574,2809.386113662043,2806.550944480862,2809.386113662043,2271343
2024-02-22,2024-02-22,GOOGL,2809.838323846129,2810.5814378729333,2806.303603735705,2808.501342757628,3650345
2024-02-23,2024-02-23,GOOGL,2810.7368579347726,2812.295158437184,2807.1537192696073,2807.4024812019825,3409452
2024-02-24,2024-02-24,GOOGL,2813.9105363746908,2815.4596474700556,2811.4651058383943,2814.8748867724926,2901928
2024-02-25,2024-02-25,GOOGL,2815.3031532019536,2818.98478344405,2813.3435941023204,2814.1719316835456,2402746
2024-02-26,2024-02-26,GOOGL,2813.86969611062,2818.3696401877005,2812.4305621113917,2815.157607632737,3809766
2024-02-27,2024-02-27,GOOGL,2813.0783180806957,2815.003870982478,2808.5258249840062,2815.003870982478,1124590
2024-02-28,2024-02-28,GOOGL,2810.6289077398424,2813.0939980686153,2809.614907402108,2809.614907402108,3777194
2024-02-29,2024-02-29,GOOGL,2813.266528639322,2813.6012763722383,2808.3287709515494,2811.8489078912944,1556467
2024-01-01,2024-01-01,MSFT,382.11321676186446,386.91877500527835,380.30715197843614,383.31271447319807,3516201
2024-01-02,2024-01-02,MSFT,383.16654132819446,388.08461940657656,380.74336412512014,384.2903254221812,1501030
2024-01-03,2024-01-03,MSFT,382.64652319454507,387.0709532932996,380.7351062091937,380.7351062091937,4574672
2024-01-04,2024-01-04,MSFT,382.95283038268195,387.618280998658,381.92665600521195,384.88842486569877,1427703
2024-01-05,2024-01-05,MSFT,382.6954444990951,384.3693093770908,378.854887410344,381.53396714992175,4833907
2024-01-06,2024-01-06,MSFT,382.9566917390164,387.6671478657603,381.815689569705,382.37989870121686,2983347
2024-01-07,2024-01-07,MSFT,381.5964441046439,384.62328623667224,377.62176881353713,381.3494485860901,3353418
2024-01-08,2024-01-08,MSFT,379.17044109758206,383.6006698968838,374.3030790726905,379.5995443412188,2204734
2024-01-09,2024-01-09,MSFT,383.15145934973236,384.64984186206027,381.61205345979835,384.64984186206027,2082462
2024-01-10,2024-01-10,MSFT,385.53602420763195,389.7591696523434,383.6317519666629,383.84589541726837,2193086
2024-01-11,2024-01-11,MSFT,387.67845582149585,390.5552070011793,384.6874905899675,388.9888382393245,2243338
2024-01-12,2024-01-12,MSFT,385.6516544315715,389.01423050599897,383.8295822869862,385.0423622275551,3189498
2024-01-13,2024-01-13,MSFT,383.86071105197493,387.12499013983177,383.6175555893184,383.6175555893184,3333601
2024-01-14,2024-01-14,MSFT,381.72868537355095,382.8036977089763,377.13237676950644,380.82499468286437,3016408
2024-01-15,2024-01-15,MSFT,383.14132363183825,386.0136256201898,380.4882089356107,383.40105802970845,3742304
2024-01-16,2024-01-16,MSFT,383.0788391392075,383.69612278085606,378.5555803861956,382.3678017734634,2101465
2024-01-17,2024-01-17,MSFT,383.4555265829032,385.6205325090715,379.66246639706225,382.51458543047335,2207099
2024-01-18,2024-01-18,MSFT,384.08162301361165,388.7933709115622,383.20776969199034,383.98031671029025,1476818
2024-01-19,2024-01-19,MSFT,380.07547210635056,381.49637181075894,378.83853876454435,380.9050223009314,3032893
2024-01-20,2024-01-20,MSFT,381.1240160337889,383.8224863369336,377.58677976545937,379.20477192193437,4001497
2024-01-21,2024-01-21,MSFT,380.8292390856082,381.3118832084765,378.40812784026105,379.14347253732313,3321175
2024-01-22,2024-01-22,MSFT,380.78892837423933,381.29645083686705,377.4125579228129,380.4991996892012,3188152
2024-01-23,2024-01-23,MSFT,382.27593459881797,387.0554262251561,381.14792036736924,382.4543554050066,1303350
2024-01-24,2024-01-24,MSFT,382.5681694919555,384.40447643844493,381.1926704255374,384.40447643844493,4199699
2024-01-25,2024-01-25,MSFT,381.1979489966397,383.7819459041509,377.16664417782016,379.9977285757934,4727690
2024-01-26,2024-01-26,MSFT,381.08362098479176,383.9849071841398,379.4550681164074,381.73002245909055,3509781
2024-01-27,2024-01-27,MSFT,380.21889969191864,383.7010876474692,377.63317599025413,380.44267691101965,4147288
2024-01-28,2024-01-28,MSFT,381.7590197000223,384.224632428212,379.44261577387186,381.79593078239935,2200814
2024-01-29,2024-01-29,MSFT,380.5141711995737,381.05879059056986,376.7169407511566,380.62615752999216,2776776
2024-01-30,2024-01-30,MSFT,379.5174146373488,380.17187952208286,376.3679533120938,378.64464665671073,4247242
2024-01-31,2024-01-31,MSFT,380.6782988075013,382.4654592180796,378.04577469819435,382.4654592180796,3541887
2024-02-01,2024-02-01,MSFT,382.34695585918934,385.0819153172742,377.87958721324094,381.79258332031435,3870835
2024-02-02,2024-02-02,MSFT,379.44650750810035,381.40210834006973,375.83046609359457,380.95392121574093,4059534
2024-02-03,2024-02-03,MSFT,380.0711708213696,384.679371961274,379.7460856609248,380.61480159379124,2593216
2024-02-04,2024-02-04,MSFT,382.18733441697543,384.51007503494424,381.0239311823694,383.15156701632736,2497939
2024-02-05,2024-02-05,MSFT,382.8145070272584,383.6321668237873,379.58367977108395,381.6255175799173,4865159
2024-02-06,2024-02-06,MSFT,380.61472355383466,383.99461325551255,377.1665618466704,381.9738842812543,4604553
2024-02-07,2024-02-07,MSFT,379.8265084726916,382.40224132018983,377.04636350669716,380.14948361003786,2993656
2024-02-08,2024-02-08,MSFT,377.0301311079265,380.6030045058812,376.18479331882276,376.86925867728235,2815895
2024-02-09,2024-02-09,MSFT,374.74474251048713,377.6021847801639,371.5873519881455,374.56042564189516,3883968
2024-02-10,2024-02-10,MSFT,375.1497666347837,378.4419634870257,373.62236031039055,374.875536694053,3768039
2024-02-11,2024-02-11,MSFT,377.3600529628038,378.207506839462,372.52984873485275,377.8507635897879,1821832
2024-02-12,2024-02-12,MSFT,377.69459608838855,380.5527946009998,374.4706994701948,377.8661050988391,2787536
2024-02-13,2024-02-13,MSFT,375.5314551391151,380.38767887806193,371.8212456361269,375.67487727428994,3006132
2024-02-14,2024-02-14,MSFT,371.92400416811626,372.6646843520298,369.81741057838303,370.70048992208564,1425632
2024-02-15,2024-02-15,MSFT,369.85641679086893,372.81411208463066,366.9447880320257,371.6632084661325,1213469
2024-02-16,2024-02-16,MSFT,368.8132169253165,371.76902600983266,367.9476543133063,368.7934702755865,4270630
2024-02-17,2024-02-17,MSFT,370.57958198041354,371.5177398375395,367.88341543316994,371.03609457233523,4865973
2024-02-18,2024-02-18,MSFT,371.9120008187928,372.97397737749435,369.6397041205735,369.6397041205735,2344023
2024-02-19,2024-02-19,MSFT,373.2281901342264,375.93647155408297,369.65742327632216,373.495367851521,3361687
2024-02-20,2024-02-20,MSFT,372.48950645612035,375.89611810822225,371.3834736361076,371.3834736361076,4827102
2024-02-21,2024-02-21,MSFT,372.76661805507246,376.09906424006454,369.78955346435015,374.09254915227723,3595351
2024-02-22,2024-02-22,MSFT,371.69304797918676,373.01978938698835,370.3389483446672,370.4609165241353,3502548
2024-02-23,2024-02-23,MSFT,371.5312519682493,375.4732669324422,367.4826728373014,371.7895870438415,2553066
2024-02-24,2024-02-24,MSFT,369.4163389525273,371.4174424579315,366.21034478976645,368.86866261735685,4054167
2024-02-25,2024-02-25,MSFT,373.5596405558333,377.14388595835436,371.883438651509,371.9756799388805,4193734
2024-02-26,2024-02-26,MSFT,376.3766221597791,378.3832711739259,375.25032125280455,375.25032125280455,1458763
2024-02-27,2024-02-27,MSFT,377.28459953388676,381.6355982200165,373.569744368447,377.6592853852386,4722585
2024-02-28,2024-02-28,MSFT,377.1798264136634,380.61836614413454,372.2653361277775,377.92000606831897,1543262
2024-02-29,2024-02-29,MSFT,376.9652295929872,379.6497561615053,372.67183297468904,376.00496301044274,3169945

</script>

<!-- ACTUAL CONTENT -->

<h1>Candlestick Chart Examples</h1>
<p></p>

<h2>Example 1: Single Stock with Volume (AAPL)</h2>
<p>Daily stock prices with volume bars. Use time sliders to zoom, toggle renormalization and volume display.</p>


<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; background-color: #f0fff0;">
    <h4 style="margin-top: 0;">Plot Attributes</h4>
            <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="chart_type_select_example1_candlestick">Chart Type: </label>
                <select id="chart_type_select_example1_candlestick" onchange="updateChart_example1_candlestick()">
                <option value="candlestick" selected>candlestick</option>
                <option value="ohlc">ohlc</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="chart_type_select_example1_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
                <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="display_mode_select_example1_candlestick">Display Mode: </label>
                <select id="display_mode_select_example1_candlestick" onchange="updateChart_example1_candlestick()">
                <option value="Overlay" selected>Overlay</option>
                <option value="Faceted">Faceted</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="display_mode_select_example1_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
            <div style="margin: 10px; display: flex; flex-direction: column;">
        <div style="margin: 5px 0;">
            <input type="checkbox" id="renormalize_checkbox_example1_candlestick" onchange="updateChart_example1_candlestick()">
            <label for="renormalize_checkbox_example1_candlestick">Renormalize (first bar open = 1)</label>
        </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="show_volume_checkbox_example1_candlestick" checked onchange="updateChart_example1_candlestick()">
        <label for="show_volume_checkbox_example1_candlestick">Show Volume</label>
    </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="log_volume_checkbox_example1_candlestick" onchange="updateChart_example1_candlestick()">
        <label for="log_volume_checkbox_example1_candlestick">Log Volume</label>
    </div>
    </div>
<div style="margin: 15px 0; padding-top: 10px; border-top: 1px solid #ddd;">
    <label for="example1_candlestick_aspect_ratio_slider">Aspect Ratio: </label>
    <span id="example1_candlestick_aspect_ratio_label">0.6</span>
    <input type="range" id="example1_candlestick_aspect_ratio_slider"
           min="-1.3862943611198906" max="0.9162907318741551" step="0.01" value="-0.5108256237659907"
           style="width: 75%; margin-left: 10px;">
    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">(0.25 - 2.5)</span>
</div>

</div>

<!-- Chart -->
<div id="example1_candlestick"></div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: stock_data_1</p><br>
<hr>
<br>
<h2>Example 2: Multiple Stocks Comparison</h2>
<p>Compare stocks with vastly different prices. Enable renormalization to see relative performance (first bar open = 1). Switch between Overlay and Faceted display modes.</p>


<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; background-color: #f0fff0;">
    <h4 style="margin-top: 0;">Plot Attributes</h4>
            <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="chart_type_select_example2_candlestick">Chart Type: </label>
                <select id="chart_type_select_example2_candlestick" onchange="updateChart_example2_candlestick()">
                <option value="candlestick" selected>candlestick</option>
                <option value="ohlc">ohlc</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="chart_type_select_example2_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
                <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="display_mode_select_example2_candlestick">Display Mode: </label>
                <select id="display_mode_select_example2_candlestick" onchange="updateChart_example2_candlestick()">
                <option value="Overlay" selected>Overlay</option>
                <option value="Faceted">Faceted</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="display_mode_select_example2_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
            <div style="margin: 10px; display: flex; flex-direction: column;">
        <div style="margin: 5px 0;">
            <input type="checkbox" id="renormalize_checkbox_example2_candlestick" onchange="updateChart_example2_candlestick()">
            <label for="renormalize_checkbox_example2_candlestick">Renormalize (first bar open = 1)</label>
        </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="show_volume_checkbox_example2_candlestick" checked onchange="updateChart_example2_candlestick()">
        <label for="show_volume_checkbox_example2_candlestick">Show Volume</label>
    </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="log_volume_checkbox_example2_candlestick" onchange="updateChart_example2_candlestick()">
        <label for="log_volume_checkbox_example2_candlestick">Log Volume</label>
    </div>
    </div>
<div style="margin: 15px 0; padding-top: 10px; border-top: 1px solid #ddd;">
    <label for="example2_candlestick_aspect_ratio_slider">Aspect Ratio: </label>
    <span id="example2_candlestick_aspect_ratio_label">0.6</span>
    <input type="range" id="example2_candlestick_aspect_ratio_slider"
           min="-1.3862943611198906" max="0.9162907318741551" step="0.01" value="-0.5108256237659907"
           style="width: 75%; margin-left: 10px;">
    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">(0.25 - 2.5)</span>
</div>

</div>

<!-- Chart -->
<div id="example2_candlestick"></div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: stock_data_2</p><br>
<hr>
<br>
<h2>Example 3: Quarterly Data Without Volume</h2>
<p>Quarterly company performance using integer time periods. No volume data. Using Candlestick bar style instead of candlesticks. Faceted display shows each company separately.</p>


<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; background-color: #f0fff0;">
    <h4 style="margin-top: 0;">Plot Attributes</h4>
            <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="chart_type_select_example3_candlestick">Chart Type: </label>
                <select id="chart_type_select_example3_candlestick" onchange="updateChart_example3_candlestick()">
                <option value="candlestick" selected>candlestick</option>
                <option value="ohlc">ohlc</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="chart_type_select_example3_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
                <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="display_mode_select_example3_candlestick">Display Mode: </label>
                <select id="display_mode_select_example3_candlestick" onchange="updateChart_example3_candlestick()">
                <option value="Overlay">Overlay</option>
                <option value="Faceted" selected>Faceted</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="display_mode_select_example3_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
            <div style="margin: 10px; display: flex; flex-direction: column;">
        <div style="margin: 5px 0;">
            <input type="checkbox" id="renormalize_checkbox_example3_candlestick" onchange="updateChart_example3_candlestick()">
            <label for="renormalize_checkbox_example3_candlestick">Renormalize (first bar open = 1)</label>
        </div>
    </div>
<div style="margin: 15px 0; padding-top: 10px; border-top: 1px solid #ddd;">
    <label for="example3_candlestick_aspect_ratio_slider">Aspect Ratio: </label>
    <span id="example3_candlestick_aspect_ratio_label">0.6</span>
    <input type="range" id="example3_candlestick_aspect_ratio_slider"
           min="-1.3862943611198906" max="0.9162907318741551" step="0.01" value="-0.5108256237659907"
           style="width: 75%; margin-left: 10px;">
    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">(0.25 - 2.5)</span>
</div>

</div>

<!-- Chart -->
<div id="example3_candlestick"></div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: company_data</p>

<hr><p align="right"><small>This page was created using <a href="https://github.com/s-baumann/JSPlots.jl">JSPlots.jl</a> v0.5.1.</small></p>
</body>
</html>
