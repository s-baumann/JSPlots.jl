<!DOCTYPE html>
<html>
<head>
    <title>JSPlots.jl</title>
    <meta charset="UTF-8">
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apache-arrow@14.0.1/Arrow.es2015.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #controls {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        #$div_id {
            width: 100%;
            height: 600px;
        }
    </style>
    

    <!-- external libs -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/pivot.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/pivot.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/d3_renderers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/c3_renderers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/export_renderers.min.js"></script>

    <!-- Prism.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    

</head>

<body>

<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

<script type="module">
// Import parquet-wasm for Parquet file support
import * as parquet from 'https://unpkg.com/parquet-wasm@0.6.1/esm/parquet_wasm.js';

// Initialize parquet-wasm
await parquet.default();

// Make parquet available globally for loadDataset
window.parquetWasm = parquet;
window.parquetReady = true;
console.log('Parquet-wasm library loaded successfully');
</script>

<script>
// Helper function to wait for parquet-wasm to be loaded
function waitForParquet() {
    return new Promise(function(resolve) {
        if (window.parquetReady) {
            resolve();
            return;
        }
        var checkInterval = setInterval(function() {
            if (window.parquetReady) {
                clearInterval(checkInterval);
                resolve();
            }
        }, 50);
    });
}

// Centralized data loading function
// Centralized date parsing function
// Converts ISO date strings to JavaScript Date objects
// This is the ONLY place in the package where date parsing happens
function parseDatesInData(data) {
    if (!data || data.length === 0) return data;

    // Regex patterns for ISO date formats
    var datePattern = /^\d{4}-\d{2}-\d{2}$/;  // YYYY-MM-DD
    var datetimePattern = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/;  // YYYY-MM-DDTHH:MM:SS
    var timePattern = /^\d{2}:\d{2}:\d{2}(\.\d+)?$/;  // HH:MM:SS or HH:MM:SS.sss

    // Check first row to identify date and time columns
    var firstRow = data[0];
    var dateColumns = [];
    var timeColumns = [];

    for (var key in firstRow) {
        if (firstRow.hasOwnProperty(key)) {
            var value = firstRow[key];
            if (typeof value === 'string') {
                if (datetimePattern.test(value) || datePattern.test(value)) {
                    dateColumns.push(key);
                } else if (timePattern.test(value)) {
                    timeColumns.push(key);
                }
            }
        }
    }

    // If no date or time columns found, return data unchanged
    if (dateColumns.length === 0 && timeColumns.length === 0) return data;

    // Convert date strings to Date objects and time strings to milliseconds in all rows
    return data.map(function(row) {
        var newRow = {};
        for (var key in row) {
            if (row.hasOwnProperty(key)) {
                if (dateColumns.indexOf(key) !== -1 && typeof row[key] === 'string') {
                    newRow[key] = new Date(row[key]);
                } else if (timeColumns.indexOf(key) !== -1 && typeof row[key] === 'string') {
                    // Convert HH:MM:SS or HH:MM:SS.sss to milliseconds since midnight
                    var parts = row[key].split(':');
                    var hours = parseInt(parts[0], 10);
                    var minutes = parseInt(parts[1], 10);
                    var seconds = parseFloat(parts[2]);  // Use parseFloat to handle decimal seconds
                    newRow[key] = (hours * 3600 + minutes * 60 + seconds) * 1000;
                } else {
                    newRow[key] = row[key];
                }
            }
        }
        return newRow;
    });
}

// Helper function to convert temporal values back to string format for categorical filtering
// Takes a value and returns the appropriate string representation
function temporalValueToString(value) {
    if (value instanceof Date) {
        // Convert Date to ISO string
        var year = value.getFullYear();
        var month = String(value.getMonth() + 1).padStart(2, '0');
        var day = String(value.getDate()).padStart(2, '0');
        var hours = String(value.getHours()).padStart(2, '0');
        var minutes = String(value.getMinutes()).padStart(2, '0');
        var seconds = String(value.getSeconds()).padStart(2, '0');

        // Check if this is a date-only value (time is midnight UTC)
        if (hours === '00' && minutes === '00' && seconds === '00') {
            return year + '-' + month + '-' + day;
        } else {
            return year + '-' + month + '-' + day + 'T' + hours + ':' + minutes + ':' + seconds;
        }
    } else if (typeof value === 'number' && value >= 0 && value < 86400000) {
        // Likely a Time value (milliseconds since midnight, less than 24 hours)
        var totalSeconds = Math.floor(value / 1000);
        var hours = Math.floor(totalSeconds / 3600);
        var minutes = Math.floor((totalSeconds % 3600) / 60);
        var seconds = totalSeconds % 60;
        var milliseconds = value % 1000;

        var timeStr = String(hours).padStart(2, '0') + ':' +
                      String(minutes).padStart(2, '0') + ':' +
                      String(seconds).padStart(2, '0');

        // Add decimal part if there are milliseconds
        if (milliseconds > 0) {
            timeStr += '.' + String(milliseconds);
        }

        return timeStr;
    } else {
        // Return as-is for other types
        return String(value);
    }
}

// Centralized observation counting and filtering function
// Applies filters incrementally while updating observation count displays
// Returns filtered data
function applyFiltersWithCounting(allData, chartTitle, categoricalFilters, continuousFilters, filters, rangeFilters) {
    var totalObs = allData.length;

    // Update total observation count
    var totalObsElement = document.getElementById(chartTitle + '_total_obs');
    if (totalObsElement) {
        totalObsElement.textContent = totalObs + ' observations';
    }

    // Apply filters incrementally to track observation counts
    var currentData = allData;

    // Apply categorical filters and update counts
    categoricalFilters.forEach(function(col) {
        if (filters[col] && filters[col].length > 0) {
            currentData = currentData.filter(function(row) {
                var rowValueStr = temporalValueToString(row[col]);
                return filters[col].includes(rowValueStr);
            });
        }

        var countElement = document.getElementById(col + '_select_' + chartTitle + '_obs_count');
        if (countElement) {
            var pct = totalObs > 0 ? Math.round((currentData.length / totalObs) * 100) : 100;
            countElement.textContent = pct + '% (' + currentData.length + ') remaining';
        }
    });

    // Apply continuous filters and update counts
    continuousFilters.forEach(function(col) {
        if (rangeFilters[col]) {
            var range = rangeFilters[col];
            currentData = currentData.filter(function(row) {
                var rawValue = row[col];
                var value;
                if (rawValue instanceof Date) {
                    value = rawValue.getTime();
                } else {
                    value = parseFloat(rawValue);
                }
                return value >= range.min && value <= range.max;
            });
        }

        var countElement = document.getElementById(col + '_range_' + chartTitle + '_obs_count');
        if (countElement) {
            var pct = totalObs > 0 ? Math.round((currentData.length / totalObs) * 100) : 100;
            countElement.textContent = pct + '% (' + currentData.length + ') remaining';
        }
    });

    return currentData;
}

// Axis transformation functions
// These transform data values according to selected transformation type
function applyAxisTransform(values, transformType) {
    if (!values || values.length === 0) return [];

    switch(transformType) {
        case 'identity':
            return values;

        case 'log':
            return values.map(function(v) {
                return v > 0 ? Math.log(v) : NaN;
            });

        case 'z_score':
            // Z-score standardization: (x - mean) / std
            var numericVals = values.filter(function(v) { return !isNaN(v) && isFinite(v); });
            if (numericVals.length === 0) return values;

            var mean = numericVals.reduce(function(a, b) { return a + b; }, 0) / numericVals.length;
            var variance = numericVals.reduce(function(sum, v) {
                return sum + Math.pow(v - mean, 2);
            }, 0) / numericVals.length;
            var std = Math.sqrt(variance);

            if (std === 0) return values;

            return values.map(function(v) {
                if (isNaN(v) || !isFinite(v)) return NaN;
                return (v - mean) / std;
            });

        case 'quantile':
            // Rank-based transformation to [0, 1]
            // Create array of {value, originalIndex} pairs
            var indexedValues = values.map(function(v, i) {
                return { value: v, index: i };
            });

            // Filter out invalid values and sort
            var validValues = indexedValues.filter(function(item) {
                return !isNaN(item.value) && isFinite(item.value);
            }).sort(function(a, b) {
                return a.value - b.value;
            });

            if (validValues.length === 0) return values;

            // Assign ranks (0 to 1)
            var ranks = new Array(values.length).fill(NaN);
            validValues.forEach(function(item, rank) {
                // Map rank to [0, 1] where lowest = 0, highest = 1
                ranks[item.index] = validValues.length === 1 ? 0.5 : rank / (validValues.length - 1);
            });

            return ranks;

        case 'inverse_cdf':
            // Z-score followed by normal CDF transformation to [0, 1]
            var numericVals2 = values.filter(function(v) { return !isNaN(v) && isFinite(v); });
            if (numericVals2.length === 0) return values;

            var mean2 = numericVals2.reduce(function(a, b) { return a + b; }, 0) / numericVals2.length;
            var variance2 = numericVals2.reduce(function(sum, v) {
                return sum + Math.pow(v - mean2, 2);
            }, 0) / numericVals2.length;
            var std2 = Math.sqrt(variance2);

            if (std2 === 0) return values.map(function() { return 0.5; });

            return values.map(function(v) {
                if (isNaN(v) || !isFinite(v)) return NaN;
                var zscore = (v - mean2) / std2;
                return normalCDF(zscore);
            });

        default:
            return values;
    }
}

// Normal CDF (cumulative distribution function) for standard normal
function normalCDF(x) {
    // Using error function approximation
    var t = 1 / (1 + 0.2316419 * Math.abs(x));
    var d = 0.3989423 * Math.exp(-x * x / 2);
    var prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
    return x > 0 ? 1 - prob : prob;
}

// Inverse normal CDF (quantile function) for standard normal
function inverseNormalCDF(p) {
    // Rational approximation for inverse normal CDF
    // Valid for 0 < p < 1
    if (p <= 0 || p >= 1) {
        return NaN;
    }

    var a = [0, -3.969683028665376e+01, 2.209460984245205e+02,
             -2.759285104469687e+02, 1.383577518672690e+02,
             -3.066479806614716e+01, 2.506628277459239e+00];
    var b = [0, -5.447609879822406e+01, 1.615858368580409e+02,
             -1.556989798598866e+02, 6.680131188771972e+01,
             -1.328068155288572e+01];
    var c = [0, -7.784894002430293e-03, -3.223964580411365e-01,
             -2.400758277161838e+00, -2.549732539343734e+00,
             4.374664141464968e+00, 2.938163982698783e+00];
    var d = [0, 7.784695709041462e-03, 3.224671290700398e-01,
             2.445134137142996e+00, 3.754408661907416e+00];

    var q, r, result;

    if (p < 0.02425) {
        q = Math.sqrt(-2 * Math.log(p));
        result = (((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q + c[6]) /
                 ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1);
    } else if (p > 0.97575) {
        q = Math.sqrt(-2 * Math.log(1 - p));
        result = -(((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q + c[6]) /
                  ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1);
    } else {
        q = p - 0.5;
        r = q * q;
        result = (((((a[1] * r + a[2]) * r + a[3]) * r + a[4]) * r + a[5]) * r + a[6]) * q /
                 (((((b[1] * r + b[2]) * r + b[3]) * r + b[4]) * r + b[5]) * r + 1);
    }

    return result;
}

// Get axis label with transformation applied
function getAxisLabel(originalLabel, transformType) {
    switch(transformType) {
        case 'log':
            return 'log(' + originalLabel + ')';
        case 'z_score':
            return 'z(' + originalLabel + ')';
        case 'quantile':
            return 'quantile(' + originalLabel + ')';
        case 'inverse_cdf':
            return 'Î¦(' + originalLabel + ')';
        default:
            return originalLabel;
    }
}

// Setup aspect ratio control for a chart
// This should be called after the chart is first rendered
// Uses logarithmic scale for better precision at smaller aspect ratios
function setupAspectRatioControl(chartId, updateCallback) {
    var slider = document.getElementById(chartId + '_aspect_ratio_slider');
    var label = document.getElementById(chartId + '_aspect_ratio_label');

    if (!slider || !label) return; // Not all charts have aspect ratio control

    slider.addEventListener('input', function() {
        // Convert from log space to linear space
        var logValue = parseFloat(this.value);
        var aspectRatio = Math.exp(logValue);
        label.textContent = aspectRatio.toFixed(2);

        // Get current width of chart div
        var chartDiv = document.getElementById(chartId);
        if (!chartDiv) return;

        var width = chartDiv.offsetWidth;
        var height = width * aspectRatio;

        // Update chart layout with new height
        Plotly.relayout(chartId, { height: height });

        // Call the optional callback if provided
        if (updateCallback && typeof updateCallback === 'function') {
            updateCallback(height);
        }
    });

    // Trigger initial sizing
    var initialLogValue = parseFloat(slider.value);
    var initialAspectRatio = Math.exp(initialLogValue);
    label.textContent = initialAspectRatio.toFixed(2);
    var chartDiv = document.getElementById(chartId);
    if (chartDiv) {
        var width = chartDiv.offsetWidth;
        var height = width * initialAspectRatio;
        Plotly.relayout(chartId, { height: height });
    }
}

// This function parses data from embedded or external sources and returns a Promise
// Supports CSV (embedded/external), JSON (embedded/external), and Parquet (external) formats
// Usage: loadDataset('dataLabel').then(function(data) { /* use data */ });
function loadDataset(dataLabel) {
    return new Promise(function(resolve, reject) {
        var dataElement = document.getElementById(dataLabel);
        if (!dataElement) {
            reject(new Error('Data element not found: ' + dataLabel));
            return;
        }

        var format = dataElement.getAttribute('data-format') || 'csv_embedded';
        var dataSrc = dataElement.getAttribute('data-src');

        // Handle external JSON files
        if (format === 'json_external' && dataSrc) {
            fetch(dataSrc)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.json();
                })
                .then(function(data) {
                    // Parse dates in JSON data (centralized)
                    resolve(parseDatesInData(data));
                })
                .catch(function(error) {
                    console.error('Error loading external JSON:', error);
                    reject(error);
                });
            return;
        }

        // Handle external Parquet files
        if (format === 'parquet' && dataSrc) {
            // Wait for parquet-wasm to be loaded first
            waitForParquet()
                .then(function() {
                    return fetch(dataSrc);
                })
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.arrayBuffer();
                })
                .then(function(arrayBuffer) {
                    // Use parquet-wasm to read the file
                    var uint8Array = new Uint8Array(arrayBuffer);

                    // readParquet returns an Arrow Table
                    var wasmTable = window.parquetWasm.readParquet(uint8Array);

                    // Convert to Arrow IPC stream
                    var ipcStream = wasmTable.intoIPCStream();

                    // Use Apache Arrow JS to read the IPC stream
                    var arrowTable = window.Arrow.tableFromIPC(ipcStream);

                    // Convert Arrow Table to array of JavaScript objects
                    var data = [];
                    for (var i = 0; i < arrowTable.numRows; i++) {
                        var row = {};
                        arrowTable.schema.fields.forEach(function(field) {
                            var column = arrowTable.getChild(field.name);
                            var value = column.get(i);

                            // Convert BigInt to Number (Arrow returns BigInt for Int64)
                            if (typeof value === 'bigint') {
                                value = Number(value);
                            }

                            row[field.name] = value;
                        });
                        data.push(row);
                    }

                    // Parse dates in Parquet data (centralized date handling)
                    resolve(parseDatesInData(data));
                })
                .catch(function(error) {
                    console.error('Error loading external Parquet:', error);
                    reject(error);
                });
            return;
        }

        // Handle external CSV files
        if (format === 'csv_external' && dataSrc) {
            fetch(dataSrc)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.text();
                })
                .then(function(csvText) {
                    Papa.parse(csvText, {
                        header: true,
                        dynamicTyping: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            // Check for fatal errors only (not warnings)
                            var fatalErrors = results.errors.filter(function(err) {
                                return err.type !== 'Delimiter';
                            });

                            if (fatalErrors.length > 0) {
                                console.error('CSV parsing errors:', fatalErrors);
                                reject(fatalErrors);
                            } else if (results.data && results.data.length > 0) {
                                // Parse dates in CSV data (centralized)
                                resolve(parseDatesInData(results.data));
                            } else {
                                reject(new Error('No data parsed from CSV'));
                            }
                        },
                        error: function(error) {
                            console.error('CSV parsing error:', error);
                            reject(error);
                        }
                    });
                })
                .catch(function(error) {
                    console.error('Error loading external CSV:', error);
                    reject(error);
                });
            return;
        }

        // Handle embedded data
        var dataText = dataElement.textContent.trim();

        if (format === 'json_embedded') {
            // Parse JSON data
            try {
                var data = JSON.parse(dataText);
                // Parse dates in JSON data (centralized)
                resolve(parseDatesInData(data));
            } catch (error) {
                console.error('JSON parsing error:', error);
                reject(error);
            }
        } else if (format === 'csv_embedded') {
            // Parse CSV data using PapaParse
            Papa.parse(dataText, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    // Check for fatal errors only (not warnings)
                    // PapaParse includes non-fatal warnings in errors array
                    var fatalErrors = results.errors.filter(function(err) {
                        // Filter out delimiter detection warnings - these aren't fatal
                        // (common for single-column CSVs)
                        return err.type !== 'Delimiter';
                    });

                    if (fatalErrors.length > 0) {
                        console.error('CSV parsing errors:', fatalErrors);
                        reject(fatalErrors);
                    } else if (results.data && results.data.length > 0) {
                        // Parse dates in CSV data (centralized)
                        resolve(parseDatesInData(results.data));
                    } else {
                        reject(new Error('No data parsed from CSV'));
                    }
                },
                error: function(error) {
                    console.error('CSV parsing error:', error);
                    reject(error);
                }
            });
        } else {
            reject(new Error('Unsupported data format: ' + format));
        }
    });
}

$(function(){

(function() {
    // Configuration
    const TIME_FROM_COL = 'time_from';
    const TIME_TO_COL = 'time_to';
    const SYMBOL_COL = 'symbol';
    const OPEN_COL = 'open';
    const HIGH_COL = 'high';
    const LOW_COL = 'low';
    const CLOSE_COL = 'close';
    const VOLUME_COL = 'volume';
    const HAS_VOLUME = true;
    const CATEGORICAL_FILTERS = [];
    const CONTINUOUS_FILTERS = [];

    let allData = [];
    let firstBarOpenPrices = {};  // Store first bar open prices for renormalization

    // Make it global so inline onchange can see it
    window.updateChart_example1_candlestick = function() {
        // Get current control values
        const renormalizeCheckbox = document.getElementById('renormalize_checkbox_example1_candlestick');
        const RENORMALIZE = renormalizeCheckbox ? renormalizeCheckbox.checked : false;

        const showVolumeCheckbox = document.getElementById('show_volume_checkbox_example1_candlestick');
        const SHOW_VOLUME = HAS_VOLUME && showVolumeCheckbox ? showVolumeCheckbox.checked : false;

        const logVolumeCheckbox = document.getElementById('log_volume_checkbox_example1_candlestick');
        const LOG_VOLUME = SHOW_VOLUME && logVolumeCheckbox ? logVolumeCheckbox.checked : false;

        const chartTypeSelect = document.getElementById('chart_type_select_example1_candlestick');
        const CHART_TYPE = chartTypeSelect ? chartTypeSelect.value : 'candlestick';

        const displayModeSelect = document.getElementById('display_mode_select_example1_candlestick');
        const DISPLAY_MODE = displayModeSelect ? displayModeSelect.value : 'Overlay';

        // Get current filter values
        const filters = {};
        const rangeFilters = {};

        // Read categorical filters (dropdowns)
        CATEGORICAL_FILTERS.forEach(col => {
            const select = document.getElementById(col + '_select_example1_candlestick');
            if (select) {
                filters[col] = Array.from(select.selectedOptions).map(opt => opt.value);
            }
        });

        // Read continuous filters (range sliders)
        CONTINUOUS_FILTERS.forEach(col => {
            const slider = $('#' + col + '_range_example1_candlestick' + '_slider');
            if (slider.length > 0) {
                rangeFilters[col] = {
                    min: slider.slider("values", 0),
                    max: slider.slider("values", 1)
                };
            }
        });

        // Apply filters with observation counting
        const filteredData = applyFiltersWithCounting(
            allData,
            'example1_candlestick',
            CATEGORICAL_FILTERS,
            CONTINUOUS_FILTERS,
            filters,
            rangeFilters
        );

        // Group data by symbol
        const symbolData = {};
        filteredData.forEach(row => {
            const symbol = String(row[SYMBOL_COL]);
            if (!symbolData[symbol]) {
                symbolData[symbol] = [];
            }
            symbolData[symbol].push(row);
        });

        // Sort each symbol's data by time
        for (let symbol in symbolData) {
            symbolData[symbol].sort((a, b) => {
                const aTime = a[TIME_FROM_COL];
                const bTime = b[TIME_FROM_COL];
                if (aTime instanceof Date && bTime instanceof Date) {
                    return aTime - bTime;
                }
                return aTime < bTime ? -1 : (aTime > bTime ? 1 : 0);
            });
        }

        // Calculate first bar open prices for renormalization (only once)
        if (Object.keys(firstBarOpenPrices).length === 0 || !RENORMALIZE) {
            firstBarOpenPrices = {};
            for (let symbol in symbolData) {
                if (symbolData[symbol].length > 0) {
                    firstBarOpenPrices[symbol] = symbolData[symbol][0][OPEN_COL];
                }
            }
        }

        // Route to appropriate rendering function
        if (DISPLAY_MODE === 'Overlay') {
            renderOverlay(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        } else {
            renderFaceted(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        }
    };

    // Render overlay mode (all symbols on same chart)
    function renderOverlay(symbolData, renormalize, showVolume, logVolume, chartType) {
        const traces = [];
        const symbols = Object.keys(symbolData).sort();
        const colorPalette = ['#636efa', '#EF553B', '#00cc96', '#ab63fa', '#FFA15A',
                             '#19d3f3', '#FF6692', '#B6E880', '#FF97FF', '#FECB52'];

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];
            const color = colorPalette[idx % colorPalette.length];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: 'x',
                yaxis: 'y',
                increasing: {line: {color: color}},
                decreasing: {line: {color: color}}
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: 'x',
                    yaxis: 'y2',
                    marker: {color: color},
                    showlegend: false
                };
                traces.push(volumeTrace);
            }
        });

        // Layout configuration
        const layout = {
            xaxis: {
                title: TIME_FROM_COL,
                anchor: 'y'
            },
            hovermode: 'closest',
            showlegend: true
        };

        if (showVolume && HAS_VOLUME) {
            // Two subplots: Candlestick on top, volume on bottom
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price',
                domain: [0.3, 1]
            };
            layout.yaxis2 = {
                title: logVolume ? 'log(Volume)' : 'Volume',
                domain: [0, 0.25],
                anchor: 'x'
            };
            layout.barmode = 'group';  // Dodge volume bars
        } else {
            // Single plot: Candlestick only
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price'
            };
        }

        Plotly.newPlot('example1_candlestick', traces, layout, {responsive: true});
    }

    // Render faceted mode (one subplot per symbol)
    function renderFaceted(symbolData, renormalize, showVolume, logVolume, chartType) {
        const symbols = Object.keys(symbolData).sort();
        const nSymbols = symbols.length;

        // Calculate grid dimensions (prefer wider grids)
        const nCols = Math.ceil(Math.sqrt(nSymbols * 1.5));
        const nRows = Math.ceil(nSymbols / nCols);

        const traces = [];
        const layout = {
            hovermode: 'closest',
            showlegend: false,
            grid: {rows: nRows, columns: nCols, pattern: 'independent'}
        };

        if (showVolume && HAS_VOLUME) {
            layout.barmode = 'group';
        }

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            const row = Math.floor(idx / nCols) + 1;
            const col = (idx % nCols) + 1;
            const xaxis = idx === 0 ? 'x' : 'x' + (idx + 1);
            const yaxis = idx === 0 ? 'y' : 'y' + (idx + 1);

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: xaxis,
                yaxis: yaxis
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const yaxis_vol = idx === 0 ? 'y' + (nSymbols + 1) : 'y' + (nSymbols + idx + 1);

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: xaxis,
                    yaxis: yaxis_vol,
                    showlegend: false
                };
                traces.push(volumeTrace);

                // Configure volume yaxis
                layout[yaxis_vol] = {
                    title: row === nRows ? (logVolume ? 'log(Vol)' : 'Vol') : '',
                    anchor: xaxis
                };
            }

            // Add axis configuration
            layout[xaxis] = {
                title: row === nRows ? TIME_FROM_COL : '',
                anchor: yaxis
            };
            layout[yaxis] = {
                title: col === 1 ? (renormalize ? 'Norm Price' : 'Price') : '',
                anchor: xaxis
            };

            // Add annotation for symbol label
            if (!layout.annotations) layout.annotations = [];
            layout.annotations.push({
                text: symbol,
                showarrow: false,
                xref: xaxis === 'x' ? 'x domain' : xaxis + ' domain',
                yref: yaxis === 'y' ? 'y domain' : yaxis + ' domain',
                x: 0.5,
                y: 1.05,
                xanchor: 'center',
                yanchor: 'bottom',
                font: {size: 10}
            });
        });

        Plotly.newPlot('example1_candlestick', traces, layout, {responsive: true});
    }

    // Load and parse CSV data using centralized parser
    loadDataset('stock_data_1').then(function(data) {
        allData = data;
        window.updateChart_example1_candlestick();

        // Setup aspect ratio control after initial render
        setupAspectRatioControl('example1_candlestick');
    }).catch(function(error) {
        console.error('Error loading data for chart example1_candlestick:', error);
    });
})();
(function() {
    // Configuration
    const TIME_FROM_COL = 'time_from';
    const TIME_TO_COL = 'time_to';
    const SYMBOL_COL = 'symbol';
    const OPEN_COL = 'open';
    const HIGH_COL = 'high';
    const LOW_COL = 'low';
    const CLOSE_COL = 'close';
    const VOLUME_COL = 'volume';
    const HAS_VOLUME = true;
    const CATEGORICAL_FILTERS = [];
    const CONTINUOUS_FILTERS = [];

    let allData = [];
    let firstBarOpenPrices = {};  // Store first bar open prices for renormalization

    // Make it global so inline onchange can see it
    window.updateChart_example2_candlestick = function() {
        // Get current control values
        const renormalizeCheckbox = document.getElementById('renormalize_checkbox_example2_candlestick');
        const RENORMALIZE = renormalizeCheckbox ? renormalizeCheckbox.checked : false;

        const showVolumeCheckbox = document.getElementById('show_volume_checkbox_example2_candlestick');
        const SHOW_VOLUME = HAS_VOLUME && showVolumeCheckbox ? showVolumeCheckbox.checked : false;

        const logVolumeCheckbox = document.getElementById('log_volume_checkbox_example2_candlestick');
        const LOG_VOLUME = SHOW_VOLUME && logVolumeCheckbox ? logVolumeCheckbox.checked : false;

        const chartTypeSelect = document.getElementById('chart_type_select_example2_candlestick');
        const CHART_TYPE = chartTypeSelect ? chartTypeSelect.value : 'candlestick';

        const displayModeSelect = document.getElementById('display_mode_select_example2_candlestick');
        const DISPLAY_MODE = displayModeSelect ? displayModeSelect.value : 'Overlay';

        // Get current filter values
        const filters = {};
        const rangeFilters = {};

        // Read categorical filters (dropdowns)
        CATEGORICAL_FILTERS.forEach(col => {
            const select = document.getElementById(col + '_select_example2_candlestick');
            if (select) {
                filters[col] = Array.from(select.selectedOptions).map(opt => opt.value);
            }
        });

        // Read continuous filters (range sliders)
        CONTINUOUS_FILTERS.forEach(col => {
            const slider = $('#' + col + '_range_example2_candlestick' + '_slider');
            if (slider.length > 0) {
                rangeFilters[col] = {
                    min: slider.slider("values", 0),
                    max: slider.slider("values", 1)
                };
            }
        });

        // Apply filters with observation counting
        const filteredData = applyFiltersWithCounting(
            allData,
            'example2_candlestick',
            CATEGORICAL_FILTERS,
            CONTINUOUS_FILTERS,
            filters,
            rangeFilters
        );

        // Group data by symbol
        const symbolData = {};
        filteredData.forEach(row => {
            const symbol = String(row[SYMBOL_COL]);
            if (!symbolData[symbol]) {
                symbolData[symbol] = [];
            }
            symbolData[symbol].push(row);
        });

        // Sort each symbol's data by time
        for (let symbol in symbolData) {
            symbolData[symbol].sort((a, b) => {
                const aTime = a[TIME_FROM_COL];
                const bTime = b[TIME_FROM_COL];
                if (aTime instanceof Date && bTime instanceof Date) {
                    return aTime - bTime;
                }
                return aTime < bTime ? -1 : (aTime > bTime ? 1 : 0);
            });
        }

        // Calculate first bar open prices for renormalization (only once)
        if (Object.keys(firstBarOpenPrices).length === 0 || !RENORMALIZE) {
            firstBarOpenPrices = {};
            for (let symbol in symbolData) {
                if (symbolData[symbol].length > 0) {
                    firstBarOpenPrices[symbol] = symbolData[symbol][0][OPEN_COL];
                }
            }
        }

        // Route to appropriate rendering function
        if (DISPLAY_MODE === 'Overlay') {
            renderOverlay(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        } else {
            renderFaceted(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        }
    };

    // Render overlay mode (all symbols on same chart)
    function renderOverlay(symbolData, renormalize, showVolume, logVolume, chartType) {
        const traces = [];
        const symbols = Object.keys(symbolData).sort();
        const colorPalette = ['#636efa', '#EF553B', '#00cc96', '#ab63fa', '#FFA15A',
                             '#19d3f3', '#FF6692', '#B6E880', '#FF97FF', '#FECB52'];

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];
            const color = colorPalette[idx % colorPalette.length];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: 'x',
                yaxis: 'y',
                increasing: {line: {color: color}},
                decreasing: {line: {color: color}}
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: 'x',
                    yaxis: 'y2',
                    marker: {color: color},
                    showlegend: false
                };
                traces.push(volumeTrace);
            }
        });

        // Layout configuration
        const layout = {
            xaxis: {
                title: TIME_FROM_COL,
                anchor: 'y'
            },
            hovermode: 'closest',
            showlegend: true
        };

        if (showVolume && HAS_VOLUME) {
            // Two subplots: Candlestick on top, volume on bottom
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price',
                domain: [0.3, 1]
            };
            layout.yaxis2 = {
                title: logVolume ? 'log(Volume)' : 'Volume',
                domain: [0, 0.25],
                anchor: 'x'
            };
            layout.barmode = 'group';  // Dodge volume bars
        } else {
            // Single plot: Candlestick only
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price'
            };
        }

        Plotly.newPlot('example2_candlestick', traces, layout, {responsive: true});
    }

    // Render faceted mode (one subplot per symbol)
    function renderFaceted(symbolData, renormalize, showVolume, logVolume, chartType) {
        const symbols = Object.keys(symbolData).sort();
        const nSymbols = symbols.length;

        // Calculate grid dimensions (prefer wider grids)
        const nCols = Math.ceil(Math.sqrt(nSymbols * 1.5));
        const nRows = Math.ceil(nSymbols / nCols);

        const traces = [];
        const layout = {
            hovermode: 'closest',
            showlegend: false,
            grid: {rows: nRows, columns: nCols, pattern: 'independent'}
        };

        if (showVolume && HAS_VOLUME) {
            layout.barmode = 'group';
        }

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            const row = Math.floor(idx / nCols) + 1;
            const col = (idx % nCols) + 1;
            const xaxis = idx === 0 ? 'x' : 'x' + (idx + 1);
            const yaxis = idx === 0 ? 'y' : 'y' + (idx + 1);

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: xaxis,
                yaxis: yaxis
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const yaxis_vol = idx === 0 ? 'y' + (nSymbols + 1) : 'y' + (nSymbols + idx + 1);

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: xaxis,
                    yaxis: yaxis_vol,
                    showlegend: false
                };
                traces.push(volumeTrace);

                // Configure volume yaxis
                layout[yaxis_vol] = {
                    title: row === nRows ? (logVolume ? 'log(Vol)' : 'Vol') : '',
                    anchor: xaxis
                };
            }

            // Add axis configuration
            layout[xaxis] = {
                title: row === nRows ? TIME_FROM_COL : '',
                anchor: yaxis
            };
            layout[yaxis] = {
                title: col === 1 ? (renormalize ? 'Norm Price' : 'Price') : '',
                anchor: xaxis
            };

            // Add annotation for symbol label
            if (!layout.annotations) layout.annotations = [];
            layout.annotations.push({
                text: symbol,
                showarrow: false,
                xref: xaxis === 'x' ? 'x domain' : xaxis + ' domain',
                yref: yaxis === 'y' ? 'y domain' : yaxis + ' domain',
                x: 0.5,
                y: 1.05,
                xanchor: 'center',
                yanchor: 'bottom',
                font: {size: 10}
            });
        });

        Plotly.newPlot('example2_candlestick', traces, layout, {responsive: true});
    }

    // Load and parse CSV data using centralized parser
    loadDataset('stock_data_2').then(function(data) {
        allData = data;
        window.updateChart_example2_candlestick();

        // Setup aspect ratio control after initial render
        setupAspectRatioControl('example2_candlestick');
    }).catch(function(error) {
        console.error('Error loading data for chart example2_candlestick:', error);
    });
})();
(function() {
    // Configuration
    const TIME_FROM_COL = 'quarter';
    const TIME_TO_COL = 'quarter_end';
    const SYMBOL_COL = 'company';
    const OPEN_COL = 'open_price';
    const HIGH_COL = 'high_price';
    const LOW_COL = 'low_price';
    const CLOSE_COL = 'close_price';
    const VOLUME_COL = '';
    const HAS_VOLUME = false;
    const CATEGORICAL_FILTERS = [];
    const CONTINUOUS_FILTERS = [];

    let allData = [];
    let firstBarOpenPrices = {};  // Store first bar open prices for renormalization

    // Make it global so inline onchange can see it
    window.updateChart_example3_candlestick = function() {
        // Get current control values
        const renormalizeCheckbox = document.getElementById('renormalize_checkbox_example3_candlestick');
        const RENORMALIZE = renormalizeCheckbox ? renormalizeCheckbox.checked : false;

        const showVolumeCheckbox = document.getElementById('show_volume_checkbox_example3_candlestick');
        const SHOW_VOLUME = HAS_VOLUME && showVolumeCheckbox ? showVolumeCheckbox.checked : false;

        const logVolumeCheckbox = document.getElementById('log_volume_checkbox_example3_candlestick');
        const LOG_VOLUME = SHOW_VOLUME && logVolumeCheckbox ? logVolumeCheckbox.checked : false;

        const chartTypeSelect = document.getElementById('chart_type_select_example3_candlestick');
        const CHART_TYPE = chartTypeSelect ? chartTypeSelect.value : 'candlestick';

        const displayModeSelect = document.getElementById('display_mode_select_example3_candlestick');
        const DISPLAY_MODE = displayModeSelect ? displayModeSelect.value : 'Faceted';

        // Get current filter values
        const filters = {};
        const rangeFilters = {};

        // Read categorical filters (dropdowns)
        CATEGORICAL_FILTERS.forEach(col => {
            const select = document.getElementById(col + '_select_example3_candlestick');
            if (select) {
                filters[col] = Array.from(select.selectedOptions).map(opt => opt.value);
            }
        });

        // Read continuous filters (range sliders)
        CONTINUOUS_FILTERS.forEach(col => {
            const slider = $('#' + col + '_range_example3_candlestick' + '_slider');
            if (slider.length > 0) {
                rangeFilters[col] = {
                    min: slider.slider("values", 0),
                    max: slider.slider("values", 1)
                };
            }
        });

        // Apply filters with observation counting
        const filteredData = applyFiltersWithCounting(
            allData,
            'example3_candlestick',
            CATEGORICAL_FILTERS,
            CONTINUOUS_FILTERS,
            filters,
            rangeFilters
        );

        // Group data by symbol
        const symbolData = {};
        filteredData.forEach(row => {
            const symbol = String(row[SYMBOL_COL]);
            if (!symbolData[symbol]) {
                symbolData[symbol] = [];
            }
            symbolData[symbol].push(row);
        });

        // Sort each symbol's data by time
        for (let symbol in symbolData) {
            symbolData[symbol].sort((a, b) => {
                const aTime = a[TIME_FROM_COL];
                const bTime = b[TIME_FROM_COL];
                if (aTime instanceof Date && bTime instanceof Date) {
                    return aTime - bTime;
                }
                return aTime < bTime ? -1 : (aTime > bTime ? 1 : 0);
            });
        }

        // Calculate first bar open prices for renormalization (only once)
        if (Object.keys(firstBarOpenPrices).length === 0 || !RENORMALIZE) {
            firstBarOpenPrices = {};
            for (let symbol in symbolData) {
                if (symbolData[symbol].length > 0) {
                    firstBarOpenPrices[symbol] = symbolData[symbol][0][OPEN_COL];
                }
            }
        }

        // Route to appropriate rendering function
        if (DISPLAY_MODE === 'Overlay') {
            renderOverlay(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        } else {
            renderFaceted(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        }
    };

    // Render overlay mode (all symbols on same chart)
    function renderOverlay(symbolData, renormalize, showVolume, logVolume, chartType) {
        const traces = [];
        const symbols = Object.keys(symbolData).sort();
        const colorPalette = ['#636efa', '#EF553B', '#00cc96', '#ab63fa', '#FFA15A',
                             '#19d3f3', '#FF6692', '#B6E880', '#FF97FF', '#FECB52'];

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];
            const color = colorPalette[idx % colorPalette.length];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: 'x',
                yaxis: 'y',
                increasing: {line: {color: color}},
                decreasing: {line: {color: color}}
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: 'x',
                    yaxis: 'y2',
                    marker: {color: color},
                    showlegend: false
                };
                traces.push(volumeTrace);
            }
        });

        // Layout configuration
        const layout = {
            xaxis: {
                title: TIME_FROM_COL,
                anchor: 'y'
            },
            hovermode: 'closest',
            showlegend: true
        };

        if (showVolume && HAS_VOLUME) {
            // Two subplots: Candlestick on top, volume on bottom
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price',
                domain: [0.3, 1]
            };
            layout.yaxis2 = {
                title: logVolume ? 'log(Volume)' : 'Volume',
                domain: [0, 0.25],
                anchor: 'x'
            };
            layout.barmode = 'group';  // Dodge volume bars
        } else {
            // Single plot: Candlestick only
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price'
            };
        }

        Plotly.newPlot('example3_candlestick', traces, layout, {responsive: true});
    }

    // Render faceted mode (one subplot per symbol)
    function renderFaceted(symbolData, renormalize, showVolume, logVolume, chartType) {
        const symbols = Object.keys(symbolData).sort();
        const nSymbols = symbols.length;

        // Calculate grid dimensions (prefer wider grids)
        const nCols = Math.ceil(Math.sqrt(nSymbols * 1.5));
        const nRows = Math.ceil(nSymbols / nCols);

        const traces = [];
        const layout = {
            hovermode: 'closest',
            showlegend: false,
            grid: {rows: nRows, columns: nCols, pattern: 'independent'}
        };

        if (showVolume && HAS_VOLUME) {
            layout.barmode = 'group';
        }

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];

            // Prepare Candlestick data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            const row = Math.floor(idx / nCols) + 1;
            const col = (idx % nCols) + 1;
            const xaxis = idx === 0 ? 'x' : 'x' + (idx + 1);
            const yaxis = idx === 0 ? 'y' : 'y' + (idx + 1);

            // Candlestick trace
            const candlestickTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: xaxis,
                yaxis: yaxis
            };
            traces.push(candlestickTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const yaxis_vol = idx === 0 ? 'y' + (nSymbols + 1) : 'y' + (nSymbols + idx + 1);

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: xaxis,
                    yaxis: yaxis_vol,
                    showlegend: false
                };
                traces.push(volumeTrace);

                // Configure volume yaxis
                layout[yaxis_vol] = {
                    title: row === nRows ? (logVolume ? 'log(Vol)' : 'Vol') : '',
                    anchor: xaxis
                };
            }

            // Add axis configuration
            layout[xaxis] = {
                title: row === nRows ? TIME_FROM_COL : '',
                anchor: yaxis
            };
            layout[yaxis] = {
                title: col === 1 ? (renormalize ? 'Norm Price' : 'Price') : '',
                anchor: xaxis
            };

            // Add annotation for symbol label
            if (!layout.annotations) layout.annotations = [];
            layout.annotations.push({
                text: symbol,
                showarrow: false,
                xref: xaxis === 'x' ? 'x domain' : xaxis + ' domain',
                yref: yaxis === 'y' ? 'y domain' : yaxis + ' domain',
                x: 0.5,
                y: 1.05,
                xanchor: 'center',
                yanchor: 'bottom',
                font: {size: 10}
            });
        });

        Plotly.newPlot('example3_candlestick', traces, layout, {responsive: true});
    }

    // Load and parse CSV data using centralized parser
    loadDataset('company_data').then(function(data) {
        allData = data;
        window.updateChart_example3_candlestick();

        // Setup aspect ratio control after initial render
        setupAspectRatioControl('example3_candlestick');
    }).catch(function(error) {
        console.error('Error loading data for chart example3_candlestick:', error);
    });
})();


});
</script>

<!-- DATASETS -->

<script type="text/plain" id="company_data" data-format="csv_embedded" data-src="">
quarter,quarter_end,company,open_price,high_price,low_price,close_price
1,1,CompanyA,64.258808431386,66.24550692925885,61.38220769786896,64.42488015250927
2,2,CompanyA,69.3139934126625,71.75206745232964,66.56582612408941,69.59925184788501
3,3,CompanyA,73.51599352618118,76.17897517075262,69.9415214630679,72.30333062207681
4,4,CompanyA,73.39455905011728,76.35681497901717,70.18947054189174,72.42576519240343
5,5,CompanyA,72.46140863263808,72.65115422340689,69.63361058328402,72.27370017290599
6,6,CompanyA,69.22892820568374,70.17874344668228,68.14048963616125,68.14048963616125
7,7,CompanyA,67.63823927103248,71.11654598623883,64.72839330415673,66.451621884621
8,8,CompanyA,73.16178573105174,76.91209599064554,70.86734208939946,73.79512571325598
9,9,CompanyA,73.86243632752846,76.91155891468945,70.71425587029199,73.88947725068348
10,10,CompanyA,77.1081342820303,80.56982687962088,74.70338949586295,77.230219841726
11,11,CompanyA,81.10186182382839,82.49946740696261,80.00164510629556,82.49946740696261
12,12,CompanyA,82.96273185911276,86.67932594150581,81.5569854650235,85.65777283554657
1,1,CompanyB,101.87584564411144,104.1197612264277,99.58521981278825,103.8795392636442
2,2,CompanyB,104.10928452721045,104.94440007189813,100.42502925688169,104.48007280895277
3,3,CompanyB,99.06724056401923,102.70155583869656,97.43437540086111,97.5161377556493
4,4,CompanyB,101.72987835175854,105.43932236341463,98.61706880221543,103.26819797359596
5,5,CompanyB,104.05139130296405,106.3865527164751,100.68237386034706,106.3865527164751
6,6,CompanyB,100.1822008368739,100.63611979871864,97.11153060664257,99.09141591152594
7,7,CompanyB,96.24912976193673,96.49644349915762,93.08052322042604,95.08788278177363
8,8,CompanyB,95.60452365084015,98.37233577503986,94.001384755193,94.58761502539159
9,9,CompanyB,93.60867157200605,96.12435573365893,91.79032653540357,92.72945232641004
10,10,CompanyB,88.61046437811878,90.74278085297085,85.34483104698376,87.65357465207187
11,11,CompanyB,86.50016559921822,87.69310992427111,82.98145789330684,86.83862940084492
12,12,CompanyB,87.8383237451574,90.50563415106517,86.13886732855087,87.82035826366898

</script><script type="text/plain" id="stock_data_1" data-format="csv_embedded" data-src="">
time_from,time_to,symbol,open,high,low,close,volume
2024-01-01,2024-01-01,AAPL,149.57386341732513,153.6031302486237,147.75896531485236,150.09273338953463,4502847
2024-01-02,2024-01-02,AAPL,149.94612520384192,152.7769320048648,149.94612520384192,151.50826391009906,4879386
2024-01-03,2024-01-03,AAPL,151.29948554214442,154.04223020806933,149.051860615221,150.76779266505548,1233655
2024-01-04,2024-01-04,AAPL,151.36563613119543,154.9866595762605,148.12171557589144,152.2325026654127,1461667
2024-01-05,2024-01-05,AAPL,149.95615436208553,155.24671683907246,148.6617536077511,151.99780404714147,2710991
2024-01-06,2024-01-06,AAPL,149.14196410330902,157.45536047778683,149.07174866888573,149.8616513748373,3073776
2024-01-07,2024-01-07,AAPL,148.9852493627151,152.60898773781344,145.6887454930564,148.89283632153177,4076291
2024-01-08,2024-01-08,AAPL,149.06656424246714,152.8680244912756,146.28085824582064,148.34942748387715,4310426
2024-01-09,2024-01-09,AAPL,149.27506940944085,149.63649124492295,146.705221434624,149.56373555786303,1608010
2024-01-10,2024-01-10,AAPL,149.77229604751403,151.7604710014699,148.3762848800064,148.9278571635574,1234680
2024-01-11,2024-01-11,AAPL,151.91486461658735,151.91486461658735,146.93836608319597,146.93836608319597,2421929
2024-01-12,2024-01-12,AAPL,149.94059721281445,152.55717995522076,147.55124071957246,150.18081803181684,2202391
2024-01-13,2024-01-13,AAPL,148.639079257672,155.17962119774353,144.48129495365959,147.16034679415142,3183048
2024-01-14,2024-01-14,AAPL,151.3291666522371,151.74145242518392,146.25010758541126,149.06612788276868,4944686
2024-01-15,2024-01-15,AAPL,151.2713850580379,151.2713850580379,143.89388177039476,145.86585066974502,2778375
2024-01-16,2024-01-16,AAPL,150.39109239223149,152.59861189080488,146.4990551269538,147.1514593129592,2369164
2024-01-17,2024-01-17,AAPL,149.70811948678468,150.19821564291365,147.04217684516343,147.4896378859546,3662004
2024-01-18,2024-01-18,AAPL,150.79139024134872,150.79139024134872,146.83553332037522,147.65262313168216,1815493
2024-01-19,2024-01-19,AAPL,150.38144641223133,150.38144641223133,146.19825054568682,147.24801289172981,2189063
2024-01-20,2024-01-20,AAPL,148.89362822324784,149.04418191828302,143.9348740042067,148.95804272398607,3888562
2024-01-21,2024-01-21,AAPL,148.12615260569999,152.6107387815351,143.8380389585588,152.6107387815351,3812792
2024-01-22,2024-01-22,AAPL,147.84600194140282,151.44834258008987,146.91648844457978,151.44834258008987,4491919
2024-01-23,2024-01-23,AAPL,146.39088628268692,151.78970746272208,146.39088628268692,151.78970746272208,2380277
2024-01-24,2024-01-24,AAPL,147.55995128469937,151.65890768587965,147.55995128469937,151.65890768587965,3081647
2024-01-25,2024-01-25,AAPL,147.73302610335548,152.34607428305418,143.86043589631944,152.34607428305418,4398716
2024-01-26,2024-01-26,AAPL,147.30351689112786,150.56533000488102,147.30351689112786,149.09874290520025,3624550
2024-01-27,2024-01-27,AAPL,147.4272007717172,150.01101886149218,145.30680364853143,150.01101886149218,2906148
2024-01-28,2024-01-28,AAPL,147.11832934652887,151.16494928836113,145.578360103475,151.16494928836113,1923504
2024-01-29,2024-01-29,AAPL,147.89022343040307,152.63635107275732,145.76858514228803,148.90294387617826,4963780
2024-01-30,2024-01-30,AAPL,149.25104871851778,152.9827742965905,145.70854081638373,150.419557848823,2929838
2024-01-31,2024-01-31,AAPL,149.08742314318948,152.42158327611384,144.82215031927294,148.67154686383478,1244809
2024-02-01,2024-02-01,AAPL,149.78981430547898,154.07393770542524,148.345820115163,149.97415594997048,3659522
2024-02-02,2024-02-02,AAPL,148.77429822705145,153.44773550323796,143.52387086261407,148.25146297629752,1167788
2024-02-03,2024-02-03,AAPL,149.8470061736999,151.8973260591348,144.9497679439099,148.64413872682664,1977930
2024-02-04,2024-02-04,AAPL,151.08476814199557,152.0156188251652,146.21363837874648,150.14997434587826,2997995
2024-02-05,2024-02-05,AAPL,150.49213712194765,156.6268468506578,143.0111074578589,149.12557353504096,1196953
2024-02-06,2024-02-06,AAPL,150.42187231298712,153.06267552588307,143.13549437337252,149.4030778731654,2257720
2024-02-07,2024-02-07,AAPL,151.1887090276474,151.7835321285319,145.5695224873583,149.88191516200303,2967595
2024-02-08,2024-02-08,AAPL,151.1608218760607,154.5818645078268,146.27152258289433,149.40855380155222,1680616
2024-02-09,2024-02-09,AAPL,151.6833731094565,153.24994162475863,144.08772008500506,147.50113309845375,4517739
2024-02-10,2024-02-10,AAPL,151.9238496648537,155.86742706275356,143.34245880958466,147.5852504562811,2379019
2024-02-11,2024-02-11,AAPL,152.22635113678226,155.26676169237047,143.08834548964745,143.08834548964745,4125788
2024-02-12,2024-02-12,AAPL,153.03355251153818,153.45848950138023,141.27665987812458,143.66771856498917,1601550
2024-02-13,2024-02-13,AAPL,152.81832068577353,155.56425671938112,144.3614207274863,144.3614207274863,1868457
2024-02-14,2024-02-14,AAPL,154.6573819226355,154.6573819226355,143.3855661532754,144.81975493299862,4920214
2024-02-15,2024-02-15,AAPL,154.7475036593001,154.7475036593001,142.3285965407972,146.23974472296504,2823988
2024-02-16,2024-02-16,AAPL,154.71745087286212,154.71745087286212,141.54025589446354,146.42956292743065,2332149
2024-02-17,2024-02-17,AAPL,153.86747149144927,154.1546573199319,142.52564316997248,143.78167487246913,2000961
2024-02-18,2024-02-18,AAPL,153.55748494887368,153.55748494887368,140.3303631208578,146.67358247519985,1700936
2024-02-19,2024-02-19,AAPL,153.24941273930312,153.24941273930312,140.7859689808788,144.60951793359328,2692784
2024-02-20,2024-02-20,AAPL,152.99636369096493,154.60749602641843,138.42552915581868,146.10764096002174,2089044
2024-02-21,2024-02-21,AAPL,153.65991746615492,153.65991746615492,140.77178303827722,144.35816927780144,4706154
2024-02-22,2024-02-22,AAPL,153.4506482239889,153.4506482239889,142.85765069898153,145.66152126114042,4952175
2024-02-23,2024-02-23,AAPL,153.24173546562017,153.24173546562017,140.76295483822835,144.09945160782556,2239382
2024-02-24,2024-02-24,AAPL,154.19256185932335,155.50753630207183,142.8918802287579,144.3709341716962,3371259
2024-02-25,2024-02-25,AAPL,153.30994297691095,153.49877530679007,141.76629051999782,142.94671292992822,1112451
2024-02-26,2024-02-26,AAPL,154.82464039110107,154.82464039110107,141.10761733014965,141.10761733014965,2216316
2024-02-27,2024-02-27,AAPL,155.67033221471522,155.67033221471522,142.3874977067548,145.6104433557549,3047144
2024-02-28,2024-02-28,AAPL,155.760490425297,155.760490425297,140.8488458978132,147.05467435338628,3201595
2024-02-29,2024-02-29,AAPL,156.9471471753395,156.9471471753395,141.45715298322983,146.3104352529575,2759106
2024-03-01,2024-03-01,AAPL,158.67289601632476,158.67289601632476,138.35608707123853,144.90186466734085,3726764
2024-03-02,2024-03-02,AAPL,159.4881339169395,159.4881339169395,138.23556576173988,145.33168467761865,4148876
2024-03-03,2024-03-03,AAPL,159.64217892597134,159.64217892597134,140.84041973894725,148.53249148388736,3210070
2024-03-04,2024-03-04,AAPL,159.91995213185166,159.91995213185166,141.8345950306918,148.57607900161005,1358956
2024-03-05,2024-03-05,AAPL,159.65382687074728,159.65382687074728,142.83579444864122,148.03660270100184,3406123
2024-03-06,2024-03-06,AAPL,159.75875151514435,159.75875151514435,143.7278716313337,149.57926167479908,1641733
2024-03-07,2024-03-07,AAPL,161.0904838833368,161.0904838833368,144.03466980753572,147.93471167997032,2374341
2024-03-08,2024-03-08,AAPL,160.22720116537985,160.22720116537985,140.01537030512426,148.15638650894056,3141601
2024-03-09,2024-03-09,AAPL,159.1271417414488,159.1271417414488,139.56485154640671,149.5529782078304,2247064
2024-03-10,2024-03-10,AAPL,156.7719066187454,156.7719066187454,137.5319269456805,151.52574927198233,3252916
2024-03-11,2024-03-11,AAPL,158.82623107074434,158.82623107074434,139.44761734360932,149.159219554387,2408084
2024-03-12,2024-03-12,AAPL,160.17851029647645,160.17851029647645,141.71981509868877,149.73587522556292,2601581
2024-03-13,2024-03-13,AAPL,157.69492587240444,157.69492587240444,141.67112443842552,151.1885028046241,4496077
2024-03-14,2024-03-14,AAPL,158.07973950445898,158.07973950445898,141.05551176351707,149.47146991874203,1092959
2024-03-15,2024-03-15,AAPL,157.73627585642222,157.73627585642222,141.03005955603038,149.7959256108109,3069152
2024-03-16,2024-03-16,AAPL,160.13551836348566,160.13551836348566,138.64787122402603,148.21806382437916,2713017
2024-03-17,2024-03-17,AAPL,161.60450446912398,161.60450446912398,140.54916300779107,148.7633959175271,3740212
2024-03-18,2024-03-18,AAPL,160.95301886039678,160.95301886039678,139.55949432928819,152.02294060727615,3969661
2024-03-19,2024-03-19,AAPL,161.06656071973228,161.06656071973228,141.2527555209094,152.1557969420859,4097952
2024-03-20,2024-03-20,AAPL,159.49776779297497,159.49776779297497,144.07639021541644,152.43077429507954,3440474
2024-03-21,2024-03-21,AAPL,159.40067128299577,159.40067128299577,140.89649438939273,149.10737044569484,3557914
2024-03-22,2024-03-22,AAPL,159.1517685815943,159.1517685815943,140.7862230014078,150.93744102485874,2105384
2024-03-23,2024-03-23,AAPL,159.29852749966867,159.29852749966867,141.25837038401394,152.23175330539246,2980237
2024-03-24,2024-03-24,AAPL,159.09815674302888,159.09815674302888,141.56033310657403,151.27807455057953,1791465
2024-03-25,2024-03-25,AAPL,158.09751646393224,158.09751646393224,143.77519975459936,152.79898018649624,4626717
2024-03-26,2024-03-26,AAPL,160.2888977277711,160.2888977277711,144.77543242047918,149.59243506785734,2948255
2024-03-27,2024-03-27,AAPL,160.37630574824874,160.37630574824874,144.72631394620188,150.3772893388386,4268642
2024-03-28,2024-03-28,AAPL,161.59794654401483,161.59794654401483,144.4303315002586,151.19728678832496,4531561
2024-03-29,2024-03-29,AAPL,160.72279171054174,160.72279171054174,142.67893260074436,151.97254755096608,1488031
2024-03-30,2024-03-30,AAPL,160.14238137237783,160.14238137237783,137.37565587055732,152.36483619033027,2356553
2024-03-31,2024-03-31,AAPL,158.89829657891622,158.89829657891622,139.07259220621617,152.71422310184357,1219132

</script><script type="text/plain" id="stock_data_2" data-format="csv_embedded" data-src="">
time_from,time_to,symbol,open,high,low,close,volume
2024-01-01,2024-01-01,AAPL,153.46688845655322,155.7301504628656,152.39226122265939,154.06484741805667,4968238
2024-01-02,2024-01-02,AAPL,152.02354482800632,154.498089505254,151.925942625966,153.2423675663679,2451084
2024-01-03,2024-01-03,AAPL,151.94253754596505,155.12319378227474,151.83022286758688,152.15226960017614,4861579
2024-01-04,2024-01-04,AAPL,154.71711750036852,157.08311682190447,153.13167769438746,153.13167769438746,3769849
2024-01-05,2024-01-05,AAPL,149.66653799544784,153.9548801370683,147.18324711320903,148.7117581805985,4173088
2024-01-06,2024-01-06,AAPL,147.71372553975908,148.08011459145,146.1627799808531,146.1627799808531,1448564
2024-01-07,2024-01-07,AAPL,148.52686126912974,151.11381641130214,143.82482543032336,148.50445940015203,2976711
2024-01-08,2024-01-08,AAPL,147.3511546853145,148.47717383088178,145.11904755424183,147.46459523845394,3548616
2024-01-09,2024-01-09,AAPL,142.8532130682601,147.0908650175132,141.63940897035832,143.48155251521212,3715097
2024-01-10,2024-01-10,AAPL,147.25564604506084,150.11217123539154,146.01837357814782,146.5375613338393,2163885
2024-01-11,2024-01-11,AAPL,145.8304354507251,149.24393477404666,144.78932724314143,145.91905852196228,1208815
2024-01-12,2024-01-12,AAPL,145.76478411552762,148.45431253216876,140.86381967406012,145.62803504183816,2878193
2024-01-13,2024-01-13,AAPL,145.71378333035832,148.38916524156753,143.72125625900085,147.11475910129934,3082175
2024-01-14,2024-01-14,AAPL,142.93173193245985,145.83047621880553,138.47499259343394,143.1668261210427,4694514
2024-01-15,2024-01-15,AAPL,143.61198687445335,146.24468139854667,141.25711744402986,145.25744503076464,2075717
2024-01-16,2024-01-16,AAPL,147.90290163282899,150.21270370375314,143.57497368016274,147.53844715379242,2267892
2024-01-17,2024-01-17,AAPL,148.3730564767269,152.57418744664201,145.88286321725258,148.24400991003643,4412604
2024-01-18,2024-01-18,AAPL,148.28275029393686,150.32358413488672,144.8955446137666,147.42795176014099,2275697
2024-01-19,2024-01-19,AAPL,148.85849513252938,151.81128840567547,145.99450753993298,149.6841798407266,1706872
2024-01-20,2024-01-20,AAPL,153.23922592866998,154.2376992798328,152.5355096351433,153.45775537826634,1439782
2024-01-21,2024-01-21,AAPL,155.4617740625424,157.3677858765986,152.99389231892422,155.4236022370059,3330108
2024-01-22,2024-01-22,AAPL,158.279861505667,158.6450091879551,153.3519585280651,158.6450091879551,3936518
2024-01-23,2024-01-23,AAPL,158.0094618865162,162.92464831768808,155.25690870800233,157.41622070523894,3230902
2024-01-24,2024-01-24,AAPL,156.68766864266664,161.01491352595707,151.8230473171696,157.6387974151201,3636723
2024-01-25,2024-01-25,AAPL,154.39502210989465,157.13708384227044,153.02721891180494,153.97952739039928,4932442
2024-01-26,2024-01-26,AAPL,153.8537567363964,158.63404253542558,151.29371777549807,154.12738678893155,1577023
2024-01-27,2024-01-27,AAPL,148.7749851133746,151.11514803665338,148.57059277899393,148.63409395643927,3450824
2024-01-28,2024-01-28,AAPL,148.1741419851226,152.4808017850695,144.30718276634389,148.8050856861183,1253817
2024-01-29,2024-01-29,AAPL,146.86967810759157,150.6642756319757,146.83818251679327,147.76728242162096,1883979
2024-01-30,2024-01-30,AAPL,146.94808435277722,148.14950121540767,146.13979431410567,146.79098248524448,1620089
2024-01-31,2024-01-31,AAPL,146.8476980218939,149.6780030789503,143.98814757129654,147.52936019529315,4230034
2024-02-01,2024-02-01,AAPL,148.35036513320404,151.4551883172624,143.48056660710176,149.79400805420704,2940920
2024-02-02,2024-02-02,AAPL,151.6425739399449,152.38182985731703,149.7188069198671,149.7188069198671,3075829
2024-02-03,2024-02-03,AAPL,153.294409473327,155.28755912310817,150.6204414482189,153.0441573572813,3592185
2024-02-04,2024-02-04,AAPL,152.0694681798829,156.92353802899044,151.52183139609798,153.29467928650422,3564914
2024-02-05,2024-02-05,AAPL,150.9489779346196,152.57977816667326,149.7459278848991,152.1516386627215,3692968
2024-02-06,2024-02-06,AAPL,147.02012927958168,150.43521543538836,144.33146941593398,146.85826936161925,3198094
2024-02-07,2024-02-07,AAPL,144.16522916331718,146.93695653442032,141.85419950457444,144.7778238053586,2267381
2024-02-08,2024-02-08,AAPL,143.47596491872736,146.78530471537084,139.22420042767084,141.98417520494772,4173582
2024-02-09,2024-02-09,AAPL,144.31452443232317,145.2842185885861,143.03519587055004,143.10351179922483,2998136
2024-02-10,2024-02-10,AAPL,143.10646267360687,144.34993014037468,139.58396689915534,144.34993014037468,1572327
2024-02-11,2024-02-11,AAPL,141.09515328570183,142.50015962899025,139.94453942311682,141.02595625635485,1251616
2024-02-12,2024-02-12,AAPL,143.67328682564317,147.04786095857244,142.9789708098444,142.9789708098444,1498618
2024-02-13,2024-02-13,AAPL,140.62507560419152,142.80748465752603,140.49199869519705,141.6288884058426,4627892
2024-02-14,2024-02-14,AAPL,138.38127615115536,143.34349110486514,135.19467660551177,138.7124517757335,3808078
2024-02-15,2024-02-15,AAPL,135.64220978404828,137.2529085191484,132.48899221248828,135.4963248229369,2442794
2024-02-16,2024-02-16,AAPL,133.95091480155017,136.01677470027005,132.99101760789017,134.77550416968978,2272788
2024-02-17,2024-02-17,AAPL,133.26624767948934,135.56948894710243,130.8695275229398,132.68155211353638,1234192
2024-02-18,2024-02-18,AAPL,137.74699659432446,137.9133236294075,133.45564875476066,137.7917520742229,4500876
2024-02-19,2024-02-19,AAPL,137.28264481810157,140.32969421509964,135.77206787222542,137.27637534037595,4193255
2024-02-20,2024-02-20,AAPL,136.5536172645324,139.75037063624774,132.4878881662123,136.0647760435447,4990872
2024-02-21,2024-02-21,AAPL,135.05178550559262,139.99781614136404,134.89462658232043,135.45376128028622,2055198
2024-02-22,2024-02-22,AAPL,132.56611453082934,134.22802401387432,131.82747602827246,134.22802401387432,1518977
2024-02-23,2024-02-23,AAPL,134.62036325350013,136.3651670663124,132.79780900719936,135.61161040539687,1596741
2024-02-24,2024-02-24,AAPL,131.74296697423344,136.33300289459484,130.23637711286196,132.54745743026498,4176937
2024-02-25,2024-02-25,AAPL,134.5316815305898,135.8153505059624,133.7975686405302,134.79088545812343,3766416
2024-02-26,2024-02-26,AAPL,135.14658668591764,137.31082939597854,132.38718793636377,134.33512550614296,4710781
2024-02-27,2024-02-27,AAPL,137.06278769006184,137.596481521437,134.08079503139393,136.61712660084507,3522327
2024-02-28,2024-02-28,AAPL,140.12121787637608,141.9585525183057,138.14744054610233,140.1707328646423,3143547
2024-02-29,2024-02-29,AAPL,140.2028780371667,141.2176524554968,139.16422297235846,141.2176524554968,4687278
2024-01-01,2024-01-01,GOOGL,2803.0175178999943,2804.1471054576546,2802.118454005008,2804.1471054576546,3281042
2024-01-02,2024-01-02,GOOGL,2798.3604107012497,2802.1294181081075,2796.219599124089,2796.5243252896803,4581528
2024-01-03,2024-01-03,GOOGL,2797.595976456576,2798.9866396579573,2793.328678214118,2796.0218601418787,4552693
2024-01-04,2024-01-04,GOOGL,2796.886208392157,2800.562010520681,2796.6905972016525,2796.6905972016525,4140038
2024-01-05,2024-01-05,GOOGL,2795.872034335704,2798.1077985992692,2794.2597875143983,2796.328087864576,2611642
2024-01-06,2024-01-06,GOOGL,2790.6465120775842,2793.5929975940358,2789.4737977535215,2792.6882728996707,4940235
2024-01-07,2024-01-07,GOOGL,2790.3623177581735,2791.9473112915684,2789.6188650138397,2791.8191315956,4386067
2024-01-08,2024-01-08,GOOGL,2791.442418397535,2794.2456875096104,2787.4831676174454,2791.905481945606,2123690
2024-01-09,2024-01-09,GOOGL,2791.403375534069,2795.221419264072,2788.3627303666935,2791.180008771484,4332123
2024-01-10,2024-01-10,GOOGL,2790.541978866926,2793.4148325307965,2788.004836816564,2790.4301170661533,1539263
2024-01-11,2024-01-11,GOOGL,2787.214222229459,2791.3396654079866,2785.02344210872,2787.8534216700436,1078959
2024-01-12,2024-01-12,GOOGL,2785.1186253780684,2789.451316745732,2783.7554999662907,2784.7633934708583,2020605
2024-01-13,2024-01-13,GOOGL,2787.6606658534374,2789.553983108713,2784.2261258796493,2788.144677061727,1513262
2024-01-14,2024-01-14,GOOGL,2788.2717468687647,2790.8711978839156,2785.992626102672,2789.3434028468496,1153838
2024-01-15,2024-01-15,GOOGL,2788.790340870836,2789.478354621567,2788.34393657985,2788.84673899378,3983532
2024-01-16,2024-01-16,GOOGL,2789.776292532694,2794.4978864708846,2788.0899790871918,2789.0941478802006,4441290
2024-01-17,2024-01-17,GOOGL,2789.709965937548,2790.829158306234,2785.6374368557867,2789.1821953361386,4654317
2024-01-18,2024-01-18,GOOGL,2790.025728266876,2791.622362397239,2787.8514633735085,2789.1642515940384,4777057
2024-01-19,2024-01-19,GOOGL,2787.655603884582,2790.518717293435,2783.531630100543,2785.6252908029937,4154064
2024-01-20,2024-01-20,GOOGL,2785.9929708253508,2786.9214388015325,2781.970101657277,2784.980795494793,4027980
2024-01-21,2024-01-21,GOOGL,2783.80138764115,2786.8341020577673,2780.2349267133236,2784.582994234689,1881595
2024-01-22,2024-01-22,GOOGL,2782.7203023803313,2785.830913483479,2780.640696351371,2782.3738122120703,2944874
2024-01-23,2024-01-23,GOOGL,2784.8353145935594,2785.191691285542,2781.6615690866192,2783.3586500632564,4566389
2024-01-24,2024-01-24,GOOGL,2784.649609104065,2787.9755661823515,2780.1427781793836,2784.5339366770154,3432965
2024-01-25,2024-01-25,GOOGL,2782.07300921305,2786.7191655791826,2780.4416765077663,2782.832193206545,1039380
2024-01-26,2024-01-26,GOOGL,2779.3563341207982,2779.627081141191,2777.688474011558,2779.1615217018852,4758790
2024-01-27,2024-01-27,GOOGL,2775.5866704623445,2777.9345019476054,2774.459389263236,2775.063582694091,3497798
2024-01-28,2024-01-28,GOOGL,2776.526185762231,2778.5500918286643,2775.186088298532,2775.625419118646,1537147
2024-01-29,2024-01-29,GOOGL,2778.7262180892903,2783.3699416602176,2778.2125574164697,2778.2125574164697,1001124
2024-01-30,2024-01-30,GOOGL,2776.7087570618605,2779.2466325925666,2773.4114360333933,2776.7680253812314,2114753
2024-01-31,2024-01-31,GOOGL,2774.338115315755,2775.7299648467388,2773.6155924991776,2775.7299648467388,4802577
2024-02-01,2024-02-01,GOOGL,2772.115950444117,2776.393531247314,2768.665187463482,2771.555251687049,3665187
2024-02-02,2024-02-02,GOOGL,2773.5778799125765,2776.159348240042,2769.6499345495154,2774.3233954985985,2063653
2024-02-03,2024-02-03,GOOGL,2771.4195436982827,2775.8188126621008,2769.491868085441,2770.33133898271,2099894
2024-02-04,2024-02-04,GOOGL,2774.756100954684,2778.43970239017,2773.069369958284,2774.6171688265654,1574435
2024-02-05,2024-02-05,GOOGL,2776.7861309342743,2779.4344241435438,2775.746832359725,2777.2560083692742,2533859
2024-02-06,2024-02-06,GOOGL,2778.892519852284,2779.88573896399,2777.685314794284,2778.800979960296,3962843
2024-02-07,2024-02-07,GOOGL,2780.006786999616,2782.1527506412826,2778.3481781117102,2780.802079502347,3005733
2024-02-08,2024-02-08,GOOGL,2781.9072051742965,2786.766245596482,2779.59789855593,2782.0776303418106,2596081
2024-02-09,2024-02-09,GOOGL,2784.2378065420653,2789.1529492405857,2782.6011840345163,2782.6011840345163,3507357
2024-02-10,2024-02-10,GOOGL,2784.2105819263797,2788.535673076309,2782.839158918181,2782.839158918181,3623221
2024-02-11,2024-02-11,GOOGL,2785.9136420246696,2788.628705848845,2781.2180375458074,2786.2337023042414,4155609
2024-02-12,2024-02-12,GOOGL,2786.831313670844,2788.3485027756433,2786.3378897981984,2787.1143351931996,2529203
2024-02-13,2024-02-13,GOOGL,2784.9148645370715,2788.1630263427733,2783.265166735162,2784.380356189409,1449522
2024-02-14,2024-02-14,GOOGL,2785.2121341552,2786.7680212752034,2782.2105653855965,2785.997007094932,4856148
2024-02-15,2024-02-15,GOOGL,2788.496983456971,2788.7306620281797,2784.051274725837,2788.7306620281797,4835165
2024-02-16,2024-02-16,GOOGL,2787.6314313385187,2788.190961381833,2787.2181367635176,2787.794808356248,2369909
2024-02-17,2024-02-17,GOOGL,2787.1889083342985,2789.8824052340583,2785.2509138828364,2787.2206678982334,1698441
2024-02-18,2024-02-18,GOOGL,2785.7934116015736,2787.6962879291395,2782.3788637446846,2786.9055678946797,1194774
2024-02-19,2024-02-19,GOOGL,2789.923988397118,2794.2060897284696,2787.752741017254,2789.1329096277314,4121738
2024-02-20,2024-02-20,GOOGL,2785.4532873153144,2786.9366814332625,2781.1911745195193,2785.704724427551,4891557
2024-02-21,2024-02-21,GOOGL,2787.2986214250627,2790.369545866747,2783.381656454392,2786.987712751702,3720330
2024-02-22,2024-02-22,GOOGL,2785.3110631752015,2789.2136877545618,2781.7132224768907,2787.3006267574247,1870278
2024-02-23,2024-02-23,GOOGL,2784.898203604649,2788.908968702228,2784.157151962161,2784.249406237102,3678669
2024-02-24,2024-02-24,GOOGL,2785.5565339376867,2789.2676352621597,2781.762817480777,2784.8139628474246,2004461
2024-02-25,2024-02-25,GOOGL,2786.075487104566,2790.790883587264,2782.5135982457186,2785.58547285563,4994001
2024-02-26,2024-02-26,GOOGL,2784.1090750744934,2788.713588555185,2779.9085249889154,2783.6009496632273,1282970
2024-02-27,2024-02-27,GOOGL,2785.437128705718,2787.3686549174595,2783.466852680201,2784.4613060919787,4176418
2024-02-28,2024-02-28,GOOGL,2788.6128596621884,2789.1490329267576,2784.531856335001,2786.5048331047283,3612198
2024-02-29,2024-02-29,GOOGL,2787.7867493703766,2792.4093611793032,2783.2576668325114,2788.7833771985893,4966519
2024-01-01,2024-01-01,MSFT,375.5418382871272,378.2976869481791,373.75373013188886,375.36911712932067,1302535
2024-01-02,2024-01-02,MSFT,375.1243154326423,377.8173808125285,372.40437045625407,374.7616415332223,2129351
2024-01-03,2024-01-03,MSFT,377.6608146081042,379.5300179986545,375.0226662576681,379.5300179986545,1701568
2024-01-04,2024-01-04,MSFT,377.8719132587325,382.4880607291245,377.34115564059186,377.7309998142465,3847352
2024-01-05,2024-01-05,MSFT,376.803094248773,377.20368911594863,372.38489440971796,376.9834563190332,4026421
2024-01-06,2024-01-06,MSFT,374.8917885167905,378.7889371511499,371.2149927721331,373.5975238808635,2407491
2024-01-07,2024-01-07,MSFT,374.7894305000593,374.9113504101644,370.37663492865295,374.14022415393475,1888907
2024-01-08,2024-01-08,MSFT,380.26684790561626,383.6328996989299,375.6225638578232,380.3122856156626,4528551
2024-01-09,2024-01-09,MSFT,381.9059543822591,386.57449310468496,379.2820411138401,382.3745766397518,4493516
2024-01-10,2024-01-10,MSFT,382.26738899487964,386.4172264270775,381.0199237311273,382.6866248400835,2071346
2024-01-11,2024-01-11,MSFT,381.7525974442336,384.80698133179646,380.32627704890564,380.32627704890564,4328551
2024-01-12,2024-01-12,MSFT,384.93753181405185,387.98297806135776,380.7475771562155,385.50477866203454,2467999
2024-01-13,2024-01-13,MSFT,384.40890849590016,386.5141971314782,380.84454149423385,383.108160394009,1822538
2024-01-14,2024-01-14,MSFT,382.0902592256154,384.84188835230304,380.3062774727502,383.0735931335435,2812706
2024-01-15,2024-01-15,MSFT,385.24107727552416,389.3630412748415,381.00050042042415,385.43612932831877,1768112
2024-01-16,2024-01-16,MSFT,386.1553908128883,387.63724727296096,381.758954321666,387.16087525420386,2334710
2024-01-17,2024-01-17,MSFT,386.4633457456858,390.16300407803,385.7092855402176,387.8724841842395,4619480
2024-01-18,2024-01-18,MSFT,386.74976642781485,390.375066260272,385.3961540905369,385.3961540905369,4935167
2024-01-19,2024-01-19,MSFT,384.9311867170893,384.939208442537,383.5001000286613,384.0640454863211,4222276
2024-01-20,2024-01-20,MSFT,384.3886839933562,386.2254482975486,379.96801863507756,386.2254482975486,1634433
2024-01-21,2024-01-21,MSFT,383.6643273548987,388.55655059480284,381.36495926126116,382.0597936983423,1507098
2024-01-22,2024-01-22,MSFT,382.24369022837436,386.07788340336083,379.5065587103684,382.32697479370114,1032638
2024-01-23,2024-01-23,MSFT,382.28635532615976,386.83953021089496,381.0176955296927,382.1235181781075,2434840
2024-01-24,2024-01-24,MSFT,379.5996192208854,381.8837181604789,374.96117731986857,380.63937956144184,3086553
2024-01-25,2024-01-25,MSFT,381.34724673487113,385.40452762582873,379.4790068291399,381.78947906090025,2398014
2024-01-26,2024-01-26,MSFT,383.82707475517793,384.16533123180847,379.07920012038574,383.3208542318384,1451555
2024-01-27,2024-01-27,MSFT,381.02600022190984,383.98205722109907,376.9729605998231,381.7120096912048,2733108
2024-01-28,2024-01-28,MSFT,382.7304030831981,384.23107529741907,379.7866455407376,383.85038578552343,3531273
2024-01-29,2024-01-29,MSFT,384.95382738921575,387.7072528957907,382.4758608541644,384.0441260970709,4557963
2024-01-30,2024-01-30,MSFT,387.19961214302765,391.2029650390523,385.166555296795,386.43869539636177,2460688
2024-01-31,2024-01-31,MSFT,386.62231088012373,389.52959479450453,385.24921864394815,385.24921864394815,2058632
2024-02-01,2024-02-01,MSFT,386.4519624664944,390.1215346920919,384.6415632788644,385.91687582338244,2495759
2024-02-02,2024-02-02,MSFT,385.6288677675937,387.7487622422268,382.2340790773208,383.73137664240943,1934775
2024-02-03,2024-02-03,MSFT,383.37167753674686,384.33955201346436,380.49223769825574,384.33955201346436,4151766
2024-02-04,2024-02-04,MSFT,379.76476856790003,381.0426433244511,379.2878677142212,380.28321343831124,2085746
2024-02-05,2024-02-05,MSFT,381.3150056601396,385.39354294747193,380.10187566114143,382.0433208399987,2681494
2024-02-06,2024-02-06,MSFT,379.7793516014237,380.8624918740282,376.37345836488606,380.66804734902206,2943832
2024-02-07,2024-02-07,MSFT,381.4012918622155,382.14225392700394,378.28131797304366,380.2233979153859,3032892
2024-02-08,2024-02-08,MSFT,381.320071183364,384.52857077359886,379.1429474201169,381.2323986080533,1251192
2024-02-09,2024-02-09,MSFT,378.501025294852,382.0020693686889,375.83703897534315,377.3643806846723,4699490
2024-02-10,2024-02-10,MSFT,377.1175703352892,378.5883231684257,375.40228250620936,377.355318447968,4069236
2024-02-11,2024-02-11,MSFT,377.52794914152986,378.3522583798759,374.9029714777756,376.7585588569189,2608484
2024-02-12,2024-02-12,MSFT,377.6121210456659,379.0602184076534,374.1506980711462,379.0602184076534,3175299
2024-02-13,2024-02-13,MSFT,374.7920912225576,377.00707797687505,373.00450997605714,373.00450997605714,4044580
2024-02-14,2024-02-14,MSFT,375.6411254163385,379.484819753104,370.9590621534005,375.0614492653402,3809687
2024-02-15,2024-02-15,MSFT,375.0003070247568,376.4529574533201,370.5683046061076,375.1340143747142,2328688
2024-02-16,2024-02-16,MSFT,374.6205559920563,376.1622566256314,371.988999893423,375.0470711084225,1395767
2024-02-17,2024-02-17,MSFT,374.70015210399634,377.1495533638729,374.4177308009426,375.82780627413314,4883409
2024-02-18,2024-02-18,MSFT,375.6963519156313,376.71445951118125,374.895972757563,375.4091954726165,3832937
2024-02-19,2024-02-19,MSFT,377.25997398127225,380.53429181236635,376.7199384883251,377.31212186545406,1930833
2024-02-20,2024-02-20,MSFT,377.5371750716425,381.2158168711261,372.6434023490507,376.6923054539522,4149848
2024-02-21,2024-02-21,MSFT,375.5175840693463,380.0835016865882,370.85304347718295,374.6223581971839,3257421
2024-02-22,2024-02-22,MSFT,378.5235712867459,381.7174517015123,376.6180790842914,377.425620930214,2280762
2024-02-23,2024-02-23,MSFT,378.03838155963433,379.8375363354679,376.26108226684664,379.8375363354679,2892683
2024-02-24,2024-02-24,MSFT,378.2001149970299,382.266348601594,377.04753873736365,378.1324231124908,2973097
2024-02-25,2024-02-25,MSFT,376.6975306663947,377.60119533307056,376.42424461728194,376.74062064350386,4821094
2024-02-26,2024-02-26,MSFT,373.1365412092275,375.40939051975636,369.35570348757034,371.6348165269448,1576613
2024-02-27,2024-02-27,MSFT,372.77094504415084,374.051009274749,369.51453053831415,373.00479857313053,1829107
2024-02-28,2024-02-28,MSFT,371.95089556894015,375.79841333489213,370.00835363770983,372.74317349460046,4591618
2024-02-29,2024-02-29,MSFT,373.99879317800526,374.1295092100267,371.54912988635834,373.4953370234027,2417821

</script>

<!-- ACTUAL CONTENT -->

<h1>Candlestick Chart Examples</h1>
<p></p>

<h2>Example 1: Single Stock with Volume (AAPL)</h2>
<p>Daily stock prices with volume bars. Use time sliders to zoom, toggle renormalization and volume display.</p>


<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; background-color: #f0fff0;">
    <h4 style="margin-top: 0;">Plot Attributes</h4>
            <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="chart_type_select_example1_candlestick">Chart Type: </label>
                <select id="chart_type_select_example1_candlestick" onchange="updateChart_example1_candlestick()">
                <option value="candlestick" selected>candlestick</option>
                <option value="ohlc">ohlc</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="chart_type_select_example1_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
                <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="display_mode_select_example1_candlestick">Display Mode: </label>
                <select id="display_mode_select_example1_candlestick" onchange="updateChart_example1_candlestick()">
                <option value="Overlay" selected>Overlay</option>
                <option value="Faceted">Faceted</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="display_mode_select_example1_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
            <div style="margin: 10px; display: flex; flex-direction: column;">
        <div style="margin: 5px 0;">
            <input type="checkbox" id="renormalize_checkbox_example1_candlestick" onchange="updateChart_example1_candlestick()">
            <label for="renormalize_checkbox_example1_candlestick">Renormalize (first bar open = 1)</label>
        </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="show_volume_checkbox_example1_candlestick" checked onchange="updateChart_example1_candlestick()">
        <label for="show_volume_checkbox_example1_candlestick">Show Volume</label>
    </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="log_volume_checkbox_example1_candlestick" onchange="updateChart_example1_candlestick()">
        <label for="log_volume_checkbox_example1_candlestick">Log Volume</label>
    </div>
    </div>
<div style="margin: 15px 0; padding-top: 10px; border-top: 1px solid #ddd;">
    <label for="example1_candlestick_aspect_ratio_slider">Aspect Ratio: </label>
    <span id="example1_candlestick_aspect_ratio_label">0.6</span>
    <input type="range" id="example1_candlestick_aspect_ratio_slider"
           min="-1.3862943611198906" max="0.9162907318741551" step="0.01" value="-0.5108256237659907"
           style="width: 75%; margin-left: 10px;">
    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">(0.25 - 2.5)</span>
</div>

</div>

<!-- Chart -->
<div id="example1_candlestick"></div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: stock_data_1</p><br>
<hr>
<br>
<h2>Example 2: Multiple Stocks Comparison</h2>
<p>Compare stocks with vastly different prices. Enable renormalization to see relative performance (first bar open = 1). Switch between Overlay and Faceted display modes.</p>


<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; background-color: #f0fff0;">
    <h4 style="margin-top: 0;">Plot Attributes</h4>
            <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="chart_type_select_example2_candlestick">Chart Type: </label>
                <select id="chart_type_select_example2_candlestick" onchange="updateChart_example2_candlestick()">
                <option value="candlestick" selected>candlestick</option>
                <option value="ohlc">ohlc</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="chart_type_select_example2_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
                <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="display_mode_select_example2_candlestick">Display Mode: </label>
                <select id="display_mode_select_example2_candlestick" onchange="updateChart_example2_candlestick()">
                <option value="Overlay" selected>Overlay</option>
                <option value="Faceted">Faceted</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="display_mode_select_example2_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
            <div style="margin: 10px; display: flex; flex-direction: column;">
        <div style="margin: 5px 0;">
            <input type="checkbox" id="renormalize_checkbox_example2_candlestick" onchange="updateChart_example2_candlestick()">
            <label for="renormalize_checkbox_example2_candlestick">Renormalize (first bar open = 1)</label>
        </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="show_volume_checkbox_example2_candlestick" checked onchange="updateChart_example2_candlestick()">
        <label for="show_volume_checkbox_example2_candlestick">Show Volume</label>
    </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="log_volume_checkbox_example2_candlestick" onchange="updateChart_example2_candlestick()">
        <label for="log_volume_checkbox_example2_candlestick">Log Volume</label>
    </div>
    </div>
<div style="margin: 15px 0; padding-top: 10px; border-top: 1px solid #ddd;">
    <label for="example2_candlestick_aspect_ratio_slider">Aspect Ratio: </label>
    <span id="example2_candlestick_aspect_ratio_label">0.6</span>
    <input type="range" id="example2_candlestick_aspect_ratio_slider"
           min="-1.3862943611198906" max="0.9162907318741551" step="0.01" value="-0.5108256237659907"
           style="width: 75%; margin-left: 10px;">
    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">(0.25 - 2.5)</span>
</div>

</div>

<!-- Chart -->
<div id="example2_candlestick"></div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: stock_data_2</p><br>
<hr>
<br>
<h2>Example 3: Quarterly Data Without Volume</h2>
<p>Quarterly company performance using integer time periods. No volume data. Using Candlestick bar style instead of candlesticks. Faceted display shows each company separately.</p>


<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; background-color: #f0fff0;">
    <h4 style="margin-top: 0;">Plot Attributes</h4>
            <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="chart_type_select_example3_candlestick">Chart Type: </label>
                <select id="chart_type_select_example3_candlestick" onchange="updateChart_example3_candlestick()">
                <option value="candlestick" selected>candlestick</option>
                <option value="ohlc">ohlc</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="chart_type_select_example3_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
                <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="display_mode_select_example3_candlestick">Display Mode: </label>
                <select id="display_mode_select_example3_candlestick" onchange="updateChart_example3_candlestick()">
                <option value="Overlay">Overlay</option>
                <option value="Faceted" selected>Faceted</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="display_mode_select_example3_candlestick_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
            <div style="margin: 10px; display: flex; flex-direction: column;">
        <div style="margin: 5px 0;">
            <input type="checkbox" id="renormalize_checkbox_example3_candlestick" onchange="updateChart_example3_candlestick()">
            <label for="renormalize_checkbox_example3_candlestick">Renormalize (first bar open = 1)</label>
        </div>
    </div>
<div style="margin: 15px 0; padding-top: 10px; border-top: 1px solid #ddd;">
    <label for="example3_candlestick_aspect_ratio_slider">Aspect Ratio: </label>
    <span id="example3_candlestick_aspect_ratio_label">0.6</span>
    <input type="range" id="example3_candlestick_aspect_ratio_slider"
           min="-1.3862943611198906" max="0.9162907318741551" step="0.01" value="-0.5108256237659907"
           style="width: 75%; margin-left: 10px;">
    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">(0.25 - 2.5)</span>
</div>

</div>

<!-- Chart -->
<div id="example3_candlestick"></div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: company_data</p>

<hr><p align="right"><small>This page was created using <a href="https://github.com/s-baumann/JSPlots.jl">JSPlots.jl</a> v0.4.2.</small></p>
</body>
</html>
