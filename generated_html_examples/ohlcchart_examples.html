<!DOCTYPE html>
<html>
<head>
    <title>JSPlots.jl</title>
    <meta charset="UTF-8">
    <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apache-arrow@14.0.1/Arrow.es2015.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #controls {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        #$div_id {
            width: 100%;
            height: 600px;
        }
    </style>
    

    <!-- external libs -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/pivot.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/pivot.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/d3_renderers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/c3_renderers.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.19.0/export_renderers.min.js"></script>

    <!-- Prism.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    

</head>

<body>

<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

<script type="module">
// Import parquet-wasm for Parquet file support
import * as parquet from 'https://unpkg.com/parquet-wasm@0.6.1/esm/parquet_wasm.js';

// Initialize parquet-wasm
await parquet.default();

// Make parquet available globally for loadDataset
window.parquetWasm = parquet;
window.parquetReady = true;
console.log('Parquet-wasm library loaded successfully');
</script>

<script>
// Helper function to wait for parquet-wasm to be loaded
function waitForParquet() {
    return new Promise(function(resolve) {
        if (window.parquetReady) {
            resolve();
            return;
        }
        var checkInterval = setInterval(function() {
            if (window.parquetReady) {
                clearInterval(checkInterval);
                resolve();
            }
        }, 50);
    });
}

// Centralized data loading function
// Centralized date parsing function
// Converts ISO date strings to JavaScript Date objects
// This is the ONLY place in the package where date parsing happens
function parseDatesInData(data) {
    if (!data || data.length === 0) return data;

    // Regex patterns for ISO date formats
    var datePattern = /^\d{4}-\d{2}-\d{2}$/;  // YYYY-MM-DD
    var datetimePattern = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/;  // YYYY-MM-DDTHH:MM:SS
    var timePattern = /^\d{2}:\d{2}:\d{2}(\.\d+)?$/;  // HH:MM:SS or HH:MM:SS.sss

    // Check first row to identify date and time columns
    var firstRow = data[0];
    var dateColumns = [];
    var timeColumns = [];

    for (var key in firstRow) {
        if (firstRow.hasOwnProperty(key)) {
            var value = firstRow[key];
            if (typeof value === 'string') {
                if (datetimePattern.test(value) || datePattern.test(value)) {
                    dateColumns.push(key);
                } else if (timePattern.test(value)) {
                    timeColumns.push(key);
                }
            }
        }
    }

    // If no date or time columns found, return data unchanged
    if (dateColumns.length === 0 && timeColumns.length === 0) return data;

    // Convert date strings to Date objects and time strings to milliseconds in all rows
    return data.map(function(row) {
        var newRow = {};
        for (var key in row) {
            if (row.hasOwnProperty(key)) {
                if (dateColumns.indexOf(key) !== -1 && typeof row[key] === 'string') {
                    newRow[key] = new Date(row[key]);
                } else if (timeColumns.indexOf(key) !== -1 && typeof row[key] === 'string') {
                    // Convert HH:MM:SS or HH:MM:SS.sss to milliseconds since midnight
                    var parts = row[key].split(':');
                    var hours = parseInt(parts[0], 10);
                    var minutes = parseInt(parts[1], 10);
                    var seconds = parseFloat(parts[2]);  // Use parseFloat to handle decimal seconds
                    newRow[key] = (hours * 3600 + minutes * 60 + seconds) * 1000;
                } else {
                    newRow[key] = row[key];
                }
            }
        }
        return newRow;
    });
}

// Helper function to convert temporal values back to string format for categorical filtering
// Takes a value and returns the appropriate string representation
function temporalValueToString(value) {
    if (value instanceof Date) {
        // Convert Date to ISO string
        var year = value.getFullYear();
        var month = String(value.getMonth() + 1).padStart(2, '0');
        var day = String(value.getDate()).padStart(2, '0');
        var hours = String(value.getHours()).padStart(2, '0');
        var minutes = String(value.getMinutes()).padStart(2, '0');
        var seconds = String(value.getSeconds()).padStart(2, '0');

        // Check if this is a date-only value (time is midnight UTC)
        if (hours === '00' && minutes === '00' && seconds === '00') {
            return year + '-' + month + '-' + day;
        } else {
            return year + '-' + month + '-' + day + 'T' + hours + ':' + minutes + ':' + seconds;
        }
    } else if (typeof value === 'number' && value >= 0 && value < 86400000) {
        // Likely a Time value (milliseconds since midnight, less than 24 hours)
        var totalSeconds = Math.floor(value / 1000);
        var hours = Math.floor(totalSeconds / 3600);
        var minutes = Math.floor((totalSeconds % 3600) / 60);
        var seconds = totalSeconds % 60;
        var milliseconds = value % 1000;

        var timeStr = String(hours).padStart(2, '0') + ':' +
                      String(minutes).padStart(2, '0') + ':' +
                      String(seconds).padStart(2, '0');

        // Add decimal part if there are milliseconds
        if (milliseconds > 0) {
            timeStr += '.' + String(milliseconds);
        }

        return timeStr;
    } else {
        // Return as-is for other types
        return String(value);
    }
}

// Centralized observation counting and filtering function
// Applies filters incrementally while updating observation count displays
// Returns filtered data
function applyFiltersWithCounting(allData, chartTitle, categoricalFilters, continuousFilters, filters, rangeFilters) {
    var totalObs = allData.length;

    // Update total observation count
    var totalObsElement = document.getElementById(chartTitle + '_total_obs');
    if (totalObsElement) {
        totalObsElement.textContent = totalObs + ' observations';
    }

    // Apply filters incrementally to track observation counts
    var currentData = allData;

    // Apply categorical filters and update counts
    categoricalFilters.forEach(function(col) {
        if (filters[col] && filters[col].length > 0) {
            currentData = currentData.filter(function(row) {
                var rowValueStr = temporalValueToString(row[col]);
                return filters[col].includes(rowValueStr);
            });
        }

        var countElement = document.getElementById(col + '_select_' + chartTitle + '_obs_count');
        if (countElement) {
            var pct = totalObs > 0 ? Math.round((currentData.length / totalObs) * 100) : 100;
            countElement.textContent = pct + '% (' + currentData.length + ') remaining';
        }
    });

    // Apply continuous filters and update counts
    continuousFilters.forEach(function(col) {
        if (rangeFilters[col]) {
            var range = rangeFilters[col];
            currentData = currentData.filter(function(row) {
                var rawValue = row[col];
                var value;
                if (rawValue instanceof Date) {
                    value = rawValue.getTime();
                } else {
                    value = parseFloat(rawValue);
                }
                return value >= range.min && value <= range.max;
            });
        }

        var countElement = document.getElementById(col + '_range_' + chartTitle + '_obs_count');
        if (countElement) {
            var pct = totalObs > 0 ? Math.round((currentData.length / totalObs) * 100) : 100;
            countElement.textContent = pct + '% (' + currentData.length + ') remaining';
        }
    });

    return currentData;
}

// Axis transformation functions
// These transform data values according to selected transformation type
function applyAxisTransform(values, transformType) {
    if (!values || values.length === 0) return [];

    switch(transformType) {
        case 'identity':
            return values;

        case 'log':
            return values.map(function(v) {
                return v > 0 ? Math.log(v) : NaN;
            });

        case 'z_score':
            // Z-score standardization: (x - mean) / std
            var numericVals = values.filter(function(v) { return !isNaN(v) && isFinite(v); });
            if (numericVals.length === 0) return values;

            var mean = numericVals.reduce(function(a, b) { return a + b; }, 0) / numericVals.length;
            var variance = numericVals.reduce(function(sum, v) {
                return sum + Math.pow(v - mean, 2);
            }, 0) / numericVals.length;
            var std = Math.sqrt(variance);

            if (std === 0) return values;

            return values.map(function(v) {
                if (isNaN(v) || !isFinite(v)) return NaN;
                return (v - mean) / std;
            });

        case 'quantile':
            // Rank-based transformation to [0, 1]
            // Create array of {value, originalIndex} pairs
            var indexedValues = values.map(function(v, i) {
                return { value: v, index: i };
            });

            // Filter out invalid values and sort
            var validValues = indexedValues.filter(function(item) {
                return !isNaN(item.value) && isFinite(item.value);
            }).sort(function(a, b) {
                return a.value - b.value;
            });

            if (validValues.length === 0) return values;

            // Assign ranks (0 to 1)
            var ranks = new Array(values.length).fill(NaN);
            validValues.forEach(function(item, rank) {
                // Map rank to [0, 1] where lowest = 0, highest = 1
                ranks[item.index] = validValues.length === 1 ? 0.5 : rank / (validValues.length - 1);
            });

            return ranks;

        case 'inverse_cdf':
            // Z-score followed by normal CDF transformation to [0, 1]
            var numericVals2 = values.filter(function(v) { return !isNaN(v) && isFinite(v); });
            if (numericVals2.length === 0) return values;

            var mean2 = numericVals2.reduce(function(a, b) { return a + b; }, 0) / numericVals2.length;
            var variance2 = numericVals2.reduce(function(sum, v) {
                return sum + Math.pow(v - mean2, 2);
            }, 0) / numericVals2.length;
            var std2 = Math.sqrt(variance2);

            if (std2 === 0) return values.map(function() { return 0.5; });

            return values.map(function(v) {
                if (isNaN(v) || !isFinite(v)) return NaN;
                var zscore = (v - mean2) / std2;
                return normalCDF(zscore);
            });

        default:
            return values;
    }
}

// Normal CDF (cumulative distribution function) for standard normal
function normalCDF(x) {
    // Using error function approximation
    var t = 1 / (1 + 0.2316419 * Math.abs(x));
    var d = 0.3989423 * Math.exp(-x * x / 2);
    var prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
    return x > 0 ? 1 - prob : prob;
}

// Inverse normal CDF (quantile function) for standard normal
function inverseNormalCDF(p) {
    // Rational approximation for inverse normal CDF
    // Valid for 0 < p < 1
    if (p <= 0 || p >= 1) {
        return NaN;
    }

    var a = [0, -3.969683028665376e+01, 2.209460984245205e+02,
             -2.759285104469687e+02, 1.383577518672690e+02,
             -3.066479806614716e+01, 2.506628277459239e+00];
    var b = [0, -5.447609879822406e+01, 1.615858368580409e+02,
             -1.556989798598866e+02, 6.680131188771972e+01,
             -1.328068155288572e+01];
    var c = [0, -7.784894002430293e-03, -3.223964580411365e-01,
             -2.400758277161838e+00, -2.549732539343734e+00,
             4.374664141464968e+00, 2.938163982698783e+00];
    var d = [0, 7.784695709041462e-03, 3.224671290700398e-01,
             2.445134137142996e+00, 3.754408661907416e+00];

    var q, r, result;

    if (p < 0.02425) {
        q = Math.sqrt(-2 * Math.log(p));
        result = (((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q + c[6]) /
                 ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1);
    } else if (p > 0.97575) {
        q = Math.sqrt(-2 * Math.log(1 - p));
        result = -(((((c[1] * q + c[2]) * q + c[3]) * q + c[4]) * q + c[5]) * q + c[6]) /
                  ((((d[1] * q + d[2]) * q + d[3]) * q + d[4]) * q + 1);
    } else {
        q = p - 0.5;
        r = q * q;
        result = (((((a[1] * r + a[2]) * r + a[3]) * r + a[4]) * r + a[5]) * r + a[6]) * q /
                 (((((b[1] * r + b[2]) * r + b[3]) * r + b[4]) * r + b[5]) * r + 1);
    }

    return result;
}

// Get axis label with transformation applied
function getAxisLabel(originalLabel, transformType) {
    switch(transformType) {
        case 'log':
            return 'log(' + originalLabel + ')';
        case 'z_score':
            return 'z(' + originalLabel + ')';
        case 'quantile':
            return 'quantile(' + originalLabel + ')';
        case 'inverse_cdf':
            return 'Î¦(' + originalLabel + ')';
        default:
            return originalLabel;
    }
}

// Setup aspect ratio control for a chart
// This should be called after the chart is first rendered
// Uses logarithmic scale for better precision at smaller aspect ratios
function setupAspectRatioControl(chartId, updateCallback) {
    var slider = document.getElementById(chartId + '_aspect_ratio_slider');
    var label = document.getElementById(chartId + '_aspect_ratio_label');

    if (!slider || !label) return; // Not all charts have aspect ratio control

    slider.addEventListener('input', function() {
        // Convert from log space to linear space
        var logValue = parseFloat(this.value);
        var aspectRatio = Math.exp(logValue);
        label.textContent = aspectRatio.toFixed(2);

        // Get current width of chart div
        var chartDiv = document.getElementById(chartId);
        if (!chartDiv) return;

        var width = chartDiv.offsetWidth;
        var height = width * aspectRatio;

        // Update chart layout with new height
        Plotly.relayout(chartId, { height: height });

        // Call the optional callback if provided
        if (updateCallback && typeof updateCallback === 'function') {
            updateCallback(height);
        }
    });

    // Trigger initial sizing
    var initialLogValue = parseFloat(slider.value);
    var initialAspectRatio = Math.exp(initialLogValue);
    label.textContent = initialAspectRatio.toFixed(2);
    var chartDiv = document.getElementById(chartId);
    if (chartDiv) {
        var width = chartDiv.offsetWidth;
        var height = width * initialAspectRatio;
        Plotly.relayout(chartId, { height: height });
    }
}

// This function parses data from embedded or external sources and returns a Promise
// Supports CSV (embedded/external), JSON (embedded/external), and Parquet (external) formats
// Usage: loadDataset('dataLabel').then(function(data) { /* use data */ });
function loadDataset(dataLabel) {
    return new Promise(function(resolve, reject) {
        var dataElement = document.getElementById(dataLabel);
        if (!dataElement) {
            reject(new Error('Data element not found: ' + dataLabel));
            return;
        }

        var format = dataElement.getAttribute('data-format') || 'csv_embedded';
        var dataSrc = dataElement.getAttribute('data-src');

        // Handle external JSON files
        if (format === 'json_external' && dataSrc) {
            fetch(dataSrc)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.json();
                })
                .then(function(data) {
                    // Parse dates in JSON data (centralized)
                    resolve(parseDatesInData(data));
                })
                .catch(function(error) {
                    console.error('Error loading external JSON:', error);
                    reject(error);
                });
            return;
        }

        // Handle external Parquet files
        if (format === 'parquet' && dataSrc) {
            // Wait for parquet-wasm to be loaded first
            waitForParquet()
                .then(function() {
                    return fetch(dataSrc);
                })
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.arrayBuffer();
                })
                .then(function(arrayBuffer) {
                    // Use parquet-wasm to read the file
                    var uint8Array = new Uint8Array(arrayBuffer);

                    // readParquet returns an Arrow Table
                    var wasmTable = window.parquetWasm.readParquet(uint8Array);

                    // Convert to Arrow IPC stream
                    var ipcStream = wasmTable.intoIPCStream();

                    // Use Apache Arrow JS to read the IPC stream
                    var arrowTable = window.Arrow.tableFromIPC(ipcStream);

                    // Convert Arrow Table to array of JavaScript objects
                    var data = [];
                    for (var i = 0; i < arrowTable.numRows; i++) {
                        var row = {};
                        arrowTable.schema.fields.forEach(function(field) {
                            var column = arrowTable.getChild(field.name);
                            var value = column.get(i);

                            // Convert BigInt to Number (Arrow returns BigInt for Int64)
                            if (typeof value === 'bigint') {
                                value = Number(value);
                            }

                            row[field.name] = value;
                        });
                        data.push(row);
                    }

                    resolve(data);
                })
                .catch(function(error) {
                    console.error('Error loading external Parquet:', error);
                    reject(error);
                });
            return;
        }

        // Handle external CSV files
        if (format === 'csv_external' && dataSrc) {
            fetch(dataSrc)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('Failed to load ' + dataSrc + ': ' + response.statusText);
                    }
                    return response.text();
                })
                .then(function(csvText) {
                    Papa.parse(csvText, {
                        header: true,
                        dynamicTyping: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            // Check for fatal errors only (not warnings)
                            var fatalErrors = results.errors.filter(function(err) {
                                return err.type !== 'Delimiter';
                            });

                            if (fatalErrors.length > 0) {
                                console.error('CSV parsing errors:', fatalErrors);
                                reject(fatalErrors);
                            } else if (results.data && results.data.length > 0) {
                                // Parse dates in CSV data (centralized)
                                resolve(parseDatesInData(results.data));
                            } else {
                                reject(new Error('No data parsed from CSV'));
                            }
                        },
                        error: function(error) {
                            console.error('CSV parsing error:', error);
                            reject(error);
                        }
                    });
                })
                .catch(function(error) {
                    console.error('Error loading external CSV:', error);
                    reject(error);
                });
            return;
        }

        // Handle embedded data
        var dataText = dataElement.textContent.trim();

        if (format === 'json_embedded') {
            // Parse JSON data
            try {
                var data = JSON.parse(dataText);
                // Parse dates in JSON data (centralized)
                resolve(parseDatesInData(data));
            } catch (error) {
                console.error('JSON parsing error:', error);
                reject(error);
            }
        } else if (format === 'csv_embedded') {
            // Parse CSV data using PapaParse
            Papa.parse(dataText, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    // Check for fatal errors only (not warnings)
                    // PapaParse includes non-fatal warnings in errors array
                    var fatalErrors = results.errors.filter(function(err) {
                        // Filter out delimiter detection warnings - these aren't fatal
                        // (common for single-column CSVs)
                        return err.type !== 'Delimiter';
                    });

                    if (fatalErrors.length > 0) {
                        console.error('CSV parsing errors:', fatalErrors);
                        reject(fatalErrors);
                    } else if (results.data && results.data.length > 0) {
                        // Parse dates in CSV data (centralized)
                        resolve(parseDatesInData(results.data));
                    } else {
                        reject(new Error('No data parsed from CSV'));
                    }
                },
                error: function(error) {
                    console.error('CSV parsing error:', error);
                    reject(error);
                }
            });
        } else {
            reject(new Error('Unsupported data format: ' + format));
        }
    });
}

$(function(){

(function() {
    // Configuration
    const TIME_FROM_COL = 'time_from';
    const TIME_TO_COL = 'time_to';
    const SYMBOL_COL = 'symbol';
    const OPEN_COL = 'open';
    const HIGH_COL = 'high';
    const LOW_COL = 'low';
    const CLOSE_COL = 'close';
    const VOLUME_COL = 'volume';
    const HAS_VOLUME = true;
    const CATEGORICAL_FILTERS = [];
    const CONTINUOUS_FILTERS = [];

    let allData = [];
    let firstBarOpenPrices = {};  // Store first bar open prices for renormalization

    // Make it global so inline onchange can see it
    window.updateChart_example1_ohlc = function() {
        // Get current control values
        const renormalizeCheckbox = document.getElementById('renormalize_checkbox_example1_ohlc');
        const RENORMALIZE = renormalizeCheckbox ? renormalizeCheckbox.checked : false;

        const showVolumeCheckbox = document.getElementById('show_volume_checkbox_example1_ohlc');
        const SHOW_VOLUME = HAS_VOLUME && showVolumeCheckbox ? showVolumeCheckbox.checked : false;

        const logVolumeCheckbox = document.getElementById('log_volume_checkbox_example1_ohlc');
        const LOG_VOLUME = SHOW_VOLUME && logVolumeCheckbox ? logVolumeCheckbox.checked : false;

        const chartTypeSelect = document.getElementById('chart_type_select_example1_ohlc');
        const CHART_TYPE = chartTypeSelect ? chartTypeSelect.value : 'candlestick';

        const displayModeSelect = document.getElementById('display_mode_select_example1_ohlc');
        const DISPLAY_MODE = displayModeSelect ? displayModeSelect.value : 'Overlay';

        // Get current filter values
        const filters = {};
        const rangeFilters = {};

        // Read categorical filters (dropdowns)
        CATEGORICAL_FILTERS.forEach(col => {
            const select = document.getElementById(col + '_select_example1_ohlc');
            if (select) {
                filters[col] = Array.from(select.selectedOptions).map(opt => opt.value);
            }
        });

        // Read continuous filters (range sliders)
        CONTINUOUS_FILTERS.forEach(col => {
            const slider = $('#' + col + '_range_example1_ohlc' + '_slider');
            if (slider.length > 0) {
                rangeFilters[col] = {
                    min: slider.slider("values", 0),
                    max: slider.slider("values", 1)
                };
            }
        });

        // Apply filters with observation counting
        const filteredData = applyFiltersWithCounting(
            allData,
            'example1_ohlc',
            CATEGORICAL_FILTERS,
            CONTINUOUS_FILTERS,
            filters,
            rangeFilters
        );

        // Group data by symbol
        const symbolData = {};
        filteredData.forEach(row => {
            const symbol = String(row[SYMBOL_COL]);
            if (!symbolData[symbol]) {
                symbolData[symbol] = [];
            }
            symbolData[symbol].push(row);
        });

        // Sort each symbol's data by time
        for (let symbol in symbolData) {
            symbolData[symbol].sort((a, b) => {
                const aTime = a[TIME_FROM_COL];
                const bTime = b[TIME_FROM_COL];
                if (aTime instanceof Date && bTime instanceof Date) {
                    return aTime - bTime;
                }
                return aTime < bTime ? -1 : (aTime > bTime ? 1 : 0);
            });
        }

        // Calculate first bar open prices for renormalization (only once)
        if (Object.keys(firstBarOpenPrices).length === 0 || !RENORMALIZE) {
            firstBarOpenPrices = {};
            for (let symbol in symbolData) {
                if (symbolData[symbol].length > 0) {
                    firstBarOpenPrices[symbol] = symbolData[symbol][0][OPEN_COL];
                }
            }
        }

        // Route to appropriate rendering function
        if (DISPLAY_MODE === 'Overlay') {
            renderOverlay(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        } else {
            renderFaceted(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        }
    };

    // Render overlay mode (all symbols on same chart)
    function renderOverlay(symbolData, renormalize, showVolume, logVolume, chartType) {
        const traces = [];
        const symbols = Object.keys(symbolData).sort();
        const colorPalette = ['#636efa', '#EF553B', '#00cc96', '#ab63fa', '#FFA15A',
                             '#19d3f3', '#FF6692', '#B6E880', '#FF97FF', '#FECB52'];

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];
            const color = colorPalette[idx % colorPalette.length];

            // Prepare OHLC data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            // OHLC trace
            const ohlcTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: 'x',
                yaxis: 'y',
                increasing: {line: {color: color}},
                decreasing: {line: {color: color}}
            };
            traces.push(ohlcTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: 'x',
                    yaxis: 'y2',
                    marker: {color: color},
                    showlegend: false
                };
                traces.push(volumeTrace);
            }
        });

        // Layout configuration
        const layout = {
            xaxis: {
                title: TIME_FROM_COL,
                anchor: 'y'
            },
            hovermode: 'closest',
            showlegend: true
        };

        if (showVolume && HAS_VOLUME) {
            // Two subplots: OHLC on top, volume on bottom
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price',
                domain: [0.3, 1]
            };
            layout.yaxis2 = {
                title: logVolume ? 'log(Volume)' : 'Volume',
                domain: [0, 0.25],
                anchor: 'x'
            };
            layout.barmode = 'group';  // Dodge volume bars
        } else {
            // Single plot: OHLC only
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price'
            };
        }

        Plotly.newPlot('example1_ohlc', traces, layout, {responsive: true});
    }

    // Render faceted mode (one subplot per symbol)
    function renderFaceted(symbolData, renormalize, showVolume, logVolume, chartType) {
        const symbols = Object.keys(symbolData).sort();
        const nSymbols = symbols.length;

        // Calculate grid dimensions (prefer wider grids)
        const nCols = Math.ceil(Math.sqrt(nSymbols * 1.5));
        const nRows = Math.ceil(nSymbols / nCols);

        const traces = [];
        const layout = {
            hovermode: 'closest',
            showlegend: false,
            grid: {rows: nRows, columns: nCols, pattern: 'independent'}
        };

        if (showVolume && HAS_VOLUME) {
            layout.barmode = 'group';
        }

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];

            // Prepare OHLC data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            const row = Math.floor(idx / nCols) + 1;
            const col = (idx % nCols) + 1;
            const xaxis = idx === 0 ? 'x' : 'x' + (idx + 1);
            const yaxis = idx === 0 ? 'y' : 'y' + (idx + 1);

            // OHLC trace
            const ohlcTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: xaxis,
                yaxis: yaxis
            };
            traces.push(ohlcTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const yaxis_vol = idx === 0 ? 'y' + (nSymbols + 1) : 'y' + (nSymbols + idx + 1);

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: xaxis,
                    yaxis: yaxis_vol,
                    showlegend: false
                };
                traces.push(volumeTrace);

                // Configure volume yaxis
                layout[yaxis_vol] = {
                    title: row === nRows ? (logVolume ? 'log(Vol)' : 'Vol') : '',
                    anchor: xaxis
                };
            }

            // Add axis configuration
            layout[xaxis] = {
                title: row === nRows ? TIME_FROM_COL : '',
                anchor: yaxis
            };
            layout[yaxis] = {
                title: col === 1 ? (renormalize ? 'Norm Price' : 'Price') : '',
                anchor: xaxis
            };

            // Add annotation for symbol label
            if (!layout.annotations) layout.annotations = [];
            layout.annotations.push({
                text: symbol,
                showarrow: false,
                xref: xaxis === 'x' ? 'x domain' : xaxis + ' domain',
                yref: yaxis === 'y' ? 'y domain' : yaxis + ' domain',
                x: 0.5,
                y: 1.05,
                xanchor: 'center',
                yanchor: 'bottom',
                font: {size: 10}
            });
        });

        Plotly.newPlot('example1_ohlc', traces, layout, {responsive: true});
    }

    // Load and parse CSV data using centralized parser
    loadDataset('stock_data_1').then(function(data) {
        allData = data;
        window.updateChart_example1_ohlc();

        // Setup aspect ratio control after initial render
        setupAspectRatioControl('example1_ohlc');
    }).catch(function(error) {
        console.error('Error loading data for chart example1_ohlc:', error);
    });
})();
(function() {
    // Configuration
    const TIME_FROM_COL = 'time_from';
    const TIME_TO_COL = 'time_to';
    const SYMBOL_COL = 'symbol';
    const OPEN_COL = 'open';
    const HIGH_COL = 'high';
    const LOW_COL = 'low';
    const CLOSE_COL = 'close';
    const VOLUME_COL = 'volume';
    const HAS_VOLUME = true;
    const CATEGORICAL_FILTERS = [];
    const CONTINUOUS_FILTERS = [];

    let allData = [];
    let firstBarOpenPrices = {};  // Store first bar open prices for renormalization

    // Make it global so inline onchange can see it
    window.updateChart_example2_ohlc = function() {
        // Get current control values
        const renormalizeCheckbox = document.getElementById('renormalize_checkbox_example2_ohlc');
        const RENORMALIZE = renormalizeCheckbox ? renormalizeCheckbox.checked : false;

        const showVolumeCheckbox = document.getElementById('show_volume_checkbox_example2_ohlc');
        const SHOW_VOLUME = HAS_VOLUME && showVolumeCheckbox ? showVolumeCheckbox.checked : false;

        const logVolumeCheckbox = document.getElementById('log_volume_checkbox_example2_ohlc');
        const LOG_VOLUME = SHOW_VOLUME && logVolumeCheckbox ? logVolumeCheckbox.checked : false;

        const chartTypeSelect = document.getElementById('chart_type_select_example2_ohlc');
        const CHART_TYPE = chartTypeSelect ? chartTypeSelect.value : 'candlestick';

        const displayModeSelect = document.getElementById('display_mode_select_example2_ohlc');
        const DISPLAY_MODE = displayModeSelect ? displayModeSelect.value : 'Overlay';

        // Get current filter values
        const filters = {};
        const rangeFilters = {};

        // Read categorical filters (dropdowns)
        CATEGORICAL_FILTERS.forEach(col => {
            const select = document.getElementById(col + '_select_example2_ohlc');
            if (select) {
                filters[col] = Array.from(select.selectedOptions).map(opt => opt.value);
            }
        });

        // Read continuous filters (range sliders)
        CONTINUOUS_FILTERS.forEach(col => {
            const slider = $('#' + col + '_range_example2_ohlc' + '_slider');
            if (slider.length > 0) {
                rangeFilters[col] = {
                    min: slider.slider("values", 0),
                    max: slider.slider("values", 1)
                };
            }
        });

        // Apply filters with observation counting
        const filteredData = applyFiltersWithCounting(
            allData,
            'example2_ohlc',
            CATEGORICAL_FILTERS,
            CONTINUOUS_FILTERS,
            filters,
            rangeFilters
        );

        // Group data by symbol
        const symbolData = {};
        filteredData.forEach(row => {
            const symbol = String(row[SYMBOL_COL]);
            if (!symbolData[symbol]) {
                symbolData[symbol] = [];
            }
            symbolData[symbol].push(row);
        });

        // Sort each symbol's data by time
        for (let symbol in symbolData) {
            symbolData[symbol].sort((a, b) => {
                const aTime = a[TIME_FROM_COL];
                const bTime = b[TIME_FROM_COL];
                if (aTime instanceof Date && bTime instanceof Date) {
                    return aTime - bTime;
                }
                return aTime < bTime ? -1 : (aTime > bTime ? 1 : 0);
            });
        }

        // Calculate first bar open prices for renormalization (only once)
        if (Object.keys(firstBarOpenPrices).length === 0 || !RENORMALIZE) {
            firstBarOpenPrices = {};
            for (let symbol in symbolData) {
                if (symbolData[symbol].length > 0) {
                    firstBarOpenPrices[symbol] = symbolData[symbol][0][OPEN_COL];
                }
            }
        }

        // Route to appropriate rendering function
        if (DISPLAY_MODE === 'Overlay') {
            renderOverlay(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        } else {
            renderFaceted(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        }
    };

    // Render overlay mode (all symbols on same chart)
    function renderOverlay(symbolData, renormalize, showVolume, logVolume, chartType) {
        const traces = [];
        const symbols = Object.keys(symbolData).sort();
        const colorPalette = ['#636efa', '#EF553B', '#00cc96', '#ab63fa', '#FFA15A',
                             '#19d3f3', '#FF6692', '#B6E880', '#FF97FF', '#FECB52'];

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];
            const color = colorPalette[idx % colorPalette.length];

            // Prepare OHLC data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            // OHLC trace
            const ohlcTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: 'x',
                yaxis: 'y',
                increasing: {line: {color: color}},
                decreasing: {line: {color: color}}
            };
            traces.push(ohlcTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: 'x',
                    yaxis: 'y2',
                    marker: {color: color},
                    showlegend: false
                };
                traces.push(volumeTrace);
            }
        });

        // Layout configuration
        const layout = {
            xaxis: {
                title: TIME_FROM_COL,
                anchor: 'y'
            },
            hovermode: 'closest',
            showlegend: true
        };

        if (showVolume && HAS_VOLUME) {
            // Two subplots: OHLC on top, volume on bottom
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price',
                domain: [0.3, 1]
            };
            layout.yaxis2 = {
                title: logVolume ? 'log(Volume)' : 'Volume',
                domain: [0, 0.25],
                anchor: 'x'
            };
            layout.barmode = 'group';  // Dodge volume bars
        } else {
            // Single plot: OHLC only
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price'
            };
        }

        Plotly.newPlot('example2_ohlc', traces, layout, {responsive: true});
    }

    // Render faceted mode (one subplot per symbol)
    function renderFaceted(symbolData, renormalize, showVolume, logVolume, chartType) {
        const symbols = Object.keys(symbolData).sort();
        const nSymbols = symbols.length;

        // Calculate grid dimensions (prefer wider grids)
        const nCols = Math.ceil(Math.sqrt(nSymbols * 1.5));
        const nRows = Math.ceil(nSymbols / nCols);

        const traces = [];
        const layout = {
            hovermode: 'closest',
            showlegend: false,
            grid: {rows: nRows, columns: nCols, pattern: 'independent'}
        };

        if (showVolume && HAS_VOLUME) {
            layout.barmode = 'group';
        }

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];

            // Prepare OHLC data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            const row = Math.floor(idx / nCols) + 1;
            const col = (idx % nCols) + 1;
            const xaxis = idx === 0 ? 'x' : 'x' + (idx + 1);
            const yaxis = idx === 0 ? 'y' : 'y' + (idx + 1);

            // OHLC trace
            const ohlcTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: xaxis,
                yaxis: yaxis
            };
            traces.push(ohlcTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const yaxis_vol = idx === 0 ? 'y' + (nSymbols + 1) : 'y' + (nSymbols + idx + 1);

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: xaxis,
                    yaxis: yaxis_vol,
                    showlegend: false
                };
                traces.push(volumeTrace);

                // Configure volume yaxis
                layout[yaxis_vol] = {
                    title: row === nRows ? (logVolume ? 'log(Vol)' : 'Vol') : '',
                    anchor: xaxis
                };
            }

            // Add axis configuration
            layout[xaxis] = {
                title: row === nRows ? TIME_FROM_COL : '',
                anchor: yaxis
            };
            layout[yaxis] = {
                title: col === 1 ? (renormalize ? 'Norm Price' : 'Price') : '',
                anchor: xaxis
            };

            // Add annotation for symbol label
            if (!layout.annotations) layout.annotations = [];
            layout.annotations.push({
                text: symbol,
                showarrow: false,
                xref: xaxis === 'x' ? 'x domain' : xaxis + ' domain',
                yref: yaxis === 'y' ? 'y domain' : yaxis + ' domain',
                x: 0.5,
                y: 1.05,
                xanchor: 'center',
                yanchor: 'bottom',
                font: {size: 10}
            });
        });

        Plotly.newPlot('example2_ohlc', traces, layout, {responsive: true});
    }

    // Load and parse CSV data using centralized parser
    loadDataset('stock_data_2').then(function(data) {
        allData = data;
        window.updateChart_example2_ohlc();

        // Setup aspect ratio control after initial render
        setupAspectRatioControl('example2_ohlc');
    }).catch(function(error) {
        console.error('Error loading data for chart example2_ohlc:', error);
    });
})();
(function() {
    // Configuration
    const TIME_FROM_COL = 'quarter';
    const TIME_TO_COL = 'quarter_end';
    const SYMBOL_COL = 'company';
    const OPEN_COL = 'open_price';
    const HIGH_COL = 'high_price';
    const LOW_COL = 'low_price';
    const CLOSE_COL = 'close_price';
    const VOLUME_COL = '';
    const HAS_VOLUME = false;
    const CATEGORICAL_FILTERS = [];
    const CONTINUOUS_FILTERS = [];

    let allData = [];
    let firstBarOpenPrices = {};  // Store first bar open prices for renormalization

    // Make it global so inline onchange can see it
    window.updateChart_example3_ohlc = function() {
        // Get current control values
        const renormalizeCheckbox = document.getElementById('renormalize_checkbox_example3_ohlc');
        const RENORMALIZE = renormalizeCheckbox ? renormalizeCheckbox.checked : false;

        const showVolumeCheckbox = document.getElementById('show_volume_checkbox_example3_ohlc');
        const SHOW_VOLUME = HAS_VOLUME && showVolumeCheckbox ? showVolumeCheckbox.checked : false;

        const logVolumeCheckbox = document.getElementById('log_volume_checkbox_example3_ohlc');
        const LOG_VOLUME = SHOW_VOLUME && logVolumeCheckbox ? logVolumeCheckbox.checked : false;

        const chartTypeSelect = document.getElementById('chart_type_select_example3_ohlc');
        const CHART_TYPE = chartTypeSelect ? chartTypeSelect.value : 'ohlc';

        const displayModeSelect = document.getElementById('display_mode_select_example3_ohlc');
        const DISPLAY_MODE = displayModeSelect ? displayModeSelect.value : 'Faceted';

        // Get current filter values
        const filters = {};
        const rangeFilters = {};

        // Read categorical filters (dropdowns)
        CATEGORICAL_FILTERS.forEach(col => {
            const select = document.getElementById(col + '_select_example3_ohlc');
            if (select) {
                filters[col] = Array.from(select.selectedOptions).map(opt => opt.value);
            }
        });

        // Read continuous filters (range sliders)
        CONTINUOUS_FILTERS.forEach(col => {
            const slider = $('#' + col + '_range_example3_ohlc' + '_slider');
            if (slider.length > 0) {
                rangeFilters[col] = {
                    min: slider.slider("values", 0),
                    max: slider.slider("values", 1)
                };
            }
        });

        // Apply filters with observation counting
        const filteredData = applyFiltersWithCounting(
            allData,
            'example3_ohlc',
            CATEGORICAL_FILTERS,
            CONTINUOUS_FILTERS,
            filters,
            rangeFilters
        );

        // Group data by symbol
        const symbolData = {};
        filteredData.forEach(row => {
            const symbol = String(row[SYMBOL_COL]);
            if (!symbolData[symbol]) {
                symbolData[symbol] = [];
            }
            symbolData[symbol].push(row);
        });

        // Sort each symbol's data by time
        for (let symbol in symbolData) {
            symbolData[symbol].sort((a, b) => {
                const aTime = a[TIME_FROM_COL];
                const bTime = b[TIME_FROM_COL];
                if (aTime instanceof Date && bTime instanceof Date) {
                    return aTime - bTime;
                }
                return aTime < bTime ? -1 : (aTime > bTime ? 1 : 0);
            });
        }

        // Calculate first bar open prices for renormalization (only once)
        if (Object.keys(firstBarOpenPrices).length === 0 || !RENORMALIZE) {
            firstBarOpenPrices = {};
            for (let symbol in symbolData) {
                if (symbolData[symbol].length > 0) {
                    firstBarOpenPrices[symbol] = symbolData[symbol][0][OPEN_COL];
                }
            }
        }

        // Route to appropriate rendering function
        if (DISPLAY_MODE === 'Overlay') {
            renderOverlay(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        } else {
            renderFaceted(symbolData, RENORMALIZE, SHOW_VOLUME, LOG_VOLUME, CHART_TYPE);
        }
    };

    // Render overlay mode (all symbols on same chart)
    function renderOverlay(symbolData, renormalize, showVolume, logVolume, chartType) {
        const traces = [];
        const symbols = Object.keys(symbolData).sort();
        const colorPalette = ['#636efa', '#EF553B', '#00cc96', '#ab63fa', '#FFA15A',
                             '#19d3f3', '#FF6692', '#B6E880', '#FF97FF', '#FECB52'];

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];
            const color = colorPalette[idx % colorPalette.length];

            // Prepare OHLC data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            // OHLC trace
            const ohlcTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: 'x',
                yaxis: 'y',
                increasing: {line: {color: color}},
                decreasing: {line: {color: color}}
            };
            traces.push(ohlcTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: 'x',
                    yaxis: 'y2',
                    marker: {color: color},
                    showlegend: false
                };
                traces.push(volumeTrace);
            }
        });

        // Layout configuration
        const layout = {
            xaxis: {
                title: TIME_FROM_COL,
                anchor: 'y'
            },
            hovermode: 'closest',
            showlegend: true
        };

        if (showVolume && HAS_VOLUME) {
            // Two subplots: OHLC on top, volume on bottom
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price',
                domain: [0.3, 1]
            };
            layout.yaxis2 = {
                title: logVolume ? 'log(Volume)' : 'Volume',
                domain: [0, 0.25],
                anchor: 'x'
            };
            layout.barmode = 'group';  // Dodge volume bars
        } else {
            // Single plot: OHLC only
            layout.yaxis = {
                title: renormalize ? 'Normalized Price' : 'Price'
            };
        }

        Plotly.newPlot('example3_ohlc', traces, layout, {responsive: true});
    }

    // Render faceted mode (one subplot per symbol)
    function renderFaceted(symbolData, renormalize, showVolume, logVolume, chartType) {
        const symbols = Object.keys(symbolData).sort();
        const nSymbols = symbols.length;

        // Calculate grid dimensions (prefer wider grids)
        const nCols = Math.ceil(Math.sqrt(nSymbols * 1.5));
        const nRows = Math.ceil(nSymbols / nCols);

        const traces = [];
        const layout = {
            hovermode: 'closest',
            showlegend: false,
            grid: {rows: nRows, columns: nCols, pattern: 'independent'}
        };

        if (showVolume && HAS_VOLUME) {
            layout.barmode = 'group';
        }

        symbols.forEach((symbol, idx) => {
            const data = symbolData[symbol];

            // Prepare OHLC data
            const x = data.map(row => row[TIME_FROM_COL]);
            let open = data.map(row => row[OPEN_COL]);
            let high = data.map(row => row[HIGH_COL]);
            let low = data.map(row => row[LOW_COL]);
            let close = data.map(row => row[CLOSE_COL]);

            // Apply renormalization if enabled
            if (renormalize && firstBarOpenPrices[symbol] && firstBarOpenPrices[symbol] !== 0) {
                const base = firstBarOpenPrices[symbol];
                open = open.map(v => v / base);
                high = high.map(v => v / base);
                low = low.map(v => v / base);
                close = close.map(v => v / base);
            }

            const row = Math.floor(idx / nCols) + 1;
            const col = (idx % nCols) + 1;
            const xaxis = idx === 0 ? 'x' : 'x' + (idx + 1);
            const yaxis = idx === 0 ? 'y' : 'y' + (idx + 1);

            // OHLC trace
            const ohlcTrace = {
                x: x,
                open: open,
                high: high,
                low: low,
                close: close,
                type: chartType,
                name: symbol,
                xaxis: xaxis,
                yaxis: yaxis
            };
            traces.push(ohlcTrace);

            // Volume trace if enabled
            if (showVolume && HAS_VOLUME) {
                let volumes = data.map(row => row[VOLUME_COL]);
                if (logVolume) {
                    volumes = volumes.map(v => Math.log(v + 1));
                }

                const yaxis_vol = idx === 0 ? 'y' + (nSymbols + 1) : 'y' + (nSymbols + idx + 1);

                const volumeTrace = {
                    x: x,
                    y: volumes,
                    type: 'bar',
                    name: symbol + ' Volume',
                    xaxis: xaxis,
                    yaxis: yaxis_vol,
                    showlegend: false
                };
                traces.push(volumeTrace);

                // Configure volume yaxis
                layout[yaxis_vol] = {
                    title: row === nRows ? (logVolume ? 'log(Vol)' : 'Vol') : '',
                    anchor: xaxis
                };
            }

            // Add axis configuration
            layout[xaxis] = {
                title: row === nRows ? TIME_FROM_COL : '',
                anchor: yaxis
            };
            layout[yaxis] = {
                title: col === 1 ? (renormalize ? 'Norm Price' : 'Price') : '',
                anchor: xaxis
            };

            // Add annotation for symbol label
            if (!layout.annotations) layout.annotations = [];
            layout.annotations.push({
                text: symbol,
                showarrow: false,
                xref: xaxis === 'x' ? 'x domain' : xaxis + ' domain',
                yref: yaxis === 'y' ? 'y domain' : yaxis + ' domain',
                x: 0.5,
                y: 1.05,
                xanchor: 'center',
                yanchor: 'bottom',
                font: {size: 10}
            });
        });

        Plotly.newPlot('example3_ohlc', traces, layout, {responsive: true});
    }

    // Load and parse CSV data using centralized parser
    loadDataset('company_data').then(function(data) {
        allData = data;
        window.updateChart_example3_ohlc();

        // Setup aspect ratio control after initial render
        setupAspectRatioControl('example3_ohlc');
    }).catch(function(error) {
        console.error('Error loading data for chart example3_ohlc:', error);
    });
})();


});
</script>

<!-- DATASETS -->

<script type="text/plain" id="company_data" data-format="csv_embedded" data-src="">
quarter,quarter_end,company,open_price,high_price,low_price,close_price
1,1,CompanyA,70.57713906720171,74.11383017335953,67.07681990675867,70.64729535115742
2,2,CompanyA,67.39837326512713,69.21304347012243,64.00775303437585,68.53564614159414
3,3,CompanyA,70.68540097850217,72.35224260185991,68.15033846139632,71.88761706339135
4,4,CompanyA,67.36898665438241,70.18555720391068,66.77948453994289,68.58988466927336
5,5,CompanyA,67.20032107043751,68.878862530441,63.6984869110729,68.878862530441
6,6,CompanyA,68.23287470399642,69.09776681196364,68.03685912610854,68.18179148441597
7,7,CompanyA,70.64354065079995,72.74348545145652,70.45513777126753,72.74348545145652
8,8,CompanyA,71.37148106807886,71.9469640036146,71.10964226189448,71.81772028548546
9,9,CompanyA,73.79711563784821,76.67183379121293,71.37673823592169,74.03841196390424
10,10,CompanyA,73.73030893273621,76.01944118088593,70.69914822221962,73.28320673405618
11,11,CompanyA,73.82276120027736,74.68492853621326,73.4352387236073,74.68492853621326
12,12,CompanyA,70.2001006782791,72.05528943308049,67.91382409585874,69.86342541507156
1,1,CompanyB,89.37419807834348,90.7963875406394,87.94799827296372,88.16222647703776
2,2,CompanyB,93.1732599739675,94.12208495931199,89.34584824509471,92.71393397488418
3,3,CompanyB,93.4212292960167,96.17906630244649,90.33150911686504,93.9258453027385
4,4,CompanyB,93.33634909806736,94.50974545825855,90.78689315758358,91.61488134762584
5,5,CompanyB,99.27434807105864,103.1990438597977,98.49821297531362,98.73521114134397
6,6,CompanyB,107.75167112803224,111.58843492700376,104.09895025597827,107.81908927207975
7,7,CompanyB,109.0343167717859,112.28347703182598,105.28485306839909,107.96059625183132
8,8,CompanyB,110.32163809981965,110.91046913715661,109.51171880622701,110.15833530268267
9,9,CompanyB,106.69298388827983,109.07354045691065,102.79811708949093,107.50772259444723
10,10,CompanyB,109.47801896490304,110.07473987328873,105.86304201558404,109.18975378045052
11,11,CompanyB,108.56070664659413,109.29400187642345,107.2426025188761,107.56692082537765
12,12,CompanyB,105.35826759243014,106.64473546335752,103.38854654675039,106.64473546335752

</script><script type="text/plain" id="stock_data_1" data-format="csv_embedded" data-src="">
time_from,time_to,symbol,open,high,low,close,volume
2024-01-01,2024-01-01,AAPL,150.6880486905846,151.7044423474569,147.62203352087622,151.7044423474569,3172433
2024-01-02,2024-01-02,AAPL,148.3587025702914,153.192570771916,147.92203696713855,149.31258992807463,2916993
2024-01-03,2024-01-03,AAPL,146.48173289436724,155.92009938989287,146.48173289436724,150.24185903096662,4271821
2024-01-04,2024-01-04,AAPL,148.562073756925,152.29681226080623,148.43412372149342,149.58142531335983,1544010
2024-01-05,2024-01-05,AAPL,148.58756051021015,151.08030309574488,148.58756051021015,149.89961166784175,3626356
2024-01-06,2024-01-06,AAPL,148.36866143521434,153.3881421744949,148.36866143521434,149.6271245550767,4149431
2024-01-07,2024-01-07,AAPL,149.85560872535024,155.85429062289876,149.67135099142018,151.57730891402247,3284221
2024-01-08,2024-01-08,AAPL,149.88814384588485,158.75602425724534,149.88814384588485,152.76603393076655,4691906
2024-01-09,2024-01-09,AAPL,149.65967330164432,155.4592367447598,149.1095113214501,152.53618853157582,2161805
2024-01-10,2024-01-10,AAPL,150.34524110084965,154.62606993652406,147.77438445915345,152.58792293829828,3783273
2024-01-11,2024-01-11,AAPL,150.87645369952267,155.49396379057563,149.6761942155988,154.89931081539598,1801070
2024-01-12,2024-01-12,AAPL,150.34064204264004,158.1023755234356,144.85495304131652,153.62141355248625,2078251
2024-01-13,2024-01-13,AAPL,149.5948313814343,158.18531527114965,143.71282981649,152.50112167232666,4044558
2024-01-14,2024-01-14,AAPL,149.03262368699208,156.31238510619085,147.0247812431974,149.6958210540872,1557843
2024-01-15,2024-01-15,AAPL,145.9895613409027,155.81313101492813,145.9895613409027,152.21809758047723,2172311
2024-01-16,2024-01-16,AAPL,144.07670584728407,161.19261271493946,144.07670584728407,151.93776656872836,3342002
2024-01-17,2024-01-17,AAPL,143.8187384246197,157.10052670377434,143.8187384246197,151.64552639205397,1024022
2024-01-18,2024-01-18,AAPL,145.06688623164223,157.44117451384597,145.06688623164223,154.52486087859955,2235650
2024-01-19,2024-01-19,AAPL,144.31450909483522,158.20002634371878,144.31450909483522,153.0710394790857,3035614
2024-01-20,2024-01-20,AAPL,143.1558475053155,156.60091545067166,143.1558475053155,151.70682961137206,4084622
2024-01-21,2024-01-21,AAPL,141.84606072343536,156.6795892347604,141.84606072343536,153.6670677729023,3526285
2024-01-22,2024-01-22,AAPL,142.23423932817923,156.99646097094222,142.23423932817923,154.16201976579518,3237383
2024-01-23,2024-01-23,AAPL,143.49160568824678,157.0840193384874,143.49160568824678,157.0840193384874,2939487
2024-01-24,2024-01-24,AAPL,143.30042699530102,158.02128136803157,143.30042699530102,154.2646105034415,2613280
2024-01-25,2024-01-25,AAPL,143.97741009888387,158.7779721403743,143.97741009888387,158.7779721403743,1774296
2024-01-26,2024-01-26,AAPL,144.48137220732482,158.98346697155714,144.48137220732482,158.98346697155714,2211120
2024-01-27,2024-01-27,AAPL,144.17942980833095,156.53464857487182,144.17942980833095,156.53464857487182,3311183
2024-01-28,2024-01-28,AAPL,145.49991738869772,157.9034363223186,145.49991738869772,157.9034363223186,3842589
2024-01-29,2024-01-29,AAPL,144.12159062274745,158.0509605835132,144.12159062274745,158.0509605835132,3351675
2024-01-30,2024-01-30,AAPL,144.38465839135762,159.38983101807253,144.38465839135762,159.38983101807253,4135095
2024-01-31,2024-01-31,AAPL,145.73729073190475,158.61881323626014,145.73729073190475,158.61881323626014,3511132
2024-02-01,2024-02-01,AAPL,145.35888249904187,157.33812407178672,145.35888249904187,157.33812407178672,2175318
2024-02-02,2024-02-02,AAPL,145.8064348116729,156.30590437322505,145.8064348116729,156.30590437322505,1918164
2024-02-03,2024-02-03,AAPL,146.0909141678962,157.03919229349086,145.82482739765155,157.03919229349086,2680462
2024-02-04,2024-02-04,AAPL,146.44032614899308,155.5659781578899,146.44032614899308,155.5659781578899,4282679
2024-02-05,2024-02-05,AAPL,146.62386431252327,157.42034682366497,146.62386431252327,157.42034682366497,1224256
2024-02-06,2024-02-06,AAPL,146.55305830794634,156.27705149107518,146.41470954145677,156.27705149107518,3328639
2024-02-07,2024-02-07,AAPL,148.46084107828702,157.08715867667829,147.2794930930256,157.08715867667829,2826149
2024-02-08,2024-02-08,AAPL,147.8398274245748,157.65492449630287,147.8398274245748,157.65492449630287,4230375
2024-02-09,2024-02-09,AAPL,147.7609085008368,155.431138343954,142.92924932797646,155.431138343954,3629464
2024-02-10,2024-02-10,AAPL,148.47741386751053,156.6873388953241,142.42120380682292,156.6873388953241,2419365
2024-02-11,2024-02-11,AAPL,150.55728187063394,156.7735890088047,144.52043121790072,156.7735890088047,3562536
2024-02-12,2024-02-12,AAPL,150.85487922205053,157.90646441180073,142.00500390077593,157.90646441180073,4863130
2024-02-13,2024-02-13,AAPL,149.55157028729852,157.99992788065447,144.2742361923322,157.99992788065447,3854002
2024-02-14,2024-02-14,AAPL,150.14971554985115,158.49569181363654,142.20843783333075,155.5567975874665,3762531
2024-02-15,2024-02-15,AAPL,149.69302982098176,159.5142504687272,144.57841501505965,156.12665980758564,1127972
2024-02-16,2024-02-16,AAPL,149.91032720980425,156.1339816504178,141.76961622729613,156.1339816504178,2115164
2024-02-17,2024-02-17,AAPL,150.25513346212992,156.03521989562347,144.67028437351067,156.03521989562347,2011720
2024-02-18,2024-02-18,AAPL,149.7195110722958,157.74859029252042,145.25810266768104,157.74859029252042,1956227
2024-02-19,2024-02-19,AAPL,151.15909220007444,157.9649329153309,141.53622536270683,157.9649329153309,1530663
2024-02-20,2024-02-20,AAPL,151.63495165298735,157.498171258285,141.6569512895134,156.1974771371655,4661281
2024-02-21,2024-02-21,AAPL,151.4642390059231,157.63822778602784,141.98267237155483,157.63822778602784,3656437
2024-02-22,2024-02-22,AAPL,150.14650530533058,160.34435676563615,142.07992300828053,160.34435676563615,2462620
2024-02-23,2024-02-23,AAPL,151.77609672331303,159.93616845236423,143.15513451912372,158.2422344950253,3193885
2024-02-24,2024-02-24,AAPL,153.2581587050957,159.36693486119756,141.1212726226141,159.36693486119756,2378988
2024-02-25,2024-02-25,AAPL,154.1361789923193,158.84977721472225,143.08097260194006,158.84977721472225,3503895
2024-02-26,2024-02-26,AAPL,155.24784718742046,158.4407877156528,143.55651235152544,158.4407877156528,4164676
2024-02-27,2024-02-27,AAPL,155.6766502538516,158.37442997565861,140.1638318896669,158.37442997565861,3350673
2024-02-28,2024-02-28,AAPL,154.92130650447857,156.40261780153608,142.6875102004795,156.40261780153608,2402708
2024-02-29,2024-02-29,AAPL,155.13716916258628,159.02365617973214,145.43085774288386,159.02365617973214,1050945
2024-03-01,2024-03-01,AAPL,153.63486979955516,161.41080065917188,141.3092621995964,161.41080065917188,4798361
2024-03-02,2024-03-02,AAPL,153.9460018851803,160.0844075344127,143.5973436645206,160.0844075344127,2067531
2024-03-03,2024-03-03,AAPL,152.97815581382645,158.19274167435705,147.7913117497814,158.19274167435705,3964237
2024-03-04,2024-03-04,AAPL,152.2259328893061,157.81317815157604,144.8484647791664,157.81317815157604,4905725
2024-03-05,2024-03-05,AAPL,151.15450578265595,156.55187680768364,143.72526717678474,156.2736416588296,2721632
2024-03-06,2024-03-06,AAPL,149.76463551671026,157.50271377014033,145.86906245157007,155.88570882837075,3508061
2024-03-07,2024-03-07,AAPL,150.97066866853189,156.09314887583682,146.18199155997306,154.57531321962966,2985913
2024-03-08,2024-03-08,AAPL,150.31988081115145,159.47240341713524,148.59615160556106,158.40724938737654,2856834
2024-03-09,2024-03-09,AAPL,150.09464232155793,158.25885588270498,144.8032760221997,155.32248057249956,2387717
2024-03-10,2024-03-10,AAPL,147.33022027881702,156.45006437366598,146.9282358885345,154.42097619835764,2019620
2024-03-11,2024-03-11,AAPL,147.0744462947897,159.03615634140766,144.57071222271892,153.56352980495984,4333935
2024-03-12,2024-03-12,AAPL,146.3432017524016,156.25768415597207,144.86815520610196,153.4195883243951,2387262
2024-03-13,2024-03-13,AAPL,146.80317211950117,155.47162585433304,145.43001529916094,151.27091820021704,1838702
2024-03-14,2024-03-14,AAPL,147.31952210393356,156.42354018736657,147.31952210393356,152.3567371370511,4416548
2024-03-15,2024-03-15,AAPL,149.02097727760344,159.29788993924035,145.8243287465355,151.6800900391236,1063322
2024-03-16,2024-03-16,AAPL,148.88046268316305,159.42279904489706,146.6778316730976,151.19700673686114,2637840
2024-03-17,2024-03-17,AAPL,149.5885642027224,152.73683452764138,143.2075987557492,150.95492081195368,2062519
2024-03-18,2024-03-18,AAPL,149.05555879360992,152.84326961510297,145.00877644016555,149.9419841534122,4115333
2024-03-19,2024-03-19,AAPL,149.52350623080918,157.41715656071142,145.93971456060447,151.2806464302232,3381325
2024-03-20,2024-03-20,AAPL,148.36754239601467,157.9269966600903,144.89182867128287,150.14340556366744,2507073
2024-03-21,2024-03-21,AAPL,147.8057837969554,160.18051448978622,145.12152702021044,150.94556481758377,4941630
2024-03-22,2024-03-22,AAPL,147.45972790682154,159.30140546537018,141.92443242720287,149.72466059919074,2610753
2024-03-23,2024-03-23,AAPL,146.38328830689923,160.6726741351602,144.93698442063186,151.82676938701664,4160602
2024-03-24,2024-03-24,AAPL,147.66462835415084,157.60465085637216,144.86358084151746,150.1400142274982,2622932
2024-03-25,2024-03-25,AAPL,148.18618314477806,160.30324542393245,148.18618314477806,152.19065403368128,2705279
2024-03-26,2024-03-26,AAPL,148.51848993594456,157.97258139104827,145.3734925693308,150.36545487502266,2517570
2024-03-27,2024-03-27,AAPL,147.9404336838701,159.0817964410418,147.3869792405035,149.25257580576667,3132949
2024-03-28,2024-03-28,AAPL,148.03221985216513,155.7492382469569,143.25553384411353,146.94831803513537,2472354
2024-03-29,2024-03-29,AAPL,149.96582629134446,156.85735326720533,145.34027069419324,150.3000728492327,2425931
2024-03-30,2024-03-30,AAPL,150.11803860799932,157.84991991932972,143.78839316126437,152.57089315679954,2661938
2024-03-31,2024-03-31,AAPL,149.19463425226644,158.18080805503095,145.9589509324482,149.9624703526958,1440924

</script><script type="text/plain" id="stock_data_2" data-format="csv_embedded" data-src="">
time_from,time_to,symbol,open,high,low,close,volume
2024-01-01,2024-01-01,AAPL,152.586253712334,156.66941816730238,150.7631227531415,152.3576716432497,1185182
2024-01-02,2024-01-02,AAPL,155.48605042170655,158.72251572224755,154.14344274680968,154.1685259778055,3282764
2024-01-03,2024-01-03,AAPL,155.27191563500207,156.56225684555383,153.94099440923995,156.56225684555383,1933138
2024-01-04,2024-01-04,AAPL,150.49178718465487,153.4715298536189,149.83649776649736,149.83649776649736,4471230
2024-01-05,2024-01-05,AAPL,153.10207067939405,155.78742144484954,152.12863618918618,155.78742144484954,1552462
2024-01-06,2024-01-06,AAPL,154.1262253264436,154.24075077038438,150.29540057282273,152.27366896864538,4657244
2024-01-07,2024-01-07,AAPL,153.69989620655483,157.16350984869803,153.2277800017024,153.2277800017024,4862496
2024-01-08,2024-01-08,AAPL,154.4617911913311,157.06113919502081,153.41522201863722,155.01071642322836,1007537
2024-01-09,2024-01-09,AAPL,157.4835445668086,159.83815446261372,154.643374837798,159.83815446261372,1077277
2024-01-10,2024-01-10,AAPL,155.2005028660041,158.58754130769336,151.28585009594218,155.36333677766956,3241754
2024-01-11,2024-01-11,AAPL,155.18665126118185,157.6680233437454,154.1451265817866,155.57639384923726,3055702
2024-01-12,2024-01-12,AAPL,152.19898079404902,154.73040882160956,147.8360040807107,153.51328958518016,3672594
2024-01-13,2024-01-13,AAPL,151.70760363241317,155.79319652478344,146.78679479900126,150.35280763050434,4865320
2024-01-14,2024-01-14,AAPL,150.60797031382785,151.81831186772493,148.2988326889715,148.48707182882418,4145391
2024-01-15,2024-01-15,AAPL,148.84483088493175,150.90972164693974,144.31650950585833,148.47085664482526,1941393
2024-01-16,2024-01-16,AAPL,150.9584050677142,152.65852039791113,150.04013289965695,151.59206486558287,2049730
2024-01-17,2024-01-17,AAPL,149.94423901960783,154.7227577328083,147.9246951320874,150.9271094317614,4924633
2024-01-18,2024-01-18,AAPL,151.29018698852744,155.21334851372836,146.59507460753048,150.84901610854973,4253556
2024-01-19,2024-01-19,AAPL,152.6165060762533,153.89193665716806,150.38392568119997,153.89193665716806,2015175
2024-01-20,2024-01-20,AAPL,153.82032421770006,156.5626054721954,152.5852807141352,153.50364858795191,4400125
2024-01-21,2024-01-21,AAPL,153.3042725720135,156.42307983648783,151.64877247453563,154.09990523718037,4019212
2024-01-22,2024-01-22,AAPL,154.7470788579481,159.41009152810344,151.86652308864475,154.79169738207304,3411681
2024-01-23,2024-01-23,AAPL,152.72276965617257,156.15376680175194,151.4441167240915,151.4441167240915,1446367
2024-01-24,2024-01-24,AAPL,152.47755335582096,153.84496861670698,148.56893948928735,153.2248019556155,4628809
2024-01-25,2024-01-25,AAPL,152.47272854205872,152.98325762747388,149.68071544447108,152.64631476595304,3864778
2024-01-26,2024-01-26,AAPL,153.61474111687406,156.83785896985285,150.71868201779031,152.03913938585978,4274437
2024-01-27,2024-01-27,AAPL,157.25396598869068,161.61543208557322,154.33213814932725,156.44428019063696,3049975
2024-01-28,2024-01-28,AAPL,156.23257747365483,158.55472596378286,152.20759180789744,154.2719863566628,1989617
2024-01-29,2024-01-29,AAPL,155.30893236434093,159.74794491333552,153.7843005525064,154.52849803369205,4878879
2024-01-30,2024-01-30,AAPL,155.25072959407984,159.1866625419872,151.63153928778232,156.2509839520693,1160351
2024-01-31,2024-01-31,AAPL,154.6972620205068,157.92582511597857,153.3761773009189,154.80601838057265,3108430
2024-02-01,2024-02-01,AAPL,157.41647747506133,159.9950570032029,157.37455091894583,158.21676608634283,1499533
2024-02-02,2024-02-02,AAPL,159.21206419813288,162.2209170860047,159.06720430308562,159.4883028150598,1935902
2024-02-03,2024-02-03,AAPL,160.10637644248465,161.36185064808487,155.9030353862668,161.2256390677872,1340306
2024-02-04,2024-02-04,AAPL,159.68321977859537,160.4447620159319,154.70016228459824,160.4447620159319,3052082
2024-02-05,2024-02-05,AAPL,157.95170972340287,158.85362789822392,153.23294147887765,158.83438353087527,2837126
2024-02-06,2024-02-06,AAPL,157.59611955136924,160.6047870683106,153.08479109154067,156.36737845269639,4871873
2024-02-07,2024-02-07,AAPL,157.47770279704227,161.70307037515934,156.2557477740967,157.96499132539319,4912755
2024-02-08,2024-02-08,AAPL,154.42568390730423,154.74559299525328,151.04028131160254,154.20304965999904,3553546
2024-02-09,2024-02-09,AAPL,155.38954553232057,158.28135493590338,153.24942816813513,156.10970400060023,3192874
2024-02-10,2024-02-10,AAPL,155.8509790156357,156.4692251576963,153.4883308783096,155.78910520689982,4873778
2024-02-11,2024-02-11,AAPL,154.05497268203897,157.75063238300064,149.53254823911465,154.41676607335265,2272779
2024-02-12,2024-02-12,AAPL,152.75693210622828,154.4647837405563,147.87723111521063,151.87175993985588,3103943
2024-02-13,2024-02-13,AAPL,151.51679574816856,154.18181495288835,150.01613497583654,150.87075737308845,4328969
2024-02-14,2024-02-14,AAPL,148.93983701034472,150.58319243740723,146.22253759442202,148.3841634003185,3844583
2024-02-15,2024-02-15,AAPL,150.01797245176937,152.28760875016656,146.8994424986232,150.8041771246569,4793265
2024-02-16,2024-02-16,AAPL,151.03812166969615,152.02083501316636,149.58012417335632,149.58012417335632,3465439
2024-02-17,2024-02-17,AAPL,155.45003460665708,156.19786680382748,151.05485902417425,154.74738931353676,4675942
2024-02-18,2024-02-18,AAPL,154.27536250284854,158.17850155477396,149.27983101335013,154.71643855393384,1592295
2024-02-19,2024-02-19,AAPL,152.5926349415167,153.05482264018417,151.31585450166833,152.476601787396,2056564
2024-02-20,2024-02-20,AAPL,153.0851416403329,154.61566704864123,152.63881034593655,153.52498994461232,2589687
2024-02-21,2024-02-21,AAPL,153.14088880036695,153.448557501835,150.47627359228466,152.19032224095946,1014004
2024-02-22,2024-02-22,AAPL,154.62039725461162,156.08936642649928,153.87009782440674,153.87009782440674,2179429
2024-02-23,2024-02-23,AAPL,154.5525279850602,156.88564986255767,154.05602541947914,154.32819788016846,2185223
2024-02-24,2024-02-24,AAPL,151.70476577639997,154.59333331150668,148.51741595118767,152.33494986968486,4297757
2024-02-25,2024-02-25,AAPL,148.3275466746012,152.97550879159004,146.38449563929478,147.59468626303982,3115469
2024-02-26,2024-02-26,AAPL,147.88780058004713,148.55974964574511,146.96679337826356,147.11294935661485,3473536
2024-02-27,2024-02-27,AAPL,149.17755465993886,150.24967260290572,147.45360152986328,150.24967260290572,1485028
2024-02-28,2024-02-28,AAPL,151.69705647908953,153.9634682229346,149.0188793158943,151.48650960505918,2062585
2024-02-29,2024-02-29,AAPL,150.89039085430423,155.19138588537484,148.7634946209188,151.53984164776068,3504403
2024-01-01,2024-01-01,GOOGL,2802.0187306756256,2803.175814177291,2800.798034160481,2802.1870530410047,3106078
2024-01-02,2024-01-02,GOOGL,2798.5283203699864,2801.623084261206,2794.221168580762,2798.229061146132,1952914
2024-01-03,2024-01-03,GOOGL,2799.753966816561,2800.2357195634504,2797.505065468963,2800.2357195634504,3551491
2024-01-04,2024-01-04,GOOGL,2801.078600089726,2804.857583215896,2799.3369930719277,2802.46029774489,4307827
2024-01-05,2024-01-05,GOOGL,2800.523063052108,2802.983465380718,2796.9445729109602,2801.4672342022955,1487342
2024-01-06,2024-01-06,GOOGL,2801.9813349219385,2803.0291309961453,2800.031872727786,2801.569761144873,1419270
2024-01-07,2024-01-07,GOOGL,2800.3510792686493,2803.0875318664635,2798.7671717085054,2800.5342348489326,4668672
2024-01-08,2024-01-08,GOOGL,2797.6530127491296,2802.1029055222584,2796.315766254959,2798.7446727771353,3048782
2024-01-09,2024-01-09,GOOGL,2799.2326662714045,2800.2835711692937,2796.535843017421,2798.160020064905,2837534
2024-01-10,2024-01-10,GOOGL,2798.0837181616503,2802.2191282015306,2796.6413905875165,2796.6413905875165,3337159
2024-01-11,2024-01-11,GOOGL,2794.9480942183336,2797.710338463411,2791.275499843483,2797.710338463411,4508542
2024-01-12,2024-01-12,GOOGL,2794.520518418721,2799.164760751538,2789.7496634652816,2794.4794760552245,3057668
2024-01-13,2024-01-13,GOOGL,2796.901604987611,2798.8570074716395,2792.0197669944605,2796.4871473138637,4974698
2024-01-14,2024-01-14,GOOGL,2796.3215597417493,2797.5509956440374,2794.8479932546406,2794.8479932546406,3013857
2024-01-15,2024-01-15,GOOGL,2797.1312925561087,2799.6218876687503,2792.9985332119154,2795.4545460795543,4780903
2024-01-16,2024-01-16,GOOGL,2796.5248815760765,2801.116860396883,2795.135471615185,2795.135471615185,4580191
2024-01-17,2024-01-17,GOOGL,2795.5293494787693,2797.6895091868105,2791.526592880336,2797.2981833997123,2706182
2024-01-18,2024-01-18,GOOGL,2799.2272249996554,2800.561739410711,2797.9870156065012,2798.6367171256065,4969632
2024-01-19,2024-01-19,GOOGL,2796.796267380701,2799.262143916214,2795.066561896375,2796.0785137461144,2974438
2024-01-20,2024-01-20,GOOGL,2798.751911196345,2802.7651643754048,2796.1823623001897,2799.721421983958,3013938
2024-01-21,2024-01-21,GOOGL,2798.75037041228,2803.0511218922356,2796.0580321350676,2800.406502450455,4228691
2024-01-22,2024-01-22,GOOGL,2800.719223322182,2800.725920015375,2797.4264228379375,2800.5496283067373,1457809
2024-01-23,2024-01-23,GOOGL,2800.1702115479266,2805.003695395483,2796.7482840856846,2800.5576016300156,3690237
2024-01-24,2024-01-24,GOOGL,2800.3535781405653,2802.7512920237664,2800.0658095747463,2801.2573885108636,4401677
2024-01-25,2024-01-25,GOOGL,2798.758490852787,2801.520292736296,2795.7423264407066,2798.194232002558,1010661
2024-01-26,2024-01-26,GOOGL,2798.4924639020646,2801.7737704655347,2798.243860251219,2798.682030813479,3545930
2024-01-27,2024-01-27,GOOGL,2795.935060137269,2797.2069475983044,2794.8546442235606,2795.7249165194135,4597170
2024-01-28,2024-01-28,GOOGL,2797.98570227863,2799.618832970489,2795.5954207840887,2799.618832970489,2295517
2024-01-29,2024-01-29,GOOGL,2798.0522560962618,2802.0664110521334,2795.9768176920584,2795.9768176920584,4992365
2024-01-30,2024-01-30,GOOGL,2799.3717771845163,2800.0775111686226,2796.7375145906826,2799.4648291911585,4492822
2024-01-31,2024-01-31,GOOGL,2798.267054722144,2802.7756055364625,2796.5894699912196,2796.5894699912196,2964110
2024-02-01,2024-02-01,GOOGL,2796.912105355227,2797.9741838547257,2794.751441438937,2796.0637699909844,4002622
2024-02-02,2024-02-02,GOOGL,2798.002463259693,2800.9791939052334,2793.9373691170417,2796.0444409207894,2359411
2024-02-03,2024-02-03,GOOGL,2795.278441466352,2799.3635491860105,2794.246699791211,2794.614480888311,3413695
2024-02-04,2024-02-04,GOOGL,2794.525129575864,2796.28836634336,2791.030889300127,2796.28836634336,4981929
2024-02-05,2024-02-05,GOOGL,2794.9602512258793,2798.1852651490776,2790.6838915350613,2796.1154218157617,3183686
2024-02-06,2024-02-06,GOOGL,2793.1188750845117,2797.438673948844,2789.145674381691,2792.1131615834306,3695923
2024-02-07,2024-02-07,GOOGL,2790.8964492353844,2794.6695778717394,2788.859663466814,2791.6076068915954,3406136
2024-02-08,2024-02-08,GOOGL,2792.515979276026,2795.709957588048,2790.281454230126,2792.2166490563873,3754287
2024-02-09,2024-02-09,GOOGL,2791.5142657741203,2795.641712335214,2786.788781023532,2792.709187205372,4749498
2024-02-10,2024-02-10,GOOGL,2789.910332212876,2792.5098259580727,2785.911917204763,2790.333831716419,4886185
2024-02-11,2024-02-11,GOOGL,2792.9569794630493,2793.2050553590684,2791.801901565209,2793.007168492665,2281522
2024-02-12,2024-02-12,GOOGL,2795.0772389778176,2796.2376115491866,2793.225975349171,2794.9455388241095,4131050
2024-02-13,2024-02-13,GOOGL,2794.018409334276,2794.694188692043,2792.7570288641277,2792.7570288641277,4274982
2024-02-14,2024-02-14,GOOGL,2794.1028946023957,2798.707054880215,2791.577204945468,2795.058676701752,1916393
2024-02-15,2024-02-15,GOOGL,2792.6855299130166,2797.5457194673672,2792.2046344104365,2792.9959703816817,2190436
2024-02-16,2024-02-16,GOOGL,2789.2046891125756,2793.0096378075723,2784.5413866477716,2788.603977974469,1162846
2024-02-17,2024-02-17,GOOGL,2789.945914010597,2790.76110454891,2788.447825101394,2790.76110454891,3167697
2024-02-18,2024-02-18,GOOGL,2788.796049546825,2790.828937278326,2787.459580005096,2789.7074090604233,4473150
2024-02-19,2024-02-19,GOOGL,2788.3495518383907,2793.210563037133,2784.0377358448172,2790.190107065843,3168405
2024-02-20,2024-02-20,GOOGL,2790.959248354972,2795.6918910958348,2789.0118876436877,2789.522723144615,4870500
2024-02-21,2024-02-21,GOOGL,2790.249375996865,2792.4508416912445,2788.2957178390393,2789.100658261428,4576395
2024-02-22,2024-02-22,GOOGL,2789.2034930628247,2791.3402125904854,2785.3134808142595,2789.3517164964,3881584
2024-02-23,2024-02-23,GOOGL,2791.178372451946,2794.7728143853146,2789.8931592617414,2790.973429713386,4393457
2024-02-24,2024-02-24,GOOGL,2790.9637714755654,2793.7186187067705,2787.4296073904743,2791.2110120935617,3785389
2024-02-25,2024-02-25,GOOGL,2793.382667421459,2795.0279542962767,2790.4553690807534,2793.5626219689366,2401896
2024-02-26,2024-02-26,GOOGL,2793.2431486822948,2796.8977183136535,2788.4643446933264,2795.021890397253,3414572
2024-02-27,2024-02-27,GOOGL,2791.3080569075037,2795.0826106292875,2788.377939205109,2790.4921669358087,2122033
2024-02-28,2024-02-28,GOOGL,2789.635262966531,2790.9931381946762,2786.20523604734,2789.60561997923,3406662
2024-02-29,2024-02-29,GOOGL,2792.5303523705047,2792.989770917985,2789.2246103575303,2792.5654191132962,4538150
2024-01-01,2024-01-01,MSFT,380.40943306436327,384.78504889745983,377.7314681667669,381.1211022583605,2393937
2024-01-02,2024-01-02,MSFT,377.3316283511146,379.34074696081,376.387236246422,376.44492764468345,4595481
2024-01-03,2024-01-03,MSFT,374.3509055476621,378.49795362346845,369.670573716846,374.96477507258123,2300858
2024-01-04,2024-01-04,MSFT,372.81463591763463,375.2165495442049,368.0994044609377,372.8414491096988,1184715
2024-01-05,2024-01-05,MSFT,374.0255516820236,377.5226799867076,372.61178025137116,373.78793067847073,2498502
2024-01-06,2024-01-06,MSFT,374.1077424473769,376.2788311410633,372.5063404148581,373.7686940053048,3161091
2024-01-07,2024-01-07,MSFT,373.8467441045817,377.3256364226991,372.06320444553796,372.6358240148236,4463579
2024-01-08,2024-01-08,MSFT,371.74327966241515,372.89526076779185,370.4620201446409,370.4620201446409,4870093
2024-01-09,2024-01-09,MSFT,369.5478141652122,370.55748371904104,366.13687663425117,370.55748371904104,3252986
2024-01-10,2024-01-10,MSFT,369.8761003607536,374.80146831779996,365.19026154357664,369.8447282948601,3279779
2024-01-11,2024-01-11,MSFT,369.8988298416993,373.6116587248677,368.0207085936549,368.0207085936549,1931232
2024-01-12,2024-01-12,MSFT,372.1262582057307,375.10227931910276,370.9931332959607,372.11562556317085,1368561
2024-01-13,2024-01-13,MSFT,372.8367870033394,374.68289377514276,369.49238450410013,373.48991339242,1626907
2024-01-14,2024-01-14,MSFT,373.1365326643012,377.2432608280383,371.0625055777781,374.61143680076736,4621414
2024-01-15,2024-01-15,MSFT,372.3123039167347,375.17269395934443,371.6473864572203,373.238653087789,2155216
2024-01-16,2024-01-16,MSFT,374.8895146734965,379.2882966916357,373.6504161977585,374.9811751816949,3646438
2024-01-17,2024-01-17,MSFT,377.62152577868187,377.6254688529531,375.3311220496009,377.2486591240262,3502084
2024-01-18,2024-01-18,MSFT,376.7393404645974,381.41317024220103,372.7021393676132,374.7073887033174,4942876
2024-01-19,2024-01-19,MSFT,378.9702937526001,383.50518290551344,375.6751821916816,378.83878437681767,4937585
2024-01-20,2024-01-20,MSFT,380.9063452095551,382.2442686779167,377.8590242011311,380.7394690300935,3393674
2024-01-21,2024-01-21,MSFT,379.2481470017025,382.3092721322141,377.34111764386495,378.6296921043611,1847854
2024-01-22,2024-01-22,MSFT,380.04275954947536,381.10663205782095,377.8191993930413,381.10663205782095,3429278
2024-01-23,2024-01-23,MSFT,378.5428956269307,382.84352202105964,376.0265259308282,376.0265259308282,2590081
2024-01-24,2024-01-24,MSFT,378.3982434252265,381.10096652640135,376.21000760340945,378.3682575062559,3945826
2024-01-25,2024-01-25,MSFT,378.03324247644804,382.056847944993,373.52272479816304,377.76984718330846,2542433
2024-01-26,2024-01-26,MSFT,376.74430044775386,379.84022525911104,375.2527336173364,375.48882841289156,4805207
2024-01-27,2024-01-27,MSFT,373.12721114946817,374.74599679339474,370.6773123308238,374.74599679339474,4842052
2024-01-28,2024-01-28,MSFT,373.2773640251142,375.2868163904643,370.33237224209364,373.2749104158838,3779474
2024-01-29,2024-01-29,MSFT,376.45172144843616,378.79063203679465,375.7547541336456,375.7547541336456,4857257
2024-01-30,2024-01-30,MSFT,376.2117170727547,378.2055911127893,372.68104690265125,375.60650813061204,4150719
2024-01-31,2024-01-31,MSFT,373.20682955375077,374.29351158565373,372.3675825946341,372.90762174247476,4630439
2024-02-01,2024-02-01,MSFT,370.4993376444064,374.6237062127579,369.09613669935,370.91101697276935,2632556
2024-02-02,2024-02-02,MSFT,373.5268386661946,373.91551302567217,369.5300390357647,373.59251477540937,1081412
2024-02-03,2024-02-03,MSFT,372.5269973007242,372.9958941569213,371.6021501874942,372.4255428799842,1676108
2024-02-04,2024-02-04,MSFT,376.57524714531036,377.0040737426341,375.3387676175009,376.4675178229567,1759001
2024-02-05,2024-02-05,MSFT,377.3981916584291,378.7148175843395,375.4485264212101,376.4597888840521,3831130
2024-02-06,2024-02-06,MSFT,375.93416397351064,379.11755298148654,372.6765675071468,377.12149329399693,3811921
2024-02-07,2024-02-07,MSFT,375.0203173787414,376.29793557991985,372.7335734078504,374.05591761987466,4858084
2024-02-08,2024-02-08,MSFT,376.39715624570806,377.6852511178442,374.96310066703506,377.4009413197338,2250363
2024-02-09,2024-02-09,MSFT,377.4104313570956,379.3932745012904,373.33362356746795,378.09336125094785,4714745
2024-02-10,2024-02-10,MSFT,377.59199124881735,380.7671839063648,376.8112382223477,378.4145766593579,3263334
2024-02-11,2024-02-11,MSFT,381.239451912843,382.7847352269193,379.3956171998657,380.2385758643528,1499554
2024-02-12,2024-02-12,MSFT,382.8015674726863,387.5254812964003,379.64000429618454,383.0485552486939,1367157
2024-02-13,2024-02-13,MSFT,384.07005386819066,384.3890997299102,379.1236248034521,383.9605653594506,3054202
2024-02-14,2024-02-14,MSFT,384.2463231651858,384.7731066790639,383.2647193400344,383.2647193400344,3174201
2024-02-15,2024-02-15,MSFT,383.0264346935453,385.74580336347515,379.10568659303385,382.8061478570344,1893498
2024-02-16,2024-02-16,MSFT,381.51702402690535,385.8429241054116,377.1757033325709,382.4349748218699,2201872
2024-02-17,2024-02-17,MSFT,380.24850521339977,383.99351842904844,379.32127380680447,380.02509751522473,4907731
2024-02-18,2024-02-18,MSFT,379.21089995927787,382.9358765748618,375.9969017461761,379.17144540215486,4679649
2024-02-19,2024-02-19,MSFT,378.8274500102946,381.8331122653649,375.0501265285326,381.8331122653649,1956816
2024-02-20,2024-02-20,MSFT,380.6930336881698,380.7842837052423,376.8804123256712,380.2298057259806,1754620
2024-02-21,2024-02-21,MSFT,380.9420214094848,385.7890950139732,379.9187795654212,381.4134618372782,1686380
2024-02-22,2024-02-22,MSFT,381.16804721070156,382.68320392449317,379.31187027496526,382.68320392449317,4299526
2024-02-23,2024-02-23,MSFT,381.39873812283014,385.05141286141645,379.0537258716689,380.7866202054128,3262247
2024-02-24,2024-02-24,MSFT,381.5153041741498,384.6629798846415,379.92106313036373,379.99439538698556,4353934
2024-02-25,2024-02-25,MSFT,381.44054583818445,385.4684555215486,379.7604246310442,379.7604246310442,4020266
2024-02-26,2024-02-26,MSFT,379.59329906306544,383.8770452896796,377.805594401461,379.68974625269027,2626436
2024-02-27,2024-02-27,MSFT,378.02099464616987,378.80460832711105,377.166798614197,378.42401965553825,3972976
2024-02-28,2024-02-28,MSFT,374.9335622033522,377.9733714257278,370.4124471911089,374.0024337169778,1520346
2024-02-29,2024-02-29,MSFT,376.124880841093,376.1713941487216,374.1731511588344,375.982047460232,3888533

</script>

<!-- ACTUAL CONTENT -->

<h1>OHLC Chart Examples</h1>
<p></p>

<h2>Example 1: Single Stock with Volume (AAPL)</h2>
<p>Daily stock prices with volume bars. Use time sliders to zoom, toggle renormalization and volume display.</p>


<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; background-color: #f0fff0;">
    <h4 style="margin-top: 0;">Plot Attributes</h4>
            <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="chart_type_select_example1_ohlc">Chart Type: </label>
                <select id="chart_type_select_example1_ohlc" onchange="updateChart_example1_ohlc()">
                <option value="candlestick" selected>candlestick</option>
                <option value="ohlc">ohlc</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="chart_type_select_example1_ohlc_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
                <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="display_mode_select_example1_ohlc">Display Mode: </label>
                <select id="display_mode_select_example1_ohlc" onchange="updateChart_example1_ohlc()">
                <option value="Overlay" selected>Overlay</option>
                <option value="Faceted">Faceted</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="display_mode_select_example1_ohlc_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
            <div style="margin: 10px; display: flex; flex-direction: column;">
        <div style="margin: 5px 0;">
            <input type="checkbox" id="renormalize_checkbox_example1_ohlc" onchange="updateChart_example1_ohlc()">
            <label for="renormalize_checkbox_example1_ohlc">Renormalize (first bar open = 1)</label>
        </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="show_volume_checkbox_example1_ohlc" checked onchange="updateChart_example1_ohlc()">
        <label for="show_volume_checkbox_example1_ohlc">Show Volume</label>
    </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="log_volume_checkbox_example1_ohlc" onchange="updateChart_example1_ohlc()">
        <label for="log_volume_checkbox_example1_ohlc">Log Volume</label>
    </div>
    </div>
<div style="margin: 15px 0; padding-top: 10px; border-top: 1px solid #ddd;">
    <label for="example1_ohlc_aspect_ratio_slider">Aspect Ratio: </label>
    <span id="example1_ohlc_aspect_ratio_label">0.6</span>
    <input type="range" id="example1_ohlc_aspect_ratio_slider"
           min="-1.3862943611198906" max="0.9162907318741551" step="0.01" value="-0.5108256237659907"
           style="width: 75%; margin-left: 10px;">
    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">(0.25 - 2.5)</span>
</div>

</div>

<!-- Chart -->
<div id="example1_ohlc"></div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: stock_data_1</p><br>
<hr>
<br>
<h2>Example 2: Multiple Stocks Comparison</h2>
<p>Compare stocks with vastly different prices. Enable renormalization to see relative performance (first bar open = 1). Switch between Overlay and Faceted display modes.</p>


<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; background-color: #f0fff0;">
    <h4 style="margin-top: 0;">Plot Attributes</h4>
            <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="chart_type_select_example2_ohlc">Chart Type: </label>
                <select id="chart_type_select_example2_ohlc" onchange="updateChart_example2_ohlc()">
                <option value="candlestick" selected>candlestick</option>
                <option value="ohlc">ohlc</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="chart_type_select_example2_ohlc_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
                <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="display_mode_select_example2_ohlc">Display Mode: </label>
                <select id="display_mode_select_example2_ohlc" onchange="updateChart_example2_ohlc()">
                <option value="Overlay" selected>Overlay</option>
                <option value="Faceted">Faceted</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="display_mode_select_example2_ohlc_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
            <div style="margin: 10px; display: flex; flex-direction: column;">
        <div style="margin: 5px 0;">
            <input type="checkbox" id="renormalize_checkbox_example2_ohlc" onchange="updateChart_example2_ohlc()">
            <label for="renormalize_checkbox_example2_ohlc">Renormalize (first bar open = 1)</label>
        </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="show_volume_checkbox_example2_ohlc" checked onchange="updateChart_example2_ohlc()">
        <label for="show_volume_checkbox_example2_ohlc">Show Volume</label>
    </div>
    <div style="margin: 5px 0;">
        <input type="checkbox" id="log_volume_checkbox_example2_ohlc" onchange="updateChart_example2_ohlc()">
        <label for="log_volume_checkbox_example2_ohlc">Log Volume</label>
    </div>
    </div>
<div style="margin: 15px 0; padding-top: 10px; border-top: 1px solid #ddd;">
    <label for="example2_ohlc_aspect_ratio_slider">Aspect Ratio: </label>
    <span id="example2_ohlc_aspect_ratio_label">0.6</span>
    <input type="range" id="example2_ohlc_aspect_ratio_slider"
           min="-1.3862943611198906" max="0.9162907318741551" step="0.01" value="-0.5108256237659907"
           style="width: 75%; margin-left: 10px;">
    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">(0.25 - 2.5)</span>
</div>

</div>

<!-- Chart -->
<div id="example2_ohlc"></div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: stock_data_2</p><br>
<hr>
<br>
<h2>Example 3: Quarterly Data Without Volume</h2>
<p>Quarterly company performance using integer time periods. No volume data. Using OHLC bar style instead of candlesticks. Faceted display shows each company separately.</p>


<div style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; background-color: #f0fff0;">
    <h4 style="margin-top: 0;">Plot Attributes</h4>
            <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="chart_type_select_example3_ohlc">Chart Type: </label>
                <select id="chart_type_select_example3_ohlc" onchange="updateChart_example3_ohlc()">
                <option value="candlestick">candlestick</option>
                <option value="ohlc" selected>ohlc</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="chart_type_select_example3_ohlc_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
                <div style="margin: 10px; display: flex; align-items: center;">
            <div style="flex: 0 0 70%;">
                <label for="display_mode_select_example3_ohlc">Display Mode: </label>
                <select id="display_mode_select_example3_ohlc" onchange="updateChart_example3_ohlc()">
                <option value="Overlay">Overlay</option>
                <option value="Faceted" selected>Faceted</option>
            </select>
            </div>
            <div style="flex: 0 0 30%; text-align: right; padding-right: 10px;">
                <span id="display_mode_select_example3_ohlc_obs_count" style="font-size: 0.9em; color: #666;"></span>
            </div>
        </div>
            <div style="margin: 10px; display: flex; flex-direction: column;">
        <div style="margin: 5px 0;">
            <input type="checkbox" id="renormalize_checkbox_example3_ohlc" onchange="updateChart_example3_ohlc()">
            <label for="renormalize_checkbox_example3_ohlc">Renormalize (first bar open = 1)</label>
        </div>
    </div>
<div style="margin: 15px 0; padding-top: 10px; border-top: 1px solid #ddd;">
    <label for="example3_ohlc_aspect_ratio_slider">Aspect Ratio: </label>
    <span id="example3_ohlc_aspect_ratio_label">0.6</span>
    <input type="range" id="example3_ohlc_aspect_ratio_slider"
           min="-1.3862943611198906" max="0.9162907318741551" step="0.01" value="-0.5108256237659907"
           style="width: 75%; margin-left: 10px;">
    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">(0.25 - 2.5)</span>
</div>

</div>

<!-- Chart -->
<div id="example3_ohlc"></div>
<br><p style="text-align: right; font-size: 0.8em; color: #666; margin-top: -10px; margin-bottom: 10px;">Data: company_data</p>

<hr><p align="right"><small>This page was created using <a href="https://github.com/s-baumann/JSPlots.jl">JSPlots.jl</a> v0.4.0.</small></p>
</body>
</html>
